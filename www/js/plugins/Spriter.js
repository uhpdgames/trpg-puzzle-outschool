//=============================================================================
// Spriter Pro Plugin https://github.com/AlexanderKanakis/RPGMV/blob/master/Spriter.js
// by KanaX
// version 1.4.0 @tag;0.01
// Last Update: 2018.11.09 | 20/1/2019
//=============================================================================
var $spriterAnimations={};var $dataSpriterObjects=[];var $infoSpriter=null;var $spriteRequestManager=null;
(()=>{const limitCounter=0;((GCBase)=>{const spriter_alias_Game_CharacterBase_initmembers=GCBase.prototype.initMembers;GCBase.prototype.initMembers=function(){spriter_alias_Game_CharacterBase_initmembers.call(this);this._spriter={};this._spriter._skeleton=null;this._spriter._skin=null;this._spriter._skinParts=[];this._spriter._spriteChildren=[];this._spriter._speed=1;this._spriter._repeat=false;this._spriter._stop=false;this._spriter._recovery="snap";this._spriter.tag=[];this._spriter.var={};this._spriter._spriteMask=
{};this._spriter._showSkeleton=false;this._spriter._spriteRequests=[];this._spriter._spriteRemoveRequests=[];this._spriter._scaleX=1;this._spriter._scaleY=1};const spriter_alias_Game_CharacterBase_update=GCBase.prototype.update;GCBase.prototype.update=function(){spriter_alias_Game_CharacterBase_update.call(this);this.checkTags()};GCBase.prototype.getSpriterSkinParts=function(){return this._spriter._skinParts};GCBase.prototype.setAnimationInfo=function(character,list,visible){let notes={};if(character.constructor===
Game_Player)notes=$dataActors[1].meta;else if(character.constructor===Game_Follower)notes={};else if(character.constructor===Game_Event){const comment=list.parameters[0].substring(9,list.parameters[0].length-1);let param;param=comment.split(",");notes.Spriter="{";notes.Spriter+='"_skeleton":'+'"'+param[0]+'"';notes.Spriter+=', "_skin":'+'"'+param[1]+'"';notes.Spriter+=', "_speed":'+param[2];notes.Spriter+=', "_cellX":'+param[3];notes.Spriter+=', "_cellY":'+param[4];notes.Spriter+=', "_spriteMask":'+
'"'+param[5]+'"';if(param[5]==="true"){notes.Spriter+=', "_spriteMaskX":'+param[6];notes.Spriter+=', "_spriteMaskY":'+param[7];notes.Spriter+=', "_spriteMaskW":'+param[8];notes.Spriter+=', "_spriteMaskH":'+param[9]}notes.Spriter+="}"}const globalInfo=this.getCharacterGlobal();if(notes.Spriter){notes=JSON.parse(notes.Spriter);character._spriter._skeleton=visible?globalInfo._skeleton||notes._skeleton:null;character._spriter._skin=visible?globalInfo._skin||notes._skin:null;character._spriter._skinParts=
globalInfo._skinParts||[];character._spriter._spriteChildren=globalInfo._spriteChildren||[];character._spriter._speed=globalInfo._speed||notes._speed;character._spriter._cellX=notes._cellX;character._spriter._cellY=notes._cellY;character._spriter._stop=globalInfo._stop||false;character._spriter._spriteMask.available=notes._spriteMask;if(character._spriter._spriteMask.available){character._spriter._spriteMask.x=notes._spriteMaskX;character._spriter._spriteMask.y=notes._spriteMaskY;character._spriter._spriteMask.w=
notes._spriteMaskW;character._spriter._spriteMask.h=notes._spriteMaskH}}else{character._spriter._skeleton=visible?globalInfo._skeleton||notes._skeleton.trim():null;character._spriter._skin=visible?globalInfo._skin||notes._skin.trim():null;character._spriter._skinParts=globalInfo._skinParts||[];character._spriter._spriteChildren=globalInfo._spriteChildren||[];character._spriter._speed=globalInfo._speed||notes._speed.trim();character._spriter._cellX=notes._cellX.trim();character._spriter._cellY=notes._cellY.trim();
character._spriter._stop=globalInfo._stop||false;character._spriter._spriteMask.available=eval(notes._spriteMask.trim());if(character._spriter._spriteMask.available){character._spriter._spriteMask.x=notes._spriteMaskX.trim();character._spriter._spriteMask.y=notes._spriteMaskY.trim();character._spriter._spriteMask.w=notes._spriteMaskW.trim();character._spriter._spriteMask.h=notes._spriteMaskH.trim()}}};GCBase.prototype.changeSkinPart=function(originName,newSkin,isSkinset="false"){this._spriter.forceUpdate=
true;let a={};a.originName=originName;if(newSkin==="bitmap"){a.bitmap=true;a.newSkin=""}else a.newSkin=newSkin;a.isSkinset=false;if(this._spriter._skinParts.length>0)for(let i=0;i<this._spriter._skinParts.length;i++)if(this._spriter._skinParts[i].originName===a.originName){this._spriter._skinParts[i]=a;break}else{if(i===this._spriter._skinParts.length-1)this._spriter._skinParts.push(a)}else this._spriter._skinParts.push(a);this.removeChildSprite(originName);const globalInfo=this.getCharacterGlobal();
globalInfo._skinParts=this._spriter._skinParts};GCBase.prototype.removeSkinPart=function(originName){this._spriter.forceUpdate=true;let a;a={};a.originName=originName;for(let i=0;i<this._spriter._skinParts.length;i++)if(this._spriter._skinParts[i].originName===a.originName){this._spriter._skinParts.splice(i,1);break}const globalInfo=this.getCharacterGlobal();globalInfo._skinParts=this._spriter._skinParts};GCBase.prototype.createChildSprite=function(parentSprite,spriteObjectName){this._spriter.forceUpdate=
true;const children=this._spriter._spriteChildren;const content=$dataSpriterObjects.find((v)=>v._name===spriteObjectName);children.push(new Game_SpriterCharacter(content,parentSprite,children.length));this._spriter._spriteRequests.push(children[children.length-1]);this.removeSkinPart(parentSprite);const globalInfo=this.getCharacterGlobal();globalInfo._spriteChildren=children};GCBase.prototype.removeChildSprite=function(spriteParentName){this._spriter.forceUpdate=true;const children=this._spriter._spriteChildren;
for(let i=0;i<children.length;i++)if(children[i]._spriteParent===spriteParentName)children.splice(i,1);this._spriter._spriteRemoveRequests.push(spriteParentName);const globalInfo=this.getCharacterGlobal();globalInfo._spriteChildren=children};GCBase.prototype.getCharacterGlobal=function(){if(this instanceof Game_Player)return $infoSpriter.player;else if(this instanceof Game_Follower)return $infoSpriter.followers["follower_"+this._memberIndex];else if(this instanceof Game_Event){this.eventDataExists();
return $infoSpriter.maps["map_"+$gameMap._mapId]["event_"+this._eventId]}};GCBase.prototype.eventDataExists=function(){const map=$infoSpriter.maps["map_"+$gameMap._mapId];if(!map.hasOwnProperty("event_"+String(this._eventId)))map["event_"+String(this._eventId)]={}};GCBase.prototype.hasActiveTag=function(tagName){for(let i=0;i<this._spriter.tag.length;i++)if(this._spriter.tag[i].name===tagName)return true;return false};GCBase.prototype.checkTags=function(){if(this.hasOwnProperty("_spriter"))for(let i=
0;i<this._spriter.tag.length;i++)this.checkForSpecialTag(this._spriter.tag[i])};GCBase.prototype.checkForSpecialTag=function(tag){if(tag.name.includes("se,"))this.playSpriterSE(tag);else if(tag.name.includes("g-variable,"))this.changeGameVariable(tag);else if(tag.name.includes("s-switch,"))this.changeSelfSwitch(tag);else if(tag.name.includes("SkinPart,")){const tagArray=tag.name.split(",");this.changeSkinPart(tagArray[1],tagArray[2],tagArray[3])}};GCBase.prototype.playSpriterSE=function(tag){let tagArray;
tagArray=tag.name.split(",");let params;params={};params.name=tagArray[1];params.pan=tagArray[2];params.pitch=tagArray[3];params.volume=Number(tagArray[4]);if(tagArray[5]==="true"){let maxVolumeArea;maxVolumeArea=Number(tagArray[6]);let maxArea;maxArea=Number(tagArray[7]);let dx;dx=Math.abs(this.x-$gamePlayer.x);dy=Math.abs(this.y-$gamePlayer.y);d=Math.sqrt(Math.pow(dx,2)+Math.pow(dy,2));if(d>maxVolumeArea&&d-maxVolumeArea<=maxArea)params.volume-=params.volume*(d-maxVolumeArea)/maxArea;else if(d-
maxVolumeArea>maxArea)params.volume=0}AudioManager.playSe(params)};GCBase.prototype.changeGameVariable=function(tag){tagArray=tag.name.split(",");const id=eval(tagArray[1]);const value=eval(tagArray[2]);$gameVariables.setValue(id,value)};GCBase.prototype.changeSelfSwitch=function(tag){if(this instanceof Game_Event){tagArray=tag.name.split(",");const key=tagArray[1];const value=eval(tagArray[2]);$gameSelfSwitches.setValue([$gameMap.mapId(),this._eventId,key],value)}}})(Game_CharacterBase);((SM)=>{SM.prototype.createSpriterCharacters=
function(){const playerNotes=$dataActors[1].meta||{};if(playerNotes.hasOwnProperty("Spriter")&&$gameMap.usingSpriterByPlayer()){const player=new Spriter_Character($gamePlayer);this._tilemap.addChild(player);if(!$uhpd.checkEV("playerSpriters"))$uhpd.setEV("playerSpriters",[player])}}})(Spriteset_Map);((DM)=>{function SpriterData(){this.initialize.apply(this,arguments)}SpriterData.prototype.initialize=function(){this.player={};this.player.tag=[];this.player.var={};this.player._children=[];this.followers=
{};this.followers._children=[];this.maps={};this._followerRequests=[];this._eventRequests=[];for(let i=1;i<$dataActors.length;i++){this.followers["follower_"+$dataActors[i].id]={};this.followers["follower_"+$dataActors[i].id].tag=[];this.followers["follower_"+$dataActors[i].id].var={}}for(let i=1;i<$dataMapInfos.length;i++)if($dataMapInfos[i]!==null)this.maps["map_"+i]={}};function SpriteRequestManager(){this.initialize.apply(this,arguments)}SpriteRequestManager.prototype.initialize=function(){this._childSprites=
[];this._spriteRequests=[]};DM._databaseFiles.push({name:"$dataSpriterObjects",src:"SpriterObjects.json"});DM._databaseFiles.push({name:"$spriterAnimations",src:"spriterAnimations.json"});DM.loadSpriterAnimations=function(){};const b=DM.makeSaveContents;DM.makeSaveContents=function(){let contents=b.call(this);contents.spriter=$infoSpriter;return contents};const a=DM.extractSaveContents;DM.extractSaveContents=function(contents){a.call(this,contents);$infoSpriter=contents.spriter};const spriter_alias_Datamanager_createGameObjects=
DM.createGameObjects;DM.createGameObjects=function(){spriter_alias_Datamanager_createGameObjects.call(this);$infoSpriter=new SpriterData;$spriteRequestManager=new SpriteRequestManager}})(DataManager);((GE)=>{})(Game_Event);((GA)=>{})(Game_Actor);const spriter_alias_Game_Player_refresh=Game_Player.prototype.refresh;Game_Player.prototype.refresh=function(){spriter_alias_Game_Player_refresh.call(this);let playerNotes=$dataActors[$gameParty.leader()._actorId].meta;if(playerNotes.hasOwnProperty("Spriter"))this.setAnimationInfo(this,
null,true)};const spriter_alias_game_interpreter_pluginCommand=Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand=function(command,args){spriter_alias_game_interpreter_pluginCommand.call(this,command,args);if(command==="playerSkeleton"){$gamePlayer._spriter._skeleton=args[0];$gamePlayer._spriter._skin=args[1]}else if(command==="playerSkin"){$gamePlayer._spriter.forceUpdate=true;$gamePlayer._spriter._skin=args[0]}else if(command==="playerSpeed")$gamePlayer._spriter._speed=
args[0];else if(command==="playerStop")$gamePlayer._spriter._stop=Boolean(args[0]==="true")||false;else if(command==="playerRecovery")$gamePlayer._spriter._recovery=args[0];else if(command==="playerSkinPart")$gamePlayer.changeSkinPart(args[0],args[1],args[2]);else if(command==="playerRemoveSkinPart")$gamePlayer.removeSkinPart(args[0]);else if(command==="playerChildSprite")$gamePlayer.createChildSprite(args[0],args[1]);else if(command==="playerRemoveChildSprite")$gamePlayer.removeChildSprite(args[0])};
const oldGraphicsRender=Graphics.render;Graphics.render=function(stage){if(!this._realStage)this._realStage=new PIXI.display.Stage;if(stage.parent!==this._realStage){this._realStage.removeChildren();this._realStage.addChild(stage)}oldGraphicsRender.call(this,this._realStage)};function Spriter_Base(){this.initialize.apply(this,arguments)}Spriter_Base.prototype=Object.create(Sprite_Base.prototype);Spriter_Base.prototype.constructor=Spriter_Base;Spriter_Base.prototype.initialize=function(character){Sprite_Base.prototype.initialize.call(this);
this.initMembers();this.setCharacter(character);this.getAnimation(this._skeleton);this.initSprite();this.displaceSprite()};Spriter_Base.prototype.initMembers=function(){this.anchor.x=.5;this.anchor.y=1;this._character=null;this._animationId=0;this._animation={};this._pathMain=null;this._pathTime=null;this._animationFrame=0;this._key=0;this._sprite=null;this._skin=null;this._skinParts=[];this._childrenSprites=[];this._skeleton=null;this._speed=1;this._cellX=null;this._cellY=null;this._spriteMaskX=
null;this._spriteMaskY=null;this._repeat=false;this._spriteMask={};this._spriteType=""};Spriter_Base.prototype.setCharacter=function(character){this._character=character;this._spriteType=this._character instanceof Game_CharacterBase?"character":"object";this._skeleton=this._character._spriter._skeleton;this._skin=this._character._spriter._skin;this._skinParts=this._character._spriter._skinParts;this._cellX=Number(this._character._spriter._cellX);this._cellY=Number(this._character._spriter._cellY);
this._speed=Number(this._character._spriter._speed);this._stop=this._character._spriter._stop;if(this._character._spriter._spriteMask)this._spriteMask.available=this._character._spriter._spriteMask.available;if(this._spriteMask.available){this._spriteMask.x=Number(this._character._spriter._spriteMask.x);this._spriteMask.y=Number(this._character._spriter._spriteMask.y);this._spriteMask.w=Number(this._character._spriter._spriteMask.w);this._spriteMask.h=Number(this._character._spriter._spriteMask.h)}};
Spriter_Base.prototype.getAnimation=function(name){this._animation=$spriterAnimations[name]};Spriter_Base.prototype.initSprite=function(){this._waitCounter=limitCounter;this._pathTime=this._animation.entity.animation[this._animationId].timeline;this._sprite=new UHPD_Sprite;this._group=new PIXI.display.Group(0,true);this._layer=new PIXI.display.Layer(this._group);this.addChild(this._sprite);this._sprite.addChild(this._layer);this._layer.group.enableSort=true;this._element=[];this._animLength=Number(this._animation.entity.animation[this._animationId].length);
this._repeat=this._animation.entity.animation[this._animationId].looping||"true";this._repeat=Boolean(this._repeat==="true");let i=0;for(const _pathTime of this._pathTime){if(_pathTime.object_type==="bone"){this._element[i]=new Sprite;this._element[i].parent=null}else{this._element[i]=new Sprite;this._element[i].parent=null;this._element[i].removeChildren();this._element[i].parentGroup=this._group}i++}this._spriteMask.available=Boolean(this._spriteMask.available==="true");if(this._spriteMask.available){let x=
this._spriteMask.x;let y=this._spriteMask.y;let w=this._spriteMask.w;let h=this._spriteMask.h;let myMask=new PIXI.Graphics;myMask.beginFill();myMask.drawRect(-this._cellX/2+2+x,-this._cellY+2+y,w+2,h+2);myMask.endFill();this.addChild(myMask);this.mask=myMask}};Spriter_Base.prototype.displaceSprite=function(){this._sprite.x=-this._cellX/2;this._sprite.y=-this._cellY};Spriter_Base.prototype.checkCharacterState=function(){if(this.characterIsErased())this.parent.removeChild(this)};Spriter_Base.prototype.characterIsErased=
function(){let character=this._character;if(character instanceof Game_Event&&character._erased)return true;else if(character instanceof Game_Follower&&!character.actor())return true;return false};Spriter_Base.prototype.resetSpriterSprite=function(){this._character._spriter.forceUpdate=true;this._character._spriter.tag=[];this._character._spriter.var={};this._animationFrame=0;this._key=0;this.refreshSpriterSprite()};Spriter_Base.prototype.refreshSpriterSprite=function(){this.removeChildren();this.getAnimation(this._skeleton);
delete this._sprite;delete this._layer;delete this._group;this.initSprite();this.start();this.displaceSprite();this._animLength=Number(this._animation.entity.animation[this._animationId].length);this._repeat=this._animation.entity.animation[this._animationId].looping||"true";this._repeat=eval(this._repeat);this.updateDisplay()};Spriter_Base.prototype.start=function(){};Spriter_Base.prototype.checkReset=function(){if(this._character.resetAnimation){this.resetSpriterSprite();this._character.resetAnimation=
false}};Spriter_Base.prototype.isItemMoving=function(){if(this instanceof Spriter_Character)return this._character._stepAnime||this._character.isMoving()&&this._character._walkAnime;else return true};Spriter_Base.prototype.checkChanges=function(){if(this._skeleton!==this._character._spriter._skeleton){this._skeleton=this._character._spriter._skeleton;this._skin=this._character._spriter._skin;this.resetSpriterSprite()}if(this._skin!==this._character._spriter._skin)this._skin=this._character._spriter._skin;
if(this._skinParts!==this._character._spriter._skinParts){this._skinParts=this._character._spriter._skinParts;this.refreshSpriterSprite()}if(this._cellX!==this._character._spriter._cellX){this._cellX=Number(this._character._spriter._cellX);this.displaceSprite()}if(this._cellY!==this._character._spriter._cellY){this._cellY=Number(this._character._spriter._cellY);this.displaceSprite()}if(this._speed!==Number(this._character._spriter._speed)){this.fixKeys();this._speed=Number(this._character._spriter._speed);
this.updateFrame()}if(this._recovery!==this._character._spriter._recovery)this._recovery=this._character._spriter._recovery;if(this._stop!==this._character._spriter._stop)this._stop=this._character._spriter._stop;if(this.scale.x!==this._character._spriter._scaleX)this.scale.x=this._character._spriter._scaleX;if(this.scale.y!==this._character._spriter._scaleY)this.scale.y=this._character._spriter._scaleY};Spriter_Base.prototype.fixKeys=function(){if(this._speed<0&&Number(this._character._spriter._speed)>
0)if(this._key===0&&this._repeat)this._key=this._pathMain.length-1;else if(this._key===0&&!this._repeat);else this._key--;else if(this._speed>0&&Number(this._character._spriter._speed)<0)if(this._key===this._pathMain.length-1&&this._repeat)this._key=0;else if(this._key===this._pathMain.length-1&&!this._repeat);else this._key++};Spriter_Base.prototype.setCharacterSprite=function(){this._pathMain=this._animation.entity.animation[this._animationId].mainline.key;this._pathTime=this._animation.entity.animation[this._animationId].timeline;
for(let i=0;i<this._element.length;i++)this._element[i].usedForKey=false;if(this._pathMain[this._key].hasOwnProperty("bone_ref"))for(let j=0;j<this._pathMain[this._key].bone_ref.length;j++){let item=this.getItemForTime("bone",j);this.updateBoneInheritance(j);this.setUpdateType(item)}if(this._pathMain[this._key].hasOwnProperty("object_ref"))for(let l=0;l<this._pathMain[this._key].object_ref.length;l++){let item=this.getItemForTime("object",l);this.objectInheritanceUpdate(l);this.setUpdateType(item)}if(this._character._spriter.forceUpdate)this._character._spriter.forceUpdate=
false;this.refreshSprite()};Spriter_Base.prototype.refreshSprite=function(){const currentKeyTime=Number(this._pathMain[this._key].time)||0;if(this._speed>0&&this._animationFrame===currentKeyTime)for(let i=0;i<this._element.length;i++)if(!this._element[i].usedForKey)this._element[i].texture=PIXI.Texture.EMPTY};Spriter_Base.prototype.setUpdateType=function(item){if(this._animationFrame===item.currentKeyTime)this.setOnKey(item);else if(!this._repeat&&this._animationFrame>item.lastKeyTime&&this.isAnimated())this.setOnKey(item);
else if(!this.isAnimated())this.setOnKey(item);else if(this.isBetweenKeys(item)&&this.isItemMoving(this._character)&&this.isAnimated())this.tween(item)};Spriter_Base.prototype.pathTimeId=function(type,i){return Number(this._pathMain[this._key][type+"_ref"][i].timeline)};Spriter_Base.prototype.getItemForTime=function(type,i){let item;id=this.pathTimeId(type,i);if(type==="bone"){item=this._element[id];item_ref=this._pathMain[this._key].bone_ref[i];item.type="bone"}else{item=this._element[id];item_ref=
this._pathMain[this._key].object_ref[i];item.type="object"}item.timelineId=Number(item_ref.timeline);item.key=Number(item_ref.key);item.currentKey=this._pathTime[item.timelineId].key[item.key];item.currentKeyTime=Number(item.currentKey.time)||0;item.lastKey=this._pathTime[item.timelineId].key[this._pathTime[item.timelineId].key.length-1];item.lastKeyTime=Number(item.lastKey.time)||0;if(this._pathTime[id].key.length>1){item.firstKey=this._pathTime[item.timelineId].key[1];item.firstKeyTime=Number(this._pathTime[item.timelineId].key[1].time)||
0}else{item.firstKey=this._pathTime[item.timelineId].key[0];item.firstKeyTime=Number(this._pathTime[item.timelineId].key[0].time)||0}item.nextKey=this._pathTime[item.timelineId].key[this.getNextKey(item)];item.nextKeyTime=Number(item.nextKey.time)||0;this.updateItemTagsAndVars(item);this.checkForSpecialItemTag(item);item.usedForKey=true;return item};Spriter_Base.prototype.tagsAndVarsCurrentKey=function(item,tagTime){if(!this.isAnimated()&&tagTime>=this._animationFrame)return true;else if(tagTime===
this._animationFrame)return true;else if(this.isBetweenKeys(item))return true;else if(this._animationFrame===this._animLength)return true;return false};Spriter_Base.prototype.getNextKey=function(item){if(this._speed>0)if(item.currentKeyTime===item.lastKeyTime&&this._repeat)return 0;else if(item.currentKeyTime===item.lastKeyTime&&!this._repeat)return item.key;else return item.key+1;else if(item.currentKeyTime===0&&this._repeat)return this._pathTime[item.timelineId].key.length-1;else if(item.currentKeyTime===
0&&!this._repeat)return item.key;else return item.key-1};Spriter_Base.prototype.isAnimated=function(){return this._pathTime[id].key.length>1};Spriter_Base.prototype.isBetweenKeys=function(item){if(this._speed>0)if(this._animationFrame<item.lastKeyTime)return this._animationFrame>item.currentKeyTime&&this._animationFrame<item.nextKeyTime;else return this._animationFrame>item.lastKeyTime;else if(this._animationFrame>item.lastKeyTime)return true;else if(this._animationFrame<item.lastKeyTime)return this._animationFrame<
item.currentKeyTime&&this._animationFrame>item.nextKeyTime;else return item.lastKeyTime!==0};Spriter_Base.prototype.setOnKey=function(item){const element=item.type==="object"?item.currentKey.object:item.currentKey.bone;const x=Number(element.x)||0;const y=Number(element.y)||0;const r=Number(element.angle)||0;let sx=element.scale_x||1;sx=Number(sx);let sy=element.scale_y||1;sy=Number(sy);item.x=x;item.y=-y;item.rotation=-r*Math.PI/180;item.scale.x=sx;item.scale.y=sy;if(item.type==="object"){const folderId=
Number(element.folder);const fileId=Number(element.file);const w=Number(this._animation.folder[folderId].file[fileId].width);const h=Number(this._animation.folder[folderId].file[fileId].height);const ax=Number(element.pivot_x)||0;const ay=1-Number(element.pivot_y)||0;let a=element.a||1;a=Number(a);item.alpha=a;item.anchor.x=ax;item.anchor.y=ay;if(!this.updateChildSprites(item,w,h))this.updateTexture(item)}else this.updateTexture(item)};Spriter_Base.prototype.checkForSpecialItemTag=function(item){if(item.tags)for(let i=
0;i<item.tags.length;i++);};Spriter_Base.prototype.getForEquipment=function(item){if(item.tags)for(let i=0;i<item.tags.length;i++)if(item.tags[i].contains("Equip "))return item.tags[i];return false};Spriter_Base.prototype.getForApparel=function(item){if(item.tags)for(let i=0;i<item.tags.length;i++)if(item.tags[i].contains("Apparel "))return item.tags[i]};Spriter_Base.prototype.characterIsActor=function(){if(this._character instanceof Game_Player)return true;else if(this._character instanceof Game_Follower&&
this._character.actor())return true;else return this._character instanceof Game_Actor};Spriter_Base.prototype.loadFromNotes=function(item){const object=item.currentKey.object;const folderId=Number(object.folder);const fileId=Number(object.file);const timelineName=this._pathTime[item.timelineId].name.replace(/_(\d){3}/,"");let filePath=this._animation.folder[folderId].file[fileId].name.replace(/_(\d){3}/,"");let skin=this._skin;const skinParts=this._skinParts;let bitmap=undefined;const i={};for(let j=
0;j<skinParts.length;j++)if(skinParts[j].originName===timelineName){if(skinParts[j].isSkinset)skin=skinParts[j].newSkin;else{skin="item";filePath=`${skinParts[j].newSkin}.png`}bitmap=skinParts[j].bitmap;break}i.skin=skin;i.filePath=filePath;return i};Spriter_Base.prototype.loadFromEquipment=function(item,tag){const object=item.currentKey.object;const folderId=Number(object.folder);const fileId=Number(object.file);const timelineName=this._pathTime[item.timelineId].name.replace(/_(\d){3}/,"");let filePath=
this._animation.folder[folderId].file[fileId].name.replace(/_(\d){3}/,"");const i={};const actor=this.getActor();const tagArray=tag.split(" ");const equipment=this.getEquipment(tagArray[1],actor);const noteObject=this.equipmentHasNote(equipment);let notes={};if(noteObject)notes=JSON.parse(noteObject);else return false;const name=notes.name||equipment.name;const folder=notes.folder||"";const isSkinset=Boolean(notes.isSkinset==="true");if(isSkinset)skin=folder+"/"+filePath;else{skin=folder.substring(1,
folder.length-1);filePath=name+".png"}i.skin=folder;i.filePath=filePath;return i};Spriter_Base.prototype.loadFromApparell=function(item,tag){const object=item.currentKey.object;const folderId=Number(object.folder);const fileId=Number(object.file);const timelineName=this._pathTime[item.timelineId].name.replace(/_(\d){3}/,"");const filePath=this._animation.folder[folderId].file[fileId].name.replace(/_(\d){3}/,"");const filePathArray=filePath.split("/");let fileName=filePathArray[filePathArray.length-
1];const fileDirection=filePathArray[0];const i={};const actor=this.getActor();const tagArray=tag.split(" ");const bodyItem=this.getApparel(tagArray[1],actor);if(!bodyItem||bodyItem.name==="")return false;const isSkinset=bodyItem.isSkinset;if(isSkinset){fileName=fileDirection+"/"+fileName;skin=bodyItem.name+"/"+fileDirection+"/"+fileName}else fileName=name+".png";i.skin=skin;i.filePath=fileDirection+"/"+fileName;return i};Spriter_Base.prototype.equipmentHasNote=function(equipment){if(equipment)if(this instanceof
Spriter_Character)return equipment.meta.Spriter;else if(this instanceof Spriter_Battler)return equipment.meta.Spriter_Battler};Spriter_Base.prototype.getActor=function(){if(this._character instanceof Game_Player)return $gameParty.leader();else if(this._character instanceof Game_Follower)return this._character.actor();else if(this._character instanceof Game_Actor)return this._character};Spriter_Base.prototype.getEquipment=function(tag,actor){if(tag==="Weapon"){const weaponId=actor._equips[0]._itemId;
return $dataWeapons[weaponId]}else{let armorId;switch(tag){case "Shield":armorId=actor._equips[1]._itemId;break;case "Head":armorId=actor._equips[2]._itemId;break;case "Body":armorId=actor._equips[3]._itemId;break;case "Accessory":armorId=actor._equips[4]._itemId;break}return $dataArmors[armorId]}};Spriter_Base.prototype.getApparel=function(tag,actor){return apparel=actor._apparel[tag]||false};Spriter_Base.prototype.bitmapIsPacked=function(path){};Spriter_Base.prototype.unpackTexture=function(item,
skin,filePath){};Spriter_Base.prototype.getRotatedCoordinates=function(x,y){rotX=y*Math.cos(Math.PI/2)-x*Math.sin(Math.PI/2);rotY=y*Math.sin(Math.PI/2)+x*Math.cos(Math.PI/2);return new PIXI.Point(rotX,rotY)};Spriter_Base.prototype.addChildSprites=function(item,w,h){const id=item.timelineId;let timelineName=this._pathTime[id].name.replace(/_(\d){3}/,"");let childrenSprites=this._childrenSprites;let requests=this._character._spriter._spriteRequests;for(const res of requests)if(res&&timelineName===res._spriteParent){let pivotX=
item.anchor.x*w;let pivotY=item.anchor.y*h;childrenSprites.push(new Spriter_Child(res,pivotX,pivotY));let childId=childrenSprites.length-1;let z=item.zIndex;this._element[id]=childrenSprites[childId];this._element[id].parentGroup=this._group;this._element[id].zIndex=z;this._element[id].texture=PIXI.Texture.EMPTY;this._character._spriter._spriteRequests=[];return true}return false};Spriter_Base.prototype.removeChildSprites=function(item){const id=item.timelineId;const childrenSprites=this._childrenSprites;
const requests=this._character._spriter._spriteRemoveRequests;for(let i=0;i<requests.length;i++)for(let j=0;j<childrenSprites.length;j++)if(requests[i]===childrenSprites[j]._character._spriteParent){childrenSprites.splice(j,1);this._character._spriter._spriteRemoveRequests=[]}};Spriter_Base.prototype.createChildSprites=function(item,w,h){const id=item.timelineId;const timelineName=this._pathTime[id].name.replace(/_(\d){3}/,"");const childrenSprites=this._childrenSprites;const children=this._character._spriter._spriteChildren;
for(const chil of children)if(chil&&timelineName===chil._spriteParent){const pivotX=item.anchor.x*w;const pivotY=item.anchor.y*h;childrenSprites.push(new Spriter_Child(chil,pivotX,pivotY));const childId=childrenSprites.length-1;const z=item.zIndex;this._element[id]=childrenSprites[childId];this._element[id].parentGroup=this._group;this._element[id].zIndex=z;this._element[id].texture=PIXI.Texture.EMPTY;this._character._spriter._spriteRequests=[];return true}return false};Spriter_Base.prototype.objectInheritanceUpdate=
function(i){const id=this.pathTimeId("object",i);if(this._pathMain[this._key].object_ref[i].hasOwnProperty("parent")){parentMainId=this._pathMain[this._key].object_ref[i].parent;parentTimeId=this.pathTimeId("bone",parentMainId);this._element[parentTimeId].addChild(this._element[id])}else if(this._element[id].parent!==this._sprite||this._element[id].parent===null)this._sprite.addChild(this._element[id]);this._element[id].zIndex=Number(this._pathMain[this._key].object_ref[i].z_index)};Spriter_Base.prototype.tween=
function(item){let pt;if(this._repeat&&this._speed<0&&item.currentKeyTime===0)pt=this._animLength;else pt=item.currentKeyTime;let nt;if(this._repeat&&this._speed>0&&item.currentKeyTime===item.lastKeyTime)nt=this._animLength;else if(this._repeat&&this._speed<0&&item.currentKeyTime===0)nt=item.lastKeyTime;else nt=item.nextKeyTime;const t=Math.abs((nt-pt)/this._speed);const pElement=item.type==="object"?item.currentKey.object:item.currentKey.bone;const px=Number(pElement.x)||0;const py=Number(pElement.y)||
0;const pr=Number(pElement.angle)||0;let psx=pElement.scale_x||1;psx=Number(psx);let psy=pElement.scale_y||1;psy=Number(psy);const nElement=item.type==="object"?item.nextKey.object:item.nextKey.bone;const nx=Number(nElement.x)||0;const ny=Number(nElement.y)||0;let nr=Number(nElement.angle)||0;let nsx=nElement.scale_x||1;nsx=Number(nsx);let nsy=nElement.scale_y||1;nsy=Number(nsy);const spin=this._speed>0?Number(item.currentKey.spin)||1:-(Number(item.nextKey.spin)||1);let dr;if(spin===-1&&nr>pr)nr-=
360;else if(spin===1&&nr<pr)nr+=360;const bx=item.x;const by=item.y;const br=item.rotation;const bsx=item.scale.x;const bsy=item.scale.y;const dt=Math.abs(this._animationFrame-pt);if(this._pathMain[this._key].hasOwnProperty("curve_type")){const cType=this._pathMain[this._key].curve_type;if(cType==="bezier"){const Bx=this._speed>0?this._pathMain[this._key].c1:this._pathMain[this._key].c3;const By=this._speed>0?this._pathMain[this._key].c2:this._pathMain[this._key].c4;const Cx=this._speed>0?this._pathMain[this._key].c3:
this._pathMain[this._key].c1;const Cy=this._speed>0?this._pathMain[this._key].c4:this._pathMain[this._key].c2;const curve=new UnitBezier(Bx,By,Cx,Cy);t0=curve.solve(dt/Math.abs(nt-pt),Number.EPSILON);t1=1-t0}else if(cType==="instant"){t0=0;t1=1}}else{t0=dt/Math.abs(nt-pt);t1=1-t0}item.x=px*t1+nx*t0;item.y=-py*t1+-ny*t0;item.rotation=(-pr*t1+-nr*t0)*(Math.PI/180);item.scale.x=psx*t1+nsx*t0;item.scale.y=psy*t1+nsy*t0;if(item.type==="object"){const a=item.alpha;let pa=pElement.a||1;pa=Number(pa);let na=
nElement.a||1;na=Number(na);const nax=Number(nElement.pivot_x)||0;const nay=1-Number(nElement.pivot_y)||0;const pax=Number(pElement.pivot_x)||0;const pay=1-Number(pElement.pivot_y)||0;item.alpha=pa*t1+na*t0;if(this._speed<0){item.anchor.x=nax;item.anchor.y=nay}}if(item.type==="object"){const folderId=Number(pElement.folder);const fileId=Number(pElement.file);const w=Number(this._animation.folder[folderId].file[fileId].width);const h=Number(this._animation.folder[folderId].file[fileId].height);if(this._character._spriter.forceUpdate)if(!this.updateChildSprites(item,
w,h))this.updateTexture(item)}else if(this._character._spriter.forceUpdate)this.updateTexture(item)};Spriter_Base.prototype.updateTagsAndVars=function(){let map;let id;let event;if(this._animation.entity.animation[this._animationId].hasOwnProperty("meta")){if(this._animation.entity.animation[this._animationId].meta.hasOwnProperty("varline")){const varline=this._animation.entity.animation[this._animationId].meta.varline;for(let i=0;i<varline.length;i++)for(let j=0;j<varline[i].key.length;j++){time=
Number(varline[i].key[j].time);if(this.isKeyTime(time)){const varId=Number(varline[i].def);const def=this._animation.entity.var_defs.i[varId];if(def.type==="string"){this._character._spriter.var[def.name]=varline[i].key[j].val;this._globalAnimationInfo.var[def.name]=varline[i].key[j].val}else if(def.type==="int"){this._character._spriter.var[def.name]=parseInt(varline[i].key[j].val);this._globalAnimationInfo.var[def.name]=parseInt(varline[i].key[j].val)}else if(def.type==="float"){this._character._spriter.var[def.name]=
parseFloat(varline[i].key[j].val);this._globalAnimationInfo.var[def.name]=parseFloat(varline[i].key[j].val)}}}}if(this._animation.entity.animation[this._animationId].meta.hasOwnProperty("tagline")){const tagline=this._animation.entity.animation[this._animationId].meta.tagline;this._character._spriter.tag=[];this._globalAnimationInfo.tag=[];for(let i=0;i<tagline.key.length;i++){time=Number(tagline.key[i].time);if(this.isKeyTime(time))if(tagline.key[i].tag)for(let j=0;j<tagline.key[i].tag.length;j++){const tag=
tagline.key[i].tag[j];const tagName=this._animation.tag_list.i[tag.t];this._character._spriter.tag.push(tagName);this._globalAnimationInfo.tag.push(tagName)}}}}};Spriter_Base.prototype.updateBoneInheritance=function(j){id=this.pathTimeId("bone",j);if(this._pathMain[this._key].bone_ref[j].hasOwnProperty("parent")){parentMainId=this._pathMain[this._key].bone_ref[j].parent;parentTimeId=this.pathTimeId("bone",parentMainId);this._element[parentTimeId].addChild(this._element[id])}else this._sprite.addChild(this._element[id])};
Spriter_Base.prototype.updateBoneBitmap=function(item){};Spriter_Base.prototype.updateTexture=function(item){if(item.type==="object")this.updateObjectTexture(item);else;};Spriter_Base.prototype.updateItemTagsAndVars=function(item){if(!item.vars)item.vars={};if(!item.tags)item.tags=[];if(this._pathTime[item.timelineId].hasOwnProperty("meta")){const meta=this._pathTime[item.timelineId].meta;if(meta.hasOwnProperty("tagline"))for(let i=0;i<meta.tagline.key.length;i++){const tagKey=meta.tagline.key[i];
const tagTime=Number(tagKey.time)||0;if(this.tagsAndVarsCurrentKey(item,tagTime)){item.tags=[];for(let j=0;j<tagKey.tag.length;j++){const tagId=Number(tagKey.tag[j].t);const tagName=this._animation.tag_list.i[tagId].name;item.tags.push(tagName)}}}else if(meta.hasOwnProperty("varline"))for(let i=0;i<meta.varline.key.length;i++)for(let j=0;j<varKey.var.length;j++){const varId=Number(varKey.var[j].def);const variable=this._animation.obj_info[item.obj].var_defs.i[varId];for(let k=0;k<varKey.var[j].key.length;k++){var varKey=
meta.varline.key[j].key[k];const varTime=Number(varKey.time)||0;if(this.tagsAndVarsCurrentKey(item,varTime))if(variable.type==="int")item.vars[variable.name]=Number(varKey.val);else if(variable.type==="float")item.vars[variable.name]=Number(varKey.val);else{if(variable.type==="string")item.vars[variable.name]=varKey.val}else if(variable.type==="int")item.vars[variable.name]=Number(variable.default);else if(variable.type==="float")item.vars[variable.name]=Number(variable.default);else if(variable.type===
"string")item.vars[variable.name]=variable.default}}}};Spriter_Base.prototype.updateFrame=function(){this._pathMain=this._animation.entity.animation[this._animationId].mainline.key;const speed=this._speed*(limitCounter+1);let nextKeyTime;const lastKeyTime=Number(this._pathMain[this._pathMain.length-1].time);if(speed>0)if(this._key<this._pathMain.length-1){nextKeyTime=Number(this._pathMain[this._key+1].time)||0;if(this._animationFrame+speed>=nextKeyTime){this._key++;this._animationFrame=nextKeyTime}else this._animationFrame+=
speed}else if(this._key===this._pathMain.length-1)if(this._animationFrame===this._animLength&&this._repeat){this._animationFrame=0;this._key=0}else if(this._animationFrame+speed>=this._animLength){this._animationFrame=this._animLength;this._key=this._pathMain.length-1}else this._animationFrame+=speed;this.updateDisplay()};Spriter_Base.prototype.updateDirection=function(){if((this._character._direction-2)/2!==this._animationId&&!this._stop){this._animationId=(this._character._direction-2)/2;this.resetSpriterSprite()}};
Spriter_Base.prototype.update=function(){if(this._waitCounter===limitCounter){Sprite_Base.prototype.update.call(this);this.checkCharacterState();this.updateSprite();this._waitCounter=0}else this._waitCounter++};Spriter_Base.prototype.updateDisplay=function(){};Spriter_Base.prototype.updateSprite=function(){if(!this._stop){this.checkChanges();this.setCharacterSprite();this.updateTagsAndVars();if(this.isItemMoving()){this._resetter=false;this.updateFrame()}else if(this._recovery==="snap")if(this._resetter){this._key=
0;this._animationFrame=0;this.updateDisplay()}else this._resetter=true}else this.checkChanges();this.checkReset()};Spriter_Base.prototype.updateObjectTexture=function(item){let i={};const tagForEquipment=this.getForEquipment(item);const tagForApparel=this.getForApparel(item);if(tagForApparel&&this.characterIsActor())i=this.loadFromApparell(item,tagForApparel);else if(tagForEquipment&&this.characterIsActor())i=this.loadFromEquipment(item,tagForEquipment);else i=this.loadFromNotes(item);i.path=`${PluginManager._pathSpriter}${i.skin}.json`;
return i};Spriter_Base.prototype.updateChildSprites=function(item,w,h){this.addChildSprites(item,w,h);this.removeChildSprites(item)};Spriter_Base.prototype.isKeyTime=function(time){return this._animationFrame===time||this._animationFrame>time&&this._animationFrame<time+this._speed};function Spriter_Character(){this.initialize.apply(this,arguments)}Spriter_Character.prototype=Object.create(Spriter_Base.prototype);Spriter_Character.prototype.constructor=Spriter_Character;Spriter_Character.prototype.initialize=
function(character){Spriter_Base.prototype.initialize.call(this,character);this.start()};Spriter_Character.prototype.initMembers=function(){Spriter_Base.prototype.initMembers.call(this);this._balloonDuration=0;this._tilesetId=0;this._resetter=false;this._recovery="snap";this._globalAnimationInfo={}};Spriter_Character.prototype.setCharacter=function(character){Spriter_Base.prototype.setCharacter.call(this,character);this._animationId=(character._direction-2)/2;this._recovery=this._character._spriter._recovery;
if(this._character.constructor===Game_Player)this._globalAnimationInfo=$infoSpriter.player;else if(this._character.constructor===Game_Event){const map=String(this._character._mapId);const id=String(this._character.eventId());this._globalAnimationInfo=$infoSpriter.maps["map_"+map]["event_"+id]}else if(this._character.constructor===Game_Follower){const folId=String(this._character._memberIndex);this._globalAnimationInfo=$infoSpriter.followers["follower_"+folId]}if(this._globalAnimationInfo===undefined)this._globalAnimationInfo=
{};if(!this._globalAnimationInfo.hasOwnProperty("bones"))this._globalAnimationInfo.bones={};if(!this._globalAnimationInfo.hasOwnProperty("objects"))this._globalAnimationInfo.objects={};if(!this._globalAnimationInfo.hasOwnProperty("tag"))this._globalAnimationInfo.tag=[];if(!this._globalAnimationInfo.hasOwnProperty("var"))this._globalAnimationInfo.var={};if(this._character._direction===this._globalAnimationInfo.dir){this._animationFrame=this._globalAnimationInfo.frame||0;this._key=this._globalAnimationInfo.key||
0}else{this._animationFrame=0;this._key=0}};Spriter_Character.prototype.start=function(){this.setInitialCharacter()};Spriter_Character.prototype.setInitialCharacter=function(){let item;this._pathMain=this._animation.entity.animation[this._animationId].mainline.key;this._pathTime=this._animation.entity.animation[this._animationId].timeline;if(!this._pathMain[this._key])this._key=0;if(this._pathMain[this._key].hasOwnProperty("bone_ref")){for(let j=0;j<this._pathMain[this._key].bone_ref.length;j++)this.updateBoneInheritance(j);
for(let n=0;n<this._pathMain[this._key].bone_ref.length;n++){id=Number(this._pathMain[this._key].bone_ref[n].timeline);item=this._element[id];item.timelineId=id;item.key=Number(this._pathMain[this._key].bone_ref[n].key);item.currentKey=this._pathTime[item.timelineId].key[item.key];item.type="bone";this.setInitialElements(n,item)}}if(this._pathMain[this._key].hasOwnProperty("object_ref"))for(let i=0;i<this._pathMain[this._key].object_ref.length;i++){id=Number(this._pathMain[this._key].object_ref[i].timeline);
item=this._element[id];item.timelineId=id;item.key=Number(this._pathMain[this._key].object_ref[i].key);item.currentKey=this._pathTime[item.timelineId].key[item.key];item.type="object";this.setInitialElements(i,item)}};Spriter_Character.prototype.setInitialElements=function(n,item){const globals=this._globalAnimationInfo;let elementGlobal;let w;let h;const element=item.type==="object"?item.currentKey.object:item.currentKey.bone;const folderId=Number(element.folder);const fileId=Number(element.file);
if(item.type==="object"){if(!globals.objects.hasOwnProperty("object_"+Number(item.timelineId)))globals.objects["object_"+Number(item.timelineId)]={};elementGlobal=globals.objects["object_"+Number(item.timelineId)];if(this._pathMain[this._key].object_ref[n].hasOwnProperty("parent")){parentMainId=this._pathMain[this._key].object_ref[n].parent;parentTimeId=this.pathTimeId("bone",parentMainId);this._element[parentTimeId].addChild(item)}else this._sprite.addChild(item);w=Number(this._animation.folder[folderId].file[fileId].width);
h=Number(this._animation.folder[folderId].file[fileId].height)}else{if(!globals.bones.hasOwnProperty("bone_"+Number(item.timelineId)))globals.bones["bone_"+Number(item.timelineId)]={};elementGlobal=globals.bones["bone_"+Number(item.timelineId)]}const ex=Number(element.x)||0;const ey=Number(element.y)||0;const er=Number(element.angle)||0;let esx=element.scale_x||1;esx=Number(esx);let esy=element.scale_y||1;esy=Number(esy);const x=elementGlobal.x||ex;const y=elementGlobal.y||-ey;item.x=x;item.y=y;item.rotation=
elementGlobal.r||-er*Math.PI/180;item.scale.x=elementGlobal.sx||esx;item.scale.y=elementGlobal.sy||esy;if(item.type==="object"){const eax=Number(element.pivot_x)||0;const eay=1-Number(element.pivot_y)||0;let ea=element.a||1;ea=Number(ea);const z=Number(this._pathMain[this._key].object_ref[n].z_index);item.alpha=elementGlobal.a||ea;item.anchor.x=elementGlobal.ex||eax;item.anchor.y=elementGlobal.ey||eay;item.zIndex=elementGlobal.z||z;item.tags=elementGlobal.tags||[];item.vars=elementGlobal.vars||{};
if(!this.createChildSprites(item,w,h))this.updateTexture(item)}};Spriter_Character.prototype.update=function(){this.updateSpriterCharacter()};Spriter_Character.prototype.updateSpriterCharacter=function(){this.updateDirection();Spriter_Base.prototype.update.call(this);this.updatePosition()};Spriter_Character.prototype.updateFrame=function(){Spriter_Base.prototype.updateFrame.call(this);this._globalAnimationInfo.key=this._key;this._globalAnimationInfo.frame=this._animationFrame};Spriter_Character.prototype.setOnKey=
function(item){Spriter_Base.prototype.setOnKey.call(this,item);this.storeToGlobal(item)};Spriter_Character.prototype.tween=function(item){Spriter_Base.prototype.tween.call(this,item);this.storeToGlobal(item)};Spriter_Character.prototype.updateObjectTexture=function(item){const i=Spriter_Base.prototype.updateObjectTexture.call(this,item);if(i){item.name=i.path;if($gameResources[i.path])item.texture=$gameResources[i.path].textures[i.filePath];else item.texture=PIXI.Texture.EMPTY}};Spriter_Character.prototype.storeToGlobal=
function(item){let characterGlobal={};if(this._character.constructor===Game_Player)characterGlobal=$infoSpriter.player;else if(this._character.constructor===Game_Event){const map=String(this._character._mapId);const id=String(this._character._eventId);characterGlobal=$infoSpriter.maps["map_"+map]["event_"+id]}else if(this._character.constructor===Game_Follower){const folId=String(this._character._memberIndex);characterGlobal=$infoSpriter.followers["follower_"+folId]}else{const map=String($gameMap._mapId);
const name=String(this._character._name);characterGlobal=$infoSpriter.maps["map_"+map]._children["child_"+name]}characterGlobal.dir=this._character._direction;if(item.type==="bone"){if(!characterGlobal.bones.hasOwnProperty(item.type+"_"+String(item.timelineId)))characterGlobal.bones[item.type+"_"+String(item.timelineId)]={};const bone=characterGlobal.bones[item.type+"_"+String(item.timelineId)];bone.x=item.x;bone.y=item.y;bone.r=item.rotation;bone.sx=item.scale.x;bone.sy=item.scale.y;bone.tags=item.tags;
bone.vars=item.vars}else if(item.type==="object"){if(!characterGlobal.objects.hasOwnProperty(item.type+"_"+String(item.timelineId)))characterGlobal.objects[item.type+"_"+String(item.timelineId)]={};const object=characterGlobal.objects[item.type+"_"+String(item.timelineId)];object.x=item.x;object.y=item.y;object.r=item.rotation;object.a=item.alpha;object.ax=item.anchor.x;object.ay=item.anchor.y;object.sx=item.scale.x;object.sy=item.scale.y;object.z=item.zIndex;object._fileName=item._fileName;object.tags=
item.tags;object.vars=item.vars}};Spriter_Character.prototype.updateVisibility=function(){Spriter_Base.prototype.updateVisibility.call(this);if(this._spriteType==="character"&&this._character.isTransparent())this.visible=false};Spriter_Character.prototype.updatePosition=function(){if(this._spriteType==="character"){this.x=this._character.screenX();this.y=this._character.screenY();this.z=this._character.screenZ()}};Spriter_Character.prototype.updateAnimation=function(){this.setupAnimation();if(!this.isAnimationPlaying())this._character.endAnimation();
if(!this.isBalloonPlaying())this._character.endBalloon()};Spriter_Character.prototype.updateOther=function(){};Spriter_Character.prototype.setupAnimation=function(){if(this._character.animationId()>0){const animation=$dataAnimations[this._character.animationId()];this.startAnimation(animation,false,0);this._character.startAnimation()}};Spriter_Character.prototype.setupBalloon=function(){if(this._character.balloonId()>0){this.startBalloon();this._character.startBalloon()}};Spriter_Character.prototype.startBalloon=
function(){if(!this._balloonSprite)this._balloonSprite=new Sprite_Balloon;this._balloonSprite.setup(this._character.balloonId());this.parent.addChild(this._balloonSprite)};Spriter_Character.prototype.updateBalloon=function(){this.setupBalloon();if(this._balloonSprite){this._balloonSprite.x=this.x;this._balloonSprite.y=this.y-this.height;if(!this._balloonSprite.isPlaying())this.endBalloon()}};Spriter_Character.prototype.endBalloon=function(){if(this._balloonSprite){this.parent.removeChild(this._balloonSprite);
this._balloonSprite=null}};Spriter_Character.prototype.isBalloonPlaying=function(){return!!this._balloonSprite};function Spriter_Child(){this.initialize.apply(this,arguments)}Spriter_Child.prototype=Object.create(Spriter_Base.prototype);Spriter_Child.prototype.constructor=Spriter_Child;Spriter_Child.prototype.initialize=function(character,pivotX,pivotY){Spriter_Base.prototype.initialize.call(this,character);this._sprite.x=-pivotX;this._sprite.y=-pivotY};Spriter_Child.prototype.displaceSprite=function(){};
Spriter_Child.prototype.update=function(){Spriter_Base.prototype.update.call(this)};Spriter_Child.prototype.updateObjectTexture=function(item){const i=Spriter_Base.prototype.updateObjectTexture.call(this,item);if(i){item.name=i.path;if($gameResources[i.path])item.texture=$gameResources[i.path].textures[i.filePath];else item.texture=PIXI.Texture.EMPTY}};class UnitBezier{constructor(p1x,p1y,p2x,p2y){this.cx=3*p1x;this.bx=3*(p2x-p1x)-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*p1y;this.by=3*(p2y-p1y)-
this.cy;this.ay=1-this.cy-this.by}sampleCurveX(t){return((this.ax*t+this.bx)*t+this.cx)*t}sampleCurveY(t){return((this.ay*t+this.by)*t+this.cy)*t}sampleCurveDerivativeX(t){return(3*this.ax*t+2*this.bx)*t+this.cx}solveCurveX(x,epsilon){let t0;let t1;let t2;let x2;let d2;let i;for(t2=x,i=0;i<8;i++){x2=this.sampleCurveX(t2)-x;if(Math.abs(x2)<epsilon)return t2;d2=this.sampleCurveDerivativeX(t2);if(Math.abs(d2)<epsilon)break;t2=t2-x2/d2}t0=0;t1=1;t2=x;if(t2<t0)return t0;if(t2>t1)return t1;while(t0<t1){x2=
this.sampleCurveX(t2);if(Math.abs(x2-x)<epsilon)return t2;if(x>x2)t0=t2;else t1=t2;t2=(t1-t0)*.5+t0}return t2}solve(x,epsilon){return this.sampleCurveY(this.solveCurveX(x,epsilon))}}function Game_SpriterCharacter(){this.initialize.apply(this,arguments)}Object.defineProperties(Game_SpriterCharacter.prototype,{x:{get:function(){return this._x},configurable:true},y:{get:function(){return this._y},configurable:true}});Game_SpriterCharacter.prototype.initialize=function(content,spriteParent,id){this.initMembers(content,
spriteParent,id)};Game_SpriterCharacter.prototype.initMembers=function(content,spriteParent,id){if(!content)return;this.x=0;this.y=0;this._spriter=content._spriter;this._spriter._spriteRequests=[];this._spriter._spriteRemoveRequests=[];this._direction=content._direction;this._stepAnime=content._stepAnime;this._id=id;this._name=content._name;this._spriteParent=spriteParent};window.Spriter_Character=Spriter_Character})();
