/*:
@author Hime --> HimeWorks (http://himeworks.com)
If you have any questions or concerns, you can contact me at any of
the following sites:
Main Website: http://himeworks.com
Facebook: https://www.facebook.com/himeworkscom/
Twitter: https://twitter.com/HimeWorks
Youtube: https://www.youtube.com/c/HimeWorks
Tumblr: http://himeworks.tumblr.com/
== Terms of Use ==
- Free for use in non-commercial projects with credits
- Contact me for commercial use
*/
(function(){const getEnemyClass=(enemy)=>{if(enemy.classId!==undefined)return enemy.classId;enemy.classId=0;if(enemy.meta&&enemy.meta.hasOwnProperty("ClassId"))enemy.classId=Number(enemy.meta.ClassId);return enemy.classId};const TH_EnemyClasses_GameEnemy_initMembers=Game_Enemy.prototype.initMembers;Game_Enemy.prototype.initMembers=function(){this._level=1;this._classId=0;TH_EnemyClasses_GameEnemy_initMembers.call(this)};const TH_EnemyClasses_GameEnemy_setup=Game_Enemy.prototype.setup;
Game_Enemy.prototype.setup=function(enemyId,x,y){this._classId=getEnemyClass($dataEnemies[enemyId]);TH_EnemyClasses_GameEnemy_setup.call(this,enemyId,x,y)};Game_Enemy.prototype.currentClass=function(){return $dataClasses[this._classId]};const TH_EnemyClasses_GameEnemy_paramBase=Game_Enemy.prototype.paramBase;Game_Enemy.prototype.paramBase=function(paramId){let param;if(this._classId===0)param=TH_EnemyClasses_GameEnemy_paramBase.call(this,paramId);else param=this.currentClass().params[paramId][this._level];
return param};Game_Enemy.prototype.changeClass=function(classId,keepExp){this._classId=classId;this.refresh()};Game_Enemy.prototype.traitObjects=function(){let obj=Game_Battler.prototype.traitObjects.call(this);if(obj.length>0)for(let t of Object.keys(obj))if(t!=="traits"){obj[t]=null;delete obj[t]}if(this._classId>0){obj.push({traits:this.currentClass().traits||[]});obj.push({traits:this.enemy().traits||[]})}return obj};const TH_GameInterpreter_pluginCommand=Game_Interpreter.prototype.pluginCommand;
Game_Interpreter.prototype.pluginCommand=function(command,args){const cmd=command.toLowerCase();if(cmd==="change_enemy_class"){const id=Math.floor(args[1])-1;const classId=Math.floor(args[4]);$gameTroop.members()[id].changeClass(classId,true)}else TH_GameInterpreter_pluginCommand.call(this,command,args)}})();(function(){const delimiter=";";const config={"MAX HP":1,"MAX MP":2,"ATTACK":3,"DEFENSE":4,"MAGICAL ATTACK":5,"MAGICAL DEFENSE":6,"AGILITY":7,"LUCK":8};const onTableLoad=function(obj,data){data=String(data).trim();data=data.split(/\n/);let table=data.map((v)=>v.split(delimiter));let columnMap=table[0].map((v)=>{let s=String(v).trim();return s.toUpperCase()});if(obj.params)obj.params=[];const rows=data.length;for(let key=1;key<columnMap.length;key++){let conf=config[columnMap[key]]||0;if(conf){--conf;
let values=[0];for(let i=1;i<rows;i++)values.push(Math.floor(table[i][key]));obj.params[conf]=values}}};let loadTable=false;const TH_DataManager_isDatabaseLoaded=DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=function(){if(!TH_DataManager_isDatabaseLoaded.call(this))return false;if(!loadTable){for(let obj of $dataClasses)if(obj)if(obj.meta.hasOwnProperty("Parameter_Curves"))UHPD.ReadFile({url:`data/${obj.meta.Parameter_Curves}.csv`,override:"application/csv"}).then((data)=>{onTableLoad(obj,
data)});loadTable=true}return true}})();(()=>{var $gameSelfVariables=null;function Game_SelfVariables(){this.initialize.apply(this,arguments)}Game_SelfVariables.prototype.initialize=function(){this._data={}};Game_SelfVariables.prototype.getMapData=function(mapId){if(!this._data[mapId])this._data[mapId]={};return this._data[mapId]};Game_SelfVariables.prototype.getEventData=function(mapId,eventId){var mapData=this.getMapData(mapId);if(!mapData[eventId])mapData[eventId]={};return mapData[eventId]};Game_SelfVariables.prototype.value=function(mapId,
eventId,id){var eventData=this.getEventData(mapId,eventId);return eventData[id]};Game_SelfVariables.prototype.setValue=function(mapId,eventId,id,value){var eventData=this.getEventData(mapId,eventId);if(value!==undefined)eventData[id]=value;else delete eventData[id];this.onChange()};Game_SelfVariables.prototype.clear=function(mapId,eventId,id){var eventData=this.getEventData(mapId,eventId);delete eventData[id]};Game_SelfVariables.prototype.clearAll=function(mapId,eventId){const mapData=this.getMapData(mapId);
delete mapData[eventId]};Game_SelfVariables.prototype.onChange=function(){$gameMap.requestRefresh()};const TH_DataManager_createGameObjects=DataManager.createGameObjects;DataManager.createGameObjects=function(){TH_DataManager_createGameObjects.call(this);$gameSelfVariables=new Game_SelfVariables};const TH_DataManager_makeSaveContents=DataManager.makeSaveContents;DataManager.makeSaveContents=function(){let contents=TH_DataManager_makeSaveContents.call(this);contents.selfVariables=$gameSelfVariables;
return contents};const TH_DataManager_extractSaveContents=DataManager.extractSaveContents;DataManager.extractSaveContents=function(contents){TH_DataManager_extractSaveContents.call(this,contents);$gameSelfVariables=contents.selfVariables;if(!($gameSelfVariables instanceof Game_SelfVariables))$gameSelfVariables=new Game_SelfVariables;$gameSelfVariables._data=contents.selfVariables._data;console.log($gameSelfVariables)};Game_Character.prototype.get_my_var=function(id,eventId,mapId){eventId=eventId||
this._eventId;if(eventId===0)eventId=this._eventId;mapId=mapId||this._mapId;return $gameSelfVariables.value(mapId,eventId,id)};Game_Character.prototype.set_my_var=function(id,value,eventId,mapId){eventId=eventId||this._eventId;if(eventId===0)eventId=this._eventId;mapId=mapId||this._mapId;$gameSelfVariables.setValue(mapId,eventId,id,value)};Game_Character.prototype.clear_my_var=function(id,eventId,mapId){eventId=eventId||this._eventId;if(eventId===0)eventId=this._eventId;mapId=mapId||this._mapId;$gameSelfVariables.clear(mapId,
eventId,id)};Game_Character.prototype.clear_all_self_variables=function(eventId,mapId){eventId=eventId||this._eventId;if(eventId===0)eventId=this._eventId;mapId=mapId||this._mapId;$gameSelfVariables.clearAll(mapId,eventId)};Game_Interpreter.prototype.get_my_var=function(id,eventId,mapId){eventId=eventId||this._eventId;if(eventId===0)eventId=this._eventId;mapId=mapId||this._mapId;return $gameSelfVariables.value(mapId,eventId,id)};Game_Interpreter.prototype.set_my_var=function(id,value,eventId,mapId){eventId=
eventId||this._eventId;if(eventId===0)eventId=this._eventId;mapId=mapId||this._mapId;$gameSelfVariables.setValue(mapId,eventId,id,value)};Game_Interpreter.prototype.clear_my_var=function(id,eventId,mapId){eventId=eventId||this._eventId;if(eventId===0)eventId=this._eventId;mapId=mapId||this._mapId;$gameSelfVariables.clear(mapId,eventId,id)};Game_Interpreter.prototype.clear_all_self_variables=function(eventId,mapId){eventId=eventId||this._eventId;if(eventId===0)eventId=this._eventId;mapId=mapId||this._mapId;
$gameSelfVariables.clearAll(mapId,eventId)};const oldGame_InterpreterPluginCommand=Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand=function(command,args){let id=String(args[0]),value=String(args[1]),eventId=Number(args[2])||undefined,mapId=Number(args[3])||undefined;switch(command){case "set_my_var":return this.set_my_var(id,value,eventId,mapId);case "clear_my_var":id=String(args[0]);eventId=Number(args[1])||undefined;mapId=Number(args[2])||undefined;return this.clear_my_var(id,
eventId,mapId);case "clear_all_self_var":eventId=Number(args[0])||undefined;mapId=Number(args[1])||undefined;return this.clear_all_self_variables(eventId,mapId);default:oldGame_InterpreterPluginCommand.call(this,command,args)}}})();
