var Imported=Imported||{};Imported.LeTBS_SpreadState=!0;var Lecode=Lecode||{};Lecode.S_TBS.SpreadState={};var parameters=PluginManager.parameters("LeTBS_SpreadState");Lecode.S_TBS.SpreadState.oldTBSEntity_setCell=TBSEntity.prototype.setCell,TBSEntity.prototype.setCell=function(t){Lecode.S_TBS.SpreadState.oldTBSEntity_setCell.call(this,t),this.checkSpreadableStates()},TBSEntity.prototype.checkSpreadableStates=function(){this.battler().isAlive()&&(this.spreadStates(),this.obtainSpreadableStates())},TBSEntity.prototype.spreadStates=function(){var l=this.battler();l.states().forEach(function(e){var t=e.TagsLetbs.spread;if(t&&t.match(/(\d+)\s(.+)\s(.+)/i)){parseInt(RegExp.$1);var a=RegExp.$2,i=RegExp.$3,r=this.getCell().toCoords(),s=BattleManagerTBS.getScopeFromData(a,r,{});BattleManagerTBS.getEntitiesInScope(s).forEach(function(t){t!==this&&t.battler().isAlive()&&("all"===i||"allies"===i&&LeUtilities.isAlly(l,t.battler())||"enemies"===i&&!LeUtilities.isAlly(l,t.battler()))&&(t.battler().isStateAffected(e.id)||t.sprite().addExtraPopup("addedState",[e]),t.battler().addState(e.id))},this)}},this)},TBSEntity.prototype.obtainSpreadableStates=function(){BattleManagerTBS.allEntities().forEach(function(t){t!==this&&t.battler().isAlive()&&(this.getSpreadStateFromEntity(t),this.getSpreadStateFromStates(t))},this)},TBSEntity.prototype.getSpreadStateFromEntity=function(t){var e=this.battler(),a=t.battler().getLeTBSTagObjectValue("spread");for(var i in a)if(a.hasOwnProperty(i)){var r=a[i];if(r&&r.match(/(\d+)\%\s(.+)\s(.+)/i)){parseInt(RegExp.$1);var s=RegExp.$2,l=RegExp.$3,S=this.getCell().toCoords(),o=BattleManagerTBS.getScopeFromData(s,S,{});if(BattleManagerTBS.isCellInScope(this.getCell(),o)&&("all"===l||"allies"===l&&LeUtilities.isAlly(e,t.battler())||"enemies"===l&&!LeUtilities.isAlly(e,t.battler()))){var d=$dataStates[i];e.isStateAffected(d.id)||this.sprite().addExtraPopup("addedState",[d]),e.addState(d.id)}}}},TBSEntity.prototype.getSpreadStateFromStates=function(l){var S=this.battler();l.battler().states().forEach(function(t){var e=t.TagsLetbs.spread;if(e&&e.match(/(\d+)\s(.+)\s(.+)/i)){parseInt(RegExp.$1);var a=RegExp.$2,i=RegExp.$3,r=l.getCell().toCoords(),s=BattleManagerTBS.getScopeFromData(a,r,{});BattleManagerTBS.isCellInScope(this.getCell(),s)&&("all"===i||"allies"===i&&LeUtilities.isAlly(S,l.battler())||"enemies"===i&&!LeUtilities.isAlly(S,l.battler()))&&(S.isStateAffected(t.id)||this.sprite().addExtraPopup("addedState",[t]),S.addState(t.id))}},this)};