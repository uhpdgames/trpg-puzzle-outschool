/*:@author Yanfly | http://yanfly.moe */
var Imported=Imported||{};Imported.YEP_SaveCore=true;var Yanfly = {};Yanfly.Save=Yanfly.Save||{};Yanfly.Save.version=1.06;
(function(){Yanfly.Parameters=PluginManager.parameters("YEP_SaveCore");Yanfly.Param=Yanfly.Param||{};Yanfly.Param.SaveMaxFiles=Number(Yanfly.Parameters["Max Files"]);Yanfly.Param.SaveIconSaved=Number(Yanfly.Parameters["Saved Icon"]);Yanfly.Param.SaveIconEmpty=Number(Yanfly.Parameters["Empty Icon"]);Yanfly.Param.SavePop=eval(String(Yanfly.Parameters["Return After Saving"]));Yanfly.Param.SaveAutoIndex=eval(String(Yanfly.Parameters["Auto New Index"]));Yanfly.Param.SaveCmdLoad=String(Yanfly.Parameters["Load Command"]);
Yanfly.Param.SaveCmdSave=String(Yanfly.Parameters["Save Command"]);Yanfly.Param.SaveCmdDelete=String(Yanfly.Parameters["Delete Command"]);Yanfly.Param.SaveHelpSelect=String(Yanfly.Parameters["Select Help"]);Yanfly.Param.SaveLoadSelect=String(Yanfly.Parameters["Load Help"]);Yanfly.Param.SaveSaveSelect=String(Yanfly.Parameters["Save Help"]);Yanfly.Param.SaveDeleteSelect=String(Yanfly.Parameters["Delete Help"]);Yanfly.Param.SaveDeleteSound={name:String(Yanfly.Parameters["Delete Filename"]),volume:Number(Yanfly.Parameters["Delete Volume"]),
pitch:Number(Yanfly.Parameters["Delete Pitch"]),pan:Number(Yanfly.Parameters["Delete Pan"])};Yanfly.Param.SaveInfoTitle=String(Yanfly.Parameters["Show Game Title"]);Yanfly.Param.SaveInfoTitle=eval(Yanfly.Param.SaveInfoTitle);Yanfly.Param.SaveInfoInvalid=String(Yanfly.Parameters["Invalid Game Text"]);Yanfly.Param.SaveInfoEmpty=String(Yanfly.Parameters["Empty Game Text"]);Yanfly.Param.SaveMapDisplayName=String(Yanfly.Parameters["Map Display Name"]);Yanfly.Param.SaveMapDisplayName=eval(Yanfly.Param.SaveMapDisplayName);
Yanfly.Param.SaveInfoPartyType=Number(Yanfly.Parameters["Party Display"]);Yanfly.Param.SaveInfoPartyType=Yanfly.Param.SaveInfoPartyType.clamp(0,3);Yanfly.Param.SaveInfoPartyY=String(Yanfly.Parameters["Party Y Position"]);Yanfly.Param.SaveInfoActorName=String(Yanfly.Parameters["Show Actor Names"]);Yanfly.Param.SaveInfoActorName=eval(Yanfly.Param.SaveInfoActorName);Yanfly.Param.SaveInfoActorNameSz=Number(Yanfly.Parameters["Name Font Size"]);Yanfly.Param.SaveInfoActorLv=String(Yanfly.Parameters["Show Actor Level"]);
Yanfly.Param.SaveInfoActorLv=eval(Yanfly.Param.SaveInfoActorLv);Yanfly.Param.SaveInfoActorLvSz=Number(Yanfly.Parameters["Level Font Size"]);Yanfly.Param.SaveInfoActorLvFmt=String(Yanfly.Parameters["Level Format"]);Yanfly.Param.SaveInfoDataSz=Number(Yanfly.Parameters["Data Font Size"]);Yanfly.Param.SaveInfoDataCol1=String(Yanfly.Parameters["Data Column 1"]);Yanfly.Param.SaveInfoDataCol1=Yanfly.Param.SaveInfoDataCol1.split(",");Yanfly.Param.SaveInfoDataCol2=String(Yanfly.Parameters["Data Column 2"]);
Yanfly.Param.SaveInfoDataCol2=Yanfly.Param.SaveInfoDataCol2.split(",");Yanfly.Param.SaveInfoDataCol3=String(Yanfly.Parameters["Data Column 3"]);Yanfly.Param.SaveInfoDataCol3=Yanfly.Param.SaveInfoDataCol3.split(",");Yanfly.Param.SaveInfoDataCol4=String(Yanfly.Parameters["Data Column 4"]);Yanfly.Param.SaveInfoDataCol4=Yanfly.Param.SaveInfoDataCol4.split(",");Yanfly.trimSaveDataColumns=function(array){var length=array.length;for(let i=0;i<length;++i)array[i]=array[i].trim();if(length===1&&array[0]===
"")array.splice(0)};Yanfly.trimSaveDataColumns(Yanfly.Param.SaveInfoDataCol1);Yanfly.trimSaveDataColumns(Yanfly.Param.SaveInfoDataCol2);Yanfly.trimSaveDataColumns(Yanfly.Param.SaveInfoDataCol3);Yanfly.trimSaveDataColumns(Yanfly.Param.SaveInfoDataCol4);Yanfly.Param.SaveVocabLocation=String(Yanfly.Parameters["Map Location"]);Yanfly.Param.SaveVocabPlaytime=String(Yanfly.Parameters["Playtime"]);Yanfly.Param.SaveVocabSaveCount=String(Yanfly.Parameters["Save Count"]);Yanfly.Param.SaveVocabGoldCount=String(Yanfly.Parameters["Gold Count"]);
Yanfly.Param.SaveTechSaveMode=String(Yanfly.Parameters["Save Mode"]).trim();Yanfly.Param.SaveTechSaveMode=Yanfly.Param.SaveTechSaveMode.toLowerCase();Yanfly.Param.SaveTechLocalConfig=String(Yanfly.Parameters["Local Config"]);Yanfly.Param.SaveTechLocalGlobal=String(Yanfly.Parameters["Local Global"]);Yanfly.Param.SaveTechLocalSave=String(Yanfly.Parameters["Local Save"]);Yanfly.Param.SaveTechWebConfig=String(Yanfly.Parameters["Web Config"]);Yanfly.Param.SaveTechWebGlobal=String(Yanfly.Parameters["Web Global"]);
Yanfly.Param.SaveTechWebSave=String(Yanfly.Parameters["Web Save"]);Yanfly.Param.SaveConfirmLoad=String(Yanfly.Parameters["Load Confirmation"]);Yanfly.Param.SaveConfirmLoad=eval(Yanfly.Param.SaveConfirmLoad);Yanfly.Param.SaveConfirmLoadTx=String(Yanfly.Parameters["Load Text"]);Yanfly.Param.SaveConfirmSave=String(Yanfly.Parameters["Save Confirmation"]);Yanfly.Param.SaveConfirmSave=eval(Yanfly.Param.SaveConfirmSave);Yanfly.Param.SaveConfirmSaveTx=String(Yanfly.Parameters["Save Text"]);Yanfly.Param.SaveConfirmDel=
String(Yanfly.Parameters["Delete Confirmation"]);Yanfly.Param.SaveConfirmDel=eval(Yanfly.Param.SaveConfirmDel);Yanfly.Param.SaveConfirmDelTx=String(Yanfly.Parameters["Delete Text"]);Yanfly.Param.SaveConfirmYes=String(Yanfly.Parameters["Confirm Yes"]);Yanfly.Param.SaveConfirmNo=String(Yanfly.Parameters["Confirm No"]);DataManager.maxSavefiles=function(){return Yanfly.Param.SaveMaxFiles};Yanfly.Save.DataManager_selectSavefileForNewGame=DataManager.selectSavefileForNewGame;DataManager.selectSavefileForNewGame=
function(){Yanfly.Save.DataManager_selectSavefileForNewGame.call(this);if(Yanfly.Param.SaveAutoIndex)return;this._lastAccessedId=1};Yanfly.Save.DataManager_makeSaveContents=DataManager.makeSaveContents;DataManager.makeSaveContents=function(){var contents=Yanfly.Save.DataManager_makeSaveContents.call(this);contents.map.locationDisplayName=$dataMap.displayName;return contents};Yanfly.Save.StorageManager_isLocalMode=StorageManager.isLocalMode;StorageManager.isLocalMode=function(){if(Yanfly.Param.SaveTechSaveMode===
"local"){if(!Utils.isNwjs())return false;return true}else if(Yanfly.Param.SaveTechSaveMode==="web")return false;else return Yanfly.Save.StorageManager_isLocalMode.call(this)};StorageManager.localFilePath=function(savefileId){var name;if(savefileId<0)name=Yanfly.Param.SaveTechLocalConfig;else if(savefileId===0)name=Yanfly.Param.SaveTechLocalGlobal;else name=Yanfly.Param.SaveTechLocalSave.format(savefileId);return this.localFileDirectoryPath()+name};Yanfly.Save.StorageManager_webStorageKey=StorageManager.webStorageKey;
StorageManager.webStorageKey=function(savefileId){if(!$dataSystem)return Yanfly.Save.StorageManager_webStorageKey.call(this);var title=$dataSystem.gameTitle;this.loadConfig();if(savefileId<0)return Yanfly.Param.SaveTechWebConfig.format(title);else if(savefileId===0)return Yanfly.Param.SaveTechWebGlobal.format(title);else return Yanfly.Param.SaveTechWebSave.format(title,savefileId)};StorageManager.loadConfig=function(){if(this._configLoaded)return;this._configLoaded=true;ConfigManager.load()};Yanfly.Save.BattleManager_setBattleTest=
BattleManager.setBattleTest;BattleManager.setBattleTest=function(battleTest){Yanfly.Save.BattleManager_setBattleTest.call(this,battleTest);if(battleTest)StorageManager.loadConfig()};Window_Base.prototype.drawSvActor=function(actor,x,y){var filename=actor.battlerName();var bitmap=ImageManager.loadSvActor(filename);var pw=bitmap.width/9;var ph=bitmap.height/6;var sx=0;var sy=0;this.contents.blt(bitmap,sx,sy,pw,ph,x-pw/2,y-ph)};Window_Base.prototype.textWidthEx=function(text){return this.drawTextEx(text,
0,this.contents.height)};Window_MenuCommand.prototype.isSaveEnabled=function(){if(DataManager.isEventTest())return false;return true};Window_SavefileList.prototype.itemHeight=function(){return this.lineHeight()};Window_SavefileList.prototype.drawItem=function(index){var id=index+1;var valid=DataManager.isThisGameFile(id);var rect=this.itemRect(index);this.resetTextColor();this.changePaintOpacity(valid);var icon=valid?Yanfly.Param.SaveIconSaved:Yanfly.Param.SaveIconEmpty;this.drawIcon(icon,rect.x+
2,rect.y+2);this.drawFileId(id,rect.x+Window_Base._iconWidth+4,rect.y)};Window_SavefileList.prototype.playOkSound=function(){Window_Selectable.prototype.playOkSound.call(this)};function Window_SaveAction(){this.initialize.apply(this,arguments)}Window_SaveAction.prototype=Object.create(Window_HorzCommand.prototype);Window_SaveAction.prototype.constructor=Window_SaveAction;Window_SaveAction.prototype.initialize=function(x,y,mode){this._width=Graphics.boxWidth-x;this._currentFile=0;this._mode=mode;Window_HorzCommand.prototype.initialize.call(this,
x,y);this.deactivate();this.deselect()};Window_SaveAction.prototype.windowWidth=function(){return this._width};Window_SaveAction.prototype.maxCols=function(){return 3};Window_SaveAction.prototype.savefileId=function(){return SceneManager._scene._listWindow.index()+1};Window_SaveAction.prototype.makeCommandList=function(){var id=this.savefileId();var enabled=DataManager.isThisGameFile(id);var valid=DataManager.loadSavefileInfo(id);this.addCommand(this.getCommandName("load"),"load",valid);this.addCommand(this.getCommandName("save"),
"save",this.isSaveEnabled());this.addCommand(this.getCommandName("delete"),"delete",enabled)};Window_SaveAction.prototype.getCommandName=function(type){if(type==="load")return Yanfly.Param.SaveCmdLoad;else if(type==="save")return Yanfly.Param.SaveCmdSave;else return Yanfly.Param.SaveCmdDelete};Window_SaveAction.prototype.isSaveEnabled=function(){if(this._mode!=="save")return false;return $gameSystem.isSaveEnabled()};Window_SaveAction.prototype.update=function(){Window_HorzCommand.prototype.update.call(this);
if(this.savefileId()!==this._currentFile)this.updateIndex()};Window_SaveAction.prototype.updateIndex=function(){this._currentFile=this.savefileId();this.refresh()};Window_SaveAction.prototype.playOkSound=function(){};Window_SaveAction.prototype.updateHelp=function(){var text="";if(this.currentSymbol()==="load")text=Yanfly.Param.SaveLoadSelect;else if(this.currentSymbol()==="save")text=Yanfly.Param.SaveSaveSelect;else if(this.currentSymbol()==="delete")text=Yanfly.Param.SaveDeleteSelect;this._helpWindow.setText(text)};
function Window_SaveInfo(){this.initialize.apply(this,arguments)}Window_SaveInfo.prototype=Object.create(Window_Base.prototype);Window_SaveInfo.prototype.constructor=Window_SaveInfo;Window_SaveInfo.prototype.initialize=function(x,y,width,height,mode){this._currentFile=0;this._waitTime=0;this._mode=mode;Window_Base.prototype.initialize.call(this,x,y,width,height)};Window_SaveInfo.prototype.resetFontSettings=function(){Window_Base.prototype.resetFontSettings.call(this);if(this._drawLevel)this.contents.fontSize=
Yanfly.Param.SaveInfoActorLvSz;if(this._drawData)this.contents.fontSize=Yanfly.Param.SaveInfoDataSz};Window_SaveInfo.prototype.savefileId=function(){return SceneManager._scene._listWindow.index()+1};Window_SaveInfo.prototype.drawDarkRect=function(dx,dy,dw,dh){var color=this.gaugeBackColor();this.changePaintOpacity(false);this.contents.fillRect(dx+1,dy+1,dw-2,dh-2,color);this.changePaintOpacity(true)};Window_SaveInfo.prototype.update=function(){Window_Base.prototype.update.call(this);if(this.savefileId()!==
this._currentFile)this.updateIndex();if(this._waitTime>0)this.updateTimer()};Window_SaveInfo.prototype.systemColorEx=function(){if(Imported.YEP_CoreEngine)return"\\c["+Yanfly.Param.ColorSystem+"]";else return"\\c[16]"};Window_SaveInfo.prototype.updateIndex=function(){var id=this.savefileId();this._currentFile=id;this._waitTime=30;this.contents.clear()};Window_SaveInfo.prototype.updateTimer=function(){this._waitTime-=1;if(this._waitTime>0)return;var id=this.savefileId();this._valid=DataManager.isThisGameFile(id);
this._info=DataManager.loadSavefileInfo(id);this.refresh()};Window_SaveInfo.prototype.refresh=function(){this.contents.clear();this.resetFontSettings();var dy=0;dy=this.drawGameTitle(dy);if(!this._valid)return this.drawInvalidText(dy);this._saveContents=StorageManager.load(this.savefileId());this.drawContents(dy)};Window_SaveInfo.prototype.drawGameTitle=function(dy){if(!Yanfly.Param.SaveInfoTitle)return dy;if(!this._info)return dy;if(!this._info.title)return dy;this.resetFontSettings();var text=this._info.title;
this.drawText(text,0,dy,this.contents.width,"center");return dy+this.lineHeight()};Window_SaveInfo.prototype.drawInvalidText=function(dy){this.drawDarkRect(0,dy,this.contents.width,this.contents.height-dy);dy=(this.contents.height-dy-this.lineHeight())/2;if(this._info)var text=Yanfly.Param.SaveInfoInvalid;else var text=Yanfly.Param.SaveInfoEmpty;this.changeTextColor(this.systemColor());this.drawText(text,0,dy,this.contents.width,"center")};Window_SaveInfo.prototype.drawContents=function(dy){if(!this._saveContents)return setTimeout(this.drawContents.bind(this,
dy),50);this._saveContents=JsonEx.parse(this._saveContents);dy=this.drawPartyGraphics(dy);dy=this.drawPartyNames(dy);dy=this.drawPartyLevels(dy);this.drawColumnData(dy)};Window_SaveInfo.prototype.drawPartyGraphics=function(dy){if(Yanfly.Param.SaveInfoPartyType===0)return dy;dy=eval(Yanfly.Param.SaveInfoPartyY);var length=this._saveContents.party.maxBattleMembers();var dw=this.contents.width/length;dw=Math.floor(dw);var dx=Math.floor(dw/2);for(let i=0;i<length;++i){var actorId=this._saveContents.party._actors[i];
var member=this._saveContents.actors._data[actorId];if(member)if(Yanfly.Param.SaveInfoPartyType===1){var name=member.characterName();var index=member.characterIndex();this.drawCharacter(name,index,dx,dy)}else if(Yanfly.Param.SaveInfoPartyType===2){var fh=Window_Base._faceHeight;var fw=Window_Base._faceWidth;var fx=dx-Math.floor(Math.min(fh,dw)/2);var dif=Math.floor(Math.max(0,dw-fw)/2);var name=member.faceName();var index=member.faceIndex();this.drawFace(name,index,fx-dif,dy-fh,dw,fh)}else if(Yanfly.Param.SaveInfoPartyType===
3)this.drawSvActor(member,dx,dy);dx+=dw}return dy};Window_SaveInfo.prototype.drawCharacter=function(name,index,x,y){var bitmap=ImageManager.loadCharacter(name);if(bitmap.width<=0)return setTimeout(this.drawCharacter.bind(this,name,index,x,y),50);Window_Base.prototype.drawCharacter.call(this,name,index,x,y)};Window_SaveInfo.prototype.drawFace=function(name,index,x,y,w,h){var bitmap=ImageManager.loadFace(name);if(bitmap.width<=0)return setTimeout(this.drawFace.bind(this,name,index,x,y,w,h),50);Window_Base.prototype.drawFace.call(this,
name,index,x,y,w,h)};Window_SaveInfo.prototype.drawSvActor=function(actor,x,y){var filename=actor.battlerName();var bitmap=ImageManager.loadSvActor(filename);if(bitmap.width<=0)return setTimeout(this.drawSvActor.bind(this,actor,x,y),50);Window_Base.prototype.drawSvActor.call(this,actor,x,y)};Window_SaveInfo.prototype.drawPartyNames=function(dy){if(!Yanfly.Param.SaveInfoActorName)return dy;this.resetFontSettings();this.contents.fontSize=Yanfly.Param.SaveInfoActorNameSz;var length=this._saveContents.party.maxBattleMembers();
var dw=this.contents.width/length;dw=Math.floor(dw);var dx=0;for(let i=0;i<length;++i){var actorId=this._saveContents.party._actors[i];var member=this._saveContents.actors._data[actorId];if(member){var name=member._name;this.drawText(name,dx,dy,dw,"center")}dx+=dw}return dy+=this.lineHeight()};Window_SaveInfo.prototype.drawPartyLevels=function(dy){if(!Yanfly.Param.SaveInfoActorLv)return dy;this._drawLevel=true;var length=this._saveContents.party.maxBattleMembers();var dw=this.contents.width/length;
dw=Math.floor(dw);var dx=0;var fmt=Yanfly.Param.SaveInfoActorLvFmt;for(let i=0;i<length;++i){var actorId=this._saveContents.party._actors[i];var member=this._saveContents.actors._data[actorId];if(member){var lv=Yanfly.Util.toGroup(member.level);var text=fmt.format(TextManager.levelA,TextManager.level,lv);var tw=this.textWidthEx(text);var dif=Math.floor(Math.max(0,dw-tw)/2);this.drawTextEx(text,dx+dif,dy)}dx+=dw}this._drawLevel=false;return dy+=this.lineHeight()};Window_SaveInfo.prototype.drawColumnData=
function(dy){var totalColumns=0;var drawnArrays=[];if(Yanfly.Param.SaveInfoDataCol1.length>0){totalColumns+=1;drawnArrays.push(Yanfly.Param.SaveInfoDataCol1)}if(Yanfly.Param.SaveInfoDataCol2.length>0){totalColumns+=1;drawnArrays.push(Yanfly.Param.SaveInfoDataCol2)}if(Yanfly.Param.SaveInfoDataCol3.length>0){totalColumns+=1;drawnArrays.push(Yanfly.Param.SaveInfoDataCol3)}if(Yanfly.Param.SaveInfoDataCol4.length>0){totalColumns+=1;drawnArrays.push(Yanfly.Param.SaveInfoDataCol4)}if(totalColumns<=0)return;
var dw=Math.floor(this.contents.width/totalColumns);var dif=totalColumns>1?this.textPadding():0;for(let i=0;i<totalColumns;++i){var column=drawnArrays[i];var dx=i*dw;this.drawColumn(column,dx,dy,dw-dif)}};Window_SaveInfo.prototype.drawColumn=function(column,dx,dy,dw){var length=column.length;var tp=this.textPadding();for(let i=0;i<length;++i){this.resetFontSettings();this.contents.fontSize=Yanfly.Param.SaveInfoDataSz;var data=column[i];if(data.toUpperCase().trim()!=="EMPTY"){this.drawDarkRect(dx,
dy,dw,this.lineHeight());this.drawData(data,dx+tp,dy,dw-tp*2)}dy+=this.lineHeight()}};Window_SaveInfo.prototype.drawData=function(data,dx,dy,dw){if(data.toUpperCase().trim()==="NULL");else if(data.toUpperCase().trim()==="LOCATION")this.drawLocation(dx,dy,dw);else if(data.toUpperCase().trim()==="PLAYTIME")this.drawPlaytime(dx,dy,dw);else if(data.toUpperCase().trim()==="SAVE COUNT")this.drawSaveCount(dx,dy,dw);else if(data.toUpperCase().trim()==="GOLD COUNT")this.drawGoldCount(dx,dy,dw);else if(data.match(/VARIABLE[ ](\d+)/i))this.drawVariable(parseInt(RegExp.$1),
dx,dy,dw);else if(data.match(/(.*)[ ]TEXT:(.*)/i))this.drawDataText(String(RegExp.$1),String(RegExp.$2),dx,dy,dw);else if(data.match(/TEXT:(.*)/i))this.drawDataText("left",String(RegExp.$1),dx,dy,dw)};Window_SaveInfo.prototype.drawLocation=function(dx,dy,dw){var id=this._saveContents.map._mapId;if(Yanfly.Param.SaveMapDisplayName){var text=this._saveContents.map.locationDisplayName||"";if(text.length<=0&&$dataMapInfos[id])text=$dataMapInfos[id].name}else if($dataMapInfos[id])var text=$dataMapInfos[id].name;
else var text="";if(Yanfly.Param.SaveVocabLocation.length>0){this.changeTextColor(this.systemColor());this.drawText(Yanfly.Param.SaveVocabLocation,dx,dy,dw,"left");this.changeTextColor(this.normalColor());this.drawText(text,dx,dy,dw,"right")}else this.drawText(text,dx,dy,dw,"center")};Window_SaveInfo.prototype.drawPlaytime=function(dx,dy,dw){if(!this._info.playtime)return;var text=this._info.playtime;if(Yanfly.Param.SaveVocabPlaytime.length>0){this.changeTextColor(this.systemColor());this.drawText(Yanfly.Param.SaveVocabPlaytime,
dx,dy,dw,"left");this.changeTextColor(this.normalColor());this.drawText(text,dx,dy,dw,"right")}else this.drawText(text,dx,dy,dw,"center")};Window_SaveInfo.prototype.drawSaveCount=function(dx,dy,dw){var text=Yanfly.Util.toGroup(this._saveContents.system._saveCount);if(Yanfly.Param.SaveVocabSaveCount.length>0){this.changeTextColor(this.systemColor());this.drawText(Yanfly.Param.SaveVocabSaveCount,dx,dy,dw,"left");this.changeTextColor(this.normalColor());this.drawText(text,dx,dy,dw,"right")}else this.drawText(text,
dx,dy,dw,"center")};Window_SaveInfo.prototype.drawGoldCount=function(dx,dy,dw){var text=Yanfly.Util.toGroup(this._saveContents.party._gold);if(Yanfly.Param.SaveVocabGoldCount.length>0){this.changeTextColor(this.systemColor());var fmt=Yanfly.Param.SaveVocabGoldCount;this.drawText(fmt.format(TextManager.currencyUnit),dx,dy,dw,"left");this.changeTextColor(this.normalColor());this.drawText(text,dx,dy,dw,"right")}else{var fmt="\\c[0]%1"+this.systemColorEx()+"%2";var ftext=fmt.format(text,TextManager.currencyUnit);
this._drawData=true;var fw=this.textWidthEx(ftext);dx+=Math.max(0,Math.floor((dw-fw)/2));this.drawTextEx(ftext,dx,dy);this._drawData=false}};Window_SaveInfo.prototype.drawVariable=function(id,dx,dy,dw){var varName=$dataSystem.variables[id];varName=varName.replace(/<<(.*?)>>/i,"");var text=Yanfly.Util.toGroup(this._saveContents.variables.value(id));var diff=Math.max(0,(this.standardFontSize()-this.contents.fontSize)/2);if(varName.length>0){this._drawData=true;this.changeTextColor(this.systemColor());
dy+=diff;this.drawTextEx(this.systemColorEx()+varName,dx,dy,dw,"left");dy-=diff;this.changeTextColor(this.normalColor());this._drawData=false;this.drawText(text,dx,dy,dw,"right")}else this.drawText(text,dx,dy,dw,"center")};Window_SaveInfo.prototype.drawDataText=function(align,text,dx,dy,dw){this._drawData=true;dy+=Math.max(0,(this.standardFontSize()-this.contents.fontSize)/2);var align=align.toLowerCase().trim();var text=text.trim();if(align==="left")this.drawTextEx(text,dx,dy);else if(align==="right"){var tw=
this.textWidthEx(text);this.drawTextEx(text,dx+dw-tw,dy)}else{var tw=this.textWidthEx(text);this.drawTextEx(text,dx+(dw-tw)/2,dy)}this._drawData=false};function Window_SaveConfirm(){this.initialize.apply(this,arguments)}Window_SaveConfirm.prototype=Object.create(Window_Command.prototype);Window_SaveConfirm.prototype.constructor=Window_SaveConfirm;Window_SaveConfirm.prototype.initialize=function(){Window_Command.prototype.initialize.call(this,0,0);this.openness=0};Window_SaveConfirm.prototype.makeCommandList=
function(){this.addCommand(Yanfly.Param.SaveConfirmYes,"confirm");this.addCommand(Yanfly.Param.SaveConfirmNo,"cancel")};Window_SaveConfirm.prototype.setData=function(text){this._text=text;var ww=this.textWidthEx(this._text)+this.standardPadding()*2;ww+=this.textPadding()*2;this.width=ww;this.refresh();this.x=(Graphics.boxWidth-this.width)/2;this.y=(Graphics.boxHeight-this.height)/2;this.drawTextEx(this._text,this.textPadding(),0)};Window_SaveConfirm.prototype.itemTextAlign=function(){return"center"};
Window_SaveConfirm.prototype.windowHeight=function(){return this.fittingHeight(3)};Window_SaveConfirm.prototype.itemRect=function(index){var rect=Window_Selectable.prototype.itemRect.call(this,index);rect.y+=this.lineHeight();return rect};Scene_File.prototype.terminate=function(){Scene_MenuBase.prototype.terminate.call(this);if(this._loadSuccess)$gameSystem.onAfterLoad()};Scene_Load.prototype.terminate=function(){Scene_File.prototype.terminate.call(this)};Scene_File.prototype.create=function(){Scene_MenuBase.prototype.create.call(this);
DataManager.loadAllSavefileImages();this.createHelpWindow();this.createListWindow();this.createActionWindow();this.createInfoWindow();this.createConfirmWindow();this._helpWindow.deactivate();this._helpWindow.hide();this._listWindow.opacity=0;this._actionWindow.opacity=0;this._infoWindow.opacity=0};Scene_File.prototype.createHelpWindow=function(){this._helpWindow=new Window_Help(2);this._helpWindow.setText(Yanfly.Param.SaveHelpSelect);this.addWindow(this._helpWindow)};Scene_File.prototype.createListWindow=
function(){var x=0;var y=this._helpWindow.height;var width=240;var height=Graphics.boxHeight-y;this._listWindow=new Window_SavefileList(x,y,width,height);this.addWindow(this._listWindow);this._listWindow.setHandler("ok",this.onSavefileOk.bind(this));this._listWindow.setHandler("cancel",this.popScene.bind(this));this._listWindow.select(this.firstSavefileIndex());this._listWindow.setTopRow(this.firstSavefileIndex()-2);this._listWindow.setMode(this.mode());this._listWindow.refresh()};Scene_File.prototype.createActionWindow=
function(){var x=this._listWindow.width;var y=this._listWindow.y;this._actionWindow=new Window_SaveAction(x,y,this.mode());this.addWindow(this._actionWindow);this._actionWindow.setHelpWindow(this._helpWindow);this._actionWindow.setHandler("load",this.onActionLoad.bind(this));this._actionWindow.setHandler("save",this.onActionSave.bind(this));this._actionWindow.setHandler("delete",this.onActionDelete.bind(this));this._actionWindow.setHandler("cancel",this.onActionCancel.bind(this))};Scene_File.prototype.createInfoWindow=
function(){var x=this._actionWindow.x;var y=this._actionWindow.y+this._actionWindow.height;var width=Graphics.boxWidth-x;var height=Graphics.boxHeight-y;this._infoWindow=new Window_SaveInfo(x,y,width,height,this.mode());this.addWindow(this._infoWindow)};Scene_File.prototype.createConfirmWindow=function(){this._confirmWindow=new Window_SaveConfirm;var win=this._confirmWindow;win.setHandler("confirm",this.onConfirmOk.bind(this));win.setHandler("cancel",this.onConfirmCancel.bind(this));this.addWindow(this._confirmWindow)};
Scene_File.prototype.onSavefileOk=function(){this._actionWindow.activate();if(this.mode()==="load")this._actionWindow.select(0);else if(this.mode()==="save")this._actionWindow.select(1)};Scene_Save.prototype.onSavefileOk=function(){Scene_File.prototype.onSavefileOk.call(this)};Scene_Load.prototype.onSavefileOk=function(){Scene_File.prototype.onSavefileOk.call(this)};Scene_File.prototype.onActionLoad=function(){if(Yanfly.Param.SaveConfirmLoad)this.startConfirmWindow(Yanfly.Param.SaveConfirmLoadTx);
else this.performActionLoad()};Scene_File.prototype.performActionLoad=function(){if(DataManager.loadGame(this.savefileId()))this.onLoadSuccess();else this.onLoadFailure()};Scene_File.prototype.onLoadSuccess=function(){SoundManager.playLoad();this.fadeOutAll();this.reloadMapIfUpdated();SceneManager.goto(Scene_Map);this._loadSuccess=true};Scene_Load.prototype.onLoadSuccess=function(){Scene_File.prototype.onLoadSuccess.call(this)};Scene_File.prototype.onLoadFailure=function(){SoundManager.playBuzzer();
this.onActionCancel()};Scene_Load.prototype.onLoadFailure=function(){Scene_File.prototype.onLoadFailure.call(this)};Scene_File.prototype.reloadMapIfUpdated=function(){if($gameSystem.versionId()===$dataSystem.versionId)return;$gamePlayer.reserveTransfer($gameMap.mapId(),$gamePlayer.x,$gamePlayer.y);$gamePlayer.requestMapReload()};Scene_File.prototype.onActionSave=function(){var id=this.savefileId();if(Yanfly.Param.SaveConfirmSave&&StorageManager.exists(id))this.startConfirmWindow(Yanfly.Param.SaveConfirmSaveTx);
else this.performActionSave()};Scene_File.prototype.performActionSave=function(){$gameSystem.onBeforeSave();if(DataManager.saveGame(this.savefileId()))this.onSaveSuccess();else this.onSaveFailure()};Scene_File.prototype.onSaveSuccess=function(){SoundManager.playSave();StorageManager.cleanBackup(this.savefileId());if(Yanfly.Param.SavePop)this.popScene();else{this._listWindow.refresh();this._actionWindow._currentFile=this.savefileId()-1;this._infoWindow._currentFile=this.savefileId()-1;this.onActionCancel()}};
Scene_Save.prototype.onSaveSuccess=function(){Scene_File.prototype.onSaveSuccess.call(this)};Scene_File.prototype.onSaveFailure=function(){SoundManager.playBuzzer();this.onActionCancel()};Scene_Save.prototype.onSaveFailure=function(){Scene_File.prototype.onSaveFailure.call(this)};Scene_File.prototype.onActionDelete=function(){if(Yanfly.Param.SaveConfirmDel)this.startConfirmWindow(Yanfly.Param.SaveConfirmDelTx);else this.performActionDelete()};Scene_File.prototype.performActionDelete=function(){AudioManager.playSe(Yanfly.Param.SaveDeleteSound);
StorageManager.remove(this.savefileId());this.onActionCancel();this._listWindow.refresh();this._actionWindow._currentFile=this.savefileId()-1;this._infoWindow._currentFile=this.savefileId()-1};Scene_File.prototype.onActionCancel=function(){this._actionWindow.deselect();this._listWindow.activate();this._helpWindow.setText(Yanfly.Param.SaveHelpSelect)};Scene_File.prototype.startConfirmWindow=function(text){SoundManager.playOk();this._confirmWindow.setData(text);this._confirmWindow.open();this._confirmWindow.activate();
this._confirmWindow.select(0)};Scene_File.prototype.onConfirmOk=function(){this._confirmWindow.deactivate();this._confirmWindow.close();if(this._actionWindow.currentSymbol()==="load")setTimeout(this.performActionLoad.bind(this),200);else if(this._actionWindow.currentSymbol()==="save")setTimeout(this.performActionSave.bind(this),200);else if(this._actionWindow.currentSymbol()==="delete")setTimeout(this.performActionDelete.bind(this),200);else this.onConfirmCancel()};Scene_File.prototype.onConfirmCancel=
function(){var index=this._actionWindow.index();this._confirmWindow.deactivate();this._confirmWindow.close();this.onSavefileOk();this._actionWindow.select(index)};Yanfly.Util=Yanfly.Util||{};if(!Yanfly.Util.toGroup)Yanfly.Util.toGroup=function(inVal){return inVal}})();Imported.YEP_BattleEngineCore=true;Yanfly.BEC=Yanfly.BEC||{};Yanfly.BEC.version=1.49;
(()=>{Yanfly.Parameters=PluginManager.parameters("YEP_BattleEngineCore");Yanfly.Param=Yanfly.Param||{};Yanfly.Param.BECSystem=String(Yanfly.Parameters["Default System"]);Yanfly.Param.BECEscRatio=String(Yanfly.Parameters["Escape Ratio"]);Yanfly.Param.BECEscFail=String(Yanfly.Parameters["Fail Escape Boost"]);Yanfly.Param.CastCertHit=Number(Yanfly.Parameters["Certain Hit Animation"]);Yanfly.Param.CastPhysical=Number(Yanfly.Parameters["Physical Animation"]);Yanfly.Param.CastMagical=Number(Yanfly.Parameters["Magical Animation"]);
Yanfly.Param.EnemyAtkAni=Number(Yanfly.Parameters["Enemy Attack Animation"]);Yanfly.Param.BECOptSpeed=String(Yanfly.Parameters["Optimize Speed"]);Yanfly.Param.BECOptSpeed=eval(Yanfly.Param.BECOptSpeed);Yanfly.Param.BECEmergeText=String(Yanfly.Parameters["Show Emerge Text"]);Yanfly.Param.BECEmergeText=eval(Yanfly.Param.BECEmergeText);Yanfly.Param.BECPreEmpText=String(Yanfly.Parameters["Show Pre-Emptive Text"]);Yanfly.Param.BECPreEmpText=eval(Yanfly.Param.BECPreEmpText);Yanfly.Param.BECSurpText=String(Yanfly.Parameters["Show Surprise Text"]);
Yanfly.Param.BECSurpText=eval(Yanfly.Param.BECSurpText);Yanfly.Param.BECPopupOverlap=String(Yanfly.Parameters["Popup Overlap Rate"]);Yanfly.Param.BECPopupOverlap=eval(Yanfly.Param.BECPopupOverlap);Yanfly.Param.BECNewPopBottom=String(Yanfly.Parameters["Newest Popup Bottom"]);Yanfly.Param.BECNewPopBottom=eval(Yanfly.Parameters["Newest Popup Bottom"]);Yanfly.Param.BECStartActCmd=String(Yanfly.Parameters["Start Actor Command"]);Yanfly.Param.BECStartActCmd=eval(Yanfly.Param.BECStartActCmd);Yanfly.Param.BECCurMax=
eval(String(Yanfly.Parameters["Current Max"]));Yanfly.Param.BECSelectHelp=String(Yanfly.Parameters["Select Help Window"]);Yanfly.Param.BECSelectHelp=eval(Yanfly.Param.BECSelectHelp);Yanfly.Param.BECHelpUserTx=String(Yanfly.Parameters["User Help Text"]);Yanfly.Param.BECHelpAllyTx=String(Yanfly.Parameters["Ally Help Text"]);Yanfly.Param.BECHelpAlliesTx=String(Yanfly.Parameters["Allies Help Text"]);Yanfly.Param.BECHelpEnemyTx=String(Yanfly.Parameters["Enemy Help Text"]);Yanfly.Param.BECHelpEnemiesTx=
String(Yanfly.Parameters["Enemies Help Text"]);Yanfly.Param.BECHelpAllTx=String(Yanfly.Parameters["All Help Text"]);Yanfly.Param.BECHelpRandTx=String(Yanfly.Parameters["Random Help Text"]);Yanfly.Param.BECFrontPosX=String(Yanfly.Parameters["Front Position X"]);Yanfly.Param.BECFrontPosY=String(Yanfly.Parameters["Front Position Y"]);Yanfly.Param.BECFrontSprite=String(Yanfly.Parameters["Front Actor Sprite"]);Yanfly.Param.BECFrontSprite=eval(Yanfly.Param.BECFrontSprite);Yanfly.Param.BECFrSpPrio=String(Yanfly.Parameters["Front Sprite Priority"]);
Yanfly.Param.BECHomePosX=String(Yanfly.Parameters["Home Position X"]);Yanfly.Param.BECHomePosY=String(Yanfly.Parameters["Home Position Y"]);Yanfly.Param.BECSideSpPrio=String(Yanfly.Parameters["Side Sprite Priority"]);Yanfly.Param.BECSideSpPrio=eval(Yanfly.Param.BECSideSpPrio);Yanfly.Param.BECAnchorX=Number(Yanfly.Parameters["Default X Anchor"]);Yanfly.Param.BECAnchorY=Number(Yanfly.Parameters["Default Y Anchor"]);Yanfly.Param.BECStepDist=Number(Yanfly.Parameters["Step Distance"]);Yanfly.Param.BECFlinchDist=
Number(Yanfly.Parameters["Flinch Distance"]);Yanfly.Param.BECShowShadows=String(Yanfly.Parameters["Show Shadows"]);Yanfly.Param.BECShowShadows=eval(Yanfly.Param.BECShowShadows);Yanfly.Param.BECPopupDur=Number(Yanfly.Parameters["Popup Duration"]);Yanfly.Param.BECCritPopup=String(Yanfly.Parameters["Critical Popup"]);Yanfly.Param.BECCritDur=Number(Yanfly.Parameters["Critical Duration"]);Yanfly.Param.BECActionSpeed=String(Yanfly.Parameters["Action Speed"]);Yanfly.Param.BECReflectAni=Number(Yanfly.Parameters["Reflect Animation"]);
Yanfly.Param.BECMotionWait=String(Yanfly.Parameters["Motion Waiting"]);Yanfly.Param.BECMotionWait=eval(Yanfly.Param.BECMotionWait);Yanfly.Param.BECTimeStates=String(Yanfly.Parameters["Timed States"]);Yanfly.Param.BECTimeStates=eval(Yanfly.Param.BECTimeStates);Yanfly.Param.BECTimeBuffs=String(Yanfly.Parameters["Timed Buffs"]);Yanfly.Param.BECTimeBuffs=eval(Yanfly.Param.BECTimeBuffs);Yanfly.Param.BECTurnTime=Number(Yanfly.Parameters["Turn Time"]);Yanfly.Param.BECAISelfTurn=eval(String(Yanfly.Parameters["AI Self Turns"]));
Yanfly.Param.BECLowerWindows=String(Yanfly.Parameters["Lower Windows"]);Yanfly.Param.BECLowerWindows=eval(Yanfly.Param.BECLowerWindows);Yanfly.Param.BECSelectMouseOver=eval(String(Yanfly.Parameters["Mouse Over"]));Yanfly.Param.BECEnemySelect=String(Yanfly.Parameters["Visual Enemy Select"]);Yanfly.Param.BECEnemySelect=eval(Yanfly.Param.BECEnemySelect);Yanfly.Param.BECActorSelect=String(Yanfly.Parameters["Visual Actor Select"]);Yanfly.Param.BECActorSelect=eval(Yanfly.Param.BECActorSelect);Yanfly.Param.BECWindowRows=
Number(Yanfly.Parameters["Window Rows"]);Yanfly.Param.BECEnemyFontSize=Number(Yanfly.Parameters["Enemy Font Size"]);Yanfly.Param.BECShowEnemyName=String(Yanfly.Parameters["Show Enemy Name"]);Yanfly.Param.BECShowEnemyName=eval(Yanfly.Param.BECShowEnemyName);Yanfly.Param.BECShowSelectBox=String(Yanfly.Parameters["Show Select Box"]);Yanfly.Param.BECShowSelectBox=eval(Yanfly.Param.BECShowSelectBox);Yanfly.Param.BECEnemyAutoSel=String(Yanfly.Parameters["Enemy Auto Select"]);Yanfly.Param.BECCommandAlign=
String(Yanfly.Parameters["Command Alignment"]);Yanfly.Param.BECCommandRows=Number(Yanfly.Parameters["Command Window Rows"]);Yanfly.Param.BECAniBaseDel=Number(Yanfly.Parameters["Animation Base Delay"]);Yanfly.Param.BECAniNextDel=Number(Yanfly.Parameters["Animation Next Delay"]);Yanfly.Param.BECFullActText=String(Yanfly.Parameters["Show Action Text"]);Yanfly.Param.BECFullActText=eval(Yanfly.Param.BECFullActText);Yanfly.Param.BECShowCntText=String(Yanfly.Parameters["Show Counter Text"]);Yanfly.Param.BECShowCntText=
eval(Yanfly.Param.BECShowCntText);Yanfly.Param.BECShowRflText=String(Yanfly.Parameters["Show Reflect Text"]);Yanfly.Param.BECShowRflText=eval(Yanfly.Param.BECShowRflText);Yanfly.Param.BECShowSubText=String(Yanfly.Parameters["Show Substitute Text"]);Yanfly.Param.BECShowSubText=eval(Yanfly.Param.BECShowSubText);Yanfly.Param.BECShowFailText=String(Yanfly.Parameters["Show Fail Text"]);Yanfly.Param.BECShowFailText=eval(Yanfly.Param.BECShowFailText);Yanfly.Param.BECShowCritText=String(Yanfly.Parameters["Show Critical Text"]);
Yanfly.Param.BECShowCritText=eval(Yanfly.Param.BECShowCritText);Yanfly.Param.BECShowMissText=String(Yanfly.Parameters["Show Miss Text"]);Yanfly.Param.BECShowMissText=eval(Yanfly.Param.BECShowMissText);Yanfly.Param.BECShowEvaText=String(Yanfly.Parameters["Show Evasion Text"]);Yanfly.Param.BECShowEvaText=eval(Yanfly.Param.BECShowEvaText);Yanfly.Param.BECShowHpText=String(Yanfly.Parameters["Show HP Text"]);Yanfly.Param.BECShowHpText=eval(Yanfly.Param.BECShowHpText);Yanfly.Param.BECShowMpText=String(Yanfly.Parameters["Show MP Text"]);
Yanfly.Param.BECShowMpText=eval(Yanfly.Param.BECShowMpText);Yanfly.Param.BECShowTpText=String(Yanfly.Parameters["Show TP Text"]);Yanfly.Param.BECShowTpText=eval(Yanfly.Param.BECShowTpText);Yanfly.Param.BECShowStateText=String(Yanfly.Parameters["Show State Text"]);Yanfly.Param.BECShowStateText=eval(Yanfly.Param.BECShowStateText);Yanfly.Param.BECShowBuffText=String(Yanfly.Parameters["Show Buff Text"]);Yanfly.Param.BECShowBuffText=eval(Yanfly.Param.BECShowBuffText);Yanfly.BEC.DataManager_isDatabaseLoaded=
DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=function(){if(!Yanfly.BEC.DataManager_isDatabaseLoaded.call(this))return false;if(!Yanfly._loaded_YEP_BattleEngineCore){this.processMELODYNotetags($dataSkills);this.processMELODYNotetags($dataItems);this.processBECNotetags1($dataSkills);this.processBECNotetags2($dataSkills);this.processBECNotetags2($dataItems);this.processBECNotetags3($dataEnemies);this.processBECNotetags4($dataActors);this.processBECNotetags4($dataClasses);this.processBECNotetags4($dataWeapons);
this.processBECNotetags4($dataArmors);this.processBECNotetags4($dataEnemies);this.processBECNotetags4($dataStates);this.processBECNotetags5($dataActors,true);this.processBECNotetags5($dataClasses,false);this.processBECNotetags5($dataWeapons,false);this.processBECNotetags5($dataArmors,false);this.processBECNotetags5($dataStates,false);this.processBECNotetags6($dataStates);Yanfly._loaded_YEP_BattleEngineCore=true}return true};DataManager.processMELODYNotetags=function(group){for(let n=1;n<group.length;n++){const obj=
group[n];if(obj.actionsMade)continue;obj.actionsMade=true;const notedata=obj.note.split(/[\r\n]+/);let actionType=0;this.setDefaultActions(obj);for(let i=0;i<notedata.length;i++){const line=notedata[i];if(line.match(/<(?:SETUP ACTION|setup)>/i)){actionType=1;obj.setupActions=[]}else if(line.match(/<\/(?:SETUP ACTION|setup)>/i))actionType=0;else if(line.match(/<(?:WHOLE ACTION|whole)>/i)){actionType=2;obj.wholeActions=[]}else if(line.match(/<\/(?:WHOLE ACTION|whole)>/i))actionType=0;else if(line.match(/<(?:TARGET ACTION|target)>/i)){actionType=
3;obj.targetActions=[]}else if(line.match(/<\/(?:TARGET ACTION|target)>/i))actionType=0;else if(line.match(/<(?:FOLLOW ACTION|follow)>/i)){actionType=4;obj.followActions=[]}else if(line.match(/<\/(?:FOLLOW ACTION|follow)>/i))actionType=0;else if(line.match(/<(?:FINISH ACTION|finish)>/i)){actionType=5;obj.finishActions=[]}else if(line.match(/<\/(?:FINISH ACTION|finish)>/i))actionType=0;else this.convertSequenceLine(obj,line,actionType)}}};Yanfly.BEC.DefaultActionSetup=[["CLEAR BATTLE LOG"],["DISPLAY ACTION"],
["IMMORTAL",["TARGETS","TRUE"]],["PERFORM START"],["WAIT FOR MOVEMENT"],["CAST ANIMATION"],["WAIT FOR ANIMATION"]];Yanfly.BEC.DefaultActionWhole=[["PERFORM ACTION"]];Yanfly.BEC.DefaultActionTarget=[["PERFORM ACTION"]];if(Yanfly.Param.BECMotionWait){Yanfly.BEC.DefaultActionWhole.push(["MOTION WAIT",["USER"]]);Yanfly.BEC.DefaultActionTarget.push(["MOTION WAIT",["USER"]])}else{Yanfly.BEC.DefaultActionWhole.push(["WAIT",[10]]);Yanfly.BEC.DefaultActionTarget.push(["WAIT",[10]])}Yanfly.BEC.DefaultActionWhole.push(["ACTION ANIMATION"]);
Yanfly.BEC.DefaultActionWhole.push(["WAIT FOR ANIMATION"]);Yanfly.BEC.DefaultActionTarget.push(["ACTION ANIMATION"]);Yanfly.BEC.DefaultActionTarget.push(["WAIT FOR ANIMATION"]);Yanfly.BEC.DefaultActionFollow=[];Yanfly.BEC.DefaultActionFinish=[["IMMORTAL",["TARGETS","FALSE"]],["WAIT FOR NEW LINE"],["CLEAR BATTLE LOG"],["PERFORM FINISH"],["WAIT FOR MOVEMENT"],["WAIT FOR EFFECT"],["ACTION COMMON EVENT"]];DataManager.setDefaultActions=function(obj){obj.setupActions=Yanfly.BEC.DefaultActionSetup.slice();
if(this.isWholeAction(obj)){obj.wholeActions=Yanfly.BEC.DefaultActionWhole.slice();this.addActionEffects(obj,obj.wholeActions);obj.targetActions=[]}else{obj.wholeActions=[];obj.targetActions=Yanfly.BEC.DefaultActionTarget.slice();this.addActionEffects(obj,obj.targetActions)}obj.followActions=Yanfly.BEC.DefaultActionFollow.slice();obj.finishActions=Yanfly.BEC.DefaultActionFinish.slice()};DataManager.isWholeAction=(obj)=>{if(obj.animationId>0&&$dataAnimations[obj.animationId]){const animation=$dataAnimations[obj.animationId];
if(animation.position===3)return true;if(animation.position!==3&&[2,8,10].contains(obj.scope))return true}return false};DataManager.addActionEffects=(obj,array)=>{for(;;){array[array.length]=["ACTION EFFECT"];array[array.length]=["DEATH BREAK"];obj.repeats-=1;if(obj.repeats<=0)break;array[array.length]=["WAIT",[8]]}obj.repeats=1};Yanfly.BEC.SeqType6=/[ ]*(.*):[ ](.*),[ ](.*),[ ](.*),[ ](.*),[ ](.*),[ ](.*)/i;Yanfly.BEC.SeqType5=/[ ]*(.*):[ ](.*),[ ](.*),[ ](.*),[ ](.*),[ ](.*)/i;Yanfly.BEC.SeqType4=
/[ ]*(.*):[ ](.*),[ ](.*),[ ](.*),[ ](.*)/i;Yanfly.BEC.SeqType3=/[ ]*(.*):[ ](.*),[ ](.*),[ ](.*)/i;Yanfly.BEC.SeqType2=/[ ]*(.*):[ ](.*),[ ](.*)/i;Yanfly.BEC.SeqType1=/[ ]*(.*):[ ](.*)/i;Yanfly.BEC.SeqType0=/[ ]*(.*)/i;DataManager.convertSequenceLine=(obj,line,actionType)=>{if(actionType<=0||actionType>5)return;let seqArgs;if(line.match(Yanfly.BEC.SeqType6)){Yanfly.BEC.SeqType=RegExp.$1;seqArgs=[RegExp.$2,RegExp.$3,RegExp.$4,RegExp.$5,RegExp.$6,RegExp.$7]}else if(line.match(Yanfly.BEC.SeqType5)){Yanfly.BEC.SeqType=
RegExp.$1;seqArgs=[RegExp.$2,RegExp.$3,RegExp.$4,RegExp.$5,RegExp.$6]}else if(line.match(Yanfly.BEC.SeqType4)){Yanfly.BEC.SeqType=RegExp.$1;seqArgs=[RegExp.$2,RegExp.$3,RegExp.$4,RegExp.$5]}else if(line.match(Yanfly.BEC.SeqType3)){Yanfly.BEC.SeqType=RegExp.$1;seqArgs=[RegExp.$2,RegExp.$3,RegExp.$4]}else if(line.match(Yanfly.BEC.SeqType2)){Yanfly.BEC.SeqType=RegExp.$1;seqArgs=[RegExp.$2,RegExp.$3]}else if(line.match(Yanfly.BEC.SeqType1)){Yanfly.BEC.SeqType=RegExp.$1;seqArgs=[RegExp.$2]}else if(line.match(Yanfly.BEC.SeqType0)){Yanfly.BEC.SeqType=
RegExp.$1;seqArgs=[]}else return;const array=[Yanfly.BEC.SeqType,seqArgs];if(actionType===1)obj.setupActions[obj.setupActions.length]=array;if(actionType===2)obj.wholeActions[obj.wholeActions.length]=array;if(actionType===3)obj.targetActions[obj.targetActions.length]=array;if(actionType===4)obj.followActions[obj.followActions.length]=array;if(actionType===5)obj.finishActions[obj.finishActions.length]=array};DataManager.processBECNotetags1=(group)=>{const note1=/<(?:CAST ANIMATION|cast ani):[ ](\d+)>/i;
for(let n=1;n<group.length;n++){const obj=group[n];const notedata=obj.note.split(/[\r\n]+/);obj.castAnimation=0;if(obj.hitType===0)obj.castAnimation=Yanfly.Param.CastCertHit;if(obj.hitType===1)obj.castAnimation=Yanfly.Param.CastPhysical;if(obj.hitType===2)obj.castAnimation=Yanfly.Param.CastMagical;for(let i=0;i<notedata.length;i++){const line=notedata[i];if(line.match(note1))obj.castAnimation=parseInt(RegExp.$1)}}};DataManager.processBECNotetags2=(group)=>{const note1=/<(?:ACTION COPY):[ ](.*):[ ]*(\d+)>/i;
const note2=/<(?:SPEED):[ ]([\+\-]\d+)>/i;const note3=/<(?:DISPLAY NAME|DISPLAY TEXT):[ ](.*)>/i;const note4=/<(?:DISPLAY ICON):[ ](\d+)>/i;for(let n=1;n<group.length;n++){const obj=group[n];const notedata=obj.note.split(/[\r\n]+/);obj.battleDisplayText=obj.name;obj.battleDisplayIcon=obj.iconIndex;for(let i=0;i<notedata.length;i++){const line=notedata[i];if(line.match(note1)){const text=String(RegExp.$1).toUpperCase();let target;if(["I","ITEM"].contains(text))target=$dataItems[parseInt(RegExp.$2)];
else if(["S","SKILL"].contains(text))target=$dataSkills[parseInt(RegExp.$2)];if(target){obj.setupActions=target.setupActions.slice();obj.wholeActions=target.wholeActions.slice();obj.targetActions=target.targetActions.slice();obj.followActions=target.followActions.slice();obj.finishActions=target.finishActions.slice()}}else if(line.match(note2))obj.speed=parseInt(RegExp.$1);else if(line.match(note3))obj.battleDisplayText=String(RegExp.$1);else if(line.match(note4))obj.battleDisplayIcon=parseInt(RegExp.$1)}}};
DataManager.processBECNotetags3=(group)=>{const note1=/<(?:ATTACK ANIMATION|attack ani):[ ](\d+)>/i;for(let n=1;n<group.length;n++){const obj=group[n];const notedata=obj.note.split(/[\r\n]+/);obj.attackAnimationId=Yanfly.Param.EnemyAtkAni;for(let i=0;i<notedata.length;i++){const line=notedata[i];if(line.match(note1))obj.attackAnimationId=parseInt(RegExp.$1)}}};DataManager.processBECNotetags4=(group)=>{const note1=/<(?:REFLECT ANIMATION|reflect ani):[ ](\d+)>/i;for(let n=1;n<group.length;n++){const obj=
group[n];const notedata=obj.note.split(/[\r\n]+/);obj.reflectAnimationId=0;obj.spriteCannotMove=false;for(let i=0;i<notedata.length;i++){const line=notedata[i];if(line.match(note1))obj.reflectAnimationId=parseInt(RegExp.$1);else if(line.match(/<(?:SPRITE CANNOT MOVE)>/i))obj.spriteCannotMove=true}}};DataManager.processBECNotetags5=(group,isActor)=>{for(let n=1;n<group.length;n++){const obj=group[n];const notedata=obj.note.split(/[\r\n]+/);if(isActor){obj.anchorX=Yanfly.Param.BECAnchorX;obj.anchorY=
Yanfly.Param.BECAnchorY}for(let i=0;i<notedata.length;i++){const line=notedata[i];if(line.match(/<(?:ANCHOR X):[ ](\d+)[.](\d+)>/i))obj.anchorX=eval(`${String(RegExp.$1)}.${String(RegExp.$2)}`);else if(line.match(/<(?:ANCHOR Y):[ ](\d+)[.](\d+)>/i))obj.anchorY=eval(`${String(RegExp.$1)}.${String(RegExp.$2)}`)}}};DataManager.processBECNotetags6=(group)=>{let turns2;let turns1;let turns;const note1a=/<(?:ACTION START):[ ](\d+)>/i;const note1b=/<(?:ACTION START):[ ](\d+)[ ](?:THROUGH|to)[ ](\d+)>/i;
const note2a=/<(?:TURN START):[ ](\d+)>/i;const note2b=/<(?:TURN START):[ ](\d+)[ ](?:THROUGH|to)[ ](\d+)>/i;for(let n=1;n<group.length;n++){const obj=group[n];const notedata=obj.note.split(/[\r\n]+/);for(let i=0;i<notedata.length;i++){const line=notedata[i];if(line.match(note1a)){turns=parseInt(RegExp.$1);obj.autoRemovalTiming=3;obj.maxTurns=turns;obj.minTurns=turns}else if(line.match(note1b)){turns1=parseInt(RegExp.$1);turns2=parseInt(RegExp.$2);obj.autoRemovalTiming=3;obj.maxTurns=turns1;obj.minTurns=
turns2}else if(line.match(note2a)){turns=parseInt(RegExp.$1);obj.autoRemovalTiming=4;obj.maxTurns=turns;obj.minTurns=turns}else if(line.match(note2b)){turns1=parseInt(RegExp.$1);turns2=parseInt(RegExp.$2);obj.autoRemovalTiming=4;obj.maxTurns=turns1;obj.minTurns=turns2}}}};Yanfly.BEC.TouchInput_onMouseMove=TouchInput._onMouseMove;TouchInput._onMouseMove=function(event){Yanfly.BEC.TouchInput_onMouseMove.call(this,event);this._mouseOverX=Graphics.pageToCanvasX(event.pageX);this._mouseOverY=Graphics.pageToCanvasY(event.pageY)};
Yanfly.BEC.BattleManager_initMembers=BattleManager.initMembers;BattleManager.initMembers=function(){Yanfly.BEC.BattleManager_initMembers.call(this);this._forceSelection=false;this._allSelection=false;this._victoryPhase=false;this._forceActionQueue=[]};BattleManager.isBattleSystem=(value)=>value.toLowerCase()===$gameSystem.getBattleSystem();BattleManager.isDTB=function(){return this.isBattleSystem("dtb")};BattleManager.isTurnBased=function(){return!!this.isDTB()};BattleManager.isTickBased=function(){return!this.isTurnBased()};
BattleManager.tickRate=()=>1;BattleManager.forceSelection=function(){this._forceSelection=true};BattleManager.isForceSelection=function(){return this._forceSelection};BattleManager.resetSelection=function(){this._forceSelection=false};BattleManager.startAllSelection=function(){this._allSelection=true};BattleManager.isAllSelection=function(){return this._allSelection&&BattleManager.isInputting()};BattleManager.stopAllSelection=function(){this._allSelection=false};Yanfly.BEC.BattleManager_makeEscapeRatio=
BattleManager.makeEscapeRatio;BattleManager.makeEscapeRatio=function(){if(this.isDTB()){let code=Yanfly.Param.BECEscRatio;try{this._escapeRatio=eval(code)}catch(e){this._escapeRatio=0;Yanfly.Util.displayError(e,code,"ESCAPE RATIO FORMULA ERROR")}code=Yanfly.Param.BECEscFail;try{this._escapeFailBoost=eval(code)}catch(e){this._escapeFailBoost=0;Yanfly.Util.displayError(e,code,"ESCAPE FAIL BOOST FORMULA ERROR")}}else{this._escapeFailBoost=.1;Yanfly.BEC.BattleManager_makeEscapeRatio.call(this)}};BattleManager.timeBasedStates=
function(){if(!$gameParty.inBattle())return false;if(this.isTurnBased())return false;if(this._timeBasedStates!==undefined)return this._timeBasedStates;this._timeBasedStates=Yanfly.Param.BECTimeStates;return this._timeBasedStates};BattleManager.timeBasedBuffs=function(){if(!$gameParty.inBattle())return false;if(this.isTurnBased())return false;if(this._timeBasedBuffs!==undefined)return this._timeBasedBuffs;this._timeBasedBuffs=Yanfly.Param.BECTimeBuffs;return this._timeBasedBuffs};BattleManager.displayStartMessages=
function(){if(Yanfly.Param.BECEmergeText)$gameTroop.enemyNames().forEach((name)=>{$gameMessage.add(TextManager.emerge.format(name))});if(this._preemptive&&Yanfly.Param.BECPreEmpText)$gameMessage.add(TextManager.preemptive.format($gameParty.name()));else if(this._surprise&&Yanfly.Param.BECSurpText)$gameMessage.add(TextManager.surprise.format($gameParty.name()))};BattleManager.registerSprite=function(battler,sprite){let id;if(!this._registeredSprites)this._registeredSprites={};if(battler.isActor())id=
1E5+battler.actorId();if(battler.isEnemy())id=2E5+battler.index();this._registeredSprites[id]=sprite};BattleManager.getSprite=function(battler){let id;if(!this._registeredSprites)this._registeredSprites={};if(battler.isActor())id=1E5+battler.actorId();if(battler.isEnemy())id=2E5+battler.index();return this._registeredSprites[id]};BattleManager.setSpritePriority=function(){if($gameSystem.isSideView())this._spritePriority=Yanfly.Param.BECSideSpPrio;else this._spritePriority=Yanfly.Param.BECFrontSprite;
if(this._spritePriority===false)this._spritePriority=0;if(this._spritePriority===true)this._spritePriority=1};BattleManager.getSpritePriority=function(){if(!this._spritePriority)this.setSpritePriority();return this._spritePriority};BattleManager.changeActor=function(newActorIndex,lastActorActionState){const lastActor=this.actor();this._actorIndex=newActorIndex;const newActor=this.actor();if(lastActor){lastActor.setActionState(lastActorActionState);lastActor.spriteReturnHome()}if(newActor){newActor.setActionState("inputting");
newActor.spriteStepForward()}};BattleManager.createActions=()=>{$gameParty.createActions();$gameTroop.createActions()};BattleManager.clearInputtingAction=function(){if(this.inputtingAction())this.inputtingAction().clear()};Yanfly.BEC.BattleManager_checkBattleEnd=BattleManager.checkBattleEnd;BattleManager.checkBattleEnd=function(){if(this._phase==="actionList")return false;if(this._phase==="actionTargetList")return false;if(this._phase==="action")return false;if(this._phase==="phaseChange")return false;
if($gameTroop.isEventRunning())return false;return Yanfly.BEC.BattleManager_checkBattleEnd.call(this)};Yanfly.BEC.BattleManager_processTurn=BattleManager.processTurn;BattleManager.processTurn=function(){this._processTurn=true;Yanfly.BEC.BattleManager_processTurn.call(this);this._processTurn=false};Yanfly.BEC.BattleManager_processVictory=BattleManager.processVictory;BattleManager.processVictory=function(){this._victoryPhase=true;if(this._windowLayer)this._windowLayer.x=0;Yanfly.BEC.BattleManager_processVictory.call(this)};
BattleManager.processEscape=function(){$gameParty.performEscape();SoundManager.playEscape();let success=this._preemptive?true:Math.random()<this._escapeRatio;if($gamePlayer.isDebugThrough())success=true;if(success){$gameParty.performEscapeSuccess();this.displayEscapeSuccessMessage();this._escaped=true;this.processAbort()}else{this.displayEscapeFailureMessage();this._escapeRatio+=this._escapeFailBoost;$gameParty.clearActions();this.startTurn()}return success};Yanfly.BEC.BattleManager_processAbort=
BattleManager.processAbort;BattleManager.processAbort=function(){$gameParty.removeBattleStates();Yanfly.BEC.BattleManager_processAbort.call(this)};BattleManager.refreshAllMembers=()=>{$gameParty.refreshMembers();$gameTroop.refreshMembers()};BattleManager.startTurn=function(){this._enteredEndPhase=false;this._phase="turn";this.clearActor();$gameTroop.increaseTurn();$gameParty.onTurnStart();$gameTroop.onTurnStart();this._performedBattlers=[];this.makeActionOrders();$gameParty.requestMotionRefresh();
this._logWindow.startTurn();this._subject=this.getNextSubject()};Yanfly.BEC.BattleManager_endTurn=BattleManager.endTurn;BattleManager.endTurn=function(){if(this.isTurnBased()&&this._spriteset.isPopupPlaying())return;if(this.isTurnBased()&&this._enteredEndPhase){this._phase="turnEnd";this._preemptive=false;this._surprise=false;return}this._enteredEndPhase=true;Yanfly.BEC.BattleManager_endTurn.call(this);BattleManager.refreshAllMembers()};BattleManager.getNextSubject=function(){if($gameTroop.turnCount()<=
0)return;this._performedBattlers=this._performedBattlers||[];this.makeActionOrders();for(;;){const battlerArray=[];for(let i=0;i<this._actionBattlers.length;++i){const obj=this._actionBattlers[i];if(!this._performedBattlers.contains(obj))battlerArray.push(obj)}this._actionBattlers=battlerArray;const battler=this._actionBattlers.shift();if(!battler)return null;if(battler.isBattleMember()&&battler.isAlive()){this.pushPerformedBattler(battler);return battler}}};BattleManager.pushPerformedBattler=function(battler){this._performedBattlers.push(battler)};
BattleManager.update=function(){if(!this.isBusy()&&!this.updateEvent())switch(this._phase){case "start":this.startInput();break;case "turn":this.updateTurn();break;case "action":this.updateAction();break;case "phaseChange":this.updatePhase();break;case "actionList":this.updateActionList();break;case "actionTargetList":this.updateActionTargetList();break;case "turnEnd":this.updateTurnEnd();break;case "battleEnd":this.updateBattleEnd();break}};BattleManager.updateEvent=function(){if(this._processingForcedAction)return false;
switch(this._phase){case "start":case "turn":case "turnEnd":case "actionList":case "actionTargetList":if(this.isActionForced()){this.processForcedAction();return true}else return this.updateEventMain()}return this.checkAbort()};BattleManager.queueForceAction=function(user,skillId,target){let targetIndex;if(target===undefined)targetIndex=0;else if(typeof target==="number")targetIndex=target;else targetIndex=target.index();const param=[user.isEnemy()?0:1,user.isActor()?user.actorId():user.index(),skillId,
targetIndex];const command={code:339,indent:0,parameters:param};$gameTemp.forceActionQueue(command);this.clearResults();if(this.isTickBased())this._phase="action"};BattleManager.addText=function(text,wait){if(!SceneManager._scene._logWindow)return;wait=wait||0;SceneManager._scene._logWindow.addText(text);if(wait<=0)return;const last=this._actionList[this._actionList.length-1];if(last&&last[0]==="WAIT")return;this._actionList.push(["WAIT",[wait]])};BattleManager.clearResults=function(){const group=
this.allBattleMembers();const length=group.length;for(let i=0;i<length;++i){const member=group[i];if(member)member.clearResult()}this._allTargets=[];this._targets=[];this._target=undefined};Yanfly.BEC.BattleManager_forceAction=BattleManager.forceAction;BattleManager.forceAction=function(battler){if(this._subject)this._subject.clearResult();this.createForceActionFailSafes();this.savePreForceActionSettings();Yanfly.BEC.BattleManager_forceAction.call(this,battler)};BattleManager.createForceActionFailSafes=
function(){this._actionList=this._actionList||[];this._targets=this._targets||[];this._allTargets=this._allTargets||[];this._individualTargets=this._individualTargets||[];this._phaseSteps=this._phaseSteps||[];this._conditionFlags=this._conditionFlags||[];this._trueFlags=this._trueFlags||[]};BattleManager.savePreForceActionSettings=function(){const settings=this.setPreForceActionSettings();this._forceActionQueue.push(settings)};BattleManager.setPreForceActionSettings=function(){return{subject:this._subject,
action:JsonEx.makeDeepCopy(this._action),actionList:JsonEx.makeDeepCopy(this._actionList),targets:this._targets.slice(),allTargets:this._allTargets.slice(),indTargets:this._individualTargets.slice(),phaseSteps:JsonEx.makeDeepCopy(this._phaseSteps),returnPhase:this._returnPhase,phase:this._phase,conditionFlags:JsonEx.makeDeepCopy(this._conditionFlags),trueFlags:JsonEx.makeDeepCopy(this._trueFlags)}};BattleManager.loadPreForceActionSettings=function(){const settings=this._forceActionQueue[0];if(settings){this._forceActionQueue.shift();
this.resetPreForceActionSettings(settings);return this._subject&&this._subject.isAppeared()}else return false};BattleManager.resetPreForceActionSettings=function(settings){this._subject=settings["subject"];this._action=settings["action"];this._actionList=settings["actionList"];this._targets=settings["targets"];this._allTargets=settings["allTargets"];this._individualTargets=settings["indTargets"];this._phaseSteps=settings["phaseSteps"];this._returnPhase=settings["returnPhase"];this._conditionFlags=
settings["conditionFlags"];this._trueFlags=settings["trueFlags"];this._phase=settings["phase"]};Yanfly.BEC.BattleManager_processForcedAction=BattleManager.processForcedAction;BattleManager.processForcedAction=function(){if(this._actionForcedBattler){this._preForcePhase=this._phase;this._processingForcedAction=true}Yanfly.BEC.BattleManager_processForcedAction.call(this)};BattleManager.setTargets=function(array){this._targets=[];const max=array.length;for(let i=0;i<max;++i){const target=array[i];if(target)this._targets.push(target)}};
BattleManager.updateAction=function(){const target=this._targets.shift();if(target)this.invokeAction(this._subject,target);else if(this._returnPhase==="target"){this.setTargets([this._individualTargets[0]]);this._phase="actionTargetList"}else{this.setTargets(this._allTargets.slice());this._phase="actionList"}};BattleManager.invokeAction=function(subject,target){if(!Yanfly.Param.BECOptSpeed)this._logWindow.push("pushBaseLine");if(Math.random()<this._action.itemMrf(target))this.invokeMagicReflection(subject,
target);else if(Math.random()<this._action.itemCnt(target))this.invokeCounterAttack(subject,target);else this.invokeNormalAction(subject,target);if(subject)subject.setLastTarget(target);if(!Yanfly.Param.BECOptSpeed)this._logWindow.push("popBaseLine")};BattleManager.invokeCounterAttack=function(subject,target){const action=new Game_Action(target);this._logWindow.displayCounter(target);action.setAttack();action.apply(subject);this._logWindow.displayActionResults(target,subject);if(subject.isDead())subject.performCollapse()};
Yanfly.BEC.BattleManager_invokeMagicReflection=BattleManager.invokeMagicReflection;BattleManager.invokeMagicReflection=function(subject,target){Yanfly.BEC.BattleManager_invokeMagicReflection.call(this,subject,target);if(subject.isDead())subject.performCollapse()};BattleManager.updatePhase=function(){const phase=this._phaseSteps.shift();if(phase)this.createPhaseChanges();switch(phase){case "setup":this.createSetupActions();break;case "whole":this.createWholeActions();break;case "target":this.createTargetActions();
break;case "follow":this.createFollowActions();break;case "finish":this.createFinishActions();break;default:this.endAction();break}};BattleManager.createPhaseChanges=function(){this._phase="actionList";this.setTargets(this._allTargets.slice());this._conditionFlags=[];this._trueFlags=[]};BattleManager.createSetupActions=function(){$gameTemp.clearActionSequenceSettings();this._returnPhase="setup";this._actionList=this._action.item().setupActions.slice()};BattleManager.createWholeActions=function(){this._returnPhase=
"whole";this._actionList=this._action.item().wholeActions.slice()};BattleManager.createTargetActions=function(){this._returnPhase="target";this._phase="actionTargetList";this.setTargets([this._individualTargets[0]]);this._actionList=this._action.item().targetActions.slice()};BattleManager.createFollowActions=function(){this._returnPhase="follow";this._actionList=this._action.item().followActions.slice()};BattleManager.createFinishActions=function(){this._returnPhase="finish";this._actionList=this._action.item().finishActions.slice()};
Yanfly.BEC.BattleManager_endAction=BattleManager.endAction;BattleManager.endAction=function(){if(this._subject)this._subject.onAllActionsEnd();if(this._processingForcedAction){this._subject.removeCurrentAction();this._phase=this._preForcePhase}this._processingForcedAction=false;if(this.loadPreForceActionSettings())return;Yanfly.BEC.BattleManager_endAction.call(this)};BattleManager.updateActionList=function(){for(;;){this._actSeq=this._actionList.shift();if(this._actSeq){if(!this.actionConditionsMet(this._actSeq))continue;
const seqName=this._actSeq[0].toUpperCase();if(!this.processActionSequenceCheck(seqName,this._actSeq[1]))break}else{this._phase="phaseChange";break}}};BattleManager.updateActionTargetList=function(){for(;;){this._actSeq=this._actionList.shift();if(this._actSeq){if(!this.actionConditionsMet(this._actSeq))continue;const seqName=this._actSeq[0].toUpperCase();if(!this.processActionSequenceCheck(seqName,this._actSeq[1]))break}else if(this._individualTargets.length>0){this._individualTargets.shift();if(this._individualTargets.length>
0){this.setTargets([this._individualTargets[0]]);this._actionList=this._action.item().targetActions.slice()}else{this._phase="phaseChange";break}}else{this._phase="phaseChange";break}}};BattleManager.updateActionTargetList=function(){for(;;){this._actSeq=this._actionList.shift();if(this._actSeq){if(!this.actionConditionsMet(this._actSeq))continue;const seqName=this._actSeq[0].toUpperCase();if(!this.processActionSequenceCheck(seqName,this._actSeq[1]))break}else if(this._individualTargets.length>0){this._individualTargets.shift();
if(this._individualTargets.length>0){this.setTargets([this._individualTargets[0]]);this._actionList=this._action.item().targetActions.slice()}else{this._phase="phaseChange";break}}else{this._phase="phaseChange";break}}};BattleManager.startAction=function(){const subject=this._subject;if(!subject)return this.endAction();const action=subject.currentAction();this._action=action;if(!this._action)return this.endAction();if(!this._action.item())return this.endAction();const targets=action.makeTargets();
this.setTargets(targets);this._allTargets=targets.slice();this._individualTargets=targets.slice();this._phase="phaseChange";this._phaseSteps=["setup","whole","target","follow","finish"];this._returnPhase="";this._actionList=[];subject.useItem(this._action.item());this._action.applyGlobal();this._logWindow.startAction(this._subject,this._action,this._targets)};BattleManager.processActionSequenceCheck=function(actionName,actionArgs){if(actionName.match(/IF[ ](.*)/i))return this.actionIfConditions(actionName,
actionArgs);return this.processActionSequence(actionName,actionArgs)};BattleManager.processActionSequence=function(actionName,actionArgs){if(actionName==="")return true;if(actionName==="ACTION ANIMATION")return this.actionActionAnimation(actionArgs);if(actionName==="ACTION COMMON EVENT")return this.actionActionCommonEvent();if(actionName==="ACTION EFFECT")return this.actionActionEffect(actionArgs);if(["ANI WAIT","ANIWAIT","ANIMATION WAIT"].contains(actionName))return this.actionAniWait(actionArgs[0]);
if(actionName==="CAST ANIMATION")return this.actionCastAnimation();if(actionName==="CLEAR BATTLE LOG")return this.actionClearBattleLog();if(actionName==="DEATH BREAK")return this.actionDeathBreak();if(actionName==="DISPLAY ACTION")return this.actionDisplayAction();if(actionName==="IMMORTAL")return this.actionImmortal(actionArgs);if(actionName==="MOTION WAIT")return this.actionMotionWait(actionArgs);if(actionName==="PERFORM ACTION")return this.actionPerformAction();if(actionName==="PERFORM FINISH")return this.actionPerformFinish();
if(actionName==="PERFORM START")return this.actionPerformStart();if(actionName==="WAIT")return this.actionWait(actionArgs[0]);if(actionName==="WAIT FOR ANIMATION")return this.actionWaitForAnimation();if(actionName==="WAIT FOR EFFECT")return this.actionWaitForEffect();if(actionName==="WAIT FOR MOVEMENT")return this.actionWaitForMovement();if(actionName==="WAIT FOR NEW LINE")return this.actionWaitForNewLine();if(actionName==="WAIT FOR POPUPS")return this.actionWaitForPopups();return false};BattleManager.makeActionTargets=
function(string){let target;let group;const targets=[];string=string.toUpperCase();if(["SUBJECT","USER"].contains(string))return[this._subject];if(["TARGET","TARGETS"].contains(string)){group=this._targets;for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["ACTORS","EXISTING ACTORS","ALIVE ACTORS"].contains(string)){group=$gameParty.aliveMembers();for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["ACTORS ALL",
"ALL ACTORS","PARTY"].contains(string)){group=$gameParty.battleMembers();for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["DEAD ACTORS","DEAD ACTOR"].contains(string)){group=$gameParty.deadMembers();for(let i=0;i<group.length;++i){target=group[i];if(target)targets.push(target)}return targets}if(["ACTORS NOT USER","ACTORS NOT SUBJECT"].contains(string)){group=$gameParty.aliveMembers();for(let i=0;i<group.length;++i){target=group[i];
if(target&&target!==this._subject&&target.isAppeared())targets.push(target)}return targets}if(["ENEMIES","EXISTING ENEMIES","ALIVE ENEMIES","TROOP","TROOPS"].contains(string)){group=$gameTroop.aliveMembers();for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["ENEMIES ALL","ALL ENEMIES"].contains(string)){group=$gameTroop.members();for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["DEAD ENEMIES",
"DEAD ENEMY"].contains(string)){group=$gameTroop.deadMembers();for(let i=0;i<group.length;++i){target=group[i];if(target)targets.push(target)}return targets}if(["ENEMIES NOT USER","ENEMIES NOT SUBJECT","TROOP NOT USER","TROOP NOT SUBJECT"].contains(string)){group=$gameTroop.aliveMembers();for(let i=0;i<group.length;++i){target=group[i];if(target&&target!==this._subject&&target.isAppeared())targets.push(target)}return targets}if(string.match(/ACTOR[ ](\d+)/i)){target=$gameParty.battleMembers()[parseInt(RegExp.$1)];
if(target&&target.isAppeared())return[target]}if(string.match(/ENEMY[ ](\d+)/i)){target=$gameTroop.members()[parseInt(RegExp.$1)];if(target&&target.isAppeared())return[target]}if(["FRIEND","FRIENDS","ALLIES"].contains(string)){group=this._action.friendsUnit().aliveMembers();for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["ALL FRIENDS","ALL ALLIES"].contains(string)){group=this._action.friendsUnit().members();for(let i=0;i<group.length;++i){target=
group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["DEAD FRIEND","DEAD FRIENDS","DEAD ALLIES"].contains(string)){group=this._action.friendsUnit().deadMembers();for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["OPPONENT","OPPONENTS","RIVALS","FOES"].contains(string)){group=this._action.opponentsUnit().aliveMembers();for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["ALL OPPONENTS",
"ALL RIVALS","ALL FOES"].contains(string)){group=this._action.opponentsUnit().members();for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["DEAD OPPONENT","DEAD OPPONENTS","DEAD RIVALS","DEAD FOES"].contains(string)){group=this._action.opponentsUnit().deadMembers();for(let i=0;i<group.length;++i){target=group[i];if(target)targets.push(target)}return targets}if(["FRIENDS NOT USER","ALLIES NOT USER"].contains(string)){group=this._action.friendsUnit().aliveMembers();
for(let i=0;i<group.length;++i){target=group[i];if(target&&target!==this._subject&&target.isAppeared())targets.push(target)}return targets}if(string.match(/(?:FRIEND|ALLY)[ ](\d+)/i)){target=this._action.friendsUnit().members()[parseInt(RegExp.$1)];if(target&&target.isAppeared())return[target]}if(string.match(/(?:OPPONENT|FOE|RIVAL)[ ](\d+)/i)){target=this._action.opponentsUnit().members()[parseInt(RegExp.$1)];if(target&&target.isAppeared())return[target]}if(["ALL ALIVE"].contains(string)){group=
this._action.friendsUnit().aliveMembers();group=group.concat(this._action.opponentsUnit().aliveMembers());for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["ALL MEMBERS"].contains(string)){group=this._action.friendsUnit().members();group=group.concat(this._action.opponentsUnit().members());for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}return targets}if(["ALL DEAD"].contains(string)){group=
this._action.friendsUnit().deadMembers();group=group.concat(this._action.opponentsUnit().deadMembers());for(let i=0;i<group.length;++i){target=group[i];if(target)targets.push(target)}return targets}if(["ALL NOT USER"].contains(string)){group=this._action.friendsUnit().aliveMembers();group=group.concat(this._action.opponentsUnit().aliveMembers());for(let i=0;i<group.length;++i){target=group[i];if(target&&target!==this._subject&&target.isAppeared())targets.push(target)}return targets}if(["FOCUS","PARTICIPANTS"].contains(string)){group=
this._targets;for(let i=0;i<group.length;++i){target=group[i];if(target&&target.isAppeared())targets.push(target)}if(!targets.contains(this._subject))targets.push(this._subject);return targets}if(["NOT FOCUS","NONPARTICIPANTS"].contains(string)){group=this._action.friendsUnit().members();group=group.concat(this._action.opponentsUnit().members());for(let i=0;i<group.length;++i){target=group[i];if(target){if(target===this._subject)continue;if(target.isHidden())continue;if(this._targets.contains(target))continue;
if(target.isDead())if(Imported.YEP_X_AnimatedSVEnemies&&target.isEnemy())if(target.hasSVBattler()&&!target.sideviewCollapse());else continue;else if(target.isActor());else continue;targets.push(target)}}return targets}if(string.match(/(?:CHAR|CHARA|CHARACTER)[ ](\d+)/i)){const actorId=parseInt(RegExp.$1);const actor=$gameActors.actor(actorId);if(actor&&$gameParty.battleMembers().contains(actor))return[actor]}if("FIRST"===string.toUpperCase())return[this._targets[0]];return targets};BattleManager.actionConditionsMet=
function(actSeq){var ci=this._conditionFlags.length-1;var actionName=actSeq[0];var actionArgs=actSeq[1];var subject=this._subject;var user=this._subject;var target=this._targets[0];var targets=this._targets;var action=this._action;var item=this._action.item();if(actionName.match(/ELSE[ ]IF[ ](.*)/i)){if(this._conditionFlags.length<=0)return false;if(this._conditionFlags[ci]){this._conditionFlags[ci]=false;this._trueFlags[ci]=true}else if(!this._conditionFlags[ci]&&!this._trueFlags[ci]){const text=
String(RegExp.$1);try{this._conditionFlags[ci]=eval(text);this._trueFlags[ci]=eval(text)}catch(e){Yanfly.Util.displayError(e,text,"ACTION SEQUENCE IF CONDITION ERROR");this._conditionFlags[ci]=false;this._trueFlags[ci]=false}}return false}else if(actionName.match(/ELSE[ ]*(.*)/i)){if(this._conditionFlags.length<=0)return false;if(this._conditionFlags[ci]){this._conditionFlags[ci]=false;this._trueFlags[ci]=true}else if(!this._conditionFlags[ci]&&!this._trueFlags[ci]){this._conditionFlags[ci]=true;
this._trueFlags[ci]=true}return false}else if(actionName.toUpperCase()==="END"){if(this._conditionFlags.length<=0)return false;this._conditionFlags.pop();this._trueFlags.pop();return false}if(this._conditionFlags.length>0)return this._conditionFlags[ci];return true};BattleManager.actionActionAnimation=function(actionArgs){let targets;if(actionArgs&&actionArgs[0])targets=this.makeActionTargets(actionArgs[0]);else targets=this._targets;let mirror=false;if(actionArgs&&actionArgs[1])if(actionArgs[1].toUpperCase()===
"MIRROR")mirror=true;const subject=this._subject;const group=targets.filter(Yanfly.Util.onlyUnique);const aniId=this._action.item().animationId;if(aniId<0)if(mirror)this._logWindow.showActorAtkAniMirror(subject,group);else this._logWindow.showAttackAnimation(subject,group);else this._logWindow.showNormalAnimation(group,aniId,mirror);return true};BattleManager.actionActionCommonEvent=function(){this._action.item().effects.forEach((effect)=>{if(effect.code===Game_Action.EFFECT_COMMON_EVENT)$gameTemp.reserveCommonEvent(effect.dataId)},
this);return false};BattleManager.actionActionEffect=function(actionArgs){let targets;if(actionArgs&&actionArgs[0])targets=this.makeActionTargets(actionArgs[0]);else targets=this._targets;targets.forEach(function(target){if(target!==undefined){const alreadyDead=target.isDead();this.invokeAction(this._subject,target);if(target.isDead()&&!alreadyDead)target.performCollapse()}},this);return true};BattleManager.actionAniWait=function(frames){frames*=Yanfly.Param.AnimationRate||4;this._logWindow._waitCount=
parseInt(frames);return false};BattleManager.actionCastAnimation=function(){if(!$gameSystem.isSideView()&&this._subject.isActor())return true;if(!this._action.isAttack()&&!this._action.isGuard()&&this._action.isSkill())if(this._action.item().castAnimation>0){var ani=$dataAnimations[this._action.item().castAnimation];this._logWindow.showAnimation(this._subject,[this._subject],this._action.item().castAnimation)}return true};BattleManager.actionClearBattleLog=()=>false;BattleManager.actionDeathBreak=
function(){if(this._subject.isDead()){this._targets=[];this._actionList=[];this._individualTargets=[];this._phase="phaseChange";return false}return true};BattleManager.actionDisplayAction=function(){this._logWindow.displayAction(this._subject,this._action.item());return false};BattleManager.actionIfConditions=function(actionName,actionArgs){var subject=this._subject;var user=this._subject;var target=this._targets[0];var critical=false;if(target&&target.result())critical=target.result().critical;var targets=
this._targets;var action=this._action;var item=this._action.item();actionName=this._actSeq[0];if(actionName.match(/IF[ ](.*)/i)){const text=String(RegExp.$1);try{this._conditionFlags.push(eval(text))}catch(e){this._conditionFlags.push(false);Yanfly.Util.displayError(e,text,"ACTION SEQUENCE IF CONDITION ERROR")}this._trueFlags.push(false);var ci=this._conditionFlags.length}return true};BattleManager.actionImmortal=function(actionArgs){let value;const targets=this.makeActionTargets(actionArgs[0]).filter(Yanfly.Util.onlyUnique);
try{value=eval(String(actionArgs[1]).toLowerCase())}catch(e){value=false}targets.forEach((target)=>{if(value)target.addImmortal();else{var alreadyDead=target.isDead();target.removeImmortal()}},this);return true};BattleManager.actionMotionWait=function(actionArgs){const targets=this.makeActionTargets(actionArgs[0]);if(targets[0].isActor()&&targets[0].isSpriteVisible()){this._logWindow._waitCount+=12;return false}return true};BattleManager.actionPerformAction=function(){this._logWindow.performAction(this._subject,
this._action);if(this._subject.isActor()&&this._subject.isSpriteVisible){this._logWindow._waitCount+=20;return false}return true};BattleManager.actionPerformFinish=function(){this._logWindow.performActionEnd(this._subject);$gameParty.aliveMembers().forEach((member)=>{member.spriteReturnHome()});$gameTroop.aliveMembers().forEach((member)=>{member.spriteReturnHome()});return true};BattleManager.actionPerformStart=function(){this._logWindow.performActionStart(this._subject,this._action);return true};
BattleManager.actionWait=function(frames){this._logWindow._waitCount=parseInt(frames);return false};BattleManager.actionWaitForAnimation=function(){this._logWindow.waitForAnimation();return false};BattleManager.actionWaitForEffect=function(){this._logWindow.waitForEffect();return false};BattleManager.actionWaitForMovement=function(){this._logWindow.waitForMovement();return false};BattleManager.actionWaitForNewLine=function(){this._logWindow.waitForNewLine();return false};BattleManager.actionWaitForPopups=
function(){this._logWindow.waitForPopups();return false};Yanfly.BEC.SceneManager_snapForBackground=SceneManager.snapForBackground;SceneManager.snapForBackground=function(){if($gameParty.inBattle()){const spriteset=this._scene._spriteset;if(spriteset.battleback1Name()===""&&spriteset.battleback2Name()==="")return}Yanfly.BEC.SceneManager_snapForBackground.call(this)};Yanfly.BEC.Sprite_Battler_initialize=Sprite_Battler.prototype.initialize;Sprite_Battler.prototype.initialize=function(battler){this.preSpriteInitialize(battler);
Yanfly.BEC.Sprite_Battler_initialize.call(this,battler)};Sprite_Battler.prototype.preSpriteInitialize=(battler)=>{};Yanfly.BEC.Sprite_Battler_update=Sprite_Battler.prototype.update;Sprite_Battler.prototype.update=function(){Yanfly.BEC.Sprite_Battler_update.call(this);if(this._postSpriteInitialized)return;this.postSpriteInitialize()};Sprite_Battler.prototype.postSpriteInitialize=function(){this._postSpriteInitialized=true};Yanfly.BEC.Sprite_Battler_initMembers=Sprite_Battler.prototype.initMembers;
Sprite_Battler.prototype.initMembers=function(){Yanfly.BEC.Sprite_Battler_initMembers.call(this);this.adjustAnchor();this.setZ()};Sprite_Battler.prototype.adjustAnchor=function(){this.anchor.x=.5;this.anchor.y=1};Sprite_Battler.prototype.setZ=function(){this.z=1};Sprite_Battler.prototype.setupDamagePopup=function(){if(this._battler.isDamagePopupRequested()){if(this._battler.isSpriteVisible()){const sprite=new Sprite_Damage;sprite.x=this.x+this.damageOffsetX();sprite.y=this.y+this.damageOffsetY();
sprite.setup(this._battler);this.pushDamageSprite(sprite);BattleManager._spriteset.addChild(sprite);this._battler.clearResult()}}else this._battler.clearDamagePopup()};Sprite_Battler.prototype.pushDamageSprite=function(sprite){let heightBuffer=Yanfly.Param.BECPopupOverlap;if(Yanfly.Param.BECNewPopBottom){this._damages.push(sprite);this._damages.forEach((spr)=>{for(let i=0;i<spr.children.length;i++){childSprite=spr.children[i];childSprite.anchor.y+=heightBuffer}},this)}else{this._damages.push(sprite);
heightBuffer*=this._damages.length;for(let i=0;i<sprite.children.length;i++){childSprite=sprite.children[i];childSprite.anchor.y+=heightBuffer}}};Yanfly.BEC.Sprite_Battler_setBattler=Sprite_Battler.prototype.setBattler;Sprite_Battler.prototype.setBattler=function(battler){Yanfly.BEC.Sprite_Battler_setBattler.call(this,battler);if(battler)battler.setBattler(this)};Yanfly.BEC.Sprite_Battler_startMove=Sprite_Battler.prototype.startMove;Sprite_Battler.prototype.startMove=function(x,y,duration){if(this._battler&&
!this._battler.spriteCanMove())return;Yanfly.BEC.Sprite_Battler_startMove.call(this,x,y,duration)};Sprite_Battler.prototype.stepForward=function(){this.startMove(Yanfly.Param.BECStepDist,0,12)};Sprite_Battler.prototype.stepBack=function(){this.startMove(0,0,12)};Sprite_Battler.prototype.stepFlinch=function(){const flinchX=this.x-this._homeX-Yanfly.Param.BECFlinchDist;const flinchY=this.y-this._homeY;this.startMove(flinchX,flinchY,6)};Sprite_Battler.prototype.stepSubBack=function(){const backX=-1*
this.width/2;this.startMove(backX,0,6)};Sprite_Battler.prototype.stepToSubstitute=function(focus){const target=focus.battler();let targetX=this.x-this._homeX+(target._homeX-this._homeX);const targetY=this.y-this._homeY+(target._homeY-this._homeY);if(focus.isActor())targetX-=this._mainSprite.width/2;if(focus.isEnemy())targetX+=this.width/2;this.startMove(targetX,targetY,1)};Sprite_Battler.prototype.startMotion=(motionType)=>{};Sprite_Battler.prototype.forceMotion=(motionType)=>{};Sprite_Battler.prototype.refreshMotion=
()=>{};Sprite_Battler.prototype.startActionMotion=()=>{};Sprite_Battler.prototype.moveForward=function(distance,frames){distance=parseInt(distance);frames=parseInt(frames);if(this._battler.isActor())distance*=-1;const moveX=this.x-this._homeX+distance;const moveY=this.y-this._homeY;this.startMove(moveX,moveY,frames)};Sprite_Battler.prototype.moveToPoint=function(pointX,pointY,frames){pointX=parseInt(pointX);pointY=parseInt(pointY);const targetX=pointX-this._homeX;const targetY=pointY-this._homeY;
this.startMove(targetX,targetY,frames)};Sprite_Battler.prototype.setMirror=function(value){if(this.scale.x>0&&value)this.scale.x*=-1;if(this.scale.x<0&&!value)this.scale.x*=-1};Sprite_Battler.prototype.isPopupPlaying=function(){if(this._damages.length>0)for(const p of this._damages)if(p&&p.isPlaying)p.isPlaying();return false};Sprite_Actor.prototype.preSpriteInitialize=function(battler){Sprite_Battler.prototype.preSpriteInitialize.call(this,battler)};Sprite_Actor.prototype.postSpriteInitialize=function(){Sprite_Battler.prototype.postSpriteInitialize.call(this)};
Yanfly.BEC.Sprite_Actor_updateShadow=Sprite_Actor.prototype.updateShadow;Sprite_Actor.prototype.updateShadow=function(){if(this._hideShadows===undefined)this._hideShadows=Yanfly.Param.BECShowShadows;if(!this._hideShadows)return this._shadowSprite.visible=false;Yanfly.BEC.Sprite_Actor_updateShadow.call(this)};Sprite_Actor.prototype.setActorHome=function(index){var screenWidth=Graphics.boxWidth;var screenHeight=Graphics.boxHeight;var maxSize=$gameParty.maxBattleMembers();var partySize=$gameParty.battleMembers().length;
let statusHeight=eval(Yanfly.Param.BECCommandRows);statusHeight*=Window_Base.prototype.lineHeight.call(this);statusHeight+=Window_Base.prototype.standardPadding.call(this)*2;if($gameSystem.isSideView()){var code=Yanfly.Param.BECHomePosX;try{var homeX=eval(code)}catch(e){var homeX=0;Yanfly.Util.displayError(e,code,"SIDE VIEW HOME X FORMULA ERROR")}var code=Yanfly.Param.BECHomePosY;try{var homeY=eval(code)}catch(e){var homeY=0;Yanfly.Util.displayError(e,code,"SIDE VIEW HOME Y FORMULA ERROR")}}else{var code=
Yanfly.Param.BECFrontPosX;try{var homeX=eval(code)}catch(e){var homeX=0;Yanfly.Util.displayError(e,code,"FRONT VIEW HOME X FORMULA ERROR")}var code=Yanfly.Param.BECFrontPosY;try{var homeY=eval(code)}catch(e){var homeY=0;Yanfly.Util.displayError(e,code,"FRONT VIEW HOME Y FORMULA ERROR")}}this._checkAliveStatus=false;if($gameParty.battleMembers()[index]){const actor=$gameParty.battleMembers()[index];if(actor.isAlive())this._checkAliveStatus=true}this.setHome(homeX,homeY);this.moveToStartPosition()};
Sprite_Actor.prototype.moveToStartPosition=function(){if(BattleManager._bypassMoveToStartLocation)return;if($gameSystem.isSideView()&&this._checkAliveStatus)this.startMove(300,0,0)};Sprite_Actor.prototype.setupMotion=()=>{};Sprite_Actor.prototype.forceMotion=function(motionType){var newMotion=Sprite_Actor.MOTIONS[motionType];this._motion=newMotion;this._motionCount=0;this._pattern=0};Sprite_Actor.prototype.updateTargetPosition=()=>{};Sprite_Actor.prototype.updateMotion=function(){this.updateMotionCount()};
Sprite_Actor.prototype.onMoveEnd=function(){Sprite_Battler.prototype.onMoveEnd.call(this)};Sprite_Actor.prototype.stepForward=function(){this.startMove(-Yanfly.Param.BECStepDist,0,12)};Sprite_Actor.prototype.stepFlinch=function(){const flinchX=this.x-this._homeX+Yanfly.Param.BECFlinchDist;const flinchY=this.y-this._homeY;this.startMove(flinchX,flinchY,6)};Sprite_Actor.prototype.stepSubBack=function(){const backX=this._mainSprite.width/2;this.startMove(backX,0,6)};Yanfly.BEC.Sprite_Actor_updateBitmap=
Sprite_Actor.prototype.updateBitmap;Sprite_Actor.prototype.updateBitmap=function(){const name=this._actor.battlerName();let needUpdate=false;if(this._battlerName!==name)needUpdate=true;Yanfly.BEC.Sprite_Actor_updateBitmap.call(this);if(needUpdate)this.adjustAnchor()};Sprite_Actor.prototype.adjustAnchor=function(){if(!this._mainSprite)return;this._mainSprite.anchor.x=this._actor.anchorX();this._mainSprite.anchor.y=this._actor.anchorY()};Yanfly.BEC.Sprite_Actor_updateFrame=Sprite_Actor.prototype.updateFrame;
Sprite_Actor.prototype.updateFrame=function(){Yanfly.BEC.Sprite_Actor_updateFrame.call(this);if(!this._mainSprite)return;if(!this._mainSprite.bitmap)return;if(this._mainSprite.bitmap.width>0&&!this.bitmap){const sw=this._mainSprite.bitmap.width/9;const sh=this._mainSprite.bitmap.height/6;this.bitmap=new Bitmap(sw,sh)}};Yanfly.BEC.Sprite_Actor_refreshMotion=Sprite_Actor.prototype.refreshMotion;Sprite_Actor.prototype.refreshMotion=function(){const actor=this._actor;if(!actor)return;const motionGuard=
Sprite_Actor.MOTIONS["guard"];if(this._motion===motionGuard&&!BattleManager.isInputting())return;const stateMotion=actor.stateMotionIndex();if(actor.isInputting()||actor.isActing())this.startMotion(actor.idleMotion());else if(stateMotion===3)this.startMotion(actor.deadMotion());else if(stateMotion===2)this.startMotion(actor.sleepMotion());else if(actor.isChanting())this.startMotion(actor.chantMotion());else if(actor.isGuard()||actor.isGuardWaiting())this.startMotion(actor.guardMotion());else if(stateMotion===
1)this.startMotion(actor.abnormalMotion());else if(actor.isDying())this.startMotion(actor.dyingMotion());else if(actor.isUndecided())this.startMotion(actor.idleMotion());else this.startMotion(actor.waitMotion())};Sprite_Enemy.prototype.preSpriteInitialize=function(battler){Sprite_Battler.prototype.preSpriteInitialize.call(this,battler);this._visualSelect=Yanfly.Param.BECEnemySelect;if(this._visualSelect)this.createVisualSelectWindow()};Yanfly.BEC.Sprite_Enemy_update=Sprite_Enemy.prototype.update;
Sprite_Enemy.prototype.update=function(){Yanfly.BEC.Sprite_Enemy_update.call(this);this.addVisualSelectWindow();this.checkExistInSceneChildren()};Sprite_Enemy.prototype.addVisualSelectWindow=function(){if(!this._visualSelect)return;if(this._addedVisualSelect)return;if(!SceneManager._scene)return;const scene=SceneManager._scene;if(!scene._windowLayer)return;this._addedVisualSelect=true;scene.addChild(this._visualSelectWindow)};Sprite_Enemy.prototype.createVisualSelectWindow=function(){this._visualSelectWindow=
new Window_EnemyVisualSelect};Yanfly.BEC.Sprite_Enemy_setBattler=Sprite_Enemy.prototype.setBattler;Sprite_Enemy.prototype.setBattler=function(battler){Yanfly.BEC.Sprite_Enemy_setBattler.call(this,battler);if(this._visualSelectWindow)this._visualSelectWindow.setBattler(battler)};Sprite_Enemy.prototype.checkExistInSceneChildren=function(){if(!this._visualSelect)return;if(!SceneManager._scene)return;const scene=SceneManager._scene;if(!scene._windowLayer)return;if(!scene.children.contains(this._visualSelectWindow)){this._addedVisualSelect=
true;scene.addChild(this._visualSelectWindow)}};Yanfly.BEC.Sprite_Weapon_setup=Sprite_Weapon.prototype.setup;Sprite_Weapon.prototype.setup=function(weaponImageId){Yanfly.BEC.Sprite_Weapon_setup.call(this,weaponImageId);this._animationCount-=1};Yanfly.BEC.Sprite_Damage_initialize=Sprite_Damage.prototype.initialize;Sprite_Damage.prototype.initialize=function(){Yanfly.BEC.Sprite_Damage_initialize.call(this);this._duration=Yanfly.Param.BECPopupDur};Sprite_Damage.prototype.setup=function(target){this._result=
target.shiftDamagePopup();const result=this._result||{};if(result.missed||result.evaded)this.createMiss();else if(result.hpAffected)this.createDigits(0,result.hpDamage);else if(target.isAlive()&&result.mpDamage!==0)this.createDigits(2,result.mpDamage);if(result.critical)this.setupCriticalEffect()};Sprite_Damage.prototype.setupCriticalEffect=function(){this._flashColor=eval(`[${Yanfly.Param.BECCritPopup}]`);this._flashDuration=Yanfly.Param.BECCritDur};Yanfly.BEC.Sprite_Damage_update=Sprite_Damage.prototype.update;
Sprite_Damage.prototype.update=function(){Yanfly.BEC.Sprite_Damage_update.call(this);if(this._duration<=0&&this.parent)this.parent.removeChild(this)};Yanfly.BEC.Sprite_StateIcon_update=Sprite_StateIcon.prototype.update;Sprite_StateIcon.prototype.update=function(){Yanfly.BEC.Sprite_StateIcon_update.call(this);this.updateMirror()};Sprite_StateIcon.prototype.updateMirror=function(){if(this.parent.scale.x<0)this.scale.x=-1*Math.abs(this.scale.x);if(this.parent.scale.x>0)this.scale.x=Math.abs(this.scale.x)};
Yanfly.BEC.Sprite_StateOverlay_update=Sprite_StateOverlay.prototype.update;Sprite_StateOverlay.prototype.update=function(){Yanfly.BEC.Sprite_StateOverlay_update.call(this);this.updateMirror()};Sprite_StateOverlay.prototype.updateMirror=function(){if(this.parent.scale.x<0)this.scale.x=-1*Math.abs(this.scale.x);if(this.parent.scale.x>0)this.scale.x=Math.abs(this.scale.x)};Game_Temp.prototype.clearActionSequenceSettings=()=>{};Game_Temp.prototype.forceActionQueue=function(command){if(!this._forceActionQueue){this._forceActionQueue=
JsonEx.makeDeepCopy($dataCommonEvents[1]);this._forceActionQueue.list=[]}this._forceActionQueue.list.push(command)};Yanfly.BEC.Game_Temp_clearCommonEvent=Game_Temp.prototype.clearCommonEvent;Game_Temp.prototype.clearCommonEvent=function(){this._forceActionQueue=undefined;Yanfly.BEC.Game_Temp_clearCommonEvent.call(this)};Yanfly.BEC.Game_Temp_isCommonEventReserved=Game_Temp.prototype.isCommonEventReserved;Game_Temp.prototype.isCommonEventReserved=function(){if(this._forceActionQueue)return true;return Yanfly.BEC.Game_Temp_isCommonEventReserved.call(this)};
Yanfly.BEC.Game_Temp_reservedCommonEvent=Game_Temp.prototype.reservedCommonEvent;Game_Temp.prototype.reservedCommonEvent=function(){if(this._forceActionQueue)return this._forceActionQueue;return Yanfly.BEC.Game_Temp_reservedCommonEvent.call(this)};Yanfly.BEC.Game_System_initialize=Game_System.prototype.initialize;Game_System.prototype.initialize=function(){Yanfly.BEC.Game_System_initialize.call(this);this.initBattleSystem()};Game_System.prototype.initBattleSystem=function(){this._battleSystem=Yanfly.Param.BECSystem.toLowerCase()};
Game_System.prototype.getBattleSystem=function(){if(this._battleSystem===undefined)this.initBattleSystem();return this._battleSystem};Game_System.prototype.setBattleSystem=function(type){this._battleSystem=type.toLowerCase()};Yanfly.BEC.Game_Interpreter_pluginCommand=Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand=function(command,args){Yanfly.BEC.Game_Interpreter_pluginCommand.call(this,command,args);if(command==="setBattleSys"&&!$gameParty.inBattle())this.setBattleSystem(args[0])};
Game_Interpreter.prototype.setBattleSystem=(value)=>{$gameSystem.setBattleSystem(value)};Game_Action.prototype.speed=function(){const user=this.subject();const a=user;const maxhp=user.mhp;const mhp=user.mhp;const hp=user.hp;const maxmp=user.mmp;const mmp=user.mmp;const mp=user.mp;const maxtp=user.maxTp();const mtp=user.maxTp();const tp=user.tp;const atk=user.atk;const def=user.def;const mat=user.mat;const int=user.mat;const mdf=user.mdf;const res=user.res;const agi=user.agi;const luk=user.luk;const code=
Yanfly.Param.BECActionSpeed;try{var speed=eval(code)}catch(e){var speed=0;Yanfly.Util.displayError(e,code,"ACTION SPEED FORMULA ERROR")}if(this.item())speed+=this.item().speed;if(this.isAttack())speed+=this.subject().attackSpeed();return speed};Yanfly.BEC.Game_Action_apply=Game_Action.prototype.apply;Game_Action.prototype.apply=function(target){target._result=null;target._result=new Game_ActionResult;this.subject()._result=null;this.subject()._result=new Game_ActionResult;Yanfly.BEC.Game_Action_apply.call(this,
target);if($gameParty.inBattle()){target.startDamagePopup();target.performResultEffects();if(target!==this.subject())this.subject().startDamagePopup()}};Game_Action.prototype.itemEffectAddAttackState=function(target,effect){this.subject().attackStates().forEach((stateId)=>{let chance=effect.value1;chance*=target.stateRate(stateId);chance*=this.subject().attackStatesRate(stateId);chance*=this.lukEffectRate(target);if(Math.random()<chance){if(stateId===target.deathStateId())if(target.isImmortal())target.removeImmortal();
target.addState(stateId);this.makeSuccess(target)}},target)};Game_Action.prototype.itemEffectAddNormalState=function(target,effect){const stateId=effect.dataId;let chance=effect.value1;if(!this.isCertainHit()){chance*=target.stateRate(stateId);chance*=this.lukEffectRate(target)}if(Math.random()<chance){if(stateId===target.deathStateId())if(target.isImmortal())target.removeImmortal();target.addState(stateId);this.makeSuccess(target)}};Yanfly.BEC.Game_Action_applyGlobal=Game_Action.prototype.applyGlobal;
Game_Action.prototype.applyGlobal=function(){if($gameParty.inBattle())return;Yanfly.BEC.Game_Action_applyGlobal.call(this)};Yanfly.BEC.Game_Action_needsSelection=Game_Action.prototype.needsSelection;Game_Action.prototype.needsSelection=function(){if($gameParty.inBattle()&&this.item().scope===0)return false;if($gameParty.inBattle()&&BattleManager.isForceSelection())return true;return Yanfly.BEC.Game_Action_needsSelection.call(this)};Yanfly.BEC.Game_BattlerBase_recoverAll=Game_BattlerBase.prototype.recoverAll;
Game_BattlerBase.prototype.recoverAll=function(){Yanfly.BEC.Game_BattlerBase_recoverAll.call(this);this.refresh();if($gameParty.inBattle())this.forceMotionRefresh()};Game_BattlerBase.prototype.requestStatusRefresh=function(){this._statusRefreshRequested=true};Game_BattlerBase.prototype.isStatusRefreshRequested=function(){return this._statusRefreshRequested};Game_BattlerBase.prototype.completetStatusRefreshRequest=function(){this._statusRefreshRequested=false};Game_BattlerBase.prototype.updateStateTicks=
function(){let needRefresh=false;for(let i=0;i<this._states.length;++i){const stateId=this._states[i];const state=$dataStates[stateId];if(!state)continue;if(state.autoRemovalTiming!==2)continue;if(!this._stateTurns[stateId])continue;const value=BattleManager.tickRate()/Yanfly.Param.BECTurnTime;const shown1=Math.ceil(this._stateTurns[stateId]);this._stateTurns[stateId]-=value;const shown2=Math.ceil(this._stateTurns[stateId]);if(shown1!==shown2)needRefresh=true;if(this._stateTurns[stateId]<=0)this.removeState(stateId)}if(needRefresh)this.refresh()};
Game_BattlerBase.prototype.isBypassUpdateTurns=()=>$gameTroop.isEventRunning();Game_BattlerBase.prototype.updateStateTurns=function(){this.updateStateTurnEnd()};Game_BattlerBase.prototype.updateStateTurnTiming=function(timing){if(this.isBypassUpdateTurns())return;const statesRemoved=[];this._freeStateTurn=this._freeStateTurn||[];for(let i=0;i<this._states.length;++i){var stateId=this._states[i];const state=$dataStates[stateId];if(!state)continue;if(state.autoRemovalTiming!==timing)continue;if(!this._stateTurns[stateId])continue;
if(this._freeStateTurn.contains(stateId)){const index=this._freeStateTurn.indexOf(stateId);this._freeStateTurn.splice(index,1)}else this._stateTurns[stateId]-=1;if(this._stateTurns[stateId]<=0)statesRemoved.push(stateId)}for(let i=0;i<statesRemoved.length;++i){var stateId=statesRemoved[i];this.removeState(stateId)}};Game_BattlerBase.prototype.updateStateActionStart=function(){this.updateStateTurnTiming(3)};Game_BattlerBase.prototype.updateStateActionEnd=function(){this.updateStateTurnTiming(1)};Game_BattlerBase.prototype.updateStateTurnStart=
function(){this.updateStateTurnTiming(4)};Game_BattlerBase.prototype.updateStateTurnEnd=function(){this.updateStateTurnTiming(2)};Game_BattlerBase.prototype.updateBuffTicks=function(){let needRefresh=false;for(let i=0;i<this._buffTurns.length;i++){if(this._buffTurns[i]<=0)continue;const value=BattleManager.tickRate()/Yanfly.Param.BECTurnTime;const shown1=Math.ceil(this._buffTurns[i]);this._buffTurns[i]-=value;const shown2=Math.ceil(this._buffTurns[i]);if(shown1!==shown2)needRefresh=true;if(this._buffTurns[i]<=
0)this.removeBuff(i)}if(needRefresh)this.refresh()};Game_BattlerBase.prototype.timedTick=()=>BattleManager.tickRate();Yanfly.BEC.Game_BattlerBase_isStateResist=Game_BattlerBase.prototype.isStateResist;Game_BattlerBase.prototype.isStateResist=function(stateId){if(stateId===this.deathStateId()&&this.isImmortal())return true;return Yanfly.BEC.Game_BattlerBase_isStateResist.call(this,stateId)};Game_BattlerBase.prototype.isImmortal=function(){return this._immortalState};Yanfly.BEC.Game_BattlerBase_paySkillCost=
Game_BattlerBase.prototype.paySkillCost;Game_BattlerBase.prototype.paySkillCost=function(skill){this.requestStatusRefresh();Yanfly.BEC.Game_BattlerBase_paySkillCost.call(this,skill)};Game_Battler.prototype.initialize=function(){Game_BattlerBase.prototype.initialize.call(this);this._damagePopup=[]};Yanfly.BEC.Game_Battler_useItem=Game_Battler.prototype.useItem;Game_Battler.prototype.useItem=function(item){Yanfly.BEC.Game_Battler_useItem.call(this,item);this.refresh();if(!$gameParty.inBattle())return;
this.increaseSelfTurnCount();this.updateStateActionStart()};Yanfly.BEC.Game_Battler_onBattleStart=Game_Battler.prototype.onBattleStart;Game_Battler.prototype.onBattleStart=function(){Yanfly.BEC.Game_Battler_onBattleStart.call(this);this._freeStateTurn=[];this._immortalState=false;this._selfTurnCount=0};Yanfly.BEC.Game_Battler_onBattleEnd=Game_Battler.prototype.onBattleEnd;Game_Battler.prototype.onBattleEnd=function(){Yanfly.BEC.Game_Battler_onBattleEnd.call(this);this._freeStateTurn=[];this._immortalState=
false};Yanfly.BEC.Game_Battler_isSelected=Game_Battler.prototype.isSelected;Game_Battler.prototype.isSelected=function(){if($gameParty.inBattle()&&BattleManager.isAllSelection()){if(!this.isAppeared())return false;const action=BattleManager.inputtingAction();if(action&&action.item()){if(this.isDead()&&this.isEnemy())return false;if(this.isDead()&&this.isActor())return action.isForDeadFriend();if(action.isForFriend()&&this.isActor())return true;if(action.isForOpponent()&&this.isEnemy())return true}}return Yanfly.BEC.Game_Battler_isSelected.call(this)};
Yanfly.BEC.Game_Battler_regenerateAll=Game_Battler.prototype.regenerateAll;Game_Battler.prototype.regenerateAll=function(){this.clearResult();const lifeState=this.isAlive();Yanfly.BEC.Game_Battler_regenerateAll.call(this);if($gameParty.inBattle()){if(!BattleManager.timeBasedStates())this.updateStateTurns();if(!BattleManager.timeBasedBuffs()){this.updateBuffTurns();this.removeBuffsAuto()}if(this.isDead()&&lifeState===true)this.performCollapse();this.startDamagePopup()}};Game_Battler.prototype.addImmortal=
function(){this._immortalState=true};Game_Battler.prototype.removeImmortal=function(){const alreadyDead=this.isDead();this._immortalState=false;this.refresh();if(this.isDead()&&!alreadyDead)this.performCollapse()};Yanfly.BEC.Game_Battler_removeState=Game_Battler.prototype.removeState;Game_Battler.prototype.removeState=function(stateId){Yanfly.BEC.Game_Battler_removeState.call(this,stateId)};Game_Battler.prototype.clearDamagePopup=function(){this._damagePopup=[]};Game_Battler.prototype.isDamagePopupRequested=
function(){if(!this._damagePopup)this.clearDamagePopup();return this._damagePopup.length>0};Game_Battler.prototype.startDamagePopup=function(){const result=this.result()||{};if(result.missed||result.evaded){var copyResult=JsonEx.makeDeepCopy(result);copyResult.hpAffected=false;copyResult.mpDamage=0;this._damagePopup.push(copyResult)}if(result.hpAffected){var copyResult=JsonEx.makeDeepCopy(result);copyResult.mpDamage=0;this._damagePopup.push(copyResult)}if(result.mpDamage!==0){var copyResult=JsonEx.makeDeepCopy(result);
copyResult.hpAffected=false;this._damagePopup.push(copyResult)}};Game_Battler.prototype.shiftDamagePopup=function(){if(!this._damagePopup)this.clearDamagePopup();return this._damagePopup.shift()};Yanfly.BEC.Game_Battler_performCollapse=Game_Battler.prototype.performCollapse;Game_Battler.prototype.performCollapse=function(){Yanfly.BEC.Game_Battler_performCollapse.call(this);if($gameParty.inBattle())this.forceMotion(this.deadMotion())};Game_Battler.prototype.performResultEffects=function(){const result=
this.result()||{};if(result.missed&&result.physical)this.performMiss();if(result.evaded)if(result.physical)this.performEvasion();else this.performMagicEvasion();if(result.hpAffected){if(result.hpDamage>0&&!result.drain)this.performDamage();if(result.hpDamage<0)this.performRecovery()}if(this.isAlive()&&result.mpDamage!==0&&result.mpDamage<0)this.performRecovery();if(this.isAlive()&&result.tpDamage!==0&&result.tpDamage<0)this.performRecovery()};Yanfly.BEC.Game_Battler_performDamage=Game_Battler.prototype.performDamage;
Game_Battler.prototype.performDamage=function(){Yanfly.BEC.Game_Battler_performDamage.call(this);this.performFlinch()};Yanfly.BEC.Game_Battler_performMiss=Game_Battler.prototype.performMiss;Game_Battler.prototype.performMiss=function(){Yanfly.BEC.Game_Battler_performMiss.call(this);this.performFlinch()};Yanfly.BEC.Game_Battler_performEvasion=Game_Battler.prototype.performEvasion;Game_Battler.prototype.performEvasion=function(){Yanfly.BEC.Game_Battler_performEvasion.call(this);this.performFlinch()};
Yanfly.BEC.Game_Battler_performMagicEvasion=Game_Battler.prototype.performMagicEvasion;Game_Battler.prototype.performMagicEvasion=function(){Yanfly.BEC.Game_Battler_performMagicEvasion.call(this);this.performFlinch()};Game_Battler.prototype.performFlinch=function(){if(this._flinched||!$gameSystem.isSideView())return;this._flinched=true;this.spriteStepFlinch()};Yanfly.BEC.Game_Battler_performReflection=Game_Battler.prototype.performReflection;Game_Battler.prototype.performReflection=function(){Yanfly.BEC.Game_Battler_performReflection.call(this);
if(!$gameSystem.isSideView()&&this.isActor())return;const animationId=this.reflectAnimationId();const mirror=this.isActor();this.startAnimation(animationId,mirror,0)};Yanfly.BEC.Game_Battler_performSubstitute=Game_Battler.prototype.performSubstitute;Game_Battler.prototype.performSubstitute=function(target){Yanfly.BEC.Game_Battler_performSubstitute.call(this,target);if(!$gameSystem.isSideView())return;this._flinched=true;if(BattleManager._action.isForAll()){this.spriteStepForward();target.spriteStepSubBack()}else{this.spriteStepToSubstitute(target);
target.spriteStepSubBack()}};Game_Battler.prototype.setBattler=function(sprite){BattleManager.registerSprite(this,sprite)};Game_Battler.prototype.battler=function(){return BattleManager.getSprite(this)};Game_Battler.prototype.requestMotion=function(motionType){this._motionType=motionType;if(this.battler())this.battler().startMotion(motionType)};Game_Battler.prototype.forceMotion=function(motionType){this._motionType=motionType;if(this.battler())this.battler().forceMotion(motionType)};Game_Battler.prototype.startWeaponAnimation=
function(weaponImageId){this._weaponImageId=weaponImageId;if(this.battler())this.battler().setupWeaponAnimation()};Game_Battler.prototype.performActionStart=function(action){if(!action.isGuard()){this.setActionState("acting");this.spriteStepForward()}};Yanfly.BEC.Game_Battler_performActionEnd=Game_Battler.prototype.performActionEnd;Game_Battler.prototype.performActionEnd=function(){Yanfly.BEC.Game_Battler_performActionEnd.call(this);this.spriteReturnHome()};Game_Battler.prototype.spriteStepForward=
function(){if($gameSystem.isSideView()&&this.battler())this.battler().stepForward()};Game_Battler.prototype.spriteStepBack=function(){if($gameSystem.isSideView()&&this.battler())this.battler().stepBack()};Game_Battler.prototype.spriteStepSubBack=function(){if($gameSystem.isSideView()&&this.battler())this.battler().stepSubBack()};Game_Battler.prototype.spriteStepToSubstitute=function(target){if($gameSystem.isSideView()&&this.battler())this.battler().stepToSubstitute(target)};Game_Battler.prototype.spriteStepFlinch=
function(){if($gameSystem.isSideView()&&this.battler())this.battler().stepFlinch()};Game_Battler.prototype.spriteReturnHome=function(){if($gameSystem.isSideView()&&this.battler()){this._flinched=false;this.spriteFaceForward();this.battler().stepBack();if(this.numActions()<=0)this.setActionState("undecided");this.battler().refreshMotion()}};Game_Battler.prototype.reflectAnimationId=function(){for(let i=0;i<this.states().length;++i){const state=this.states()[i];if(state.reflectAnimationId>0)return state.reflectAnimationId}return Yanfly.Param.BECReflectAni};
Game_Battler.prototype.spriteCanMove=function(){if(!$gameSystem.isSideView())return false;for(let i=0;i<this.states().length;++i){const state=this.states()[i];if(state.spriteCannotMove)return false}return this.canMove()};Game_Battler.prototype.spritePosX=function(){if($gameSystem.isSideView()&&this.battler())return this.battler().x;else if(this.battler())return this.battler().x;else return 0};Game_Battler.prototype.spritePosY=function(){if($gameSystem.isSideView()&&this.battler())return this.battler().y;
else if(this.battler())return this.battler().y;else return 0};Game_Battler.prototype.spriteWidth=function(){if($gameSystem.isSideView()&&this.battler()&&this.battler().bitmap)return this.battler().bitmap.width;else if(this.battler()&&this.battler().bitmap)return this.battler().bitmap.width;else return 1};Game_Battler.prototype.spriteHeight=function(){if($gameSystem.isSideView()&&this.battler()&&this.battler().bitmap)return this.battler().bitmap.height;else if(this.battler()&&this.battler().bitmap)return this.battler().bitmap.height;
else return 1};Game_Battler.prototype.anchorX=()=>Yanfly.Param.BECAnchorX;Game_Battler.prototype.anchorY=()=>Yanfly.Param.BECAnchorY;Game_Battler.prototype.spriteHomeX=function(){if($gameSystem.isSideView()&&this.battler())return this.battler()._homeX;else return 0};Game_Battler.prototype.spriteHomeY=function(){if($gameSystem.isSideView()&&this.battler())return this.battler()._homeY;else return 0};Game_Battler.prototype.setMirror=function(value){if($gameSystem.isSideView()&&this.battler()&&this.spriteCanMove())this.battler().setMirror(value)};
Game_Battler.prototype.spriteFaceForward=function(){this.setMirror(false)};Game_Battler.prototype.spriteFaceBackward=function(){this.setMirror(true)};Game_Battler.prototype.spriteFacePoint=function(pointX,pointY){if(this.spritePosX()>pointX)this.spriteFaceBackward();else this.spriteFaceForward()};Game_Battler.prototype.spriteFaceAwayPoint=function(pointX,pointY){if(this.spritePosX()>pointX)this.spriteFaceForward();else this.spriteFaceBackward()};Game_Battler.prototype.spriteFaceTarget=function(target){if(!target)return;
const pointX=target.spritePosX();const pointY=target.spritePosY();this.spriteFacePoint(pointX,pointY)};Game_Battler.prototype.spriteFaceAwayTarget=function(target){if(!target)return;const pointX=target.spritePosX();const pointY=target.spritePosY();this.spriteFaceAwayPoint(pointX,pointY)};Game_Battler.prototype.spriteFaceHome=function(){const pointX=this.spriteHomeX();const pointY=this.spriteHomeY();this.spriteFacePoint(pointX,pointY)};Game_Battler.prototype.spriteFaceAwayHome=function(){const pointX=
target.spriteHomeX();const pointY=target.spriteHomeY();this.spriteFaceAwayPoint(pointX,pointY)};Game_Battler.prototype.attackMotion=()=>"thrust";Game_Battler.prototype.performAttack=()=>{};Game_Battler.prototype.forceMotionRefresh=function(){if(!$gameParty.inBattle())return;if(this.battler())this.battler().refreshMotion()};Game_Battler.prototype.requestMotionRefresh=function(){const deadMotion=this.deadMotion();if(this.isDead()&&this._motionType!==deadMotion)this.requestMotion(deadMotion);if(this.isDead()&&
this._motionType===deadMotion)return;if(this._motionType==="victory")return;if(this._motionType==="escape"&&!BattleManager.isInputting())return;if(this._motionType==="guard"&&!BattleManager.isInputting())return;this.clearMotion();if(this.battler()&&BattleManager.isInputting())this.battler().refreshMotion()};Game_Battler.prototype.onTurnStart=function(){this.updateStateTurnStart()};Game_Battler.prototype.onTurnEnd=function(){this.clearResult();if(BattleManager.isTurnBased())this.regenerateAll();else if(BattleManager.isTickBased()&&
!BattleManager.isTurnEnd())this.regenerateAll();this.removeStatesAuto(2)};Yanfly.BEC.Game_Battler_onAllActionsEnd=Game_Battler.prototype.onAllActionsEnd;Game_Battler.prototype.onAllActionsEnd=function(){Yanfly.BEC.Game_Battler_onAllActionsEnd.call(this);if(!BattleManager._processTurn)this.updateStateActionEnd()};Game_Battler.prototype.updateTick=function(){if(BattleManager.timeBasedStates())this.updateStateTicks();if(BattleManager.timeBasedBuffs())this.updateBuffTicks()};Game_Battler.prototype.increaseSelfTurnCount=
function(){if(this._selfTurnCount===undefined)this._selfTurnCount=0;this._selfTurnCount+=1};Game_Battler.prototype.turnCount=function(){if(BattleManager.isTurnBased())return $gameTroop.turnCount();if(BattleManager.isTickBased()&&Yanfly.Param.BECAISelfTurn)return this._selfTurnCount;return $gameTroop.turnCount()};Game_Battler.prototype.createActions=function(){if(this.currentAction())return;this.makeActions()};Yanfly.BEC.Game_Battler_addState=Game_Battler.prototype.addState;Game_Battler.prototype.addState=
function(stateId){Yanfly.BEC.Game_Battler_addState.call(this,stateId);if(this.canAddStateFreeTurn(stateId))this.setStateFreeTurn(stateId)};Game_Battler.prototype.canAddStateFreeTurn=function(stateId){if(!$gameParty.inBattle())return false;if(BattleManager._subject!==this)return false;if($dataStates[stateId].autoRemovalTiming!==1)return false;if(Imported.YEP_BuffsStatesCore)if($dataStates[stateId].reapplyRules===0)return false;return true};Game_Battler.prototype.setStateFreeTurn=function(stateId){this._freeStateTurn=
this._freeStateTurn||[];this._freeStateTurn.push(stateId)};Game_Battler.prototype.idleMotion=()=>"walk";Game_Battler.prototype.deadMotion=()=>"dead";Game_Battler.prototype.sleepMotion=()=>"sleep";Game_Battler.prototype.chantMotion=()=>"chant";Game_Battler.prototype.guardMotion=()=>"guard";Game_Battler.prototype.abnormalMotion=()=>"abnormal";Game_Battler.prototype.dyingMotion=()=>"dying";Game_Battler.prototype.waitMotion=()=>"wait";Yanfly.BEC.Game_Battler_startAnimation=Game_Battler.prototype.startAnimation;
Game_Battler.prototype.startAnimation=function(animationId,mirror,delay){if(!$dataAnimations[animationId])return;Yanfly.BEC.Game_Battler_startAnimation.call(this,animationId,mirror,delay)};Yanfly.BEC.Game_Actor_refresh=Game_Actor.prototype.refresh;Game_Actor.prototype.refresh=function(){this._anchorX=undefined;this._anchorY=undefined;Yanfly.BEC.Game_Actor_refresh.call(this);if($gameParty.inBattle())this.requestStatusRefresh()};Game_Actor.prototype.isSpriteVisible=()=>{if($gameSystem.isSideView())return true;
return Yanfly.Param.BECFrontSprite};Game_Actor.prototype.reflectAnimationId=function(){if(this.actor().reflectAnimationId>0)return this.actor().reflectAnimationId;if(this.currentClass().reflectAnimationId>0)return this.currentClass().reflectAnimationId;for(let i=0;i<this.equips().length;++i){const equip=this.equips()[i];if(equip&&equip.reflectAnimationId>0)return equip.reflectAnimationId}return Game_Battler.prototype.reflectAnimationId.call(this)};Game_Actor.prototype.spriteCanMove=function(){if(this.actor().spriteCannotMove)return false;
if(this.currentClass().spriteCannotMove)return false;for(let i=0;i<this.equips().length;++i){const equip=this.equips()[i];if(equip&&equip.spriteCannotMove)return false}return Game_Battler.prototype.spriteCanMove.call(this)};Game_Actor.prototype.spriteWidth=function(){if($gameSystem.isSideView()&&this.battler())return this.battler()._mainSprite.width;else return 1};Game_Actor.prototype.spriteHeight=function(){if($gameSystem.isSideView()&&this.battler())return this.battler()._mainSprite.height;else return 1};
Game_Actor.prototype.anchorX=function(){if(this._anchorX!==undefined)return this._anchorX;let length=this.states().length;for(let i=0;i<length;++i){var obj=this.states()[i];if(obj&&obj.anchorX!==undefined){this._anchorX=obj.anchorX;return this._anchorX}}length=this.equips().length;for(let i=0;i<length;++i){var obj=this.equips()[i];if(obj&&obj.anchorX!==undefined){this._anchorX=obj.anchorX;return this._anchorX}}if(this.currentClass().anchorX!==undefined){this._anchorX=this.currentClass().anchorX;return this._anchorX}this._anchorX=
this.actor().anchorX;return this._anchorX};Game_Actor.prototype.anchorY=function(){if(this._anchorY!==undefined)return this._anchorY;let length=this.states().length;for(let i=0;i<length;++i){var obj=this.states()[i];if(obj&&obj.anchorY!==undefined){this._anchorY=obj.anchorY;return this._anchorY}}length=this.equips().length;for(let i=0;i<length;++i){var obj=this.equips()[i];if(obj&&obj.anchorY!==undefined){this._anchorY=obj.anchorY;return this._anchorY}}if(this.currentClass().anchorY!==undefined){this._anchorY=
this.currentClass().anchorY;return this._anchorY}this._anchorY=this.actor().anchorY;return this._anchorY};Game_Actor.prototype.spriteFacePoint=function(pointX,pointY){if(this.spritePosX()>pointX)this.spriteFaceForward();else this.spriteFaceBackward()};Game_Actor.prototype.spriteFaceAwayPoint=function(pointX,pointY){if(this.spritePosX()>pointX)this.spriteFaceBackward();else this.spriteFaceForward()};Game_Actor.prototype.performAttack=function(){const weapons=this.weapons();const wtypeId=weapons[0]?
weapons[0].wtypeId:0;const attackMotion=$dataSystem.attackMotions[wtypeId];if(attackMotion){if(attackMotion.type===0)this.forceMotion("thrust");else if(attackMotion.type===1)this.forceMotion("swing");else if(attackMotion.type===2)this.forceMotion("missile");this.startWeaponAnimation(attackMotion.weaponImageId)}};Game_Actor.prototype.attackMotion=function(){const weapons=this.weapons();const wtypeId=weapons[0]?weapons[0].wtypeId:0;const attackMotion=$dataSystem.attackMotions[wtypeId];if(attackMotion)if(attackMotion.type===
0)return"thrust";else if(attackMotion.type===1)return"swing";else if(attackMotion.type===2)return"missile";return"thrust"};Game_Actor.prototype.performEscapeSuccess=function(){if(this.battler()){this.performEscape();this.battler().startMove(300,0,60)}};if(!Game_Enemy.prototype.skills)Game_Enemy.prototype.skills=function(){const skills=[];for(let i=0;i<this.enemy().actions.length;++i){const skill=$dataSkills[this.enemy().actions[i].skillId];if(skill)skills.push(skill)}return skills};Game_Enemy.prototype.performActionStart=
function(action){Game_Battler.prototype.performActionStart.call(this,action);if(!$gameSystem.isSideView()||!this.spriteCanMove())this.requestEffect("whiten")};Yanfly.BEC.Game_Enemy_performDamage=Game_Enemy.prototype.performDamage;Game_Enemy.prototype.performDamage=function(){if($gameSystem.isSideView()){Game_Battler.prototype.performDamage.call(this);SoundManager.playEnemyDamage()}else Yanfly.BEC.Game_Enemy_performDamage.call(this)};Game_Enemy.prototype.attackAnimationId=function(){return this.enemy().attackAnimationId};
Game_Enemy.prototype.attackAnimationId1=function(){return this.attackAnimationId()};Game_Enemy.prototype.attackAnimationId2=function(){return this.attackAnimationId()};Game_Enemy.prototype.reflectAnimationId=function(){if(this.enemy().reflectAnimationId>0)return this.enemy().reflectAnimationId;return Game_Battler.prototype.reflectAnimationId.call(this)};Game_Enemy.prototype.spriteCanMove=function(){if(this.enemy().spriteCannotMove)return false;return Game_Battler.prototype.spriteCanMove.call(this)};
Game_Enemy.prototype.meetsTurnCondition=function(param1,param2){const n=this.turnCount();if(param2===0)return n===param1;else return n>0&&n>=param1&&n%param2===param1%param2};Game_Unit.prototype.createActions=function(){const max=this.members().length;for(let i=0;i<max;++i){const member=this.members()[i];if(member)member.createActions()}};Game_Unit.prototype.requestMotionRefresh=function(){const max=this.members().length;for(let i=0;i<max;++i){const member=this.members()[i];if(member)member.requestMotionRefresh()}};
Game_Unit.prototype.onTurnStart=function(){const max=this.members().length;for(let i=0;i<max;++i){const member=this.members()[i];if(member){member.onTurnStart();member.refresh()}}};Game_Unit.prototype.updateTick=function(){const max=this.members().length;for(let i=0;i<max;++i){const member=this.members()[i];if(member)member.updateTick()}};Game_Unit.prototype.refreshMembers=function(){const group=this.allMembers();const length=group.length;for(let i=0;i<length;++i){const member=group[i];if(member)member.refresh()}};
Game_Party.prototype.performEscapeSuccess=function(){for(let i=0;i<this.members().length;++i){const member=this.members()[i];if(member)member.performEscapeSuccess()}};Game_Troop.prototype.allMembers=function(){return this.members()};Yanfly.BEC.Scene_Battle_update=Scene_Battle.prototype.update;Scene_Battle.prototype.update=function(){Yanfly.BEC.Scene_Battle_update.call(this);this.updateStatusWindowRequests()};Scene_Battle.prototype.updateStatusWindowRequests=function(){if(!this._statusWindow)return;
if(this._statusWindow.isClosed())return;this._statusWindow.updateStatusRequests()};Yanfly.BEC.Scene_Battle_createSkillWindow=Scene_Battle.prototype.createSkillWindow;Scene_Battle.prototype.createSkillWindow=function(){Yanfly.BEC.Scene_Battle_createSkillWindow.call(this);if(Yanfly.Param.BECLowerWindows)this.adjustLowerWindow(this._skillWindow)};Yanfly.BEC.Scene_Battle_createItemWindow=Scene_Battle.prototype.createItemWindow;Scene_Battle.prototype.createItemWindow=function(){Yanfly.BEC.Scene_Battle_createItemWindow.call(this);
if(Yanfly.Param.BECLowerWindows)this.adjustLowerWindow(this._itemWindow)};Yanfly.BEC.Scene_Battle_createActorWindow=Scene_Battle.prototype.createActorWindow;Scene_Battle.prototype.createActorWindow=function(){Yanfly.BEC.Scene_Battle_createActorWindow.call(this);this._actorWindow.x=Graphics.boxWidth-this._actorWindow.width;if(Yanfly.Param.BECSelectHelp)this._actorWindow.setHelpWindow(this._helpWindow)};Yanfly.BEC.Scene_Battle_createEnemyWindow=Scene_Battle.prototype.createEnemyWindow;Scene_Battle.prototype.createEnemyWindow=
function(){Yanfly.BEC.Scene_Battle_createEnemyWindow.call(this);if(Yanfly.Param.BECSelectHelp)this._enemyWindow.setHelpWindow(this._helpWindow)};Scene_Battle.prototype.adjustLowerWindow=(win)=>{win.height=win.fittingHeight(Yanfly.Param.BECWindowRows);win.y=Graphics.boxHeight-win.height};Yanfly.BEC.Scene_Battle_startPartyCommandSelection=Scene_Battle.prototype.startPartyCommandSelection;Scene_Battle.prototype.startPartyCommandSelection=function(){if(this.isStartActorCommand())this.selectNextCommand();
else Yanfly.BEC.Scene_Battle_startPartyCommandSelection.call(this)};Scene_Battle.prototype.isStartActorCommand=function(){if(this._isStartActorCommand===undefined)this._isStartActorCommand=Yanfly.Param.BECStartActCmd;return this._isStartActorCommand};Yanfly.BEC.Scene_Battle_selectPreviousCommand=Scene_Battle.prototype.selectPreviousCommand;Scene_Battle.prototype.selectPreviousCommand=function(){if(this.isStartActorCommand()){BattleManager.selectPreviousCommand();if(BattleManager.isInputting()&&BattleManager.actor())this.startActorCommandSelection();
else Yanfly.BEC.Scene_Battle_startPartyCommandSelection.call(this)}else Yanfly.BEC.Scene_Battle_selectPreviousCommand.call(this)};Yanfly.BEC.Scene_Battle_selectNextCommand=Scene_Battle.prototype.selectNextCommand;Scene_Battle.prototype.selectNextCommand=function(){Yanfly.BEC.Scene_Battle_selectNextCommand.call(this);this._helpWindow.clear();BattleManager.stopAllSelection()};Yanfly.BEC.Scene_Battle_commandSkill=Scene_Battle.prototype.commandSkill;Scene_Battle.prototype.commandSkill=function(){this._helpWindow.clear();
Yanfly.BEC.Scene_Battle_commandSkill.call(this)};Yanfly.BEC.Scene_Battle_commandItem=Scene_Battle.prototype.commandItem;Scene_Battle.prototype.commandItem=function(){this._helpWindow.clear();Yanfly.BEC.Scene_Battle_commandItem.call(this)};Yanfly.BEC.Scene_Battle_startActorCommandSelection=Scene_Battle.prototype.startActorCommandSelection;Scene_Battle.prototype.startActorCommandSelection=function(){BattleManager.createActions();Yanfly.BEC.Scene_Battle_startActorCommandSelection.call(this);this._statusWindow.refresh()};
Yanfly.BEC.Scene_Battle_selectActorSelection=Scene_Battle.prototype.selectActorSelection;Scene_Battle.prototype.selectActorSelection=function(){if(Yanfly.Param.BECSelectHelp)this._helpWindow.show();this._helpWindow.clear();Yanfly.BEC.Scene_Battle_selectActorSelection.call(this);this._actorWindow.autoSelect()};Yanfly.BEC.Scene_Battle_onActorCancel=Scene_Battle.prototype.onActorCancel;Scene_Battle.prototype.onActorCancel=function(){if(Yanfly.Param.BECSelectHelp)this._helpWindow.hide();this._helpWindow.clear();
Yanfly.BEC.Scene_Battle_onActorCancel.call(this);BattleManager.stopAllSelection();BattleManager.clearInputtingAction()};Yanfly.BEC.Scene_Battle_selectEnemySelection=Scene_Battle.prototype.selectEnemySelection;Scene_Battle.prototype.selectEnemySelection=function(){if(Yanfly.Param.BECSelectHelp)this._helpWindow.show();this._helpWindow.clear();Yanfly.BEC.Scene_Battle_selectEnemySelection.call(this);this._enemyWindow.autoSelect()};Yanfly.BEC.Scene_Battle_onEnemyCancel=Scene_Battle.prototype.onEnemyCancel;
Scene_Battle.prototype.onEnemyCancel=function(){if(Yanfly.Param.BECSelectHelp)this._helpWindow.hide();this._helpWindow.clear();Yanfly.BEC.Scene_Battle_onEnemyCancel.call(this);BattleManager.stopAllSelection();BattleManager.clearInputtingAction()};Yanfly.BEC.Scene_Battle_onSelectAction=Scene_Battle.prototype.onSelectAction;Scene_Battle.prototype.onSelectAction=function(){if(Yanfly.Param.BECSelectHelp)BattleManager.forceSelection();this._helpWindow.clear();Yanfly.BEC.Scene_Battle_onSelectAction.call(this);
if(Yanfly.Param.BECSelectHelp)BattleManager.resetSelection()};Yanfly.BEC.Scene_Battle_onSkillOk=Scene_Battle.prototype.onSkillOk;Scene_Battle.prototype.onSkillOk=function(){this._helpWindow.clear();Yanfly.BEC.Scene_Battle_onSkillOk.call(this)};Yanfly.BEC.Scene_Battle_onSkillCancel=Scene_Battle.prototype.onSkillCancel;Scene_Battle.prototype.onSkillCancel=function(){this._helpWindow.clear();Yanfly.BEC.Scene_Battle_onSkillCancel.call(this);BattleManager.clearInputtingAction()};Yanfly.BEC.Scene_Battle_onItemOk=
Scene_Battle.prototype.onItemOk;Scene_Battle.prototype.onItemOk=function(){this._helpWindow.clear();Yanfly.BEC.Scene_Battle_onItemOk.call(this)};Yanfly.BEC.Scene_Battle_onItemCancel=Scene_Battle.prototype.onItemCancel;Scene_Battle.prototype.onItemCancel=function(){this._helpWindow.clear();Yanfly.BEC.Scene_Battle_onItemCancel.call(this);BattleManager.clearInputtingAction()};Yanfly.BEC.Window_Selectable_isCursorMovable=Window_Selectable.prototype.isCursorMovable;Window_Selectable.prototype.isCursorMovable=
function(){if(this._inputLock)return false;return Yanfly.BEC.Window_Selectable_isCursorMovable.call(this)};Yanfly.BEC.Window_Help_clear=Window_Help.prototype.clear;Window_Help.prototype.clear=function(){Yanfly.BEC.Window_Help_clear.call(this);this.contents.clear()};Window_Help.prototype.setBattler=function(battler){this.contents.clear();this.clear();this.resetFontSettings();if(!$gameParty.inBattle())return;if(!battler)return;const action=BattleManager.inputtingAction();if(this.specialSelectionText(action))this.drawSpecialSelectionText(action);
else this.drawBattler(battler)};Window_Help.prototype.specialSelectionText=(action)=>{BattleManager.resetSelection();if(!action)return false;return!action.needsSelection()};Window_Help.prototype.drawBattler=function(battler){const text=battler.name();const wx=0;const wy=(this.contents.height-this.lineHeight())/2;this.drawText(text,wx,wy,this.contents.width,"center")};Window_Help.prototype.drawSpecialSelectionText=function(action){const wx=0;const wy=(this.contents.height-this.lineHeight())/2;let text=
"";if(action.isForUser())text=Yanfly.Param.BECHelpUserTx;else if(action.isForRandom()){BattleManager.startAllSelection();var fmt=Yanfly.Param.BECHelpRandTx;if(action.isForOpponent()&&action.numTargets()!==1)var target=Yanfly.Param.BECHelpEnemiesTx;else if(action.isForOpponent()&&action.numTargets()===1)var target=Yanfly.Param.BECHelpEnemyTx;else if(action.isForFriend()&&action.numTargets()!==1)var target=Yanfly.Param.BECHelpAlliesTx;else var target=Yanfly.Param.BECHelpAllyTx;text=fmt.format(target,
Yanfly.Util.toGroup(action.numTargets()))}else if(action.isForAll()){BattleManager.startAllSelection();var fmt=Yanfly.Param.BECHelpAllTx;if(action.isForOpponent())var target=Yanfly.Param.BECHelpEnemiesTx;else var target=Yanfly.Param.BECHelpAlliesTx;text=fmt.format(target)}this.drawText(text,wx,wy,this.contents.width,"center")};Window_BattleActor.prototype.autoSelect=function(){const action=BattleManager.inputtingAction();if(!action)return;this._inputLock=false;this._selectDead=false;this.setCursorAll(false);
if(action.isForUser()){this.select(BattleManager.actor().index());this._inputLock=true}else if(action.isForAll()){this._inputLock=true;this.setCursorAll(true)}else if(action.isForDeadFriend()){this._selectDead=true;this.autoSelectFirstDeadActor()}this.updateCursor()};Window_BattleActor.prototype.updateCursor=function(){if(this._cursorAll){const allRowsHeight=this.maxRows()*this.itemHeight();this.setCursorRect(0,0,this.contents.width,allRowsHeight);this.setTopRow(0)}else if(this.isCursorVisible()){const rect=
this.itemRect(this.index());this.setCursorRect(rect.x,rect.y,rect.width,rect.height)}else this.setCursorRect(0,0,0,0)};Window_BattleActor.prototype.autoSelectFirstDeadActor=function(){const length=$gameParty.members().length;for(let i=0;i<length;++i){const member=$gameParty.members()[i];if(member&&member.isDead())return this.select(i)}};Window_BattleActor.prototype.isOkEnabled=function(){if(this._selectDead)return this.actor().isDead();return Window_Selectable.prototype.isOkEnabled.call(this)};Window_BattleActor.prototype.updateHelp=
function(){if(!this._helpWindow)return;this._helpWindow.setBattler(this.actor())};Yanfly.BEC.Window_BattleActor_processTouch=Window_BattleActor.prototype.processTouch;Window_BattleActor.prototype.processTouch=function(){if(Yanfly.Param.BECActorSelect&&this.isOpenAndActive()){if(TouchInput.isTriggered()&&!this.isTouchedInsideFrame())if(this.getClickedActor()>=0){var index=this.getClickedActor();if(this.index()===index)return this.processOk();else{SoundManager.playCursor();return this.select(index)}}if(TouchInput.isPressed()&&
!this.isTouchedInsideFrame())if(this.getClickedActor()>=0){var index=this.getClickedActor();if(this.index()!==index){SoundManager.playCursor();return this.select(index)}}if(Yanfly.Param.BECSelectMouseOver){var index=this.getMouseOverActor();if(index>=0&&this.index()!==index){SoundManager.playCursor();return this.select(index)}}}Yanfly.BEC.Window_BattleActor_processTouch.call(this)};Window_BattleActor.prototype.getClickedActor=function(){for(let i=0;i<$gameParty.battleMembers().length;++i){const actor=
$gameParty.battleMembers().reverse()[i];if(!actor)continue;if(this.isClickedActor(actor)){if(this._selectDead&&!actor.isDead())continue;if(this._inputLock&&actor.index()!==this.index())continue;return actor.index()}}return-1};Window_BattleActor.prototype.isClickedActor=(actor)=>{if(!actor)return false;if(!actor.isSpriteVisible())return false;if(!actor.isAppeared())return false;if($gameTemp._disableMouseOverSelect)return false;const x=TouchInput.x;const y=TouchInput.y;const rect=new Rectangle;rect.width=
actor.spriteWidth();rect.height=actor.spriteHeight();rect.x=actor.spritePosX()-rect.width/2;rect.y=actor.spritePosY()-rect.height;return x>=rect.x&&y>=rect.y&&x<rect.x+rect.width&&y<rect.y+rect.height};Window_BattleActor.prototype.getMouseOverActor=function(){for(let i=0;i<$gameParty.battleMembers().length;++i){const actor=$gameParty.battleMembers().reverse()[i];if(!actor)continue;if(this.isMouseOverActor(actor)){if(this._selectDead&&!actor.isDead())continue;if(this._inputLock&&actor.index()!==this.index())continue;
return actor.index()}}return-1};Window_BattleActor.prototype.isMouseOverActor=(actor)=>{if(!actor)return false;if(!actor.isSpriteVisible())return false;if(!actor.isAppeared())return false;if($gameTemp._disableMouseOverSelect)return false;const x=TouchInput._mouseOverX;const y=TouchInput._mouseOverY;const rect=new Rectangle;rect.width=actor.spriteWidth();rect.height=actor.spriteHeight();rect.x=actor.spritePosX()-rect.width/2;rect.y=actor.spritePosY()-rect.height;return x>=rect.x&&y>=rect.y&&x<rect.x+
rect.width&&y<rect.y+rect.height};Yanfly.DisableWebGLMask=false;Yanfly.BEC.Window_BattleEnemy_initialize=Window_BattleEnemy.prototype.initialize;Window_BattleEnemy.prototype.initialize=function(x,y){if(Yanfly.Param.BECEnemySelect){x-=Graphics.boxWidth*200;y-=Graphics.boxHeight*200}Yanfly.BEC.Window_BattleEnemy_initialize.call(this,x,y)};Yanfly.BEC.WindowLayer_webglMaskWindow=WindowLayer.prototype._webglMaskWindow;WindowLayer.prototype._webglMaskWindow=function(renderSession,win){if(win._ignoreMask)return;
Yanfly.BEC.WindowLayer_webglMaskWindow.call(this,renderSession,win)};Yanfly.BEC.Window_BattleEnemy_maxCols=Window_BattleEnemy.prototype.maxCols;Window_BattleEnemy.prototype.maxCols=function(){if(Yanfly.Param.BECEnemySelect)return this._enemies.length;return Yanfly.BEC.Window_BattleEnemy_maxCols.call(this)};Window_BattleEnemy.prototype.allowedTargets=()=>{let targets=[];targets=targets.concat($gameTroop.aliveMembers());return targets};Window_BattleEnemy.prototype.refresh=function(){this._enemies=this.allowedTargets();
this.sortTargets();Window_Selectable.prototype.refresh.call(this)};Window_BattleEnemy.prototype.sortTargets=function(){this._enemies.sort((a,b)=>{if(a.spritePosX()===b.spritePosX())return a.spritePosY()-b.spritePosY();return a.spritePosX()-b.spritePosX()})};Window_BattleEnemy.prototype.autoSelect=function(){if(Yanfly.Param.BECEnemyAutoSel===0||Yanfly.Param.BECEnemyAutoSel==="0")var selectIndex=0;else var selectIndex=this.furthestRight();this.select(selectIndex)};Window_BattleEnemy.prototype.furthestRight=
function(){return this.maxItems()-1};Window_BattleEnemy.prototype.updateHelp=function(){if(!this._helpWindow)return;this._helpWindow.setBattler(this.enemy())};Yanfly.BEC.Window_BattleEnemy_processTouch=Window_BattleEnemy.prototype.processTouch;Window_BattleEnemy.prototype.processTouch=function(){if(Yanfly.Param.BECEnemySelect&&this.isOpenAndActive()){if(TouchInput.isTriggered()&&!this.isTouchedInsideFrame())if(this.getClickedEnemy()>=0){var index=this.getClickedEnemy();if(this.index()===index)return this.processOk();
else{SoundManager.playCursor();return this.select(index)}}if(TouchInput.isPressed()&&!this.isTouchedInsideFrame())if(this.getClickedEnemy()>=0){var index=this.getClickedEnemy();if(this.index()!==index){SoundManager.playCursor();return this.select(index)}}if(Yanfly.Param.BECSelectMouseOver){var index=this.getMouseOverEnemy();if(index>=0&&this.index()!==index){SoundManager.playCursor();return this.select(index)}}}Yanfly.BEC.Window_BattleEnemy_processTouch.call(this)};Window_BattleEnemy.prototype.getClickedEnemy=
function(){for(let i=0;i<this._enemies.length;++i){const enemy=this._enemies[i];if(!enemy)continue;if(this.isClickedEnemy(enemy)){if(this._selectDead&&!enemy.isDead())continue;const index=this._enemies.indexOf(enemy);if(this._inputLock&&index!==this.index())continue;return index}}return-1};Window_BattleEnemy.prototype.isClickedEnemy=(enemy)=>{if(!enemy)return false;if(!enemy.isSpriteVisible())return false;if($gameTemp._disableMouseOverSelect)return false;const x=TouchInput.x;const y=TouchInput.y;
const rect=new Rectangle;rect.width=enemy.spriteWidth();rect.height=enemy.spriteHeight();rect.x=enemy.spritePosX()-rect.width/2;rect.y=enemy.spritePosY()-rect.height;return x>=rect.x&&y>=rect.y&&x<rect.x+rect.width&&y<rect.y+rect.height};Window_BattleEnemy.prototype.getMouseOverEnemy=function(){for(let i=0;i<this._enemies.length;++i){const enemy=this._enemies[i];if(!enemy)continue;if(this.isMouseOverEnemy(enemy)){if(this._selectDead&&!enemy.isDead())continue;const index=this._enemies.indexOf(enemy);
if(this._inputLock&&index!==this.index())continue;return index}}return-1};Window_BattleEnemy.prototype.isMouseOverEnemy=(enemy)=>{if(!enemy)return false;if(!enemy.isSpriteVisible())return false;if($gameTemp._disableMouseOverSelect)return false;const x=TouchInput._mouseOverX;const y=TouchInput._mouseOverY;const rect=new Rectangle;rect.width=enemy.spriteWidth();rect.height=enemy.spriteHeight();rect.x=enemy.spritePosX()-rect.width/2;rect.y=enemy.spritePosY()-rect.height;return x>=rect.x&&y>=rect.y&&
x<rect.x+rect.width&&y<rect.y+rect.height};function Window_EnemyVisualSelect(){this.initialize.apply(this,arguments)}Window_EnemyVisualSelect.prototype=Object.create(Window_Base.prototype);Window_EnemyVisualSelect.prototype.constructor=Window_EnemyVisualSelect;Window_EnemyVisualSelect.prototype.initialize=function(){Window_Base.prototype.initialize.call(this,0,0,1,1);this._battler=null;this._battlerName="";this._requestRefresh=false;this._showSelectCursor=Yanfly.Param.BECShowSelectBox;this._showEnemyName=
Yanfly.Param.BECShowEnemyName;this.contentsOpacity=0;this.opacity=0};Window_EnemyVisualSelect.prototype.setBattler=function(battler){if(this._battler===battler)return;this._battler=battler;this._battlerName=battler.name()};Window_EnemyVisualSelect.prototype.update=function(){Window_Base.prototype.update.call(this);if(!this._battler)return;this.updateWindowAspects()};Window_EnemyVisualSelect.prototype.updateWindowAspects=function(){this.updateBattlerName();this.updateWindowSize();this.updateWindowPosition();
this.updateOpacity();this.updateRefresh();this.updateCursor()};Window_EnemyVisualSelect.prototype.updateBattlerName=function(){if(this._battlerName!==this._battler.name())this._battlerName=this._battler.name();this._requestRefresh=true;this._nameTextWidth=undefined};Window_EnemyVisualSelect.prototype.updateWindowSize=function(){const spriteWidth=this._battler.spriteWidth();this.contents.fontSize=Yanfly.Param.BECEnemyFontSize;if(this._nameTextWidth===undefined)this._nameTextWidth=this.textWidth(this._battler.name());
let textWidth=this._nameTextWidth;textWidth+=this.textPadding()*2;let width=Math.max(spriteWidth,textWidth)+this.standardPadding()*2;width=Math.ceil(width);let height=this._battler.spriteHeight()+this.standardPadding()*2;height=Math.ceil(height);height=Math.max(height,this.lineHeight()+this.standardPadding()*2);if(width===this.width&&height===this.height)return;this.width=width;this.height=height;this.createContents();this._requestRefresh=true;this.makeWindowBoundaries()};Window_EnemyVisualSelect.prototype.makeWindowBoundaries=
function(){if(!this._requestRefresh)return;this._minX=-1*this.standardPadding();this._maxX=Graphics.boxWidth-this.width+this.standardPadding();this._minY=-1*this.standardPadding();this._maxY=Graphics.boxHeight-this.height+this.standardPadding();this._maxY-=SceneManager._scene._statusWindow.height};Window_EnemyVisualSelect.prototype.updateWindowPosition=function(){if(!this._battler)return;this.x=-1*this.width/2;this.y=-1*this.height+this.standardPadding();this.x+=this._battler.spritePosX();this.y+=
this._battler.spritePosY();this.x=this.x.clamp(this._minX,this._maxX);this.y=this.y.clamp(this._minY,this._maxY)};Window_EnemyVisualSelect.prototype.updateOpacity=function(){if(this.isShowWindow())this.contentsOpacity+=32;else this.contentsOpacity-=32};Window_EnemyVisualSelect.prototype.isShowWindow=function(){const scene=SceneManager._scene;if(!scene._enemyWindow)return false;const enemyWindow=scene._enemyWindow;if(!enemyWindow.active)return false;if(!this._battler.isAppeared())return false;if(this._battler.isDead())return enemyWindow._selectDead;
return enemyWindow._enemies.contains(this._battler)};Window_EnemyVisualSelect.prototype.updateCursor=function(){if(this.isShowCursor()){const wy=this.contents.height-this.lineHeight();this.setCursorRect(0,wy,this.contents.width,this.lineHeight())}else this.setCursorRect(0,0,0,0)};Window_EnemyVisualSelect.prototype.isShowCursor=function(){if(!this._showSelectCursor)return false;const scene=SceneManager._scene;if(!scene._enemyWindow)return false;const enemyWindow=scene._enemyWindow;if(!enemyWindow.active)return false;
if(!this._battler.isAppeared())return false;return this._battler.isSelected()};Window_EnemyVisualSelect.prototype.updateRefresh=function(){if(this._requestRefresh)this.refresh()};Window_EnemyVisualSelect.prototype.refresh=function(){this.contents.clear();if(!this._battler)return;if(!this._showEnemyName)return;if(this._battler.isHidden())return;this._requestRefresh=false;this.contents.fontSize=Yanfly.Param.BECEnemyFontSize;const text=this._battler.name();const wy=this.contents.height-this.lineHeight();
this.drawText(text,0,wy,this.contents.width,"center")};Window_PartyCommand.prototype.itemTextAlign=()=>Yanfly.Param.BECCommandAlign;Window_PartyCommand.prototype.numVisibleRows=()=>Yanfly.Param.BECCommandRows;Window_ActorCommand.prototype.itemTextAlign=()=>Yanfly.Param.BECCommandAlign;Window_ActorCommand.prototype.numVisibleRows=()=>Yanfly.Param.BECCommandRows;Window_BattleStatus.prototype.numVisibleRows=()=>Yanfly.Param.BECCommandRows;Window_BattleStatus.prototype.updateStatusRequests=function(){if(BattleManager._victoryPhase)return;
for(let i=0;i<$gameParty.battleMembers().length;++i){const actor=$gameParty.battleMembers()[i];if(!actor)continue;if(actor.isStatusRefreshRequested())this.processStatusRefresh(i)}};Window_BattleStatus.prototype.processStatusRefresh=function(index){const actor=$gameParty.battleMembers()[index];if(!actor)return;const rect=this.itemRect(index);this.contents.clearRect(rect.x,rect.y,rect.width,rect.height);this.drawItem(index);actor.completetStatusRefreshRequest()};Window_BattleStatus.prototype.update=
function(){Window_Selectable.prototype.update.call(this)};if(!Yanfly.Param.BECCurMax)Window_BattleStatus.prototype.drawCurrentAndMax=function(current,max,x,y,width,color1,color2){const labelWidth=this.textWidth("HP");const valueWidth=this.textWidth(Yanfly.Util.toGroup(max));const slashWidth=this.textWidth("/");const x1=x+width-valueWidth;this.changeTextColor(color1);this.drawText(Yanfly.Util.toGroup(current),x1,y,valueWidth,"right")};Yanfly.BEC.Window_BattleLog_isFastForward=Window_BattleLog.prototype.isFastForward;
Window_BattleLog.prototype.isFastForward=function(){if(Yanfly.Param.BECOptSpeed)return true;return Yanfly.BEC.Window_BattleLog_isFastForward.call(this)};Window_BattleLog.prototype.updateWaitCount=function(){if(this._waitCount>0){this._waitCount-=1;if(this._waitCount<0)this._waitCount=0;return true}return false};Window_BattleLog.prototype.animationBaseDelay=()=>Yanfly.Param.BECAniBaseDel;Window_BattleLog.prototype.animationNextDelay=()=>Yanfly.Param.BECAniNextDel;Window_BattleLog.prototype.updateWaitMode=
function(){let waiting=false;switch(this._waitMode){case "effect":waiting=this._spriteset.isEffecting();break;case "movement":waiting=this._spriteset.isAnyoneMoving();break;case "animation":waiting=this._spriteset.isAnimationPlaying();break;case "popups":waiting=this._spriteset.isPopupPlaying();break}if(!waiting)this._waitMode="";return waiting};Window_BattleLog.prototype.startAction=(subject,action,targets)=>{};Window_BattleLog.prototype.endAction=(subject)=>{};Window_BattleLog.prototype.waitForAnimation=
function(){this.setWaitMode("animation")};Window_BattleLog.prototype.waitForEffect=function(){this.setWaitMode("effect")};Window_BattleLog.prototype.waitForPopups=function(){this.setWaitMode("popups")};Yanfly.BEC.Window_BattleLog_displayAction=Window_BattleLog.prototype.displayAction;Window_BattleLog.prototype.displayAction=function(subject,item){if(Yanfly.Param.BECFullActText)Yanfly.BEC.Window_BattleLog_displayAction.call(this,subject,item);else{this._actionIcon=this.displayIcon(item);const text=
this.displayText(item);this.push("addText",`<SIMPLE>${text}`);if(item.message2)this.push("addText",`<CENTER>${item.message2.format(text)}`)}};Window_BattleLog.prototype.displayIcon=(item)=>{if(!item)return 0;return item.battleDisplayIcon};Window_BattleLog.prototype.displayText=(item)=>{if(!item)return"";return item.battleDisplayText};Yanfly.BEC.Window_BattleLog_displayActionResults=Window_BattleLog.prototype.displayActionResults;Window_BattleLog.prototype.displayActionResults=function(subject,target){if(Yanfly.Param.BECOptSpeed){if(target.result().used){this.displayCritical(target);
this.displayDamage(target);this.displayAffectedStatus(target);this.displayFailure(target)}}else Yanfly.BEC.Window_BattleLog_displayActionResults.call(this,subject,target);if(target.isDead())target.performCollapse()};Yanfly.BEC.Window_BattleLog_drawLineText=Window_BattleLog.prototype.drawLineText;Window_BattleLog.prototype.drawLineText=function(index){if(this._lines[index].match("<CENTER>"))this.drawCenterLine(index);else if(this._lines[index].match("<SIMPLE>"))this.drawSimpleActionLine(index);else Yanfly.BEC.Window_BattleLog_drawLineText.call(this,
index)};Window_BattleLog.prototype.textWidthEx=function(text){return this.drawTextEx(text,0,this.contents.height+this.lineHeight())};Window_BattleLog.prototype.drawCenterLine=function(index){const text=this._lines[index].replace("<CENTER>","");const rect=this.itemRectForText(index);this.contents.clearRect(rect.x,rect.y,rect.width,rect.height);const tw=this.textWidthEx(text);const wx=rect.x+(rect.width-tw)/2;this.resetFontSettings();this.drawTextEx(text,wx,rect.y)};Window_BattleLog.prototype.drawSimpleActionLine=
function(index){const text=this._lines[index].replace("<SIMPLE>","");const rect=this.itemRectForText(index);this.contents.clearRect(rect.x,rect.y,rect.width,rect.height);if(this._actionIcon){const tw=this.textWidth(text);const ix=(rect.width-tw)/2-4;this.drawIcon(this._actionIcon,ix,rect.y+2)}this.drawText(text,rect.x,rect.y,Graphics.boxWidth,"center")};Window_BattleLog.prototype.displayCounter=function(target){if(Yanfly.Param.BECShowCntText)this.addText(TextManager.counterAttack.format(target.name()));
target.performCounter();this.showAttackAnimation(target,[BattleManager._subject]);this.waitForAnimation()};Window_BattleLog.prototype.displayReflection=function(target){if(Yanfly.Param.BECShowRflText)this.addText(TextManager.magicReflection.format(target.name()));target.performReflection();const animationId=BattleManager._action.item().animationId;this.showNormalAnimation([BattleManager._subject],animationId);this.waitForAnimation()};Window_BattleLog.prototype.displaySubstitute=function(substitute,
target){if(Yanfly.Param.BECShowSubText){const substName=substitute.name();this.addText(TextManager.substitute.format(substName,target.name()))}substitute.performSubstitute(target)};Yanfly.BEC.Window_BattleLog_displayFailure=Window_BattleLog.prototype.displayFailure;Window_BattleLog.prototype.displayFailure=function(target){if(!Yanfly.Param.BECShowFailText)return;Yanfly.BEC.Window_BattleLog_displayFailure.call(this,target)};Yanfly.BEC.Window_BattleLog_displayCritical=Window_BattleLog.prototype.displayCritical;
Window_BattleLog.prototype.displayCritical=function(target){if(!Yanfly.Param.BECShowCritText)return;Yanfly.BEC.Window_BattleLog_displayCritical.call(this,target)};Yanfly.BEC.Window_BattleLog_displayMiss=Window_BattleLog.prototype.displayMiss;Window_BattleLog.prototype.displayMiss=function(target){if(!Yanfly.Param.BECShowMissText)return;Yanfly.BEC.Window_BattleLog_displayMiss.call(this,target)};Yanfly.BEC.Window_BattleLog_displayEvasion=Window_BattleLog.prototype.displayEvasion;Window_BattleLog.prototype.displayEvasion=
function(target){if(!Yanfly.Param.BECShowEvaText)return;Yanfly.BEC.Window_BattleLog_displayEvasion.call(this,target)};Yanfly.BEC.Window_BattleLog_displayHpDamage=Window_BattleLog.prototype.displayHpDamage;Window_BattleLog.prototype.displayHpDamage=function(target){if(!Yanfly.Param.BECShowHpText)return;Yanfly.BEC.Window_BattleLog_displayHpDamage.call(this,target)};Yanfly.BEC.Window_BattleLog_displayMpDamage=Window_BattleLog.prototype.displayMpDamage;Window_BattleLog.prototype.displayMpDamage=function(target){if(!Yanfly.Param.BECShowMpText)return;
Yanfly.BEC.Window_BattleLog_displayMpDamage.call(this,target)};Yanfly.BEC.Window_BattleLog_displayTpDamage=Window_BattleLog.prototype.displayTpDamage;Window_BattleLog.prototype.displayTpDamage=function(target){if(!Yanfly.Param.BECShowTpText)return;Yanfly.BEC.Window_BattleLog_displayTpDamage.call(this,target)};Yanfly.BEC.Window_BattleLog_displayCurrentState=Window_BattleLog.prototype.displayCurrentState;Window_BattleLog.prototype.displayCurrentState=function(subject){if(!Yanfly.Param.BECShowStateText)return;
Yanfly.BEC.Window_BattleLog_displayCurrentState.call(this,subject)};Yanfly.BEC.Window_BattleLog_displayAddedStates=Window_BattleLog.prototype.displayAddedStates;Window_BattleLog.prototype.displayAddedStates=function(target){if(!Yanfly.Param.BECShowStateText)return;Yanfly.BEC.Window_BattleLog_displayAddedStates.call(this,target)};Yanfly.BEC.Window_BattleLog_displayRemovedStates=Window_BattleLog.prototype.displayRemovedStates;Window_BattleLog.prototype.displayRemovedStates=function(target){if(!Yanfly.Param.BECShowStateText)return;
Yanfly.BEC.Window_BattleLog_displayRemovedStates.call(this,target)};Yanfly.BEC.Window_BattleLog_displayChangedBuffs=Window_BattleLog.prototype.displayChangedBuffs;Window_BattleLog.prototype.displayChangedBuffs=function(target){if(!Yanfly.Param.BECShowBuffText)return;Yanfly.BEC.Window_BattleLog_displayChangedBuffs.call(this,target)};Window_BattleLog.prototype.popupDamage=(target)=>{};Yanfly.BEC.Window_BattleLog_showEnemyAttackAnimation=Window_BattleLog.prototype.showEnemyAttackAnimation;Window_BattleLog.prototype.showEnemyAttackAnimation=
function(subject,targets){if($gameSystem.isSideView())this.showNormalAnimation(targets,subject.attackAnimationId(),false);else{this.showNormalAnimation(targets,subject.attackAnimationId(),false);Yanfly.BEC.Window_BattleLog_showEnemyAttackAnimation.call(this,subject,targets)}};Window_BattleLog.prototype.showActorAtkAniMirror=function(subject,targets){if(subject.isActor()){this.showNormalAnimation(targets,subject.attackAnimationId1(),true);this.showNormalAnimation(targets,subject.attackAnimationId2(),
false)}else this.showNormalAnimation(targets,subject.attackAnimationId1(),true)};Yanfly.Util=Yanfly.Util||{};Yanfly.Util.displayError=(e,code,message)=>{console.log(message);console.log(code||"NON-EXISTENT");console.error(e);if(Utils.RPGMAKER_VERSION&&Utils.RPGMAKER_VERSION>="1.6.0")return;if(Utils.isNwjs()&&Utils.isOptionValid("test"))if(!require("nw.gui").Window.get().isDevToolsOpen())require("nw.gui").Window.get().showDevTools()};if(!Yanfly.Util.toGroup)Yanfly.Util.toGroup=(inVal)=>inVal;Yanfly.Util.getRange=
(n,m)=>{const result=[];for(let i=n;i<=m;++i)result.push(i);return result};Yanfly.Util.onlyUnique=(value,index,self)=>self.indexOf(value)===index})();(function(){function Window_CreditsPage(){this.initialize.apply(this,arguments)}Window_CreditsPage.prototype=Object.create(Window_Command.prototype);Window_CreditsPage.prototype.constructor=Window_CreditsPage;Window_CreditsPage.prototype.initialize=function(){Window_Command.prototype.initialize.call(this,0,0);this.openness=0};Window_CreditsPage.prototype.windowWidth=function(){return Graphics.boxWidth};Window_CreditsPage.prototype.windowHeight=function(){return Graphics.boxHeight/1.5};const credit=
`
  \\c[17]\\{#{text_credited_title1}
\\c[6]\\{#{text_credited_title2}
\\c[8]Copyright \u00a9 2019 UHPD Games
\\c[29]Developed by:\\c[2]UHPD Games
\\c[29]Written by:\\c[2]Ung Hoang Phi Dang
\\c[29]Solving puzzle design, GDD:\\c[2]Ung Hoang Phi Dang
\\c[29]Parallax Mapping and Coder (ES6+, kotlin):\\c[2]Ung Hoang Phi Dang
\\c[29]Graphics:\\c[2]nanikasiratkool, comshou, Kadokawa
\\c[29]Art, characters:\\c[2]nanikasiratkool
\\c[29]Skill animation: \\c[2]Hadecynn
\\c[29]Character animation skeleton: \\c[2]Ung Hoang Phi Dang
\\c[29]Windowskins: \\c[2]SkottyTV
\\c[29]Fonts SHPinscher: \\c[2]Sayshu
\\c[29]JS Plugin/ addon: \\c[2]Aloe Guvner, SumRndmDde,
\\c[2]Lecode, Hime, Quxios, Yanfly, Vlue, Iavra, KanaX, and Galv.
\\c[29]The softwares: \\c[2]RPG Maker MV engine, QMapEditor, 
\\c[2]PyxelEdit, Draw.io, Tilde, Twine and Spriter pro.
\\c[29]The other tools: \\c[2]Orange mapshot: Hudell, 
\\c[2]document for development (code): Kino
\\c[29]JS Libraries : \\c[2]Pixijs v5, TWEEN, CrytoJS, EasyStar.js
\\c[29]Modern Battle Theme 3: Scythuz
\\c[29]Background Music: johnleonardfrench
\\c[29]Sound FX: Imphenzia
  `;Window_CreditsPage.prototype.makeCommandList=function(){const CreditsLine=credit.split("\n");for(const t of CreditsLine)this.addCommand(t,"credit",false,false)};Window_CreditsPage.prototype.drawItem=function(index){const rect=this.itemRectForText(index);const align=this.itemTextAlign();const text=this.commandName(index);this.resetTextColor();this.changePaintOpacity(1);this.drawTextEx(text,rect.x,rect.y,rect.width,align)};Scene_GameEnd.prototype.onCreditsCancel=function(){this._creditsWindow.close();
this._creditsWindow.deactivate();this._creditsWindow.hide()};Scene_GameEnd.prototype.onCreditsOk=function(){this._creditsWindow.show();this._creditsWindow.select(0);this._creditsWindow.activate();this._creditsWindow.open()};Scene_GameEnd.prototype.createCommandWindow=function(){this._commandWindow=new Window_GameEnd;this._commandWindow.setHandler("credit",this.onCreditsOk.bind(this));this._commandWindow.setHandler("cancel",this.popScene.bind(this));this.addWindow(this._commandWindow);this._creditsWindow=
new Window_CreditsPage;this._creditsWindow.y=48;this.onCreditsCancel();this._creditsWindow.setHandler("cancel",this.popScene.bind(this));this.addWindow(this._creditsWindow)};Window_GameEnd.prototype.makeCommandList=function(){this.addCommand("Credits","credit",true);this.addCommand("#{commands.22}","cancel",true)}})();Imported.YEP_OptionsCore=true;Yanfly.Options=Yanfly.Options||{};Yanfly.Options.version=1.02;
(function(){const removeOldLang=(newLang)=>{if($gameText[currentLang])$gameText[currentLang]=null;if(newLang){newLang=String(newLang).substring(0,2);window.currentLang=newLang;loadNewLang();for(const t of listLang){if(!$gameText[t])$gameText[t]={};$gameText[t]["lang.label"]=t}}};const _prevLanguage=(language)=>{const index=listLang.indexOf(language)+1;const newLang=listLang[index>=listLang.length?0:index];removeOldLang(newLang);return newLang};const _nextLanguage=(language)=>{const index=listLang.indexOf(language)-
1;const newLang=listLang[index<0?listLang.length-1:index];removeOldLang(newLang);return newLang};Yanfly.Parameters=PluginManager.parameters("YEP_OptionsCore");Yanfly.Param=Yanfly.Param||{};Yanfly.Param.OptionsAllCmd=String(Yanfly.Parameters["AllCommand"]);Yanfly.Param.OptionsAllCmdHelp=String(Yanfly.Parameters["AllHelpDesc"]);Yanfly.Param.OptionsExitCmd=String(Yanfly.Parameters["ExitCommand"]);Yanfly.Param.OptionsExitCmdHelp=String(Yanfly.Parameters["ExitHelpDesc"]);Yanfly.Param.OptionsCategoryWidth=
Number(Yanfly.Parameters["CategoryWidth"]);Yanfly.Param.OptionsStatusWidth=Number(Yanfly.Parameters["StatusWidth"]);Yanfly.Param.OptionsVolumeOffset=Number(Yanfly.Parameters["VolumeOffset"]);Yanfly.Param.OptionsWinToneOffset=Number(Yanfly.Parameters["WindowToneOffset"]);Yanfly.SetupParameters=function(){Yanfly.Param.OptionsSymbols={};var data=JSON.parse(Yanfly.Parameters["OptionsCategories"]);var length=data.length;for(let i=0;i<length;++i){data[i]=JSON.parse(data[i]);data[i]["OptionsList"]=JSON.parse(data[i]["OptionsList"]);
var optionsLength=data[i]["OptionsList"].length;for(let j=0;j<optionsLength;++j){data[i]["OptionsList"][j]=JSON.parse(data[i]["OptionsList"][j]);var settings=data[i]["OptionsList"][j];var symbol=settings.Symbol;var name=symbol;eval(JSON.parse(settings.DefaultConfigCode));Yanfly.Param.OptionsSymbols[symbol]={SaveConfigCode:settings.SaveConfigCode,LoadConfigCode:settings.LoadConfigCode}}}Yanfly.Param.OptionsCategories=data};Yanfly.SetupParameters();ConfigManager.masterVolume=100;Object.defineProperty(ConfigManager,
"masterVolume",{get:function(){return parseInt(AudioManager.masterVolume*100)},set:function(value){AudioManager.masterVolume=value/100},configurable:true});Yanfly.Options.ConfigManager_makeData=ConfigManager.makeData;ConfigManager.makeData=function(){var config=Yanfly.Options.ConfigManager_makeData.call(this);for(let key in Yanfly.Param.OptionsSymbols){var setting=Yanfly.Param.OptionsSymbols[key];var symbol=key;var name=symbol;eval(JSON.parse(Yanfly.Param.OptionsSymbols[key].SaveConfigCode))}return config};
Yanfly.Options.ConfigManager_applyData=ConfigManager.applyData;ConfigManager.applyData=function(config){Yanfly.Options.ConfigManager_applyData.call(this,config);for(let key in Yanfly.Param.OptionsSymbols){var setting=Yanfly.Param.OptionsSymbols[key];var symbol=key;var name=symbol;eval(JSON.parse(Yanfly.Param.OptionsSymbols[key].LoadConfigCode))}};function Window_OptionsCategory(){this.initialize.apply(this,arguments)}Window_OptionsCategory.prototype=Object.create(Window_Command.prototype);Window_OptionsCategory.prototype.constructor=
Window_OptionsCategory;Window_OptionsCategory.prototype.initialize=function(helpWin,optionsWin){var x=0;var y=helpWin.y+helpWin.height;this._width=Yanfly.Param.OptionsCategoryWidth;this._height=Graphics.boxHeight-y;Window_Command.prototype.initialize.call(this,x,y);this.setOptionsWindow(optionsWin);this.setHelpWindow(helpWin);this.refresh();this.select(0);this.activate()};Window_OptionsCategory.prototype.windowWidth=function(){return this._width};Window_OptionsCategory.prototype.windowHeight=function(){return this._height};
Window_OptionsCategory.prototype.setOptionsWindow=function(optionsWindow){this._optionsWindow=optionsWindow};Window_OptionsCategory.prototype.makeCommandList=function(){this.addAllCommand();this.addCategoryList();this.addExitCommand()};Window_OptionsCategory.prototype.addCategoryList=function(){var categories=Yanfly.Param.OptionsCategories;var length=categories.length;for(let i=0;i<length;++i){var category=categories[i];var name=category.Name;this.addCommand(name,"category",true,category)}};Window_OptionsCategory.prototype.addAllCommand=
function(){if(!Yanfly.Param.OptionsAllCmd)return;var data={HelpDesc:Yanfly.Param.OptionsAllCmdHelp,OptionsList:[]};for(let key in Yanfly.Param.OptionsCategories){var category=Yanfly.Param.OptionsCategories[key];var list=category.OptionsList;if(list){var length=list.length;for(let i=0;i<length;++i)data.OptionsList.push(list[i])}}this.addCommand(Yanfly.Param.OptionsAllCmd,"category",true,data)};Window_OptionsCategory.prototype.addExitCommand=function(){if(!Yanfly.Param.OptionsExitCmd)return;var data=
{HelpDesc:Yanfly.Param.OptionsExitCmdHelp,OptionsList:[]};this.addCommand(Yanfly.Param.OptionsExitCmd,"cancel",true,data)};Window_OptionsCategory.prototype.updateHelp=function(){if(!this._helpWindow)return;if(this.currentExt()){var data=this.currentExt();this._helpWindow.setText(JSON.parse(data.HelpDesc));if(data.OptionsList.length>0)this._optionsWindow.makeCommandListFromData(data.OptionsList);else this._optionsWindow.clearRefresh()}else this._helpWindow.clear()};Window_OptionsCategory.prototype.drawItem=
function(index){var rect=this.itemRectForText(index);var align=this.itemTextAlign();this.resetTextColor();this.changePaintOpacity(this.isCommandEnabled(index));this.drawTextEx(this.commandName(index),rect.x,rect.y)};Window_Options.prototype.initialize=function(){this._commandListData=undefined;Window_Command.prototype.initialize.call(this,0,0);this.deactivate();this.deselect()};Window_Options.prototype.updatePlacement=function(){this._placementUpdated=true;this.x=Yanfly.Param.OptionsCategoryWidth;
this.y=this._helpWindow.y+this._helpWindow.height};Window_Options.prototype.windowWidth=function(){return Graphics.boxWidth-Yanfly.Param.OptionsCategoryWidth};Window_Options.prototype.windowHeight=function(){if(this._placementUpdated)return Graphics.boxHeight-this.y;else return Graphics.boxHeight-this.fittingHeight(2)};Window_Options.prototype.setHelpWindow=function(helpWindow){Window_Command.prototype.setHelpWindow.call(this,helpWindow);this.updatePlacement();this.refresh()};Window_Options.prototype.clearRefresh=
function(){this.clearCommandList();this.createContents();Window_Selectable.prototype.refresh.call(this)};Window_Options.prototype.makeCommandList=function(){if(!this._commandListData)return;this._symbolData={};var data=this._commandListData;var length=data.length;for(let i=0;i<length;++i)this.processCommandData(data[i])};Window_Options.prototype.statusWidth=function(){return Math.min(Yanfly.Param.OptionsStatusWidth,this.contents.width/2)};Window_Options.prototype.volumeOffset=function(){return Yanfly.Param.OptionsVolumeOffset||
20};Window_Options.prototype.windowToneOffset=function(){return Yanfly.Param.OptionsWinToneOffset||5};Window_Options.prototype.makeCommandListFromData=function(data){if(!data)return;this._commandListData=data;this.refresh()};Window_Options.prototype.processCommandData=function(data){var show=false;eval(JSON.parse(data.ShowHide));if(!show)return;var name=data.Name;if(name==="<insert option name>")return;if(name.match(/EVAL:[ ](.*)/i)){var code=String(RegExp.$1);try{name=eval(code)}catch(e){Yanfly.Util.displayError(e,
formula,"CUSTOM OPTIONS NAME ERROR")}}var symbol=data.Symbol;if(symbol==="<insert option symbol>")symbol=name;var enable=false;var ext=0;eval(JSON.parse(data.Enable));eval(JSON.parse(data.Ext));eval(JSON.parse(data.MakeCommandCode));this._symbolData[symbol]={DrawItemCode:data.DrawItemCode,ProcessOkCode:data.ProcessOkCode,CursorLeftCode:data.CursorLeftCode,CursorRightCode:data.CursorRightCode,HelpDesc:data.HelpDesc}};Yanfly.Options.Window_Options_drawItem=Window_Options.prototype.drawItem;Window_Options.prototype.drawItem=
function(index){var symbol=this.commandSymbol(index);if(symbol)eval(JSON.parse(this._symbolData[symbol].DrawItemCode));else Yanfly.Options.Window_Options_drawItem.call(this,index)};Window_Options.prototype.drawOptionsName=function(index){var rect=this.itemRectForText(index);var statusWidth=this.statusWidth();var titleWidth=rect.width-statusWidth;this.resetTextColor();this.changePaintOpacity(this.isCommandEnabled(index));Graphics.boxWidth;this.drawTextEx(this.commandName(index),rect.x,rect.y)};Window_Options.prototype.drawOptionsOnOff=
function(index,onText,offText){onText=onText||"ON";offText=offText||"OFF";var rect=this.itemRectForText(index);var statusWidth=this.statusWidth();var halfStatusWidth=this.statusWidth()/2;var titleWidth=rect.width-statusWidth;this.resetTextColor();var symbol=this.commandSymbol(index);var value=this.getConfigValue(symbol);this.changePaintOpacity(!value);this.drawText(offText,titleWidth,rect.y,halfStatusWidth,"center");this.changePaintOpacity(value);this.drawText(onText,titleWidth+halfStatusWidth,rect.y,
halfStatusWidth,"center")};Window_Options.prototype.drawOptionsGauge=function(index,rate,c1,c2){var rect=this.itemRectForText(index);var statusWidth=this.statusWidth();var halfStatusWidth=this.statusWidth()/2;var titleWidth=rect.width-statusWidth;this.drawGauge(titleWidth,rect.y,statusWidth,rate,c1,c2)};Yanfly.Options.Window_Options_processOk=Window_Options.prototype.processOk;Window_Options.prototype.processOk=function(){var symbol=this.commandSymbol(this.index());if(symbol)eval(JSON.parse(this._symbolData[symbol].ProcessOkCode));
else Yanfly.Options.Window_Options_processOk.call(this)};Yanfly.Options.Window_Options_cursorLeft=Window_Options.prototype.cursorLeft;Window_Options.prototype.cursorLeft=function(wrap){var symbol=this.commandSymbol(this.index());if(symbol)eval(JSON.parse(this._symbolData[symbol].CursorLeftCode));else Yanfly.Options.Window_Options_cursorLeft.call(this,wrap)};Yanfly.Options.Window_Options_cursorRight=Window_Options.prototype.cursorRight;Window_Options.prototype.cursorRight=function(wrap){var symbol=
this.commandSymbol(this.index());if(symbol)eval(JSON.parse(this._symbolData[symbol].CursorRightCode));else Yanfly.Options.Window_Options_cursorRight.call(this,wrap)};Window_Options.prototype.changeWindowTone=function(symbol,value,color){var index=["red","green","blue"].indexOf(color);if(index<0)return;var tone=JsonEx.makeDeepCopy($gameSystem.windowTone());var lastValue=tone[index];tone[index]=value.clamp(-255,255);if(lastValue!==tone[index]){$gameSystem.setWindowTone(tone);this.redrawItem(this.findSymbol(symbol));
SoundManager.playCursor()}};Window_Options.prototype.updateHelp=function(){if(!this._helpWindow)return;if(this.index()<0)return;var symbol=this.commandSymbol(this.index());if(this._symbolData&&this._symbolData[symbol])this._helpWindow.setText(JSON.parse(this._symbolData[symbol].HelpDesc));else this._helpWindow.clear()};Scene_Options.prototype.create=function(){Scene_MenuBase.prototype.create.call(this);this.createHelpWindow();this.createOptionsWindow();this.createCategoryWindow();this._categoryWindow.x=
0;this._categoryWindow.y=96;this._optionsWindow.y=96;this._optionsWindow.x=this._categoryWindow.width||0;this._categoryWindow._height=this._optionsWindow._height=this._categoryWindow.height=this._optionsWindow.height=Graphics.boxHeight/2};Yanfly.Options.Scene_Options_createOptionsWindow=Scene_Options.prototype.createOptionsWindow;Scene_Options.prototype.createOptionsWindow=function(){Yanfly.Options.Scene_Options_createOptionsWindow.call(this);this._optionsWindow.setHelpWindow(this._helpWindow);this._optionsWindow.setHandler("cancel",
this.onOptionsCancel.bind(this))};Scene_Options.prototype.createCategoryWindow=function(){var helpWin=this._helpWindow;var optionsWin=this._optionsWindow;this._categoryWindow=new Window_OptionsCategory(helpWin,optionsWin);this._categoryWindow.setHandler("cancel",this.popScene.bind(this));this._categoryWindow.setHandler("category",this.onCategoryOk.bind(this));this.addWindow(this._categoryWindow)};Scene_Options.prototype.onCategoryOk=function(){this._optionsWindow.activate();this._optionsWindow.select(0)};
Scene_Options.prototype.onOptionsCancel=function(){this._optionsWindow.deselect();this._categoryWindow.activate()};Yanfly.Util=Yanfly.Util||{};Yanfly.Util.displayError=function(e,code,message){console.log(message);console.log(code||"NON-EXISTENT");console.error(e);if(Utils.RPGMAKER_VERSION&&Utils.RPGMAKER_VERSION>="1.6.0")return;if(Utils.isNwjs()&&Utils.isOptionValid("test"))if(!require("nw.gui").Window.get().isDevToolsOpen())require("nw.gui").Window.get().showDevTools()}})();(()=>{function Sprite_IconBalloon(...args){this.initialize(...args)}function Sprite_GrowingBalloonIcon(...args){this.initialize(...args)}const ballonFilename="EmptyBalloon";const alise_Game_CharacterBase_initMembers=Game_CharacterBase.prototype.initMembers;Game_CharacterBase.prototype.initMembers=function(){alise_Game_CharacterBase_initMembers.call(this);this._iconBalloon=[]};Game_CharacterBase.prototype.iconBalloonId=function(){return this._iconBalloon||[]};Game_CharacterBase.prototype.setIconBalloon=
function(iconIndex1,iconIndex2){this._iconBalloon=[iconIndex1,iconIndex2]};Game_CharacterBase.prototype.startIconBalloon=function(){this._iconBalloon=[];this._iconBalloonPlaying=true};Game_CharacterBase.prototype.isIconBalloonPlaying=function(){return this._iconBalloon.length>0||this._iconBalloonPlaying};Game_CharacterBase.prototype.endIconBalloon=function(){this._iconBalloon=[];this._iconBalloonPlaying=false};Game_Interpreter.prototype.argsToString=function(args){return args.join(" ")};Game_Interpreter.prototype.canShowIconBalloons=
()=>!$gameParty.inBattle();Game_Interpreter.prototype.processIconBalloons=function(str){str=str.replace("This Event",`Event ${this._eventId}`)||"";let iconIndex1,iconIndex2;if(str.match(/(\d+)[ ]TO[ ](\d+)[ ](.*)/i)){iconIndex1=parseInt(RegExp.$1);iconIndex2=parseInt(RegExp.$2);str=String(RegExp.$3).trim();if(iconIndex1>iconIndex2)return}else if(str.match(/(\d+)[ ](.*)/i)){iconIndex1=parseInt(RegExp.$1);iconIndex2=iconIndex1;str=String(RegExp.$2).trim()}else return;if(!iconIndex1)return;if(!iconIndex2)return;
if(!str)return;let waiting=false;if(str.match(/WAIT/i))waiting=true;if(str.match(/PLAYER/i)){$gamePlayer.setIconBalloon(iconIndex1,iconIndex2);this._character=$gamePlayer}else if(str.match(/EVENT[ ](\d+)/i)){let eventId=parseInt(RegExp.$1);let ev=$gameMap.event(eventId);if(ev){ev.setIconBalloon(iconIndex1,iconIndex2);this._character=ev}}else if(str.match(/FOLLOWER[ ](\d+)/i)){let followerIndex=Math.max(0,parseInt(RegExp.$1)-1);let follower=$gamePlayer.followers().follower(followerIndex);if(follower){follower.setIconBalloon(iconIndex1,
iconIndex2);this._character=follower}}this._waitMode="";if(waiting)this.setWaitMode("iconBalloon")};const alise_Game_Interpreter_updateWaitMode=Game_Interpreter.prototype.updateWaitMode;Game_Interpreter.prototype.updateWaitMode=function(){if(this._waitMode==="iconBalloon")return this._character.isIconBalloonPlaying();else return alise_Game_Interpreter_updateWaitMode.call(this)};const alise_Sprite_Character_setupBalloon=Sprite_Character.prototype.setupBalloon;Sprite_Character.prototype.setupBalloon=
function(){alise_Sprite_Character_setupBalloon.call(this);if(this._character.iconBalloonId().length>0){this.startIconBalloon();this._character.startIconBalloon()}};Sprite_Character.prototype.startIconBalloon=function(){if(!this._iconBalloonSprite)this._iconBalloonSprite=new Sprite_IconBalloon;this._iconBalloonSprite.setup(this._character.iconBalloonId());this.parent.addChild(this._iconBalloonSprite)};const alise_Sprite_Character_updateBalloon=Sprite_Character.prototype.updateBalloon;Sprite_Character.prototype.updateBalloon=
function(){alise_Sprite_Character_updateBalloon.call(this);this.updateIconBalloon()};Sprite_Character.prototype.updateIconBalloon=function(){if(this._iconBalloonSprite){this._iconBalloonSprite.x=this.x;this._iconBalloonSprite.y=this.y-this.height;if(!this._iconBalloonSprite.isPlaying())this.endIconBalloon()}};Sprite_Character.prototype.endIconBalloon=function(){if(this._iconBalloonSprite){this.parent.removeChild(this._iconBalloonSprite);this._iconBalloonSprite=null;this._character.endIconBalloon()}};
Sprite_Character.prototype.isIconBalloonPlaying=function(){return!!this._iconBalloonSprite};Sprite_IconBalloon.prototype=Object.create(Sprite_Balloon.prototype);Sprite_IconBalloon.prototype.constructor=Sprite_IconBalloon;Sprite_IconBalloon.prototype.initialize=function(){Sprite_Balloon.prototype.initialize.call(this)};Sprite_IconBalloon.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem(ballonFilename);this.setFrame(0,0,0,0)};Sprite_IconBalloon.prototype.setup=function(iconData){this._duration=
8*this.speed()+this.waitTime();if(this._icon)this._icon.setIconIndex(iconData);else{this._icon=new Sprite_GrowingBalloonIcon(iconData,this._duration);this.addChild(this._icon)}};Sprite_IconBalloon.prototype.updateFrame=function(){var w=48;var h=48;var sx=this.frameIndex()*w;var sy=0;this.setFrame(sx,sy,w,h)};Sprite_GrowingBalloonIcon.prototype=Object.create(Sprite_Base.prototype);Sprite_GrowingBalloonIcon.prototype.constructor=Sprite_Balloon;Sprite_GrowingBalloonIcon.prototype.initialize=function(iconData,
duration){this._speed=6;this._duration=duration;this._count=0;this._growth=1/(duration/this._speed)||1;Sprite_Base.prototype.initialize.call(this);this.setIconIndex(iconData);this.loadBitmap();this.anchor.x=.5;this.anchor.y=.5;var buffer=-28;this.y=buffer};Sprite_GrowingBalloonIcon.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("IconSet");this.setFrame(0,0,0,0)};Sprite_GrowingBalloonIcon.prototype.setIconIndex=function(iconData){this._iconIndex=iconData[0];this._iconIndexGoal=
iconData[1];this._waitFrames=this._duration*2/3;this._waitFrames/=Math.max(1,iconData[1]-iconData[0]);this._count=this._waitFrames;if(this._iconIndex===this._iconIndexGoal)this.scale.y=0;else this.scale.y=1};Sprite_GrowingBalloonIcon.prototype.update=function(){Sprite.prototype.update.call(this);this.scale.y=Math.min(1,this.scale.y+this._growth);this.updateFrame();this.updateCount()};Sprite_GrowingBalloonIcon.prototype.updateFrame=function(){var pw=Sprite_StateIcon._iconWidth;var ph=Sprite_StateIcon._iconHeight;
var sx=this._iconIndex%16*pw;var sy=Math.floor(this._iconIndex/16)*ph;this.setFrame(sx,sy,pw,ph)};Sprite_GrowingBalloonIcon.prototype.updateCount=function(){this._count-=1;if(this._count<=0){this._iconIndex=Math.min(this._iconIndexGoal,this._iconIndex+1);this._count=this._waitFrames}}})();Imported.YEP_EnemyLevels=true;Yanfly.ELV=Yanfly.ELV||{};Yanfly.ELV.version=1.09;
(function(){Yanfly.Parameters=PluginManager.parameters("YEP_EnemyLevels");Yanfly.Param=Yanfly.Param||{};Yanfly.Param.ELVShow=eval(String(Yanfly.Parameters["Show Level"]));Yanfly.Param.ELVFmt=String(Yanfly.Parameters["Level Format"]);Yanfly.Param.ELVMinLv=Number(Yanfly.Parameters["Minimum Level"]);Yanfly.Param.ELVMaxLv=Number(Yanfly.Parameters["Maximum Level"]);Yanfly.Param.ELVMaxCap=Number(Yanfly.Parameters["Maximum Cap"]);Yanfly.Param.ELVPreserveRate=eval(String(Yanfly.Parameters["Preserve Rate"]));
Yanfly.Param.ELVDefaultType=Number(Yanfly.Parameters["Default Type"]);Yanfly.Param.ELVPosFluc=Number(Yanfly.Parameters["Positive Fluctuation"]);Yanfly.Param.ELVNegFluc=Number(Yanfly.Parameters["Negative Fluctuation"]);Yanfly.Param.ELVFormula=[String(Yanfly.Parameters["MaxHP Formula"]),String(Yanfly.Parameters["MaxMP Formula"]),String(Yanfly.Parameters["ATK Formula"]),String(Yanfly.Parameters["DEF Formula"]),String(Yanfly.Parameters["MAT Formula"]),String(Yanfly.Parameters["MDF Formula"]),String(Yanfly.Parameters["AGI Formula"]),
String(Yanfly.Parameters["LUK Formula"]),String(Yanfly.Parameters["EXP Formula"]),String(Yanfly.Parameters["Gold Formula"])];Yanfly.Param.ELVRate=[Number(Yanfly.Parameters["MaxHP Rate Growth"]),Number(Yanfly.Parameters["MaxMP Rate Growth"]),Number(Yanfly.Parameters["ATK Rate Growth"]),Number(Yanfly.Parameters["DEF Rate Growth"]),Number(Yanfly.Parameters["MAT Rate Growth"]),Number(Yanfly.Parameters["MDF Rate Growth"]),Number(Yanfly.Parameters["AGI Rate Growth"]),Number(Yanfly.Parameters["LUK Rate Growth"]),
Number(Yanfly.Parameters["EXP Rate Growth"]),Number(Yanfly.Parameters["Gold Rate Growth"])];Yanfly.Param.ELVFlat=[Number(Yanfly.Parameters["MaxHP Flat Growth"]),Number(Yanfly.Parameters["MaxMP Flat Growth"]),Number(Yanfly.Parameters["ATK Flat Growth"]),Number(Yanfly.Parameters["DEF Flat Growth"]),Number(Yanfly.Parameters["MAT Flat Growth"]),Number(Yanfly.Parameters["MDF Flat Growth"]),Number(Yanfly.Parameters["AGI Flat Growth"]),Number(Yanfly.Parameters["LUK Flat Growth"]),Number(Yanfly.Parameters["EXP Flat Growth"]),
Number(Yanfly.Parameters["Gold Flat Growth"])];Yanfly.ELV.DataManager_isDatabaseLoaded=DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=function(){if(!Yanfly.ELV.DataManager_isDatabaseLoaded.call(this))return false;if(!Yanfly._loaded_YEP_EnemyLevels){this.processELVNotetagsS($dataSkills);this.processELVNotetags1($dataEnemies);this.processELVNotetags2($dataSkills);this.processELVNotetags2($dataItems);Yanfly._loaded_YEP_EnemyLevels=true}return true};DataManager.processELVNotetagsS=function(group){if(Yanfly.SkillIdRef)return;
Yanfly.SkillIdRef={};for(let n=1;n<group.length;n++){var obj=group[n];if(obj.name.length<=0)continue;Yanfly.SkillIdRef[obj.name.toUpperCase()]=n}};DataManager.processELVNotetags1=function(group){var note1a=/<(.*)[ ]RATE:[ ]([\+\-]\d+)([%\uff05])[ ]PER LEVEL>/i;var note1b=/<(.*)[ ]RATE:[ ]([\+\-]\d+).(\d+)[ ]PER LEVEL>/i;var note2a=/<(.*)[ ]FLAT:[ ]([\+\-]\d+)[ ]PER LEVEL>/i;var note2b=/<(.*)[ ]FLAT:[ ]([\+\-]\d+).(\d+)[ ]PER LEVEL>/i;for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);
obj.showLevel=Yanfly.Param.ELVShow;obj.ignoreLevelBonuses=false;obj.minLevel=Yanfly.Param.ELVMinLv;obj.maxLevel=Yanfly.Param.ELVMaxLv;obj.levelType=Yanfly.Param.ELVDefaultType;obj.positiveLevelFluctuation=Yanfly.Param.ELVPosFluc;obj.negativeLevelFluctuation=Yanfly.Param.ELVPosFluc;obj.baseParamFormula=Yanfly.Param.ELVFormula.slice();obj.baseParamRate=Yanfly.Param.ELVRate.slice();obj.baseParamFlat=Yanfly.Param.ELVFlat.slice();obj.resistLevelChange=false;obj.skillLevelRequirements={};var evalMode="none";
var evalParam=0;for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(?:SHOW LEVEL)>/i))obj.showLevel=true;else if(line.match(/<(?:HIDE LEVEL)>/i))obj.showLevel=false;else if(line.match(/<(?:IGNORE LEVEL BONUS|IGNORE LEVEL BONUSES)>/i))obj.ignoreLevelBonuses=true;else if(line.match(/<(?:MIN LEVEL|MINIMUM LEVEL):[ ](\d+)>/i))obj.minLevel=parseInt(RegExp.$1);else if(line.match(/<(?:MAX LEVEL|MAXIMUM LEVEL):[ ](\d+)>/i))obj.maxLevel=parseInt(RegExp.$1);else if(line.match(/<(?:SET LEVEL|STATIC LEVEL):[ ](\d+)>/i)){obj.minLevel=
parseInt(RegExp.$1);obj.maxLevel=parseInt(RegExp.$1)}else if(line.match(/<(?:LEVEL TYPE|STARTING LEVEL TYPE):[ ](\d+)>/i))obj.levelType=parseInt(RegExp.$1).clamp(0,5);else if(line.match(/<POSITIVE LEVEL FLUCTUATION:[ ](\d+)>/i))obj.positiveLevelFluctuation=parseInt(RegExp.$1);else if(line.match(/<NEGATIVE LEVEL FLUCTUATION:[ ](\d+)>/i))obj.negativeLevelFluctuation=parseInt(RegExp.$1);else if(line.match(/<LEVEL FLUCTUATION:[ ](\d+)>/i)){obj.positiveLevelFluctuation=parseInt(RegExp.$1);obj.negativeLevelFluctuation=
parseInt(RegExp.$1)}else if(line.match(note1a)){var param=String(RegExp.$1).toUpperCase();var rate=parseFloat(RegExp.$2)*.01;if(["MAXHP","MAX HP","MHP","HP"].contains(param))param=0;else if(["MAXMP","MAX MP","MMP","MP","MAXSP","MAX SP","MSP","SP"].contains(param))param=1;else if(["ATK","STR"].contains(param))param=2;else if(["DEF"].contains(param))param=3;else if(["MAT","INT","SPI"].contains(param))param=4;else if(["MDF","RES"].contains(param))param=5;else if(["AGI","SPD"].contains(param))param=6;
else if(["LUK"].contains(param))param=7;else if(["EXP","XP"].contains(param))param=8;else if(["GOLD"].contains(param))param=9;else continue;obj.baseParamRate[param]=rate}else if(line.match(note1b)){var param=String(RegExp.$1).toUpperCase();var rate=parseFloat(String(RegExp.$2)+"."+String(RegExp.$3));if(["MAXHP","MAX HP","MHP","HP"].contains(param))param=0;else if(["MAXMP","MAX MP","MMP","MP","MAXSP","MAX SP","MSP","SP"].contains(param))param=1;else if(["ATK","STR"].contains(param))param=2;else if(["DEF"].contains(param))param=
3;else if(["MAT","INT","SPI"].contains(param))param=4;else if(["MDF","RES"].contains(param))param=5;else if(["AGI","SPD"].contains(param))param=6;else if(["LUK"].contains(param))param=7;else if(["EXP","XP"].contains(param))param=8;else if(["GOLD"].contains(param))param=9;else continue;obj.baseParamRate[param]=rate}else if(line.match(note2a)){var param=String(RegExp.$1).toUpperCase();var flat=parseFloat(RegExp.$2);if(["MAXHP","MAX HP","MHP","HP"].contains(param))param=0;else if(["MAXMP","MAX MP","MMP",
"MP","MAXSP","MAX SP","MSP","SP"].contains(param))param=1;else if(["ATK","STR"].contains(param))param=2;else if(["DEF"].contains(param))param=3;else if(["MAT","INT","SPI"].contains(param))param=4;else if(["MDF","RES"].contains(param))param=5;else if(["AGI","SPD"].contains(param))param=6;else if(["LUK"].contains(param))param=7;else if(["EXP","XP"].contains(param))param=8;else if(["GOLD"].contains(param))param=9;else continue;obj.baseParamFlat[param]=flat}else if(line.match(note2b)){var param=String(RegExp.$1).toUpperCase();
var flat=parseFloat(String(RegExp.$2)+"."+String(RegExp.$3));if(["MAXHP","MAX HP","MHP","HP"].contains(param))param=0;else if(["MAXMP","MAX MP","MMP","MP","MAXSP","MAX SP","MSP","SP"].contains(param))param=1;else if(["ATK","STR"].contains(param))param=2;else if(["DEF"].contains(param))param=3;else if(["MAT","INT","SPI"].contains(param))param=4;else if(["MDF","RES"].contains(param))param=5;else if(["AGI","SPD"].contains(param))param=6;else if(["LUK"].contains(param))param=7;else if(["EXP","XP"].contains(param))param=
8;else if(["GOLD"].contains(param))param=9;else continue;obj.baseParamFlat[param]=flat}else if(line.match(/<\/CUSTOM PARAMETER[ ](.*)[ ]FORMULA>/i)){evalMode="none";evalParam=0}else if(line.match(/<CUSTOM PARAMETER[ ](.*)[ ]FORMULA>/i)){var param=String(RegExp.$1).toUpperCase();if(["MAXHP","MAX HP","MHP","HP"].contains(param))param=0;else if(["MAXMP","MAX MP","MMP","MP","MAXSP","MAX SP","MSP","SP"].contains(param))evalParam=1;else if(["ATK","STR"].contains(param))evalParam=2;else if(["DEF"].contains(param))evalParam=
3;else if(["MAT","INT","SPI"].contains(param))evalParam=4;else if(["MDF","RES"].contains(param))evalParam=5;else if(["AGI","SPD"].contains(param))evalParam=6;else if(["LUK"].contains(param))evalParam=7;else if(["EXP","XP"].contains(param))evalParam=8;else if(["GOLD"].contains(param))evalParam=9;else continue;obj.baseParamFormula[evalParam]="";evalMode="custom param level formula"}else if(evalMode==="custom param level formula"){var pId=evalParam;obj.baseParamFormula[pId]=obj.baseParamFormula[pId]+
line+"\n"}else if(line.match(/<(?:RESIST LEVEL CHANGE)>/i))obj.resistLevelChange=true;else if(line.match(/<SKILL[ ](\d+)[ ]REQUIRE LEVEL:[ ](\d+)>/i)){var skillId=parseInt(RegExp.$1);var level=parseInt(RegExp.$2);obj.skillLevelRequirements[skillId]=level}else if(line.match(/<SKILL[ ](.*)[ ]REQUIRE LEVEL:[ ](\d+)>/i)){var name=String(RegExp.$1).toUpperCase();var level=parseInt(RegExp.$2);if(Yanfly.SkillIdRef[name])var skillId=Yanfly.SkillIdRef[name];else continue;obj.skillLevelRequirements[skillId]=
level}}evalMode="none";if(obj.levelType===0)obj.startingLevel="level = $gameParty.lowestLevelAllMembers()";else if(obj.levelType===1)obj.startingLevel="level = $gameParty.lowestLevelBattleMembers()";else if(obj.levelType===2)obj.startingLevel="level = $gameParty.averageLevelAllMembers()";else if(obj.levelType===3)obj.startingLevel="level = $gameParty.averageLevelBattleMembers()";else if(obj.levelType===4)obj.startingLevel="level = $gameParty.highestLevelAllMembers()";else if(obj.levelType===5)obj.startingLevel=
"level = $gameParty.highestLevelBattleMembers()";for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(?:CUSTOM STARTING LEVEL)>/i)){obj.startingLevel="";evalMode="custom starting level"}else if(line.match(/<\/(?:CUSTOM STARTING LEVEL)>/i))evalMode="none";else if(evalMode==="custom starting level")obj.startingLevel=obj.startingLevel+line+"\n"}}};DataManager.processELVNotetags2=function(group){for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);
obj.resetEnemyLevel=false;obj.changeEnemyLevel=0;obj.enemyLevelEval="";var evalMode="none";for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(?:CHANGE ENEMY LEVEL):[ ]([\+\-]\d+)>/i))obj.changeEnemyLevel=parseInt(RegExp.$1);else if(line.match(/<(?:RESET ENEMY LEVEL)>/i))obj.resetEnemyLevel=true;else if(line.match(/<(?:CUSTOM CHANGE ENEMY LEVEL)>/i))var evalMode="custom change enemy level";else if(line.match(/<\/(?:CUSTOM CHANGE ENEMY LEVEL)>/i))var evalMode="none";else if(evalMode===
"custom change enemy level")obj.enemyLevelEval=obj.enemyLevelEval+line+"\n"}}};Yanfly.ELV.Game_BattlerBase_isSkillSealed=Game_BattlerBase.prototype.isSkillSealed;Game_BattlerBase.prototype.isSkillSealed=function(skillId){if(this.isEnemySkillLevelSealed(skillId))return true;return Yanfly.ELV.Game_BattlerBase_isSkillSealed.call(this,skillId)};Game_BattlerBase.prototype.isEnemySkillLevelSealed=function(skillId){if(!this.isEnemy())return false;if(!this.enemy().skillLevelRequirements[skillId])return false;
var reqLevel=this.enemy().skillLevelRequirements[skillId];return this.level<reqLevel};Object.defineProperty(Game_Enemy.prototype,"level",{get:function(){return this._level},configurable:true});Yanfly.ELV.Game_Enemy_initMembers=Game_Enemy.prototype.initMembers;Game_Enemy.prototype.initMembers=function(){Yanfly.ELV.Game_Enemy_initMembers.call(this);this._level=0};Yanfly.ELV.Game_Enemy_setup=Game_Enemy.prototype.setup;Game_Enemy.prototype.setup=function(enemyId,x,y){this._enemyId=enemyId;this.setupEnemyLevel();
Yanfly.ELV.Game_Enemy_setup.call(this,enemyId,x,y)};Game_Enemy.prototype.setupEnemyLevel=function(){var min=this.setupMinimumLevel();var max=this.setupMaximumLevel();this._level=this.getSetupLevel().clamp(min,max);this.applySetupLevelFluctuation();this._level=this._level.clamp(1,Yanfly.Param.ELVMaxCap);this._originalLevel=this._level};Game_Enemy.prototype.setupMinimumLevel=function(){return this.enemy().minLevel};Game_Enemy.prototype.setupMaximumLevel=function(){return this.enemy().maxLevel};Game_Enemy.prototype.originalLevel=
function(){return this._originalLevel};Game_Enemy.prototype.getSetupLevel=function(){var level=0;var code=this.enemy().startingLevel;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"ENEMY STARTING LEVEL ERROR")}return Math.floor(level)};Game_Enemy.prototype.applySetupLevelFluctuation=function(){var min=this._level-this.negativeLevelFluctuation();var max=this._level+this.positiveLevelFluctuation();this._level=Math.floor(Math.random()*(max-min+1)+min)};Game_Enemy.prototype.negativeLevelFluctuation=
function(){return this.enemy().negativeLevelFluctuation};Game_Enemy.prototype.positiveLevelFluctuation=function(){return this.enemy().positiveLevelFluctuation};Yanfly.ELV.Game_Enemy_name=Game_Enemy.prototype.name;Game_Enemy.prototype.name=function(){var name=Yanfly.ELV.Game_Enemy_name.call(this);if(this.enemy().showLevel){var fmt=Yanfly.Param.ELVFmt;name=fmt.format(this.level,name)}return name};Yanfly.ELV.Game_Enemy_paramBase=Game_Enemy.prototype.paramBase;Game_Enemy.prototype.paramBase=function(paramId){this._cacheBaseParam=
this._cacheBaseParam||{};if(this._cacheBaseParam[paramId])return this._cacheBaseParam[paramId];var base=Yanfly.ELV.Game_Enemy_paramBase.call(this,paramId);if(this.enemy().ignoreLevelBonuses){this._cacheBaseParam[paramId]=base;return this._cacheBaseParam[paramId]}var level=this.level;var formula=this.enemy().baseParamFormula[paramId];var rate=this.enemy().baseParamRate[paramId];var flat=this.enemy().baseParamFlat[paramId];var user=this;var s=$gameSwitches._data;var v=$gameVariables._data;try{this._cacheBaseParam[paramId]=
eval(formula)}catch(e){this._cacheBaseParam[paramId]=0;Yanfly.Util.displayError(e,formula,"ENEMY PARAM BASE FORMULA ERROR")}return this._cacheBaseParam[paramId]};Yanfly.ELV.Game_Enemy_exp=Game_Enemy.prototype.exp;Game_Enemy.prototype.exp=function(){var paramId=8;this._cacheBaseParam=this._cacheBaseParam||{};if(this._cacheBaseParam[paramId])return this._cacheBaseParam[paramId];var base=Yanfly.ELV.Game_Enemy_exp.call(this);if(this.enemy().ignoreLevelBonuses){this._cacheBaseParam[paramId]=base;return this._cacheBaseParam[paramId]}var level=
this.level;var formula=this.enemy().baseParamFormula[paramId];var rate=this.enemy().baseParamRate[paramId];var flat=this.enemy().baseParamFlat[paramId];var user=this;var b=base;var l=level;var f=flat;var r=rate;var s=$gameSwitches._data;var v=$gameVariables._data;try{this._cacheBaseParam[paramId]=Math.floor(eval(formula))}catch(e){this._cacheBaseParam[paramId]=0;Yanfly.Util.displayError(e,formula,"ENEMY EXP FORMULA ERROR")}return this._cacheBaseParam[paramId]};Yanfly.ELV.Game_Enemy_gold=Game_Enemy.prototype.gold;
Game_Enemy.prototype.gold=function(){var paramId=9;this._cacheBaseParam=this._cacheBaseParam||{};if(this._cacheBaseParam[paramId])return this._cacheBaseParam[paramId];var base=Yanfly.ELV.Game_Enemy_gold.call(this);if(this.enemy().ignoreLevelBonuses){this._cacheBaseParam[paramId]=base;return this._cacheBaseParam[paramId]}var level=this.level;var formula=this.enemy().baseParamFormula[paramId];var rate=this.enemy().baseParamRate[paramId];var flat=this.enemy().baseParamFlat[paramId];var user=this;var s=
$gameSwitches._data;var v=$gameVariables._data;try{this._cacheBaseParam[paramId]=Math.floor(eval(formula))}catch(e){this._cacheBaseParam[paramId]=0;Yanfly.Util.displayError(e,formula,"ENEMY GOLD FORMULA ERROR")}return this._cacheBaseParam[paramId]};Game_Enemy.prototype.changeLevel=function(level){if(level===this._level)return;if(Yanfly.Param.ELVPreserveRate){var hpRate=this.hp/Math.max(1,this.mhp);var mpRate=this.mp/Math.max(1,this.mmp);var prevHp=Math.min(this.hp,1)}this._level=level.clamp(1,Yanfly.Param.ELVMaxCap);
this._cacheBaseParam={};this.refresh();if(Yanfly.Param.ELVPreserveRate){var max=this.isDead()?0:prevHp;var hpAmount=Math.max(max,parseInt(this.mhp*hpRate));this.setHp(hpAmount);this.setMp(parseInt(this.mmp*mpRate))}};Game_Enemy.prototype.gainLevel=function(value){this.changeLevel(this.level+value)};Game_Enemy.prototype.loseLevel=function(value){this.changeLevel(this.level-value)};Game_Enemy.prototype.isResistLevelChange=function(){return this.enemy().resistLevelChange};Game_Enemy.prototype.resetLevel=
function(){this.changeLevel(this.originalLevel())};Yanfly.ELV.Game_Enemy_transform=Game_Enemy.prototype.transform;Game_Enemy.prototype.transform=function(enemyId){Yanfly.ELV.Game_Enemy_transform.call(this,enemyId);this._cacheBaseParam={}};Game_Party.prototype.lowestLevelAllMembers=function(){var length=this.allMembers().length;var value=Yanfly.Param.ELVMaxCap;for(let i=0;i<length;++i){var member=this.allMembers()[i];value=Math.min(value,member.level)}return value};Game_Party.prototype.lowestLevelBattleMembers=
function(){var length=this.battleMembers().length;var value=Yanfly.Param.ELVMaxCap;for(let i=0;i<length;++i){var member=this.battleMembers()[i];value=Math.min(value,member.level)}return value};Game_Party.prototype.averageLevelAllMembers=function(){var length=this.allMembers().length;var value=0;for(let i=0;i<length;++i){var member=this.allMembers()[i];value+=member.level}return Math.ceil(value/length)};Game_Party.prototype.averageLevelBattleMembers=function(){var length=this.battleMembers().length;
var value=0;for(let i=0;i<length;++i){var member=this.battleMembers()[i];value+=member.level}return Math.ceil(value/length)};Game_Party.prototype.highestLevelAllMembers=function(){var length=this.allMembers().length;var value=0;for(let i=0;i<length;++i){var member=this.allMembers()[i];value=Math.max(value,member.level)}return value};Game_Party.prototype.highestLevelBattleMembers=function(){var length=this.battleMembers().length;var value=0;for(let i=0;i<length;++i){var member=this.battleMembers()[i];
value=Math.max(value,member.level)}return value};Game_Troop.prototype.changeLevel=function(value){var length=this.members().length;for(let i=0;i<length;++i){var member=this.members()[i];if(member)member.changeLevel(value)}};Game_Troop.prototype.gainLevel=function(value){var length=this.members().length;for(let i=0;i<length;++i){var member=this.members()[i];if(member)member.gainLevel(value)}};Game_Troop.prototype.loseLevel=function(value){var length=this.members().length;for(let i=0;i<length;++i){var member=
this.members()[i];if(member)member.loseLevel(value)}};Game_Troop.prototype.resetLevel=function(){var length=this.members().length;for(let i=0;i<length;++i){var member=this.members()[i];if(member)member.resetLevel()}};Game_Troop.prototype.lowestLevel=function(){var length=this.members().length;var value=Yanfly.Param.ELVMaxCap;for(let i=0;i<length;++i){var member=this.members()[i];value=Math.min(value,member.level)}return value};Game_Troop.prototype.averageLevel=function(){var length=this.members().length;
var value=0;for(let i=0;i<length;++i){var member=this.members()[i];value=member.level}return Math.ceil(value/length)};Game_Troop.prototype.highestLevel=function(){var length=this.members().length;var value=0;for(let i=0;i<length;++i){var member=this.members()[i];value=Math.max(value,member.level)}return value};Yanfly.ELV.Game_Action_applyItemUserEffect=Game_Action.prototype.applyItemUserEffect;Game_Action.prototype.applyItemUserEffect=function(target){Yanfly.ELV.Game_Action_applyItemUserEffect.call(this,
target);if(target&&target.isEnemy())this.applyItemEnemyLevelEffects(target)};Game_Action.prototype.applyItemEnemyLevelEffects=function(target){if(!this.item())return;if(target.isResistLevelChange())return;if(this.item().resetEnemyLevel)target.resetLevel();var level=target.level+this.item().changeEnemyLevel;if(this.item().enemyLevelEval!=="")level=this.itemEnemyLevelEval(target,level);target.changeLevel(level)};Game_Action.prototype.itemEnemyLevelEval=function(target,level){var item=this.item();var a=
this.subject();var b=target;var user=this.subject();var subject=this.subject();var s=$gameSwitches._data;var v=$gameVariables._data;var code=this.item().enemyLevelEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"ENEMY LEVEL ITEM ALTER CODE ERROR")}return level};Yanfly.ELV.Game_Interpreter_pluginCommand=Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand=function(command,args){Yanfly.ELV.Game_Interpreter_pluginCommand.call(this,command,args);if(!$gameParty.inBattle())return;
if(command==="EnemyLevelReset")this.resetEnemyLevel(args);if(command==="EnemyLevelResetAll")$gameTroop.resetLevel();if(command==="EnemyLevelChange")this.changeEnemyLevel(args);if(command==="EnemyLevelChangeAll")this.changeEnemyLevelAll(args);if(command==="EnemyGainLevel")this.gainEnemyLevel(args);if(command==="EnemyGainLevelAll")this.gainEnemyLevelAll(args);if(command==="EnemyLoseLevel")this.loseEnemyLevel(args);if(command==="EnemyLoseLevelAll")this.loseEnemyLevelAll(args)};Game_Interpreter.prototype.resetEnemyLevel=
function(args){if(!args)return;var index=parseInt(args[0])-1;var enemy=$gameTroop.members()[index];if(enemy)enemy.resetLevel()};Game_Interpreter.prototype.changeEnemyLevel=function(args){if(!args)return;var index=parseInt(args[0])-1;var level=parseInt(args[2]);var enemy=$gameTroop.members()[index];if(enemy)enemy.changeLevel(level)};Game_Interpreter.prototype.changeEnemyLevelAll=function(args){if(!args)return;var level=parseInt(args[0]);$gameTroop.changeLevel(level)};Game_Interpreter.prototype.gainEnemyLevel=
function(args){if(!args)return;var index=parseInt(args[0])-1;var level=parseInt(args[2]);var enemy=$gameTroop.members()[index];if(enemy)enemy.gainLevel(level)};Game_Interpreter.prototype.gainEnemyLevelAll=function(args){if(!args)return;var level=parseInt(args[0]);$gameTroop.gainLevel(level)};Game_Interpreter.prototype.loseEnemyLevel=function(args){if(!args)return;var index=parseInt(args[0])-1;var level=parseInt(args[2]);var enemy=$gameTroop.members()[index];if(enemy)enemy.loseLevel(level)};Game_Interpreter.prototype.loseEnemyLevelAll=
function(args){if(!args)return;var level=parseInt(args[0]);$gameTroop.loseLevel(level)};Yanfly.Util=Yanfly.Util||{};if(!Yanfly.Util.toGroup)Yanfly.Util.toGroup=function(inVal){return inVal};Yanfly.Util.displayError=function(e,code,message){console.log(message);console.log(code||"NON-EXISTENT");console.error(e);if(Utils.RPGMAKER_VERSION&&Utils.RPGMAKER_VERSION>="1.6.0")return;if(Utils.isNwjs()&&Utils.isOptionValid("test"))if(!require("nw.gui").Window.get().isDevToolsOpen())require("nw.gui").Window.get().showDevTools()}})();Imported.YEP_BaseParamControl=true;Yanfly.BPC=Yanfly.BPC||{};Yanfly.BPC.version=1.04;
(function(){Yanfly.Parameters=PluginManager.parameters("YEP_BaseParamControl");Yanfly.Param=Yanfly.Param||{};Yanfly.Param.BPCFormula=[];Yanfly.Param.BPCFormula.push(String(Yanfly.Parameters["MHP Formula"]));Yanfly.Param.BPCFormula.push(String(Yanfly.Parameters["MMP Formula"]));Yanfly.Param.BPCFormula.push(String(Yanfly.Parameters["ATK Formula"]));Yanfly.Param.BPCFormula.push(String(Yanfly.Parameters["DEF Formula"]));Yanfly.Param.BPCFormula.push(String(Yanfly.Parameters["MAT Formula"]));Yanfly.Param.BPCFormula.push(String(Yanfly.Parameters["MDF Formula"]));
Yanfly.Param.BPCFormula.push(String(Yanfly.Parameters["AGI Formula"]));Yanfly.Param.BPCFormula.push(String(Yanfly.Parameters["LUK Formula"]));Yanfly.Param.BPCMaximum=[];Yanfly.Param.BPCMaximum.push(String(Yanfly.Parameters["MHP Maximum"]));Yanfly.Param.BPCMaximum.push(String(Yanfly.Parameters["MMP Maximum"]));Yanfly.Param.BPCMaximum.push(String(Yanfly.Parameters["ATK Maximum"]));Yanfly.Param.BPCMaximum.push(String(Yanfly.Parameters["DEF Maximum"]));Yanfly.Param.BPCMaximum.push(String(Yanfly.Parameters["MAT Maximum"]));
Yanfly.Param.BPCMaximum.push(String(Yanfly.Parameters["MDF Maximum"]));Yanfly.Param.BPCMaximum.push(String(Yanfly.Parameters["AGI Maximum"]));Yanfly.Param.BPCMaximum.push(String(Yanfly.Parameters["LUK Maximum"]));Yanfly.Param.BPCMinimum=[];Yanfly.Param.BPCMinimum.push(String(Yanfly.Parameters["MHP Minimum"]));Yanfly.Param.BPCMinimum.push(String(Yanfly.Parameters["MMP Minimum"]));Yanfly.Param.BPCMinimum.push(String(Yanfly.Parameters["ATK Minimum"]));Yanfly.Param.BPCMinimum.push(String(Yanfly.Parameters["DEF Minimum"]));
Yanfly.Param.BPCMinimum.push(String(Yanfly.Parameters["MAT Minimum"]));Yanfly.Param.BPCMinimum.push(String(Yanfly.Parameters["MDF Minimum"]));Yanfly.Param.BPCMinimum.push(String(Yanfly.Parameters["AGI Minimum"]));Yanfly.Param.BPCMinimum.push(String(Yanfly.Parameters["LUK Minimum"]));Yanfly.Param.BPCLukEffectRate=String(Yanfly.Parameters["LUK Effect"]);Yanfly.BPC.DataManager_isDatabaseLoaded=DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=function(){if(!Yanfly.BPC.DataManager_isDatabaseLoaded.call(this))return false;
if(!Yanfly._loaded_YEP_BaseParamControl){this.processBPCNotetags1($dataActors);this.processBPCNotetags1($dataClasses);this.processBPCNotetags1($dataEnemies);this.processBPCNotetags1($dataWeapons);this.processBPCNotetags1($dataArmors);this.processBPCNotetags1($dataStates);Yanfly._loaded_YEP_BaseParamControl=true}return true};DataManager.processBPCNotetags1=function(group){for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.plusParams=[0,0,0,0,0,0,0,0];obj.rateParams=
[1,1,1,1,1,1,1,1];obj.flatParams=[0,0,0,0,0,0,0,0];obj.maxParams=[];obj.minParams=[];for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(.*) PLUS:[ ]([\+\-]\d+)>/i)){var text=String(RegExp.$1).toUpperCase();var value=parseInt(RegExp.$2);var id=this.getParamId(text);if(id!==null)obj.plusParams[id]=value}else if(line.match(/<(.*) RATE:[ ](\d+)([%\uff05])>/i)){var text=String(RegExp.$1).toUpperCase();var rate=parseFloat(RegExp.$2)*.01;var id=this.getParamId(text);if(id!==null)obj.rateParams[id]=
rate}else if(line.match(/<(.*) RATE:[ ](\d+).(\d+)>/i)){var text=String(RegExp.$1).toUpperCase();var rate=parseFloat(String(RegExp.$2)+"."+String(RegExp.$3));var id=this.getParamId(text);if(id!==null)obj.rateParams[id]=rate}else if(line.match(/<(.*) FLAT:[ ]([\+\-]\d+)>/i)){var text=String(RegExp.$1).toUpperCase();var value=parseInt(RegExp.$2);var id=this.getParamId(text);if(id!==null)obj.flatParams[id]=value}else if(line.match(/<(.*) MAX:[ ](\d+)>/i)){var text=String(RegExp.$1).toUpperCase();var value=
parseInt(RegExp.$2);var id=this.getParamId(text);if(id!==null)obj.maxParams[id]=value}else if(line.match(/<(.*) MIN:[ ](\d+)>/i)){var text=String(RegExp.$1).toUpperCase();var value=parseInt(RegExp.$2);var id=this.getParamId(text);if(id!==null)obj.minParams[id]=value}}}};DataManager.getParamId=function(string){if(["MHP",,"MAXHP","MAX HP","HP"].contains(string))return 0;else if(["MMP",,"MAXMP","MAX MP","MP"].contains(string))return 1;else if(["ATK","ATTACK"].contains(string))return 2;else if(["DEF",
"DEFENSE"].contains(string))return 3;else if(["MAT","MAGIC ATTACK","M.ATTACK","INT"].contains(string))return 4;else if(["MDF","MAGIC DEFENSE","M.DEFENSE","RES"].contains(string))return 5;else if(["AGI","AGILITY","SPD"].contains(string))return 6;else if(["LUK","LUK"].contains(string))return 7;else return null};Game_BattlerBase.prototype.param=function(paramId){this._baseParamCache=this._baseParamCache||[];if(this._baseParamCache[paramId])return this._baseParamCache[paramId];var base=this.paramBase(paramId);
var plus=this.paramPlus(paramId);var paramRate=this.paramRate(paramId);var buffRate=this.paramBuffRate(paramId);var flat=this.paramFlat(paramId);var minValue=this.paramMin(paramId);var maxValue=Math.max(minValue,this.paramMax(paramId));var a=this;var user=this;var subject=this;var b=this;var target=this;var s=$gameSwitches._data;var v=$gameVariables._data;var code=Yanfly.Param.BPCFormula[paramId];try{var value=eval(code)}catch(e){var value=0;Yanfly.Util.displayError(e,code,"CUSTOM PARAM FORMULA ERROR")}value=
Math.round(value.clamp(minValue,maxValue));this._baseParamCache[paramId]=value;return this._baseParamCache[paramId]};Game_BattlerBase.prototype.paramMax=function(paramId){var customMax=this.customParamMax(paramId);var a=this;var user=this;var subject=this;var b=this;var target=this;var s=$gameSwitches._data;var v=$gameVariables._data;var code=Yanfly.Param.BPCMaximum[paramId];try{var value=eval(code)}catch(e){var value=0;Yanfly.Util.displayError(e,code,"CUSTOM PARAM MAX FORMULA ERROR")}value=Math.ceil(value);
return value};Game_BattlerBase.prototype.paramMin=function(paramId){var customMin=this.customParamMin(paramId);var a=this;var user=this;var subject=this;var b=this;var target=this;var s=$gameSwitches._data;var v=$gameVariables._data;var code=Yanfly.Param.BPCMinimum[paramId];try{var value=eval(code)}catch(e){var value=0;Yanfly.Util.displayError(e,code,"CUSTOM PARAM MIN FORMULA ERROR")}value=Math.ceil(value);return value};Yanfly.BPC.Game_BattlerBase_initMembers=Game_BattlerBase.prototype.initMembers;
Game_BattlerBase.prototype.initMembers=function(){Yanfly.BPC.Game_BattlerBase_initMembers.call(this);this.clearCustomParamLimits()};Game_BattlerBase.prototype.clearCustomParamLimits=function(){this._paramLimitMin=[0,0,0,0,0,0,0,0];this._paramLimitMax=[0,0,0,0,0,0,0,0]};Game_BattlerBase.prototype.customParamMax=function(paramId){if(!this._paramLimitMax)this.clearCustomParamLimits();var value=this._paramLimitMax[paramId];return value};Game_BattlerBase.prototype.customParamMin=function(paramId){if(!this._paramLimitMin)this.clearCustomParamLimits();
var value=this._paramLimitMin[paramId];return value};Game_BattlerBase.prototype.setParam=function(id,value){this._paramPlus[id]=0;this._baseParamCache=[];this._paramPlus[id]=value-this.param(id);this.refresh()};Game_BattlerBase.prototype.setMaxHp=function(value){this.setParam(0,value)};Game_BattlerBase.prototype.setMaxMp=function(value){this.setParam(1,value)};Game_BattlerBase.prototype.setAtk=function(value){this.setParam(2,value)};Game_BattlerBase.prototype.setDef=function(value){this.setParam(3,
value)};Game_BattlerBase.prototype.setMat=function(value){this.setParam(4,value)};Game_BattlerBase.prototype.setMdf=function(value){this.setParam(5,value)};Game_BattlerBase.prototype.setAgi=function(value){this.setParam(6,value)};Game_BattlerBase.prototype.setLuk=function(value){this.setParam(7,value)};Game_BattlerBase.prototype.setParamPlus=function(id,value){this._paramPlus[id]=value;this.refresh()};Game_BattlerBase.prototype.setMaxHpPlus=function(value){this.setParamPlus(0,value)};Game_BattlerBase.prototype.setMaxMpPlus=
function(value){this.setParamPlus(1,value)};Game_BattlerBase.prototype.setAtkPlus=function(value){this.setParamPlus(2,value)};Game_BattlerBase.prototype.setDefPlus=function(value){this.setParamPlus(3,value)};Game_BattlerBase.prototype.setMatPlus=function(value){this.setParamPlus(4,value)};Game_BattlerBase.prototype.setMdfPlus=function(value){this.setParamPlus(5,value)};Game_BattlerBase.prototype.setAgiPlus=function(value){this.setParamPlus(6,value)};Game_BattlerBase.prototype.setLukPlus=function(value){this.setParamPlus(7,
value)};Game_BattlerBase.prototype.addMaxHp=function(value){this.addParam(0,value)};Game_BattlerBase.prototype.addMaxMp=function(value){this.addParam(1,value)};Game_BattlerBase.prototype.addAtk=function(value){this.addParam(2,value)};Game_BattlerBase.prototype.addDef=function(value){this.addParam(3,value)};Game_BattlerBase.prototype.addMat=function(value){this.addParam(4,value)};Game_BattlerBase.prototype.addMdf=function(value){this.addParam(5,value)};Game_BattlerBase.prototype.addAgi=function(value){this.addParam(6,
value)};Game_BattlerBase.prototype.addLuk=function(value){this.addParam(7,value)};Game_BattlerBase.prototype.minusMaxHp=function(value){this.addParam(0,-value)};Game_BattlerBase.prototype.minusMaxMp=function(value){this.addParam(1,-value)};Game_BattlerBase.prototype.minusAtk=function(value){this.addParam(2,-value)};Game_BattlerBase.prototype.minusDef=function(value){this.addParam(3,-value)};Game_BattlerBase.prototype.minusMat=function(value){this.addParam(4,-value)};Game_BattlerBase.prototype.minusMdf=
function(value){this.addParam(5,-value)};Game_BattlerBase.prototype.minusAgi=function(value){this.addParam(6,-value)};Game_BattlerBase.prototype.minusLuk=function(value){this.addParam(7,-value)};Game_BattlerBase.prototype.setCustomParamLimitMax=function(id,value){if(!this._paramLimitMax)this.clearCustomParamLimits();this._paramLimitMax[id]=value;this.refresh()};Game_BattlerBase.prototype.setCustomMaxHpMax=function(value){this.setCustomParamLimitMax(0,value)};Game_BattlerBase.prototype.setCustomMaxMpMax=
function(value){this.setCustomParamLimitMax(1,value)};Game_BattlerBase.prototype.setCustomAtkMax=function(value){this.setCustomParamLimitMax(2,value)};Game_BattlerBase.prototype.setCustomDefMax=function(value){this.setCustomParamLimitMax(3,value)};Game_BattlerBase.prototype.setCustomMatMax=function(value){this.setCustomParamLimitMax(4,value)};Game_BattlerBase.prototype.setCustomMdfMax=function(value){this.setCustomParamLimitMax(5,value)};Game_BattlerBase.prototype.setCustomAgiMax=function(value){this.setCustomParamLimitMax(6,
value)};Game_BattlerBase.prototype.setCustomLukMax=function(value){this.setCustomParamLimitMax(7,value)};Game_BattlerBase.prototype.setCustomParamLimitMin=function(id,value){if(!this._paramLimitMin)this.clearCustomParamLimits();this._paramLimitMin[id]=value;this.refresh()};Game_BattlerBase.prototype.setCustomMaxHpMin=function(value){this.setCustomParamLimitMin(0,value)};Game_BattlerBase.prototype.setCustomMaxMpMin=function(value){this.setCustomParamLimitMin(1,value)};Game_BattlerBase.prototype.setCustomAtkMin=
function(value){this.setCustomParamLimitMin(2,value)};Game_BattlerBase.prototype.setCustomDefMin=function(value){this.setCustomParamLimitMin(3,value)};Game_BattlerBase.prototype.setCustomMatMin=function(value){this.setCustomParamLimitMin(4,value)};Game_BattlerBase.prototype.setCustomMdfMin=function(value){this.setCustomParamLimitMin(5,value)};Game_BattlerBase.prototype.setCustomAgiMin=function(value){this.setCustomParamLimitMin(6,value)};Game_BattlerBase.prototype.setCustomLukMin=function(value){this.setCustomParamLimitMin(7,
value)};Yanfly.BPC.Game_Battler_refresh=Game_Battler.prototype.refresh;Game_Battler.prototype.refresh=function(){this._baseParamCache=undefined;Yanfly.BPC.Game_Battler_refresh.call(this)};Game_Battler.prototype.paramPlus=function(paramId){var value=Game_BattlerBase.prototype.paramPlus.call(this,paramId);var length=this.states().length;for(let i=0;i<length;++i){var obj=this.states()[i];if(obj&&obj.plusParams)value+=obj.plusParams[paramId]}return value};Game_Battler.prototype.paramRate=function(paramId){var rate=
Game_BattlerBase.prototype.paramRate.call(this,paramId);var length=this.states().length;for(let i=0;i<length;++i){var obj=this.states()[i];if(obj&&obj.rateParams)rate*=obj.rateParams[paramId]}return rate};Game_Battler.prototype.paramFlat=function(paramId){var value=0;var length=this.states().length;for(let i=0;i<length;++i){var obj=this.states()[i];if(obj&&obj.flatParams)value+=obj.flatParams[paramId]}return value};Game_Battler.prototype.customParamMax=function(paramId){var value=Game_BattlerBase.prototype.customParamMax.call(this,
paramId);var length=this.states().length;for(let i=0;i<length;++i){var obj=this.states()[i];if(obj&&obj.maxParams&&obj.maxParams[paramId])value=Math.max(value,obj.maxParams[paramId])}return value};Game_Battler.prototype.customParamMin=function(paramId){var value=Game_BattlerBase.prototype.customParamMin.call(this,paramId);var length=this.states().length;for(let i=0;i<length;++i){var obj=this.states()[i];if(obj&&obj.minParams&&obj.minParams[paramId])value=Math.max(value,obj.minParams[paramId])}return value};
Yanfly.BPC.Game_Actor_setup=Game_Actor.prototype.setup;Game_Actor.prototype.setup=function(actorId){Yanfly.BPC.Game_Actor_setup.call(this,actorId);this.clearCustomParamLimits()};Game_Actor.prototype.paramPlus=function(paramId){var value=Game_Battler.prototype.paramPlus.call(this,paramId);value+=this.actor().plusParams[paramId];value+=this.currentClass().plusParams[paramId];var length=this.equips().length;for(let i=0;i<length;++i){var obj=this.equips()[i];if(!obj)continue;value+=obj.params[paramId];
if(obj.plusParams)value+=obj.plusParams[paramId]}return value};Game_Actor.prototype.paramRate=function(paramId){var rate=Game_Battler.prototype.paramRate.call(this,paramId);rate*=this.actor().rateParams[paramId];rate*=this.currentClass().rateParams[paramId];var length=this.equips().length;for(let i=0;i<length;++i){var obj=this.equips()[i];if(obj&&obj.rateParams)rate*=obj.rateParams[paramId]}return rate};Game_Actor.prototype.paramFlat=function(paramId){var value=Game_Battler.prototype.paramFlat.call(this,
paramId);value+=this.actor().flatParams[paramId];value+=this.currentClass().flatParams[paramId];var length=this.equips().length;for(let i=0;i<length;++i){var obj=this.equips()[i];if(obj&&obj.flatParams)value+=obj.flatParams[paramId]}return value};Game_Actor.prototype.paramMax=function(paramId){return Game_Battler.prototype.paramMax.call(this,paramId)};Game_Actor.prototype.customParamMax=function(paramId){var value=Game_Battler.prototype.customParamMax.call(this,paramId);if(this.actor().maxParams[paramId])value=
Math.max(value,this.actor().maxParams[paramId]);if(this.currentClass().maxParams[paramId])value=Math.max(value,this.currentClass().maxParams[paramId]);var length=this.equips().length;for(let i=0;i<length;++i){var obj=this.equips()[i];if(obj&&obj.maxParams&&obj.maxParams[paramId])value=Math.max(value,obj.maxParams[paramId])}return value};Game_Actor.prototype.customParamMin=function(paramId){var value=Game_Battler.prototype.customParamMin.call(this,paramId);if(this.actor().minParams[paramId])value=
Math.max(value,this.actor().minParams[paramId]);if(this.currentClass().minParams[paramId])value=Math.max(value,this.currentClass().minParams[paramId]);var length=this.equips().length;for(let i=0;i<length;++i){var obj=this.equips()[i];if(obj&&obj.minParams&&obj.minParams[paramId])value=Math.max(value,obj.minParams[paramId])}return value};Game_Enemy.prototype.paramPlus=function(paramId){var value=Game_Battler.prototype.paramPlus.call(this,paramId);value+=this.enemy().plusParams[paramId];return value};
Game_Enemy.prototype.paramRate=function(paramId){var rate=Game_Battler.prototype.paramRate.call(this,paramId);rate*=this.enemy().rateParams[paramId];return rate};Game_Enemy.prototype.paramFlat=function(paramId){var value=Game_Battler.prototype.paramFlat.call(this,paramId);value+=this.enemy().flatParams[paramId];return value};Game_Enemy.prototype.customParamMax=function(paramId){var value=Game_Battler.prototype.customParamMax.call(this,paramId);if(this.enemy().maxParams[paramId])value=Math.max(value,
this.enemy().maxParams[paramId]);return value};Game_Enemy.prototype.customParamMin=function(paramId){var value=Game_Battler.prototype.customParamMin.call(this,paramId);if(this.enemy().minParams[paramId])value=Math.max(value,this.enemy().minParams[paramId]);return value};Game_Action.prototype.lukEffectRate=function(target){var item=this.item();var skill=this.item();var a=this.subject();var user=this.subject();var subject=this.subject();var b=target;var s=$gameSwitches._data;var v=$gameVariables._data;
return eval(Yanfly.Param.BPCLukEffectRate)};Yanfly.Util=Yanfly.Util||{};Yanfly.Util.displayError=function(e,code,message){console.log(message);console.log(code||"NON-EXISTENT");console.error(e);if(Utils.RPGMAKER_VERSION&&Utils.RPGMAKER_VERSION>="1.6.0")return;if(Utils.isNwjs()&&Utils.isOptionValid("test"))if(!require("nw.gui").Window.get().isDevToolsOpen())require("nw.gui").Window.get().showDevTools()}})();Imported.YEP_ExtraParamFormula=true;Yanfly.XParam=Yanfly.XParam||{};Yanfly.XParam.version=1.04;
(function(){Yanfly.Parameters=PluginManager.parameters("YEP_ExtraParamFormula");Yanfly.Param=Yanfly.Param||{};Yanfly.Param.XParamFormula=[];Yanfly.Param.XParamFormula.push(String(Yanfly.Parameters["HIT Formula"]));Yanfly.Param.XParamFormula.push(String(Yanfly.Parameters["EVA Formula"]));Yanfly.Param.XParamFormula.push(String(Yanfly.Parameters["CRI Formula"]));Yanfly.Param.XParamFormula.push(String(Yanfly.Parameters["CEV Formula"]));Yanfly.Param.XParamFormula.push(String(Yanfly.Parameters["MEV Formula"]));
Yanfly.Param.XParamFormula.push(String(Yanfly.Parameters["MRF Formula"]));Yanfly.Param.XParamFormula.push(String(Yanfly.Parameters["CNT Formula"]));Yanfly.Param.XParamFormula.push(String(Yanfly.Parameters["HRG Formula"]));Yanfly.Param.XParamFormula.push(String(Yanfly.Parameters["MRG Formula"]));Yanfly.Param.XParamFormula.push(String(Yanfly.Parameters["TRG Formula"]));Yanfly.XParam.DataManager_isDatabaseLoaded=DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=function(){if(!Yanfly.XParam.DataManager_isDatabaseLoaded.call(this))return false;
if(!Yanfly._loaded_YEP_ExtraParamFormula){this.processXParamNotetags($dataActors);this.processXParamNotetags($dataClasses);this.processXParamNotetags($dataEnemies);this.processXParamNotetags($dataWeapons);this.processXParamNotetags($dataArmors);this.processXParamNotetags($dataStates);Yanfly._loaded_YEP_ExtraParamFormula=true}return true};DataManager.processXParamNotetags=function(group){for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.plusXParams=[0,0,0,
0,0,0,0,0,0,0];obj.rateXParams=[1,1,1,1,1,1,1,1,1,1];obj.flatXParams=[0,0,0,0,0,0,0,0,0,0];for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(.*) PLUS:[ ]([\+\-]\d+)([%\uff05])>/i)){var text=String(RegExp.$1).toUpperCase();var rate=parseFloat(RegExp.$2)*.01;var id=this.getXParamId(text);if(id!==null)obj.plusXParams[id]=rate}else if(line.match(/<(.*) PLUS:[ ]([\+\-]\d+).(\d+)>/i)){var text=String(RegExp.$1).toUpperCase();var rate=parseFloat(String(RegExp.$2)+"."+String(RegExp.$3));
var id=this.getXParamId(text);if(id!==null)obj.plusXParams[id]=rate}else if(line.match(/<(.*) RATE:[ ](\d+)([%\uff05])>/i)){var text=String(RegExp.$1).toUpperCase();var rate=parseFloat(RegExp.$2)*.01;var id=this.getXParamId(text);if(id!==null)obj.rateXParams[id]=rate}else if(line.match(/<(.*) RATE:[ ](\d+).(\d+)>/i)){var text=String(RegExp.$1).toUpperCase();var rate=parseFloat(String(RegExp.$2)+"."+String(RegExp.$3));var id=this.getXParamId(text);if(id!==null)obj.rateXParams[id]=rate}else if(line.match(/<(.*) FLAT:[ ]([\+\-]\d+)([%\uff05])>/i)){var text=
String(RegExp.$1).toUpperCase();var rate=parseFloat(RegExp.$2)*.01;var id=this.getXParamId(text);if(id!==null)obj.flatXParams[id]=rate}else if(line.match(/<(.*) FLAT:[ ]([\+\-]\d+).(\d+)>/i)){var text=String(RegExp.$1).toUpperCase();var rate=parseFloat(String(RegExp.$2)+"."+String(RegExp.$3));var id=this.getXParamId(text);if(id!==null)obj.flatXParams[id]=rate}}}};DataManager.getXParamId=function(string){if(["HIT","HIT RATE"].contains(string))return 0;else if(["EVA","EVADE","EVASION"].contains(string))return 1;
else if(["CRI","CRITICAL","CRITICAL HIT"].contains(string))return 2;else if(["CEV","CRITICAL EVADE","CRITICAL EVASION"].contains(string))return 3;else if(["MEV","MAGIC EVADE","MAGIC EVASION"].contains(string))return 4;else if(["MRF","MAGIC REFLECT","MAGIC REFLECTION"].contains(string))return 5;else if(["CNT","COUNTER","COUNTERATTACK"].contains(string))return 6;else if(["HRG","HP REGEN","HP REGENERATION"].contains(string))return 7;else if(["MRG","MP REGEN","MP REGENERATION"].contains(string))return 8;
else if(["TRG","TP REGEN","TP REGENERATION"].contains(string))return 9;else return null};Yanfly.XParam.Game_BattlerBase_initMembers=Game_BattlerBase.prototype.initMembers;Game_BattlerBase.prototype.initMembers=function(){Yanfly.XParam.Game_BattlerBase_initMembers.call(this);this.clearXParamPlus()};Game_BattlerBase.prototype.clearXParamPlus=function(id){this._xparamPlus=[0,0,0,0,0,0,0,0,0,0]};Yanfly.XParam.Game_BattlerBase_refresh=Game_BattlerBase.prototype.refresh;Game_BattlerBase.prototype.refresh=
function(){this._xparam=undefined;Yanfly.XParam.Game_BattlerBase_refresh.call(this)};Yanfly.XParam.Game_BattlerBase_xparam=Game_BattlerBase.prototype.xparam;Game_BattlerBase.prototype.xparam=function(id){if(this._xparam&&this._xparam[id]!==undefined)return this._xparam[id];if(this._xparam===undefined)this._xparam={};var base=Yanfly.XParam.Game_BattlerBase_xparam.call(this,id);var plus=this.xparamPlus(id);var rate=this.xparamRate(id);var flat=this.xparamFlat(id);var a=this;var user=this;var subject=
this;var s=$gameSwitches._data;var v=$gameVariables._data;var code=Yanfly.Param.XParamFormula[id];try{this._xparam[id]=eval(code)}catch(e){this._xparam[id]=0;Yanfly.Util.displayError(e,code,"EXTRA PARAM FORMULA ERROR")}return this._xparam[id]};Game_BattlerBase.prototype.xparamPlus=function(id){if(this._xparamPlus===undefined)this.clearXParamPlus();return this._xparamPlus[id]};Game_BattlerBase.prototype.xparamRate=function(id){return 1};Game_BattlerBase.prototype.xparamFlat=function(id){return 0};
Game_BattlerBase.prototype.setXParam=function(id,value){if(this._xparamPlus===undefined)this.clearXParamPlus();this._xparam={};this._xparamPlus[id]=0;this._xparamPlus[id]=value-this.xparam(id);this.refresh()};Game_BattlerBase.prototype.setHit=function(value){this.setXParam(0,value)};Game_BattlerBase.prototype.setEva=function(value){this.setXParam(1,value)};Game_BattlerBase.prototype.setCri=function(value){this.setXParam(2,value)};Game_BattlerBase.prototype.setCev=function(value){this.setXParam(3,
value)};Game_BattlerBase.prototype.setMev=function(value){this.setXParam(4,value)};Game_BattlerBase.prototype.setMrf=function(value){this.setXParam(5,value)};Game_BattlerBase.prototype.setCnt=function(value){this.setXParam(6,value)};Game_BattlerBase.prototype.setHrg=function(value){this.setXParam(7,value)};Game_BattlerBase.prototype.setMrg=function(value){this.setXParam(8,value)};Game_BattlerBase.prototype.setTrg=function(value){this.setXParam(9,value)};Game_BattlerBase.prototype.setXParamPlus=function(id,
value){if(this._xparamPlus===undefined)this.clearXParamPlus();this._xparamPlus[id]=value;this.refresh()};Game_BattlerBase.prototype.setHitPlus=function(value){this.setXParamPlus(0,value)};Game_BattlerBase.prototype.setEvaPlus=function(value){this.setXParamPlus(1,value)};Game_BattlerBase.prototype.setCriPlus=function(value){this.setXParamPlus(2,value)};Game_BattlerBase.prototype.setCevPlus=function(value){this.setXParamPlus(3,value)};Game_BattlerBase.prototype.setMevPlus=function(value){this.setXParamPlus(4,
value)};Game_BattlerBase.prototype.setMrfPlus=function(value){this.setXParamPlus(5,value)};Game_BattlerBase.prototype.setCntPlus=function(value){this.setXParamPlus(6,value)};Game_BattlerBase.prototype.setHrgPlus=function(value){this.setXParamPlus(7,value)};Game_BattlerBase.prototype.setMrgPlus=function(value){this.setXParamPlus(8,value)};Game_BattlerBase.prototype.setTrgPlus=function(value){this.setXParamPlus(9,value)};Game_BattlerBase.prototype.addXParam=function(id,value){if(this._xparamPlus===
undefined)this.clearXParamPlus();this._xparamPlus[id]+=value;this.refresh()};Game_BattlerBase.prototype.addHit=function(value){this.addXParam(0,value)};Game_BattlerBase.prototype.addEva=function(value){this.addXParam(1,value)};Game_BattlerBase.prototype.addCri=function(value){this.addXParam(2,value)};Game_BattlerBase.prototype.addCev=function(value){this.addXParam(3,value)};Game_BattlerBase.prototype.addMev=function(value){this.addXParam(4,value)};Game_BattlerBase.prototype.addMrf=function(value){this.addXParam(5,
value)};Game_BattlerBase.prototype.addCnt=function(value){this.addXParam(6,value)};Game_BattlerBase.prototype.addHrg=function(value){this.addXParam(7,value)};Game_BattlerBase.prototype.addMrg=function(value){this.addXParam(8,value)};Game_BattlerBase.prototype.addTrg=function(value){this.addXParam(9,value)};Game_BattlerBase.prototype.minusHit=function(value){this.addXParam(0,-value)};Game_BattlerBase.prototype.minusEva=function(value){this.addXParam(1,-value)};Game_BattlerBase.prototype.minusCri=function(value){this.addXParam(2,
-value)};Game_BattlerBase.prototype.minusCev=function(value){this.addXParam(3,-value)};Game_BattlerBase.prototype.minusMev=function(value){this.addXParam(4,-value)};Game_BattlerBase.prototype.minusMrf=function(value){this.addXParam(5,-value)};Game_BattlerBase.prototype.minusCnt=function(value){this.addXParam(6,-value)};Game_BattlerBase.prototype.minusHrg=function(value){this.addXParam(7,-value)};Game_BattlerBase.prototype.minusMrg=function(value){this.addXParam(8,-value)};Game_BattlerBase.prototype.minusTrg=
function(value){this.addXParam(9,-value)};Game_Battler.prototype.xparamPlus=function(id){var value=Game_BattlerBase.prototype.xparamPlus.call(this,id);var length=this.states().length;for(let i=0;i<length;++i){var obj=this.states()[i];if(obj&&obj.plusXParams)value+=obj.plusXParams[id]}return value};Game_Battler.prototype.xparamRate=function(id){var value=Game_BattlerBase.prototype.xparamRate.call(this,id);var length=this.states().length;for(let i=0;i<length;++i){var obj=this.states()[i];if(obj&&obj.rateXParams)value*=
obj.rateXParams[id]}return value};Game_Battler.prototype.xparamFlat=function(id){var value=Game_BattlerBase.prototype.xparamFlat.call(this,id);var length=this.states().length;for(let i=0;i<length;++i){var obj=this.states()[i];if(obj&&obj.flatXParams)value+=obj.flatXParams[id]}return value};Yanfly.XParam.Game_Actor_setup=Game_Actor.prototype.setup;Game_Actor.prototype.setup=function(actorId){Yanfly.XParam.Game_Actor_setup.call(this,actorId);this.clearXParamPlus()};Game_Actor.prototype.xparamPlus=function(id){var value=
Game_Battler.prototype.xparamPlus.call(this,id);var length=this.equips().length;for(let i=0;i<length;++i){var obj=this.equips()[i];if(obj&&obj.plusXParams)value+=obj.plusXParams[id]}value+=this.actor().plusXParams[id];value+=this.currentClass().plusXParams[id];return value};Game_Actor.prototype.xparamRate=function(id){var value=Game_Battler.prototype.xparamRate.call(this,id);var length=this.equips().length;for(let i=0;i<length;++i){var obj=this.equips()[i];if(obj&&obj.rateXParams)value*=obj.rateXParams[id]}value*=
this.actor().rateXParams[id];value*=this.currentClass().rateXParams[id];return value};Game_Actor.prototype.xparamFlat=function(id){var value=Game_Battler.prototype.xparamFlat.call(this,id);var length=this.equips().length;for(let i=0;i<length;++i){var obj=this.equips()[i];if(obj&&obj.flatXParams)value+=obj.flatXParams[id]}value+=this.actor().flatXParams[id];value+=this.currentClass().flatXParams[id];return value};Game_Enemy.prototype.xparamPlus=function(id){var value=Game_Battler.prototype.xparamPlus.call(this,
id);value+=this.enemy().plusXParams[id];return value};Game_Enemy.prototype.xparamRate=function(id){var value=Game_Battler.prototype.xparamRate.call(this,id);value*=this.enemy().rateXParams[id];return value};Game_Enemy.prototype.xparamFlat=function(id){var value=Game_Battler.prototype.xparamFlat.call(this,id);value+=this.enemy().flatXParams[id];return value};Yanfly.Util=Yanfly.Util||{};Yanfly.Util.displayError=function(e,code,message){console.log(message);console.log(code||"NON-EXISTENT");console.error(e);
if(Utils.isNwjs()&&Utils.isOptionValid("test"))if(!require("nw.gui").Window.get().isDevToolsOpen())require("nw.gui").Window.get().showDevTools()}})();Imported.YEP_DamageCore=true;Yanfly.DMG=Yanfly.DMG||{};Yanfly.DMG.version=1.08;
(function(){Yanfly.Parameters=PluginManager.parameters("YEP_DamageCore");Yanfly.Param=Yanfly.Param||{};Yanfly.Param.DMGEnableCap=Boolean(Yanfly.Parameters["Enable Cap"]==="true")||false;Yanfly.Param.DMGMaxDamage=Number(Yanfly.Parameters["Maximum Damage"])||9999;Yanfly.Param.DMGMaxHealing=Number(Yanfly.Parameters["Maximum Healing"])||999;console.log("tag");Yanfly.DMG.DataManager_isDatabaseLoaded=DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=function(){if(!Yanfly.DMG.DataManager_isDatabaseLoaded.call(this))return false;
if(!Yanfly._loaded_YEP_DamageCore){this.processDMGNotetags1($dataSkills);this.processDMGNotetags1($dataItems);this.processDMGNotetags2($dataActors);this.processDMGNotetags2($dataClasses);this.processDMGNotetags2($dataEnemies);this.processDMGNotetags2($dataWeapons);this.processDMGNotetags2($dataArmors);this.processDMGNotetags2($dataStates);Yanfly._loaded_YEP_DamageCore=true}return true};DataManager.processDMGNotetags1=function(group){let noteD1=/<(?:DAMAGE CAP|HEAL CAP|HEALING CAP):[ ](\d+)>/i;for(let n=
1;n<group.length;n++){let obj=group[n];let notedata=obj.note.split(/[\r\n]+/);let damageFormulaMode=false;obj.damage.custom=false;obj.breakDamageCap=false;obj.damageCap=undefined;for(let i=0;i<notedata.length;i++){let line=notedata[i];if(line.match(/<(?:BREAK DAMAGE CAP|BYPASS DAMAGE CAP)>/i)){obj.breakDamageCap=true;obj.damageCap=undefined}else if(line.match(noteD1)){obj.damageCap=parseInt(RegExp.$1);obj.breakDamageCap=false}else if(line.match(/<(?:DAMAGE FORMULA)>/i)){damageFormulaMode=true;obj.damage.formula=
"";obj.damage.custom=true}else if(line.match(/<\/(?:DAMAGE FORMULA)>/i))damageFormulaMode=false;else if(damageFormulaMode)obj.damage.formula=obj.damage.formula+line+"\n"}}};DataManager.processDMGNotetags2=function(group){let noteD1=/<(?:BREAK DAMAGE CAP|BYPASS DAMAGE CAP)>/i;let noteD2=/<(?:DAMAGE CAP):[ ](\d+)>/i;let noteD3=/<(?:HEAL CAP|HEALING CAP):[ ](\d+)>/i;for(let n=1;n<group.length;n++){let obj=group[n];let notedata=obj.note.split(/[\r\n]+/);obj.breakDamageCap=undefined;obj.damageCap=undefined;
obj.healCap=undefined;for(let i=0;i<notedata.length;i++){let line=notedata[i];if(line.match(noteD1)){obj.breakDamageCap=true;obj.damageCap=undefined;obj.healCap=undefined}else if(line.match(noteD2)){obj.damageCap=parseInt(RegExp.$1);obj.breakDamageCap=undefined}else if(line.match(noteD3)){obj.healCap=parseInt(RegExp.$1)*-1;obj.breakDamageCap=undefined}}}};if(Imported.YEP_BattleEngineCore){Yanfly.DMG.BattleManager_processActionSequence=BattleManager.processActionSequence;BattleManager.processActionSequence=
function(actionName,actionArgs){if(actionName==="BYPASS DAMAGE CAP")return this.actionBypassDamageCap();if(actionName==="DAMAGE CAP"||actionName==="HEALING CAP")return this.actionDamageCap(actionArgs);if(actionName==="DAMAGE RATE")return this.actionDamageRate(actionArgs);if(actionName==="FLAT DAMAGE")return this.actionFlatDamage(actionArgs);if(actionName==="FLAT GLOBAL")return this.actionFlatGlobal(actionArgs);if(actionName==="FLAT HEAL")return this.actionFlatHeal(actionArgs);if(actionName==="GLOBAL RATE")return this.actionGlobalRate(actionArgs);
if(actionName==="HEAL RATE")return this.actionHealRate(actionArgs);if(actionName==="RESET DAMAGE CAP")return this.actionResetDamageCap();if(actionName==="RESET DAMAGE MODIFIERS")return this.actionResetDamageModifiers();return Yanfly.DMG.BattleManager_processActionSequence.call(this,actionName,actionArgs)}}BattleManager.actionBypassDamageCap=function(){$gameSystem.actSeqBypassDamageCap();return true};BattleManager.actionDamageCap=function(actionArgs){if(!actionArgs)return;if(actionArgs[0]){var value=
parseInt(actionArgs[0]);$gameSystem.setActSeqDamageCap(value)}return true};BattleManager.actionDamageRate=function(actionArgs){if(actionArgs[0].match(/(?:VARIABLE|VAR)[ ](\d+)/i))var value=parseFloat($gameVariables.value(parseInt(RegExp.$1))*.01);else if(actionArgs[0].match(/(\d+)([%\uff05])/i))var value=parseFloat(RegExp.$1*.01);else if(actionArgs[0].match(/(\d+).(\d+)/i))var value=parseFloat(String(RegExp.$1)+"."+String(RegExp.$1));else return true;$gameSystem._damageRate=value;return true};BattleManager.actionFlatDamage=
function(actionArgs){if(actionArgs[0].match(/(?:VARIABLE|VAR)[ ](\d+)/i))var value=parseInt($gameVariables.value(parseInt(RegExp.$1)));else if(actionArgs[0].match(/([\+\-]\d+)/i))var value=parseInt(RegExp.$1);else if(actionArgs[0].match(/(\d+)/i))var value=parseInt(RegExp.$1);else return true;$gameSystem._flatDamage=value;return true};BattleManager.actionFlatGlobal=function(actionArgs){if(actionArgs[0].match(/(?:VARIABLE|VAR)[ ](\d+)/i))var value=parseInt($gameVariables.value(parseInt(RegExp.$1)));
else if(actionArgs[0].match(/([\+\-]\d+)/i))var value=parseInt(RegExp.$1);else if(actionArgs[0].match(/(\d+)/i))var value=parseInt(RegExp.$1);else return true;$gameSystem._flatDamage=value;$gameSystem._flatHeal=value;return true};BattleManager.actionFlatHeal=function(actionArgs){if(actionArgs[0].match(/(?:VARIABLE|VAR)[ ](\d+)/i))var value=parseInt($gameVariables.value(parseInt(RegExp.$1)));else if(actionArgs[0].match(/([\+\-]\d+)/i))var value=parseInt(RegExp.$1);else if(actionArgs[0].match(/(\d+)/i))var value=
parseInt(RegExp.$1);else return true;$gameSystem._flatHeal=value;return true};BattleManager.actionGlobalRate=function(actionArgs){if(actionArgs[0].match(/(?:VARIABLE|VAR)[ ](\d+)/i))var value=parseFloat($gameVariables.value(parseInt(RegExp.$1))*.01);else if(actionArgs[0].match(/(\d+)([%\uff05])/i))var value=parseFloat(RegExp.$1*.01);else if(actionArgs[0].match(/(\d+).(\d+)/i))var value=parseFloat(String(RegExp.$1)+"."+String(RegExp.$1));else return true;$gameSystem._damageRate=value;$gameSystem._healRate=
value;return true};BattleManager.actionHealRate=function(actionArgs){if(actionArgs[0].match(/(?:VARIABLE|VAR)[ ](\d+)/i))var value=parseFloat($gameVariables.value(parseInt(RegExp.$1))*.01);else if(actionArgs[0].match(/(\d+)([%\uff05])/i))var value=parseFloat(RegExp.$1*.01);else if(actionArgs[0].match(/(\d+).(\d+)/i))var value=parseFloat(String(RegExp.$1)+"."+String(RegExp.$1));else return true;$gameSystem._healRate=value;return true};BattleManager.actionResetDamageCap=function(){$gameSystem.resetActSeqDamageCap();
return true};BattleManager.actionResetDamageModifiers=function(){$gameSystem.resetDamageSettings();return true};Yanfly.DMG.Game_System_initialize=Game_System.prototype.initialize;Game_System.prototype.initialize=function(){Yanfly.DMG.Game_System_initialize.call(this);this.resetActSeqDamageCap();this.resetDamageSettings()};Game_System.prototype.resetActSeqDamageCap=function(){this._actSeqBypassDamageCap=false;this._actSeqDamageCap=undefined};Game_System.prototype.actSeqBypassDamageCap=function(){this._actSeqBypassDamageCap=
true};Game_System.prototype.getActSeqBypassDamageCap=function(){return this._actSeqBypassDamageCap};Game_System.prototype.setActSeqDamageCap=function(value){this._actSeqDamageCap=value};Game_System.prototype.getActSeqDamageCap=function(){return this._actSeqDamageCap};Game_System.prototype.resetDamageSettings=function(){this._damageRate=1;this._flatDamage=0;this._healRate=1;this._flatHeal=0;this._defaultDamageCap=Yanfly.Param.DMGEnableCap};Game_System.prototype.damageRate=function(){if(this._damageRate===
undefined)this.resetDamageSettings();return this._damageRate};Game_System.prototype.flatDamage=function(){if(this._flatDamage===undefined)this.resetDamageSettings();return this._flatDamage};Game_System.prototype.healRate=function(){if(this._healRate===undefined)this.resetDamageSettings();return this._healRate};Game_System.prototype.flatHeal=function(){if(this._flatHeal===undefined)this.resetDamageSettings();return this._flatHeal};Game_System.prototype.isDamageCapped=function(){return this._defaultDamageCap};
Game_System.prototype.maximumDamage=function(){if(this._newDamageCap!==undefined)return this._newDamageCap;return Yanfly.Param.DMGMaxDamage};Game_System.prototype.maximumHealing=function(){if(this._newHealingCap!==undefined)return this._newHealingCap;return Yanfly.Param.DMGMaxHealing*-1};Game_System.prototype.setNewDamageCap=function(value,damage){if(damage)this._newDamageCap=value;else this._newHealingCap=value*-1};Yanfly.DMG.Game_BattlerBase_refresh=Game_BattlerBase.prototype.refresh;Game_BattlerBase.prototype.refresh=
function(){Yanfly.DMG.Game_BattlerBase_refresh.call(this);this.resetDMGTempValues()};Game_BattlerBase.prototype.resetDMGTempValues=function(){this._isDMGCapped=undefined;this._maximumDamage=undefined;this._maximumHealing=undefined};Yanfly.DMG.Game_Battler_performActionEnd=Game_Battler.prototype.performActionEnd;Game_Battler.prototype.performActionEnd=function(){Yanfly.DMG.Game_Battler_performActionEnd.call(this);$gameSystem.resetDamageSettings()};Game_Battler.prototype.isDamageCapped=function(){for(let i=
0;i<this.states().length;++i){var state=this.states()[i];if(state&&state.breakDamageCap)return this._isDMGCapped=false}return this._isDMGCapped=$gameSystem.isDamageCapped()};Game_Battler.prototype.maximumDamage=function(){var value=$gameSystem.maximumDamage();for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(state&&state.damageCap)value=Math.max(value,state.damageCap)}return value};Game_Battler.prototype.maximumHealing=function(){var value=$gameSystem.maximumHealing();for(let i=
0;i<this.states().length;++i){var state=this.states()[i];if(state&&state.healCap)value=Math.min(value,state.healCap)}return value};Game_Actor.prototype.isDamageCapped=function(){if(this._isDMGCapped!==undefined)return this._isDMGCapped;if(this.actor().breakDamageCap)return this._isDMGCapped=false;if(this.currentClass().breakDamageCap)return this._isDMGCapped=false;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip&&equip.breakDamageCap)return this._isDMGCapped=false}return Game_Battler.prototype.isDamageCapped.call(this)};
Game_Actor.prototype.maximumDamage=function(){if(this._maximumDamage!==undefined)return this._maximumDamage;var value=Game_Battler.prototype.maximumDamage.call(this);if(this.actor().damageCap)value=Math.max(value,this.actor().damageCap);if(this.currentClass().damageCap)value=Math.max(value,this.currentClass().damageCap);for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip&&equip.damageCap)value=Math.max(value,equip.damageCap)}return this._maximumDamage=value};Game_Actor.prototype.maximumHealing=
function(){if(this._maximumHealing!==undefined)return this._maximumHealing;var value=Game_Battler.prototype.maximumHealing.call(this);if(this.actor().healCap)value=Math.min(value,this.actor().healCap);if(this.currentClass().healCap)value=Math.min(value,this.currentClass().healCap);for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip&&equip.healCap)value=Math.min(value,equip.healCap)}return this._maximumHealing=value};Game_Enemy.prototype.isDamageCapped=function(){if(this._isDMGCapped!==
undefined)return this._isDMGCapped;if(this.enemy().breakDamageCap)return this._isDMGCapped=false;return Game_Battler.prototype.isDamageCapped.call(this)};Game_Enemy.prototype.maximumDamage=function(){if(this._maximumDamage!==undefined)return this._maximumDamage;var value=Game_Battler.prototype.maximumDamage.call(this);if(this.enemy().damageCap)value=Math.max(value,this.enemy().damageCap);return this._maximumDamage=value};Game_Enemy.prototype.maximumHealing=function(){if(this._maximumHealing!==undefined)return this._maximumHealing;
var value=Game_Battler.prototype.maximumHealing.call(this);if(this.enemy().healCap)value=Math.min(value,this.enemy().healCap);return this._maximumHealing=value};Game_Action.prototype.makeDamageValue=function(target,critical){let item=this.item();let a=this.subject();let b=target;let user=this.subject();let s=$gameSwitches._data;let v=$gameVariables._data;let baseDamage=this.evalDamageFormula(target);let value=baseDamage;baseDamage=this.modifyBaseDamage(value,baseDamage,target);baseDamage*=this.calcElementRate(target);
critical=this.modifyCritical(critical,baseDamage,target);target.result().critical=critical;value=baseDamage;if(baseDamage>0)value=this.applyDamageRate(value,baseDamage,target);if(baseDamage<0)value=this.applyHealRate(value,baseDamage,target);if(critical)value=this.applyCriticalRate(value,baseDamage,target);if(this.isPhysical()){value=this.applyPhysicalRate(value,baseDamage,target);value=this.applyFlatPhysical(value,baseDamage,target)}if(this.isMagical()){value=this.applyMagicalRate(value,baseDamage,
target);value=this.applyFlatMagical(value,baseDamage,target)}if(baseDamage>0)value=this.applyFlatDamage(value,baseDamage,target);if(baseDamage<0)value=this.applyFlatHeal(value,baseDamage,target);if(critical)value=this.applyFlatCritical(value,baseDamage,target);value=this.applyVariance(value,item.damage.variance);value=this.applyGuard(value,target);value=this.applyFlatGlobal(value,baseDamage,target);value=this.applyMinimumDamage(value,baseDamage,target);return Math.round(value)};Game_Action.prototype.evalDamageFormula=
function(target){try{var item=this.item();var a=this.subject();var b=target;var user=this.subject();var subject=this.subject();var s=$gameSwitches._data;var v=$gameVariables._data;var sign=[3,4].contains(item.damage.type)?-1:1;var value=0;if(item.damage.custom){eval(item.damage.formula);value=Math.max(value,0)*sign}else value=Math.max(eval(item.damage.formula),0)*sign;return value}catch(e){if(item.damage.custom)Yanfly.Util.displayError(e,item.damage.custom,"DAMAGE FORMULA ERROR");else Yanfly.Util.displayError(e,
item.damage.formula,"DAMAGE FORMULA ERROR");return 0}};Game_Action.prototype.modifyCritical=function(critical,baseDamage,target){return critical};Game_Action.prototype.modifyBaseDamage=function(value,baseDamage,target){return baseDamage};Game_Action.prototype.applyDamageRate=function(value,baseDamage,target){value*=$gameSystem.damageRate();value=Math.max(0,value);return value};Game_Action.prototype.applyHealRate=function(value,baseDamage,target){value*=$gameSystem.healRate();value*=target.rec;value=
Math.min(0,value);return value};Game_Action.prototype.applyCriticalRate=function(value,baseDamage,target){value=this.applyCritical(value);return value};Game_Action.prototype.applyPhysicalRate=function(value,baseDamage,target){value*=target.pdr;return value};Game_Action.prototype.applyFlatPhysical=function(value,baseDamage,target){return value};Game_Action.prototype.applyMagicalRate=function(value,baseDamage,target){value*=target.mdr;return value};Game_Action.prototype.applyFlatMagical=function(value,
baseDamage,target){return value};Game_Action.prototype.applyFlatDamage=function(value,baseDamage,target){value+=$gameSystem.flatDamage();return value};Game_Action.prototype.applyFlatHeal=function(value,baseDamage,target){value-=$gameSystem.flatHeal();return value};Game_Action.prototype.applyFlatCritical=function(value,baseDamage,target){return value};Game_Action.prototype.applyFlatGlobal=function(value,baseDamage,target){return value};Game_Action.prototype.applyMinimumDamage=function(value,baseDamage,
target){if(baseDamage>0)value=Math.max(0,value);else if(baseDamage<0)value=Math.min(0,value);if(this.isDamageCapped()){if($gameSystem.getActSeqDamageCap()!==undefined){var min=$gameSystem.getActSeqDamageCap()*-1;var max=$gameSystem.getActSeqDamageCap()}else if(this.item().damageCap){var min=this.item().damageCap*-1;var max=this.item().damageCap}else{var min=this.subject().maximumHealing();var max=this.subject().maximumDamage()}value=value.clamp(min,max)}return value};Game_Action.prototype.isDamageCapped=
function(){var item=this.item();if($gameSystem.getActSeqBypassDamageCap())return false;if($gameSystem.getActSeqDamageCap()!==undefined)return true;if(item.damageCap!==undefined)return true;if(item.breakDamageCap)return false;return this.subject().isDamageCapped()};Yanfly.DMG.Game_Action_executeHpDamage=Game_Action.prototype.executeHpDamage;Game_Action.prototype.executeHpDamage=function(target,value){value=this.applyMinimumDamage(value,value,target);Yanfly.DMG.Game_Action_executeHpDamage.call(this,
target,value)};Yanfly.DMG.Game_Action_executeMpDamage=Game_Action.prototype.executeMpDamage;Game_Action.prototype.executeMpDamage=function(target,value){value=this.applyMinimumDamage(value,value,target);Yanfly.DMG.Game_Action_executeMpDamage.call(this,target,value)};Yanfly.DMG.Game_Interpreter_pluginCommand=Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand=function(command,args){Yanfly.DMG.Game_Interpreter_pluginCommand.call(this,command,args);if(command==="SetDamageCap")this.setDamageCap(args);
if(command==="SetHealingCap")this.setHealingCap(args);if(command==="EnableDamageCap")this.setDefaultDamageCap(true);if(command==="DisableDamageCap")this.setDefaultDamageCap(false)};Game_Interpreter.prototype.setDamageCap=function(args){$gameSystem.setNewDamageCap(parseInt(args[0]),true)};Game_Interpreter.prototype.setHealingCap=function(args){$gameSystem.setNewDamageCap(parseInt(args[0]),false)};Game_Interpreter.prototype.setDefaultDamageCap=function(value){$gameSystem._defaultDamageCap=value};Yanfly.Util=
Yanfly.Util||{};Yanfly.Util.displayError=function(e,code,message){console.log(message);console.log(code||"NON-EXISTENT");console.error(e);if(Utils.RPGMAKER_VERSION&&Utils.RPGMAKER_VERSION>="1.6.0")return;if(Utils.isNwjs()&&Utils.isOptionValid("test"))if(!require("nw.gui").Window.get().isDevToolsOpen())require("nw.gui").Window.get().showDevTools()}})();Imported.YEP_HitAccuracy=true;Yanfly.HA=Yanfly.HA||{};Yanfly.HA.version=1.04;
(function(){Yanfly.Parameters=PluginManager.parameters("YEP_HitAccuracy");Yanfly.Param=Yanfly.Param||{};Yanfly.Param.HAHitFormula=String(Yanfly.Parameters["Accuracy Formula"]);Yanfly.Param.HAEvaFormula=String(Yanfly.Parameters["Evade Formula"]);Yanfly.Param.HAUserPhysical=String(Yanfly.Parameters["User Physical Hit"]);Yanfly.Param.HAUserMagical=String(Yanfly.Parameters["User Magical Hit"]);Yanfly.Param.HAUserCertain=String(Yanfly.Parameters["User Certain Hit"]);Yanfly.Param.HATarPhysical=String(Yanfly.Parameters["Target Physical Evade"]);
Yanfly.Param.HATarMagical=String(Yanfly.Parameters["Target Magical Evade"]);Yanfly.Param.HATarCertain=String(Yanfly.Parameters["Target Certain Evade"]);Game_Action.prototype.itemHit=function(target){var item=this.item();var skill=this.item();var a=this.subject();var user=this.subject();var subject=this.subject();var b=target;var s=$gameSwitches._data;var v=$gameVariables._data;var skillHitRate=this.item().successRate*.01;var userHitRate=this.userHitRate(target);var targetEvadeRate=this.targetEvadeRate(target);
var code=Yanfly.Param.HAHitFormula;try{return eval(code)}catch(e){Yanfly.Util.displayError(e,code,"CUSTOM HIT FORMULA ERROR");return false}};Game_Action.prototype.itemEva=function(target){var item=this.item();var skill=this.item();var a=this.subject();var user=this.subject();var subject=this.subject();var b=target;var s=$gameSwitches._data;var v=$gameVariables._data;var skillHitRate=this.item().successRate*.01;var userHitRate=this.userHitRate(target);var targetEvadeRate=this.targetEvadeRate(target);
var code=Yanfly.Param.HAEvaFormula;try{return eval(code)}catch(e){Yanfly.Util.displayError(e,code,"CUSTOM EVA FORMULA ERROR");return false}};Game_Action.prototype.userHitRate=function(target){var item=this.item();var skill=this.item();var a=this.subject();var user=this.subject();var subject=this.subject();var b=target;var s=$gameSwitches._data;var v=$gameVariables._data;if(this.isPhysical())var code=Yanfly.Param.HAUserPhysical;else if(this.isMagical())var code=Yanfly.Param.HAUserMagical;else var code=
Yanfly.Param.HAUserCertain;try{return eval(code)}catch(e){Yanfly.Util.displayError(e,code,"CUSTOM HIT RATE FORMULA ERROR");return 0}};Game_Action.prototype.targetEvadeRate=function(target){var item=this.item();var skill=this.item();var a=this.subject();var user=this.subject();var subject=this.subject();var b=target;var s=$gameSwitches._data;var v=$gameVariables._data;if(this.isPhysical())var code=Yanfly.Param.HATarPhysical;else if(this.isMagical())var code=Yanfly.Param.HATarMagical;else var code=
Yanfly.Param.HATarCertain;try{return eval(code)}catch(e){Yanfly.Util.displayError(e,code,"CUSTOM EVA RATE FORMULA ERROR");return 0}};Yanfly.Util=Yanfly.Util||{};Yanfly.Util.displayError=function(e,code,message){console.log(message);console.log(code||"NON-EXISTENT");console.error(e);if(Utils.RPGMAKER_VERSION&&Utils.RPGMAKER_VERSION>="1.6.0")return;if(Utils.isNwjs()&&Utils.isOptionValid("test"))if(!require("nw.gui").Window.get().isDevToolsOpen())require("nw.gui").Window.get().showDevTools()}})();Imported.YEP_X_ArmorScaling=true;Yanfly.ARS=Yanfly.ARS||{};Yanfly.ARS.version=1.05;
(function(){Yanfly.Parameters=PluginManager.parameters("YEP_X_ArmorScaling");Yanfly.Param=Yanfly.Param||{};Yanfly.Param.ARSPPhysRate=String(Yanfly.Parameters["Positive Physical Rate"]);Yanfly.Param.ARSNPhysRate=String(Yanfly.Parameters["Negative Physical Rate"]);Yanfly.Param.ARSBPhysArmor=String(Yanfly.Parameters["Physical Base Armor"]);Yanfly.Param.ARSPMagRate=String(Yanfly.Parameters["Positive Magical Rate"]);Yanfly.Param.ARSNMagRate=String(Yanfly.Parameters["Negative Magical Rate"]);Yanfly.Param.ARSBMagArmor=
String(Yanfly.Parameters["Magical Base Armor"]);Yanfly.Param.ARSPCerRate=String(Yanfly.Parameters["Positive Certain Rate"]);Yanfly.Param.ARSNCerRate=String(Yanfly.Parameters["Negative Certain Rate"]);Yanfly.Param.ARSBCerArmor=String(Yanfly.Parameters["Certain Base Armor"]);Yanfly.ARS.DataManager_isDatabaseLoaded=DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=function(){if(!Yanfly.ARS.DataManager_isDatabaseLoaded.call(this))return false;if(!Yanfly._loaded_YEP_X_ArmorScaling){this.processARSNotetags1($dataSkills);
this.processARSNotetags1($dataItems);this.processARSNotetags2($dataActors);this.processARSNotetags2($dataClasses);this.processARSNotetags2($dataEnemies);this.processARSNotetags2($dataWeapons);this.processARSNotetags2($dataArmors);this.processARSNotetags2($dataStates);Yanfly._loaded_YEP_X_ArmorScaling=true}return true};DataManager.processARSNotetags2=function(group){var note01=/<(?:PHYSICAL ARMOR REDUCTION):[ ](\d+)>/i;var note02=/<(?:PHYSICAL ARMOR REDUCTION):[ ](\d+)([%\uff05])>/i;var note03=/<(?:PHYSICAL ARMOR PENETRATION):[ ](\d+)([%\uff05])>/i;
var note04=/<(?:PHYSICAL ARMOR PENETRATION):[ ](\d+)>/i;var note05=/<(?:MAGICAL ARMOR REDUCTION):[ ](\d+)>/i;var note06=/<(?:MAGICAL ARMOR REDUCTION):[ ](\d+)([%\uff05])>/i;var note07=/<(?:MAGICAL ARMOR PENETRATION):[ ](\d+)([%\uff05])>/i;var note08=/<(?:MAGICAL ARMOR PENETRATION):[ ](\d+)>/i;var note09=/<(?:CERTAIN ARMOR REDUCTION):[ ](\d+)>/i;var note10=/<(?:CERTAIN ARMOR REDUCTION):[ ](\d+)([%\uff05])>/i;var note11=/<(?:CERTAIN ARMOR PENETRATION):[ ](\d+)([%\uff05])>/i;var note12=/<(?:CERTAIN ARMOR PENETRATION):[ ](\d+)>/i;
for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.physArmorRedFlat=0;obj.physArmorRedRate=0;obj.physArmorPenRate=0;obj.physArmorPenFlat=0;obj.magArmorRedFlat=0;obj.magArmorRedRate=0;obj.magArmorPenRate=0;obj.magArmorPenFlat=0;obj.cerArmorRedFlat=0;obj.cerArmorRedRate=0;obj.cerArmorPenRate=0;obj.cerArmorPenFlat=0;for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(note01))obj.physArmorRedFlat=parseInt(RegExp.$1);else if(line.match(note02))obj.physArmorRedRate=
parseFloat(RegExp.$1*.01);else if(line.match(note03))obj.physArmorPenRate=parseFloat(RegExp.$1*.01);else if(line.match(note04))obj.physArmorPenFlat=parseInt(RegExp.$1);else if(line.match(note05))obj.magArmorRedFlat=parseInt(RegExp.$1);else if(line.match(note06))obj.magArmorRedRate=parseFloat(RegExp.$1*.01);else if(line.match(note07))obj.magArmorPenRate=parseFloat(RegExp.$1*.01);else if(line.match(note08))obj.magArmorPenFlat=parseInt(RegExp.$1);else if(line.match(note09))obj.cerArmorRedFlat=parseInt(RegExp.$1);
else if(line.match(note10))obj.cerArmorRedRate=parseFloat(RegExp.$1*.01);else if(line.match(note11))obj.cerArmorPenRate=parseFloat(RegExp.$1*.01);else if(line.match(note12))obj.cerArmorPenFlat=parseInt(RegExp.$1)}}};DataManager.processARSNotetags1=function(group){for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);var armorScaleMode=0;if(obj.hitType===1){obj.positiveArmorScale=Yanfly.Param.ARSPPhysRate;obj.negativeArmorScale=Yanfly.Param.ARSNPhysRate;obj.baseArmorScale=
Yanfly.Param.ARSBPhysArmor}else if(obj.hitType===2){obj.positiveArmorScale=Yanfly.Param.ARSPMagRate;obj.negativeArmorScale=Yanfly.Param.ARSNMagRate;obj.baseArmorScale=Yanfly.Param.ARSBMagArmor}else{obj.positiveArmorScale=Yanfly.Param.ARSPCerRate;obj.negativeArmorScale=Yanfly.Param.ARSNCerRate;obj.baseArmorScale=Yanfly.Param.ARSBCerArmor}obj.armorReductionFlat=0;obj.armorReductionRate=0;obj.armorPenetrationFlat=0;obj.armorPenetrationRate=0;for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(?:POSITIVE ARMOR RATE)>/i)){armorScaleMode=
1;obj.positiveArmorScale=""}else if(line.match(/<\/(?:POSITIVE ARMOR RATE)>/i))armorScaleMode=0;else if(line.match(/<(?:NEGATIVE ARMOR RATE)>/i)){armorScaleMode=-1;obj.negativeArmorScale=""}else if(line.match(/<\/(?:NEGATIVE ARMOR RATE)>/i))armorScaleMode=0;else if(line.match(/<(?:BASE ARMOR)>/i)){armorScaleMode=2;obj.baseArmorScale=""}else if(line.match(/<\/(?:BASE ARMOR)>/i))armorScaleMode=0;else if(line.match(/<(?:ARMOR REDUCTION):[ ](\d+)>/i))obj.armorReductionFlat=parseInt(RegExp.$1);else if(line.match(/<(?:ARMOR REDUCTION):[ ](\d+)([%\uff05])>/i))obj.armorReductionRate=
parseFloat(RegExp.$1*.01);else if(line.match(/<(?:ARMOR PENETRATION):[ ](\d+)>/i))obj.armorPenetrationFlat=parseInt(RegExp.$1);else if(line.match(/<(?:ARMOR PENETRATION):[ ](\d+)([%\uff05])>/i))obj.armorPenetrationRate=parseFloat(RegExp.$1*.01);else if(line.match(/<(?:BYPASS ARMOR SCALING)>/i)){obj.positiveArmorScale="";obj.negativeArmorScale=""}else if(armorScaleMode===1)obj.positiveArmorScale=obj.positiveArmorScale+line+"\n";else if(armorScaleMode===-1)obj.negativeArmorScale=obj.negativeArmorScale+
line+"\n";else if(armorScaleMode===2)obj.baseArmorScale=obj.baseArmorScale+line+"\n"}}};if(Imported.YEP_BattleEngineCore){Yanfly.ARS.BattleManager_processActionSequence=BattleManager.processActionSequence;BattleManager.processActionSequence=function(actionName,actionArgs){if(actionName==="ARMOR PENETRATION")return this.actionArmorPenetration(actionArgs);if(actionName==="ARMOR REDUCTION")return this.actionArmorReduction(actionArgs);if(actionName==="RESET ARMOR PENETRATION")return this.actionResetArmorPenetration();
if(actionName==="RESET ARMOR REDUCTION")return this.actionResetArmorReduction();return Yanfly.ARS.BattleManager_processActionSequence.call(this,actionName,actionArgs)}}BattleManager.actionArmorPenetration=function(actionArgs){if(actionArgs[0].match(/(\d+)([%\uff05])/i)){var value=parseFloat(RegExp.$1*.01);$gameSystem._armorPenRate=value}else if(actionArgs[0].match(/(\d+)/i)){var value=parseInt(RegExp.$1);$gameSystem._armorPenFlat=value}else return true;return true};BattleManager.actionArmorReduction=
function(actionArgs){if(actionArgs[0].match(/(\d+)([%\uff05])/i)){var value=parseFloat(RegExp.$1*.01);$gameSystem._armorRedRate=value}else if(actionArgs[0].match(/(\d+)/i)){var value=parseInt(RegExp.$1);$gameSystem._armorRedFlat=value}else return true;return true};BattleManager.actionResetArmorPenetration=function(){$gameSystem._armorPenRate=0;$gameSystem._armorPenFlat=0;return true};BattleManager.actionResetArmorReduction=function(){$gameSystem._armorRedRate=0;$gameSystem._armorRedFlat=0;return true};
Yanfly.ARS.Game_System_rDS=Game_System.prototype.resetDamageSettings;Game_System.prototype.resetDamageSettings=function(){Yanfly.ARS.Game_System_rDS.call(this);this._armorRedFlat=0;this._armorRedRate=0;this._armorPenRate=0;this._armorPenFlat=0};Game_System.prototype.armorReductionFlat=function(){if(this._armorRedFlat===undefined)this.resetDamageSettings();return this._armorRedFlat};Game_System.prototype.armorReductionRate=function(){if(this._armorRedRate===undefined)this.resetDamageSettings();return this._armorRedRate};
Game_System.prototype.armorPenetrationRate=function(){if(this._armorPenRate===undefined)this.resetDamageSettings();return this._armorPenRate};Game_System.prototype.armorPenetrationFlat=function(){if(this._armorPenFlat===undefined)this.resetDamageSettings();return this._armorPenFlat};Game_Battler.prototype.certainArmorReductionFlat=function(){var value=0;if($gameParty.inBattle())value+=$gameSystem.armorReductionFlat();for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(state)value+=
state.cerArmorRedFlat}return value};Game_Battler.prototype.physicalArmorReductionFlat=function(){var value=0;if($gameParty.inBattle())value+=$gameSystem.armorReductionFlat();for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(state)value+=state.physArmorRedFlat}return value};Game_Battler.prototype.magicalArmorReductionFlat=function(){var value=0;if($gameParty.inBattle())value+=$gameSystem.armorReductionFlat();for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(state)value+=
state.magArmorRedFlat}return value};Game_Battler.prototype.certainArmorReductionRate=function(){var value=1;if($gameParty.inBattle())value*=1-$gameSystem.armorReductionRate();for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(state)value*=1-state.cerArmorRedRate}return value};Game_Battler.prototype.physicalArmorReductionRate=function(){var value=1;if($gameParty.inBattle())value*=1-$gameSystem.armorReductionRate();for(let i=0;i<this.states().length;++i){var state=this.states()[i];
if(state)value*=1-state.physArmorRedRate}return value};Game_Battler.prototype.magicalArmorReductionRate=function(){var value=1;if($gameParty.inBattle())value*=1-$gameSystem.armorReductionRate();for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(state)value*=1-state.magArmorRedRate}return value};Game_Battler.prototype.certainArmorPenetrationRate=function(){var value=1;if($gameParty.inBattle())value*=1-$gameSystem.armorPenetrationRate();for(let i=0;i<this.states().length;++i){var state=
this.states()[i];if(state)value*=1-state.cerArmorPenRate}return value};Game_Battler.prototype.physicalArmorPenetrationRate=function(){var value=1;if($gameParty.inBattle())value*=1-$gameSystem.armorPenetrationRate();for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(state)value*=1-state.physArmorPenRate}return value};Game_Battler.prototype.magicalArmorPenetrationRate=function(){var value=1;if($gameParty.inBattle())value*=1-$gameSystem.armorPenetrationRate();for(let i=0;i<this.states().length;++i){var state=
this.states()[i];if(state)value*=1-state.magArmorPenRate}return value};Game_Battler.prototype.certainArmorPenetrationFlat=function(){var value=0;if($gameParty.inBattle())value+=$gameSystem.armorPenetrationFlat();for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(state)value+=state.cerArmorPenFlat}return value};Game_Battler.prototype.physicalArmorPenetrationFlat=function(){var value=0;if($gameParty.inBattle())value+=$gameSystem.armorPenetrationFlat();for(let i=0;i<this.states().length;++i){var state=
this.states()[i];if(state)value+=state.physArmorPenFlat}return value};Game_Battler.prototype.magicalArmorPenetrationFlat=function(){var value=0;if($gameParty.inBattle())value+=$gameSystem.armorPenetrationFlat();for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(state)value+=state.magArmorPenFlat}return value};Game_Actor.prototype.certainArmorReductionFlat=function(){var value=Game_Battler.prototype.certainArmorReductionFlat.call(this);value+=this.actor().cerArmorRedFlat;value+=
this.currentClass().cerArmorRedFlat;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip)value+=equip.cerArmorRedFlat}return value};Game_Actor.prototype.physicalArmorReductionFlat=function(){var value=Game_Battler.prototype.physicalArmorReductionFlat.call(this);value+=this.actor().physArmorRedFlat;value+=this.currentClass().physArmorRedFlat;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip)value+=equip.physArmorRedFlat}return value};Game_Actor.prototype.magicalArmorReductionFlat=
function(){var value=Game_Battler.prototype.magicalArmorReductionFlat.call(this);value+=this.actor().magArmorRedFlat;value+=this.currentClass().magArmorRedFlat;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip)value+=equip.magArmorRedFlat}return value};Game_Actor.prototype.certainArmorReductionRate=function(){var value=Game_Battler.prototype.certainArmorReductionRate.call(this);value*=1-this.actor().cerArmorRedRate;value*=1-this.currentClass().cerArmorRedRate;for(let i=0;i<
this.equips().length;++i){var equip=this.equips()[i];if(equip)value*=1-equip.cerArmorRedRate}return value};Game_Actor.prototype.physicalArmorReductionRate=function(){var value=Game_Battler.prototype.physicalArmorReductionRate.call(this);value*=1-this.actor().physArmorRedRate;value*=1-this.currentClass().physArmorRedRate;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip)value*=1-equip.physArmorRedRate}return value};Game_Actor.prototype.magicalArmorReductionRate=function(){var value=
Game_Battler.prototype.magicalArmorReductionRate.call(this);value*=1-this.actor().magArmorRedRate;value*=1-this.currentClass().magArmorRedRate;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip)value*=1-equip.magArmorRedRate}return value};Game_Actor.prototype.certainArmorPenetrationRate=function(){var value=Game_Battler.prototype.certainArmorPenetrationRate.call(this);value*=1-this.actor().cerArmorPenRate;value*=1-this.currentClass().cerArmorPenRate;for(let i=0;i<this.equips().length;++i){var equip=
this.equips()[i];if(equip)value*=1-equip.cerArmorPenRate}return value};Game_Actor.prototype.physicalArmorPenetrationRate=function(){var value=Game_Battler.prototype.physicalArmorPenetrationRate.call(this);value*=1-this.actor().physArmorPenRate;value*=1-this.currentClass().physArmorPenRate;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip)value*=1-equip.physArmorPenRate}return value};Game_Actor.prototype.magicalArmorPenetrationRate=function(){var value=Game_Battler.prototype.magicalArmorPenetrationRate.call(this);
value*=1-this.actor().magArmorPenRate;value*=1-this.currentClass().magArmorPenRate;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip)value*=1-equip.magArmorPenRate}return value};Game_Actor.prototype.certainArmorPenetrationFlat=function(){var value=Game_Battler.prototype.certainArmorPenetrationFlat.call(this);value+=this.actor().cerArmorPenFlat;value+=this.currentClass().cerArmorPenFlat;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip)value+=equip.cerArmorPenFlat}return value};
Game_Actor.prototype.physicalArmorPenetrationFlat=function(){var value=Game_Battler.prototype.physicalArmorPenetrationFlat.call(this);value+=this.actor().physArmorPenFlat;value+=this.currentClass().physArmorPenFlat;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip)value+=equip.physArmorPenFlat}return value};Game_Actor.prototype.magicalArmorPenetrationFlat=function(){var value=Game_Battler.prototype.magicalArmorPenetrationFlat.call(this);value+=this.actor().magArmorPenFlat;
value+=this.currentClass().magArmorPenFlat;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(equip)value+=equip.magArmorPenFlat}return value};Game_Enemy.prototype.certainArmorReductionFlat=function(){var value=Game_Battler.prototype.certainArmorReductionFlat.call(this);value+=this.enemy().cerArmorRedFlat;return value};Game_Enemy.prototype.physicalArmorReductionFlat=function(){var value=Game_Battler.prototype.physicalArmorReductionFlat.call(this);value+=this.enemy().physArmorRedFlat;
return value};Game_Enemy.prototype.magicalArmorReductionFlat=function(){var value=Game_Battler.prototype.magicalArmorReductionFlat.call(this);value+=this.enemy().magArmorRedFlat;return value};Game_Enemy.prototype.certainArmorReductionRate=function(){var value=Game_Battler.prototype.certainArmorReductionRate.call(this);value*=1-this.enemy().cerArmorRedRate;return value};Game_Enemy.prototype.physicalArmorReductionRate=function(){var value=Game_Battler.prototype.physicalArmorReductionRate.call(this);
value*=1-this.enemy().physArmorRedRate;return value};Game_Enemy.prototype.magicalArmorReductionRate=function(){var value=Game_Battler.prototype.magicalArmorReductionRate.call(this);value*=1-this.enemy().magArmorRedRate;return value};Game_Enemy.prototype.certainArmorPenetrationRate=function(){var value=Game_Battler.prototype.certainArmorPenetrationRate.call(this);value*=1-this.enemy().cerArmorPenRate;return value};Game_Enemy.prototype.physicalArmorPenetrationRate=function(){var value=Game_Battler.prototype.physicalArmorPenetrationRate.call(this);
value*=1-this.enemy().physArmorPenRate;return value};Game_Enemy.prototype.magicalArmorPenetrationRate=function(){var value=Game_Battler.prototype.magicalArmorPenetrationRate.call(this);value*=1-this.enemy().magArmorPenRate;return value};Game_Enemy.prototype.certainArmorPenetrationFlat=function(){var value=Game_Battler.prototype.certainArmorPenetrationFlat.call(this);value+=this.enemy().cerArmorPenFlat;return value};Game_Enemy.prototype.physicalArmorPenetrationFlat=function(){var value=Game_Battler.prototype.physicalArmorPenetrationFlat.call(this);
value+=this.enemy().physArmorPenFlat;return value};Game_Enemy.prototype.magicalArmorPenetrationFlat=function(){var value=Game_Battler.prototype.magicalArmorPenetrationFlat.call(this);value+=this.enemy().magArmorPenFlat;return value};Yanfly.ARS.Game_Action_applyDamageRate=Game_Action.prototype.applyDamageRate;Game_Action.prototype.applyDamageRate=function(value,baseDamage,target){value=this.scaleCertainArmor(value,baseDamage,target);return Yanfly.ARS.Game_Action_applyDamageRate.call(this,value,baseDamage,
target)};Yanfly.ARS.Game_Action_applyPhysicalRate=Game_Action.prototype.applyPhysicalRate;Game_Action.prototype.applyPhysicalRate=function(value,baseDamage,target){value=this.scalePhysicalArmor(value,baseDamage,target);return Yanfly.ARS.Game_Action_applyPhysicalRate.call(this,value,baseDamage,target)};Yanfly.ARS.Game_Action_applyMagicalRate=Game_Action.prototype.applyMagicalRate;Game_Action.prototype.applyMagicalRate=function(value,baseDamage,target){value=this.scaleMagicalArmor(value,baseDamage,
target);return Yanfly.ARS.Game_Action_applyMagicalRate.call(this,value,baseDamage,target)};Game_Action.prototype.scaleCertainArmor=function(value,baseDamage,target){if(baseDamage<=0)return value;if(!this.isCertainHit())return value;let armor=this.getBaseArmor(value,baseDamage,target);armor=this.applyCertainArmorScale(armor,target);let item=this.item();var a=this.subject();var b=target;var user=this.subject();var subject=this.subject();var s=$gameSwitches._data;var v=$gameVariables._data;let code=
"";if(armor>=0)code=item.positiveArmorScale;else code=item.negativeArmorScale;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"ARMOR SCALING FORMULA ERROR")}return value};Game_Action.prototype.scalePhysicalArmor=function(value,baseDamage,target){if(baseDamage<=0)return value;var armor=this.getBaseArmor(value,baseDamage,target);armor=this.applyPhysicalArmorScale(armor,target);var item=this.item();var a=this.subject();var b=target;var user=this.subject();var subject=this.subject();var s=$gameSwitches._data;
var v=$gameVariables._data;if(armor>=0)var code=item.positiveArmorScale;else var code=item.negativeArmorScale;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"ARMOR SCALING FORMULA ERROR")}return value};Game_Action.prototype.scaleMagicalArmor=function(value,baseDamage,target){if(baseDamage<=0)return value;var armor=this.getBaseArmor(value,baseDamage,target);armor=this.applyMagicalArmorScale(armor,target);var item=this.item();var a=this.subject();var b=target;var user=this.subject();var subject=
this.subject();var s=$gameSwitches._data;var v=$gameVariables._data;if(armor>=0)var code=item.positiveArmorScale;else var code=item.negativeArmorScale;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"ARMOR SCALING FORMULA ERROR")}return value};Game_Action.prototype.getBaseArmor=function(value,baseDamage,target){var armor=0;var item=this.item();var a=this.subject();var b=target;var user=this.subject();var subject=this.subject();var s=$gameSwitches._data;var v=$gameVariables._data;var code=
item.baseArmorScale;try{armor=eval(code)}catch(e){Yanfly.Util.displayError(e,code,"BASE ARMOR FORMULA ERROR")}return armor};Game_Action.prototype.applyCertainArmorScale=function(armor,target){armor-=this.item().armorReductionFlat;armor-=target.certainArmorReductionFlat();if(armor>0){armor*=1-this.item().armorReductionRate;armor*=target.certainArmorReductionRate();armor*=1-this.item().armorPenetrationRate;armor*=this.subject().certainArmorPenetrationRate();armor-=this.item().armorPenetrationFlat;armor-=
Math.min(armor,this.subject().certainArmorPenetrationFlat())}return armor};Game_Action.prototype.applyPhysicalArmorScale=function(armor,target){armor-=this.item().armorReductionFlat;armor-=target.physicalArmorReductionFlat();if(armor>0){armor*=1-this.item().armorReductionRate;armor*=target.physicalArmorReductionRate();armor*=1-this.item().armorPenetrationRate;armor*=this.subject().physicalArmorPenetrationRate();armor-=this.item().armorPenetrationFlat;armor-=Math.min(armor,this.subject().physicalArmorPenetrationFlat())}return armor};
Game_Action.prototype.applyMagicalArmorScale=function(armor,target){armor-=this.item().armorReductionFlat;armor-=target.magicalArmorReductionFlat();if(armor>0){armor*=1-this.item().armorReductionRate;armor*=target.magicalArmorReductionRate();armor*=1-this.item().armorPenetrationRate;armor*=this.subject().magicalArmorPenetrationRate();armor-=this.item().armorPenetrationFlat;armor-=Math.min(armor,this.subject().magicalArmorPenetrationFlat())}return armor};Yanfly.Util=Yanfly.Util||{};Yanfly.Util.displayError=
function(e,code,message){console.log(message);console.log(code||"NON-EXISTENT");console.error(e);if(Utils.RPGMAKER_VERSION&&Utils.RPGMAKER_VERSION>="1.6.0")return;if(Utils.isNwjs()&&Utils.isOptionValid("test"))if(!require("nw.gui").Window.get().isDevToolsOpen())require("nw.gui").Window.get().showDevTools()}})();Imported.YEP_BuffsStatesCore=true;Yanfly.BSC=Yanfly.BSC||{};Yanfly.BSC.version=1.16;
(()=>{Yanfly.Parameters=PluginManager.parameters("YEP_BuffsStatesCore");Yanfly.Param=Yanfly.Param||{};Yanfly.Param.BSCShowTurns=eval(String(Yanfly.Parameters["Show Turns"]));Yanfly.Param.BSCFontSize=String(Yanfly.Parameters["Font Size"]);Yanfly.Param.BSCTurnAlign=String(Yanfly.Parameters["Turn Alignment"]);Yanfly.Param.BSCTurnBufferX=Number(Yanfly.Parameters["Turn Buffer X"]);Yanfly.Param.BSCTurnBufferY=Number(Yanfly.Parameters["Turn Buffer Y"]);Yanfly.Param.BSCTurnColor=Number(Yanfly.Parameters["State Color"]);
Yanfly.Param.BSCBuffColor=Number(Yanfly.Parameters["Buff Color"]);Yanfly.Param.BSCDebuffColor=Number(Yanfly.Parameters["Debuff Color"]);Yanfly.Param.BSCShowEnemyIcon=String(Yanfly.Parameters["Show Enemy Icons"]);Yanfly.Param.BSCShowEnemyIcon=eval(Yanfly.Param.BSCShowEnemyIcon);Yanfly.Param.BSCEnemyBTurn=String(Yanfly.Parameters["Enemy Buff Turn"]);Yanfly.Param.BSCEnemyBTurn=eval(Yanfly.Param.BSCEnemyBTurn);Yanfly.Param.BSCEnemyTurn=String(Yanfly.Parameters["Enemy State Turn"]);Yanfly.Param.BSCEnemyTurn=
eval(Yanfly.Param.BSCEnemyTurn);Yanfly.Param.BSCEnemyCounter=String(Yanfly.Parameters["Enemy State Counter"]);Yanfly.Param.BSCEnemyCounter=eval(Yanfly.Param.BSCEnemyCounter);Yanfly.Param.BSCDefaultLimit=Number(Yanfly.Parameters["Default Limit"]);Yanfly.Param.BSCMaximumLimit=Number(Yanfly.Parameters["Maximum Limit"]);Yanfly.Param.BSCBuffFormula=String(Yanfly.Parameters["Buff Formula"]);Yanfly.Param.BSCShowBuffRate=String(Yanfly.Parameters["Show Buff Rate"]);Yanfly.Param.BSCShowBuffRate=eval(Yanfly.Param.BSCShowBuffRate);
Yanfly.Param.BSCReapplyRules=Number(Yanfly.Parameters["Reapply Rules"]);Yanfly.Param.BSCShowEnemyTurns=String(Yanfly.Parameters["Show Enemy Turns"]);Yanfly.Param.BSCShowEnemyTurns=eval(Yanfly.Param.BSCShowEnemyTurns);Yanfly.Param.BSCCounterSize=Number(Yanfly.Parameters["Counter Font Size"]);Yanfly.Param.BSCCounterAlign=String(Yanfly.Parameters["Counter Alignment"]);Yanfly.Param.BSCCounterBufferX=Number(Yanfly.Parameters["Counter Buffer X"]);Yanfly.Param.BSCCounterBufferY=Number(Yanfly.Parameters["Counter Buffer Y"]);
Yanfly.Param.BSCCounterColor=Number(Yanfly.Parameters["Counter Color"]);Yanfly.BSC.DataManager_isDatabaseLoaded=DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=function(){if(!Yanfly.BSC.DataManager_isDatabaseLoaded.call(this))return false;if(!Yanfly._loaded_YEP_BuffsStatesCore){this.processBSCNotetagsT($dataStates);this.processBSCNotetags1($dataStates);this.processBSCNotetags2($dataActors);this.processBSCNotetags2($dataClasses);this.processBSCNotetags2($dataEnemies);this.processBSCNotetags2($dataWeapons);
this.processBSCNotetags2($dataArmors);this.processBSCNotetags2($dataStates);this.processBSCNotetags3($dataSkills);this.processBSCNotetags3($dataItems);this.processBSCNotetags4($dataEnemies);Yanfly._loaded_YEP_BuffsStatesCore=true}return true};DataManager.processBSCNotetagsT=(group)=>{if(Yanfly.StateIdRef)return;Yanfly.StateIdRef={};for(let n=1;n<group.length;n++){var obj=group[n];if(obj.name.length<=0)continue;Yanfly.StateIdRef[obj.name.toUpperCase()]=n}};DataManager.processBSCNotetags1=function(group){for(let n=
1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.showTurns=Yanfly.Param.BSCShowTurns;obj.turnAlign=Yanfly.Param.BSCTurnAlign;obj.turnFontSize=Yanfly.Param.BSCFontSize;obj.turnBufferX=Yanfly.Param.BSCTurnBufferX;obj.turnBufferY=Yanfly.Param.BSCTurnBufferY;obj.turnColor=Yanfly.Param.BSCTurnColor;obj.reapplyRules=Yanfly.Param.BSCReapplyRules;this.initStateEval(obj);this.initStateCounter(obj);var evalMode="none";var evalType="none";for(let i=0;i<notedata.length;i++){var line=
notedata[i];if(line.match(/<(?:SHOW TURNS)>/i))obj.showTurns=true;else if(line.match(/<(?:HIDE TURNS)>/i))obj.showTurns=false;else if(line.match(/<(?:TURN ALIGNMENT|turn align):[ ](.*)>/i))obj.turnAlign=String(RegExp.$1).toLowerCase();else if(line.match(/<(?:TURN FONT SIZE):[ ](\d+)>/i))obj.turnFontSize=parseInt(RegExp.$1);else if(line.match(/<(?:TURN BUFFER X):[ ]([\+\-]\d+)>/i))obj.turnBufferX=parseInt(RegExp.$1);else if(line.match(/<(?:TURN BUFFER Y):[ ]([\+\-]\d+)>/i))obj.turnBufferY=parseInt(RegExp.$1);
else if(line.match(/<(?:TURN COLOR):[ ](\d+)>/i))obj.turnColor=parseInt(RegExp.$1);else if(line.match(/<(?:REAPPLY IGNORE TURNS)>/i))obj.reapplyRules=0;else if(line.match(/<(?:REAPPLY RESET TURNS)>/i))obj.reapplyRules=1;else if(line.match(/<(?:REAPPLY ADD TURNS)>/i))obj.reapplyRules=2;else if(line.match(/<CUSTOM[ ](.*)[ ]EFFECT>/i)){var name=String(RegExp.$1).toUpperCase();evalMode="custom state effect";if(["APPLY","ADD"].contains(name))evalType="addState";else if(["REMOVE","ERASE"].contains(name))evalType=
"removeState";else if(["LEAVE","DECAY"].contains(name))evalType="leaveState";else if(["TURN START","BEGIN"].contains(name))evalType="turnStartState";else if(["TURN END","CLOSE"].contains(name))evalType="turnEndState";else if(["REGENERATE","REGEN","WHILE"].contains(name))evalType="regenerateState";else if(["SELECT","ONTARGET"].contains(name))evalType="selectState";else if(["DESELECT","OFFTARGET"].contains(name))evalType="deselectState";else if(["REACT","REACTION"].contains(name))evalType="reactState";
else if(["RESPOND","RESPONSE"].contains(name))evalType="respondState";else if(["INITIATE","ONAPPLY"].contains(name))evalType="initiateState";else if(["CONFIRM","PREDAMAGE","PRE-DAMAGE"].contains(name))evalType="confirmState";else if(["ESTABLISH","POSTDAMAGE","POST-DAMAGE"].contains(name))evalType="establishState";else if(["CONCLUDE","OFFAPPLY"].contains(name))evalType="concludeState";else if(["ACTION START","START"].contains(name))evalType="actionStartState";else if(["ACTION END","FINISH"].contains(name))evalType=
"actionEndState";else if(["BATTLE","BATTLE START"].contains(name))evalType="battle";else if(["VICTORY","BATTLE VICTORY"].contains(name))evalType="victory";else if(["DEFEAT","BATTLE DEFEAT"].contains(name))evalType="defeat";else if(["ESCAPE","BATTLE ESCAPE"].contains(name))evalType="escape"}else if(line.match(/<\/CUSTOM[ ](.*)[ ]EFFECT>/i)){evalMode="none";evalType="none"}else if(evalMode==="custom state effect")obj.customEffectEval[evalType]=`${obj.customEffectEval[evalType]+line}\n`;else if(line.match(/<COUNTER FONT SIZE:[ ](\d+)>/i))obj.stateCounterSettings["size"]=
parseInt(RegExp.$1);else if(line.match(/<COUNTER[ ](?:ALIGNMENT|align):[ ](.*)>/i))obj.stateCounterSettings["align"]=String(RegExp.$1).toLowerCase();else if(line.match(/<COUNTER BUFFER X:[ ]([\+\-]\d+)>/i))obj.stateCounterSettings["bufferX"]=parseInt(RegExp.$1);else if(line.match(/<COUNTER BUFFER Y:[ ]([\+\-]\d+)>/i))obj.stateCounterSettings["bufferY"]=parseInt(RegExp.$1);else if(line.match(/<COUNTER TEXT COLOR:[ ](\d+)>/i))obj.stateCounterSettings["color"]=parseInt(RegExp.$1)}}};DataManager.initStateEval=
(obj)=>{obj.customEffectEval={};obj.customEffectEval["addState"]="";obj.customEffectEval["removeState"]="";obj.customEffectEval["leaveState"]="";obj.customEffectEval["turnStartState"]="";obj.customEffectEval["turnEndState"]="";obj.customEffectEval["regenerateState"]="";obj.customEffectEval["selectState"]="";obj.customEffectEval["deselectState"]="";obj.customEffectEval["reactState"]="";obj.customEffectEval["respondState"]="";obj.customEffectEval["initiateState"]="";obj.customEffectEval["concludeState"]=
"";obj.customEffectEval["confirmState"]="";obj.customEffectEval["establishState"]="";obj.customEffectEval["actionStartState"]="";obj.customEffectEval["actionEndState"]="";obj.customEffectEval["battle"]="";obj.customEffectEval["victory"]="";obj.customEffectEval["defeat"]="";obj.customEffectEval["escape"]=""};DataManager.initStateCounter=(obj)=>{obj.stateCounterSettings={};obj.stateCounterSettings["size"]=Yanfly.Param.BSCCounterSize||16;obj.stateCounterSettings["align"]=Yanfly.Param.BSCCounterAlign;
if(obj.stateCounterSettings["align"]==="undefined")obj.stateCounterSettings["align"]="center";obj.stateCounterSettings["bufferX"]=Yanfly.Param.BSCCounterBufferX||0;obj.stateCounterSettings["bufferY"]=Yanfly.Param.BSCCounterBufferY||8;obj.stateCounterSettings["color"]=Yanfly.Param.BSCCounterColor||0};DataManager.processBSCNotetags2=(group)=>{for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.maxBuff=[0,0,0,0,0,0,0,0];obj.maxDebuff=[0,0,0,0,0,0,0,0];for(let i=
0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(?:MAX)[ ](.*)[ ](?:BUFF):[ ]([\+\-]\d+)>/i)){var paramId=8;var stat=String(RegExp.$1).toUpperCase();var limit=parseInt(RegExp.$2);if(["MAXHP","MAX HP","MHP","HP"].contains(stat))paramId=0;else if(["MAXMP","MAX MP","MMP","MP"].contains(stat))paramId=1;else if(["ATK","STR"].contains(stat))paramId=2;else if(["DEF"].contains(stat))paramId=3;else if(["MAT","INT"].contains(stat))paramId=4;else if(["MDF","RES"].contains(stat))paramId=5;else if(["AGI",
"SPD"].contains(stat))paramId=6;else if(["LUK"].contains(stat))paramId=7;obj.maxBuff[paramId]=limit}else if(line.match(/<(?:MAX)[ ](.*)[ ](?:DEBUFF):[ ]([\+\-]\d+)>/i)){var paramId=8;var stat=String(RegExp.$1).toUpperCase();var limit=parseInt(RegExp.$2);if(["MAXHP","MAX HP","MHP","HP"].contains(stat))paramId=0;else if(["MAXMP","MAX MP","MMP","MP"].contains(stat))paramId=1;else if(["ATK","STR"].contains(stat))paramId=2;else if(["DEF"].contains(stat))paramId=3;else if(["MAT","INT"].contains(stat))paramId=
4;else if(["MDF","RES"].contains(stat))paramId=5;else if(["AGI","SPD"].contains(stat))paramId=6;else if(["LUK"].contains(stat))paramId=7;obj.maxDebuff[paramId]=limit}}}};DataManager.processBSCNotetags3=(group)=>{for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.modifyTurnBuff=[0,0,0,0,0,0,0,0];obj.modifyTurnDebuff=[0,0,0,0,0,0,0,0];obj.modifyTurnBuffEval=["","","","","","","",""];obj.modifyTurnDebuffEval=["","","","","","","",""];obj.modifyTurnState={};obj.modifyTurnStateEval=
{};var evalMode="none";var evalLine="";for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(.*)[ ](?:BUFF TURNS):[ ]([\+\-]\d+)>/i)){var paramId=8;var stat=String(RegExp.$1).toUpperCase();var value=parseInt(RegExp.$2);if(["MAXHP","MAX HP","MHP","HP"].contains(stat))paramId=0;else if(["MAXMP","MAX MP","MMP","MP"].contains(stat))paramId=1;else if(["ATK","STR"].contains(stat))paramId=2;else if(["DEF"].contains(stat))paramId=3;else if(["MAT","INT"].contains(stat))paramId=4;else if(["MDF",
"RES"].contains(stat))paramId=5;else if(["AGI","SPD"].contains(stat))paramId=6;else if(["LUK"].contains(stat))paramId=7;obj.modifyTurnBuff[paramId]=value}else if(line.match(/<(.*)[ ](?:DEBUFF TURNS):[ ]([\+\-]\d+)>/i)){var paramId=8;var stat=String(RegExp.$1).toUpperCase();var value=parseInt(RegExp.$2);if(["MAXHP","MAX HP","MHP","HP"].contains(stat))paramId=0;else if(["MAXMP","MAX MP","MMP","MP"].contains(stat))paramId=1;else if(["ATK","STR"].contains(stat))paramId=2;else if(["DEF"].contains(stat))paramId=
3;else if(["MAT","INT"].contains(stat))paramId=4;else if(["MDF","RES"].contains(stat))paramId=5;else if(["AGI","SPD"].contains(stat))paramId=6;else if(["LUK"].contains(stat))paramId=7;obj.modifyTurnDebuff[paramId]=value}else if(line.match(/<(?:CUSTOM)[ ](.*)[ ](?:BUFF TURNS)>/i)){evalMode="custom buff";evalLine=""}else if(line.match(/<\/(?:CUSTOM)[ ](.*)[ ](?:BUFF TURNS)>/i)){var paramId=8;var stat=String(RegExp.$1).toUpperCase();if(["MAXHP","MAX HP","MHP","HP"].contains(stat))paramId=0;else if(["MAXMP",
"MAX MP","MMP","MP"].contains(stat))paramId=1;else if(["ATK","STR"].contains(stat))paramId=2;else if(["DEF"].contains(stat))paramId=3;else if(["MAT","INT"].contains(stat))paramId=4;else if(["MDF","RES"].contains(stat))paramId=5;else if(["AGI","SPD"].contains(stat))paramId=6;else if(["LUK"].contains(stat))paramId=7;obj.modifyTurnBuffEval[paramId]=evalLine;evalMode="none";evalLine=""}else if(evalMode==="custom buff")evalLine=`${evalLine+line}\n`;else if(line.match(/<STATE[ ](\d+)[ ]TURNS:[ ]([\+\-]\d+)>/i))obj.modifyTurnState[parseInt(RegExp.$1)]=
parseInt(RegExp.$2);else if(line.match(/<STATE[ ](.*)[ ]TURNS:[ ]([\+\-]\d+)>/i)){var name=String(RegExp.$1).toUpperCase();var value=parseInt(RegExp.$2);var id=Yanfly.StateIdRef[name];obj.modifyTurnState[id]=value}else if(line.match(/<(?:CUSTOM STATE)[ ](.*)[ ](?:TURNS)>/i)){evalMode="custom state";evalLine=""}else if(line.match(/<\/(?:CUSTOM STATE)[ ](.*)[ ](?:TURNS)>/i)){var text=String(RegExp.$1);if(text.match(/(\d+)/i))var id=parseInt(RegExp.$1);else var id=Yanfly.StateIdRef[text.toUpperCase()];
obj.modifyTurnStateEval[id]=evalLine;evalMode="none";evalLine=""}else if(evalMode==="custom state")evalLine=`${evalLine+line}\n`}}};DataManager.processBSCNotetags4=(group)=>{for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.showStateTurns=Yanfly.Param.BSCShowEnemyTurns;for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(?:SHOW STATE TURNS)>/i))obj.showStateTurns=true;else if(line.match(/<(?:HIDE STATE TURNS)>/i))obj.showStateTurns=false}}};
Yanfly.BSC.BattleManager_startAction=BattleManager.startAction;BattleManager.startAction=function(){if(this._subject)this._subject.onActionStartStateEffects();Yanfly.BSC.BattleManager_startAction.call(this)};Yanfly.BSC.BattleManager_endAction=BattleManager.endAction;BattleManager.endAction=function(){if(this._subject)this._subject.onActionEndStateEffects();Yanfly.BSC.BattleManager_endAction.call(this)};Yanfly.BSC.BattleManager_endBattle=BattleManager.endBattle;BattleManager.endBattle=function(result){if(result===
0)$gameParty.processStateEval("victory");else if(result===1)$gameParty.processStateEval("escape");else if(result===2)$gameParty.processStateEval("defeat");Yanfly.BSC.BattleManager_endBattle.call(this,result)};Yanfly.BSC.Game_BattlerBase_initMembers=Game_BattlerBase.prototype.initMembers;Game_BattlerBase.prototype.initMembers=function(){Yanfly.BSC.Game_BattlerBase_initMembers.call(this);this.initStateCounter()};Yanfly.BSC.Game_BattlerBase_refresh=Game_BattlerBase.prototype.refresh;Game_BattlerBase.prototype.refresh=
function(){this._cacheParamBuffRate={};Yanfly.BSC.Game_BattlerBase_refresh.call(this)};Game_BattlerBase.prototype.stateOrigin=function(stateId){if(this._stateOrigin===undefined)this._stateOrigin={};if(!this._stateOrigin[stateId])return this;var arr=this._stateOrigin[stateId];if(arr[0]===0)return $gameActors.actor(arr[1]);if(arr[0]===1)return $gameTroop.members()[arr[1]];return this};Game_BattlerBase.prototype.setStateOrigin=function(stateId,battler){if(this._stateOrigin===undefined)this._stateOrigin=
{};if(!$gameParty.inBattle())return;if(!battler){var battler=BattleManager._subject;if(!battler)return}if(battler.isActor())var arr=[0,battler._actorId];else var arr=[1,battler.index()];this._stateOrigin[stateId]=arr};Game_BattlerBase.prototype.clearStateOrigin=function(stateId){if(this._stateOrigin===undefined)this._stateOrigin={};this._stateOrigin[stateId]=undefined};Game_BattlerBase.prototype.clearEnemyStateOrigins=function(){var length=$dataStates.length;for(let i=0;i<length;++i){if(this._stateOrigin===
undefined)this._stateOrigin={};if(this._stateOrigin[i]===undefined)continue;var data=this._stateOrigin[i];if(data[0]===1)this.clearStateOrigin(i)}};Game_BattlerBase.prototype.stateTurns=function(stateId){return this._stateTurns[stateId]};Game_BattlerBase.prototype.setStateTurns=function(stateId,turns){if(Imported.YEP_BattleEngineCore&&!Yanfly.Param.BECTimeStates)turns=Math.floor(turns);this._stateTurns[stateId]=turns};Game_BattlerBase.prototype.buffTurns=function(paramId){return this._buffTurns[paramId]};
Game_BattlerBase.prototype.setBuffTurns=function(paramId,turns){if(Imported.YEP_BattleEngineCore&&!Yanfly.Param.BECTimeBuffs)turns=Math.floor(turns);this._buffTurns[paramId]=turns};Game_BattlerBase.prototype.paramBuffRate=function(paramId){if(this._cacheParamBuffRate===undefined)this._cacheParamBuffRate={};if(this._cacheParamBuffRate[paramId]!==undefined)return this._cacheParamBuffRate[paramId];var code=Yanfly.Param.BSCBuffFormula;try{var rate=eval(code)}catch(e){var rate=1;Yanfly.Util.displayError(e,
code,"PARAM BUFF RATE FORMULA ERROR")}this._cacheParamBuffRate[paramId]=rate;return this._cacheParamBuffRate[paramId]};Game_BattlerBase.prototype.isMaxBuffAffected=function(paramId){var limit=Math.max(1,this.maxBuffLimit(paramId));var max=Yanfly.Param.BSCMaximumLimit;return this._buffs[paramId]===Math.min(limit,max)};Game_BattlerBase.prototype.maxBuffLimit=function(paramId){var value=Yanfly.Param.BSCDefaultLimit;var states=this.states();var length=states.length;for(let i=0;i<length;++i){var state=
states[i];if(!state)continue;if(state.maxBuff)value+=state.maxBuff[paramId]}return value};Game_BattlerBase.prototype.isMaxDebuffAffected=function(paramId){var limit=Math.min(-1,this.maxDebuffLimit(paramId));var max=Yanfly.Param.BSCMaximumLimit*-1;return this._buffs[paramId]===Math.max(limit,max)};Game_BattlerBase.prototype.maxDebuffLimit=function(paramId){var value=-1*Yanfly.Param.BSCDefaultLimit;var states=this.states();var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(!state)continue;
if(state.maxDebuff)value-=state.maxDebuff[paramId]}return value};Game_BattlerBase.prototype.buffIconIndex=(buffLevel,paramId)=>{if(buffLevel>0){var level=Math.min(buffLevel-1,1);return Game_BattlerBase.ICON_BUFF_START+level*8+paramId}else if(buffLevel<0){var level=Math.min(-buffLevel-1,1);return Game_BattlerBase.ICON_DEBUFF_START+level*8+paramId}else return 0};Yanfly.BSC.Game_BattlerBase_resetStateCounts=Game_BattlerBase.prototype.resetStateCounts;Game_BattlerBase.prototype.resetStateCounts=function(stateId){var state=
$dataStates[stateId];if(state.reapplyRules===1)Yanfly.BSC.Game_BattlerBase_resetStateCounts.call(this,stateId);else if(state.reapplyRules===2){this._stateTurns[stateId]=this._stateTurns[stateId]||0;var variance=1+Math.max(state.maxTurns-state.minTurns,0);this._stateTurns[stateId]+=state.minTurns+Math.randomInt(variance)}else if(state.reapplyRules===0&&state.minTurns)if(this._stateTurns[stateId]===undefined)Yanfly.BSC.Game_BattlerBase_resetStateCounts.call(this,stateId)};Game_BattlerBase.prototype.initStateCounter=
function(){this._stateCounter={}};Game_BattlerBase.prototype.clearStateCounters=function(){this._stateCounter={}};Game_BattlerBase.prototype.setStateCounter=function(stateId,value){if(this._stateCounter===undefined)this.initStateCounter();this._stateCounter[stateId]=value;this.refresh()};Game_BattlerBase.prototype.addStateCounter=function(stateId,value){if(this._stateCounter===undefined)this.initStateCounter();this.setStateCounter(stateId,value+(this.getStateCounter(stateId)||0))};Game_BattlerBase.prototype.clampStateCounter=
function(stateId,min,max){var value=this.getStateCounter(stateId).clamp(min,max);this.setStateCounter(stateId,value)};Game_BattlerBase.prototype.removeStateCounter=function(stateId){if(this._stateCounter===undefined)this.initStateCounter();this._stateCounter[stateId]=undefined};Game_BattlerBase.prototype.getStateCounter=function(stateId){if(this._stateCounter===undefined)this.initStateCounter();return this._stateCounter[stateId]};Game_BattlerBase.prototype.statesAndBuffs=function(){var group=this.states();
var length=group.length;var array=[];for(let i=0;i<length;++i){var state=group[i];if(state&&state.iconIndex>0)array.push(state)}for(let i=0;i<8;++i)if(this._buffs[i])array.push(i);return array};Game_Battler.prototype.hasState=function(stateId){return this.states().contains($dataStates[stateId])};Game_Battler.prototype.customEffectEval=function(stateId,type){var state=$dataStates[stateId];if(!state)return;if(state.customEffectEval[type]==="")return;var a=this;var user=this;var target=this;var origin=
this.stateOrigin(stateId);var s=$gameSwitches._data;var v=$gameVariables._data;var code=state.customEffectEval[type];try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,`CUSTOM STATE ${stateId} CODE ERROR`)}};Yanfly.BSC.Game_Battler_addState=Game_Battler.prototype.addState;Game_Battler.prototype.addState=function(stateId){var addable=this.isStateAddable(stateId);Yanfly.BSC.Game_Battler_addState.call(this,stateId);if(addable){this.setStateOrigin(stateId);this.addStateEffects(stateId)}};Game_Battler.prototype.addStateEffects=
function(stateId){this.customEffectEval(stateId,"addState")};Yanfly.BSC.Game_Battler_removeState=Game_Battler.prototype.removeState;Game_Battler.prototype.removeState=function(stateId){var affected=this.isStateAffected(stateId);Yanfly.BSC.Game_Battler_removeState.call(this,stateId);this.removeStateCounter(stateId);if(affected){this.removeStateEffects(stateId);this.clearStateOrigin(stateId)}};Game_Battler.prototype.removeStateEffects=function(stateId){this.customEffectEval(stateId,"removeState");if($gameTemp._customLeaveEffectEval)this.leaveStateEffects(stateId)};
Yanfly.BSC.Game_Battler_removeStatesAuto=Game_Battler.prototype.removeStatesAuto;Game_Battler.prototype.removeStatesAuto=function(timing){$gameTemp._customLeaveEffectEval=true;Yanfly.BSC.Game_Battler_removeStatesAuto.call(this,timing);$gameTemp._customLeaveEffectEval=undefined};Game_Battler.prototype.leaveStateEffects=function(stateId){this.customEffectEval(stateId,"leaveState")};Game_Battler.prototype.onTurnStartStateEffects=function(){var states=this.states();var length=states.length;for(let i=
0;i<length;++i){var state=states[i];if(state)this.turnStartStateEffects(state.id)}};Game_Battler.prototype.turnStartStateEffects=function(stateId){this.customEffectEval(stateId,"turnStartState")};Game_Battler.prototype.onTurnEndStateEffects=function(){var states=this.states();var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(state)this.turnEndStateEffects(state.id)}};Game_Battler.prototype.turnEndStateEffects=function(stateId){this.customEffectEval(stateId,"turnEndState")};
Yanfly.BSC.Game_Battler_onTurnEnd=Game_Battler.prototype.onTurnEnd;Game_Battler.prototype.onTurnEnd=function(){Yanfly.BSC.Game_Battler_onTurnEnd.call(this);if(this.meetTurnEndStateEffectsConditions())this.onTurnEndStateEffects()};Game_Battler.prototype.meetTurnEndStateEffectsConditions=()=>{if(!$gameParty.inBattle())return false;if(Imported.YEP_BattleEngineCore)if(BattleManager.isTurnBased())return true;else if(BattleManager.isTickBased()&&!BattleManager.isTurnEnd())return true;else return false;
return true};Game_Battler.prototype.onRegenerateStateEffects=function(){var states=this.states();var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(state)this.regenerateStateEffects(state.id)}};Game_Battler.prototype.regenerateStateEffects=function(stateId){if($gameParty.inBattle())this.clearResult();var lifeState=this.isAlive();this.customEffectEval(stateId,"regenerateState");if($gameParty.inBattle()&&this.isDead()&&lifeState===true)this.performCollapse();if(!Imported.YEP_BattleEngineCore)return;
if($gameParty.inBattle())this.startDamagePopup()};Yanfly.BSC.Game_Battler_regenerateAll=Game_Battler.prototype.regenerateAll;Game_Battler.prototype.regenerateAll=function(){if($gameParty.inBattle())this.onRegenerateStateEffects();Yanfly.BSC.Game_Battler_regenerateAll.call(this)};if(Imported.YEP_BattleEngineCore){Yanfly.BSC.Game_BattlerBase_updateStateTicks=Game_BattlerBase.prototype.updateStateTicks;Game_BattlerBase.prototype.updateStateTicks=function(){$gameTemp._customLeaveEffectEval=true;Yanfly.BSC.Game_BattlerBase_updateStateTicks.call(this);
$gameTemp._customLeaveEffectEval=undefined};Yanfly.BSC.Game_BattlerBase_updateStateTurnTiming=Game_BattlerBase.prototype.updateStateTurnTiming;Game_BattlerBase.prototype.updateStateTurnTiming=function(timing){$gameTemp._customLeaveEffectEval=true;Yanfly.BSC.Game_BattlerBase_updateStateTurnTiming.call(this,timing);$gameTemp._customLeaveEffectEval=undefined};Yanfly.BSC.Game_Battler_onTurnStart=Game_Battler.prototype.onTurnStart;Game_Battler.prototype.onTurnStart=function(){Yanfly.BSC.Game_Battler_onTurnStart.call(this);
if(this.meetTurnStartStateEffectsConditions())this.onTurnStartStateEffects()};Game_Battler.prototype.meetTurnStartStateEffectsConditions=()=>true}Game_Battler.prototype.onActionStartStateEffects=function(){var states=this.states();var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(state)this.actionStartStateEffects(state.id)}};Game_Battler.prototype.actionStartStateEffects=function(stateId){this.customEffectEval(stateId,"actionStartState")};Game_Battler.prototype.onActionEndStateEffects=
function(){var states=this.states();var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(state)this.actionEndStateEffects(state.id)}};Game_Battler.prototype.actionEndStateEffects=function(stateId){this.customEffectEval(stateId,"actionEndState")};Yanfly.BSC.Game_Battler_onBattleEnd=Game_Battler.prototype.onBattleEnd;Game_Battler.prototype.onBattleEnd=function(){Yanfly.BSC.Game_Battler_onBattleEnd.call(this);this.clearEnemyStateOrigins()};Game_Actor.prototype.maxBuffLimit=function(paramId){var value=
Game_Battler.prototype.maxBuffLimit.call(this,paramId);value+=this.actor().maxBuff[paramId];value+=this.currentClass().maxBuff[paramId];var length=this.equips().length;for(let i=0;i<length;++i){var equip=this.equips()[i];if(!equip)continue;if(equip.maxBuff)value+=equip.maxBuff[paramId]}return value};Game_Actor.prototype.maxDebuffLimit=function(paramId){var value=Game_Battler.prototype.maxDebuffLimit.call(this,paramId);value-=this.actor().maxDebuff[paramId];value-=this.currentClass().maxDebuff[paramId];
var length=this.equips().length;for(let i=0;i<length;++i){var equip=this.equips()[i];if(!equip)continue;if(equip.maxDebuff)value-=equip.maxDebuff[paramId]}return value};Game_Enemy.prototype.maxBuffLimit=function(paramId){var value=Game_Battler.prototype.maxBuffLimit.call(this,paramId);value+=this.enemy().maxBuff[paramId];return value};Game_Enemy.prototype.maxDebuffLimit=function(paramId){var value=Game_Battler.prototype.maxDebuffLimit.call(this,paramId);value-=this.enemy().maxDebuff[paramId];return value};
Game_Unit.prototype.processStateEval=function(type){var length1=this.allMembers().length;for(let i=0;i<length1;++i){var member=this.allMembers()[i];if(!member)return;member.refresh();var states=member.states();var length2=states.length;for(let j=0;j<length2;++j){var state=states[j];if(state)member.customEffectEval(state.id,type)}}};Yanfly.BSC.Game_Unit_onBattleStart=Game_Unit.prototype.onBattleStart;Game_Unit.prototype.onBattleStart=function(){Yanfly.BSC.Game_Unit_onBattleStart.call(this);this.processStateEval("battle")};
Game_Troop.prototype.allMembers=function(){return this.members()};Yanfly.BSC.Game_Action_applyItemUserEffect=Game_Action.prototype.applyItemUserEffect;Game_Action.prototype.applyItemUserEffect=function(target){Yanfly.BSC.Game_Action_applyItemUserEffect.call(this,target);if(!target)return;this.applyModifyBuffTurns(target);this.applyModifyDebuffTurns(target);this.applyModifyStateTurns(target)};Game_Action.prototype.applyModifyBuffTurns=function(target){if(!this.item())return;var affected=false;for(let i=
0;i<8;++i){if(!target.isBuffAffected(i))continue;var turn=this.item().modifyTurnBuff[i]+target.buffTurns(i);turn=this.applyBuffTurnsEval(turn,i,target);target.setBuffTurns(i,turn);if(target.buffTurns(i)<=0)target.eraseBuff(i);affected=true}if(affected)target.refresh()};Game_Action.prototype.applyBuffTurnsEval=function(turn,paramId,target){if(this.item().modifyTurnBuffEval[paramId]==="")return turn;var item=this.item();var a=this.subject();var b=target;var user=this.subject();var s=$gameSwitches._data;
var v=$gameVariables._data;var code=this.item().modifyTurnBuffEval[paramId];try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"CUSTOM BUFF TURN SET ERROR")}return turn};Game_Action.prototype.applyModifyDebuffTurns=function(target){if(!this.item())return;var affected=false;for(let i=0;i<8;++i){if(!target.isDebuffAffected(i))continue;var turn=this.item().modifyTurnDebuff[i]+target.buffTurns(i);turn=this.applyDebuffTurnsEval(turn,i,target);target.setBuffTurns(i,turn);if(target.buffTurns(i)<=0)target.eraseBuff(i);
affected=true}if(affected)target.refresh()};Game_Action.prototype.applyDebuffTurnsEval=function(turn,paramId,target){if(this.item().modifyTurnBuffEval[paramId]==="")return turn;var item=this.item();var a=this.subject();var b=target;var user=this.subject();var s=$gameSwitches._data;var v=$gameVariables._data;var code=this.item().modifyTurnBuffEval[paramId];try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"CUSTOM DEBUFF TURN SET ERROR")}return turn};Game_Action.prototype.applyModifyStateTurns=
function(target){if(!this.item())return;var affected=false;var states=target.states();var length=states.length;var removed=[];for(let i=0;i<length;++i){var state=states[i];if(state.autoRemovalTiming<=0)continue;if(!target.isStateAffected(state.id))continue;var turn=target.stateTurns(state.id);if(this.item().modifyTurnState[state.id])turn+=this.item().modifyTurnState[state.id];turn=this.applyStateTurnsEval(turn,state.id,target);target.setStateTurns(state.id,turn);if(target.stateTurns(state.id)<=0)removed.push(state.id)}for(let i=
0;i<removed.length;++i){target.removeState(removed[i]);affected=true}if(affected)target.refresh()};Game_Action.prototype.applyStateTurnsEval=function(turn,stateId,target){if(this.item().modifyTurnStateEval[stateId]===undefined)return turn;var item=this.item();var a=this.subject();var b=target;var user=this.subject();var origin=target.stateOrigin(stateId);var s=$gameSwitches._data;var v=$gameVariables._data;var code=this.item().modifyTurnStateEval[stateId];try{eval(code)}catch(e){Yanfly.Util.displayError(e,
code,"CUSTOM STATE TURN SET ERROR")}return turn};Yanfly.BSC.Game_Action_apply=Game_Action.prototype.apply;Game_Action.prototype.apply=function(target){this.onApplyStateEffects(target);this.onSelectStateEffects(target);Yanfly.BSC.Game_Action_apply.call(this,target);this.onDeselectStateEffects(target);this.offApplyStateEffects(target)};Game_Action.prototype.customEffectEval=function(target,stateId,type,side,value){var state=$dataStates[stateId];if(!state)return value;if(state.customEffectEval[type]===
"")return value;var attacker=this.subject();var defender=target;var a=this.subject();var b=target;var user=this.subject();var origin=side.stateOrigin(stateId);var s=$gameSwitches._data;var v=$gameVariables._data;var code=state.customEffectEval[type];try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,`CUSTOM STATE ${stateId} CODE ERROR`)}return value};Game_Action.prototype.onApplyStateEffects=function(target){var states=this.subject().states();var length=this.subject().states().length;for(let i=
0;i<length;++i){var state=states[i];if(!state)continue;this.initiateStateEffects(target,state.id)}};Game_Action.prototype.initiateStateEffects=function(target,stateId){this.customEffectEval(target,stateId,"initiateState",this.subject())};Game_Action.prototype.onSelectStateEffects=function(target){var states=target.states();var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(!state)continue;this.selectStateEffects(target,state.id)}};Game_Action.prototype.selectStateEffects=function(target,
stateId){this.customEffectEval(target,stateId,"selectState",target)};Game_Action.prototype.onDeselectStateEffects=function(target){var states=target.states();var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(!state)continue;this.deselectStateEffects(target,state.id)}};Game_Action.prototype.deselectStateEffects=function(target,stateId){this.customEffectEval(target,stateId,"deselectState",target)};Game_Action.prototype.offApplyStateEffects=function(target){var states=this.subject().states();
var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(!state)continue;this.concludeStateEffects(target,state.id)}};Game_Action.prototype.concludeStateEffects=function(target,stateId){this.customEffectEval(target,stateId,"concludeState",this.subject())};Yanfly.BSC.Game_Action_executeDamage=Game_Action.prototype.executeDamage;Game_Action.prototype.executeDamage=function(target,value){value=this.onPreDamageStateEffects(target,value);value=this.onReactStateEffects(target,value);Yanfly.BSC.Game_Action_executeDamage.call(this,
target,value);value=this.onRespondStateEffects(target,value);value=this.onPostDamageStateEffects(target,value)};Game_Action.prototype.onPreDamageStateEffects=function(target,value){var states=this.subject().states();var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(!state)continue;value=this.confirmStateEffects(target,state.id,value)}return value};Game_Action.prototype.confirmStateEffects=function(target,stateId,value){return this.customEffectEval(target,stateId,"confirmState",
this.subject(),value)};Game_Action.prototype.onReactStateEffects=function(target,value){var states=target.states();var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(!state)continue;value=this.reactStateEffects(target,state.id,value)}return value};Game_Action.prototype.reactStateEffects=function(target,stateId,value){return this.customEffectEval(target,stateId,"reactState",target,value)};Game_Action.prototype.onRespondStateEffects=function(target,value){var states=target.states();
var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(!state)continue;value=this.respondStateEffects(target,state.id,value)}return value};Game_Action.prototype.respondStateEffects=function(target,stateId,value){return this.customEffectEval(target,stateId,"respondState",target,value)};Game_Action.prototype.onPostDamageStateEffects=function(target,value){var states=this.subject().states();var length=states.length;for(let i=0;i<length;++i){var state=states[i];if(!state)continue;value=
this.establishStateEffects(target,state.id,value)}return value};Game_Action.prototype.establishStateEffects=function(target,stateId,value){return this.customEffectEval(target,stateId,"establishState",this.subject(),value)};if(!Yanfly.Param.BSCShowEnemyIcon)Sprite_StateIcon.prototype.updateFrame=()=>{};else{Yanfly.BSC.Sprite_StateIcon_initMembers=Sprite_StateIcon.prototype.initMembers;Sprite_StateIcon.prototype.initMembers=function(){Yanfly.BSC.Sprite_StateIcon_initMembers.call(this);this._turnCounterSprite=
new Sprite;this.addChild(this._turnCounterSprite);this._turnCounterSprite.anchor.x=.5;this._turnCounterSprite.anchor.y=.5;var w=Window_Base._iconWidth;var h=Window_Base._iconHeight;this._turnCounterSprite.bitmap=new Bitmap(w,h)};Yanfly.BSC.Sprite_StateIcon_updateFrame=Sprite_StateIcon.prototype.updateFrame;Sprite_StateIcon.prototype.updateFrame=function(){Yanfly.BSC.Sprite_StateIcon_updateFrame.call(this);if(this._turnCounterSprite)this.updateTurnAndCounter()};Sprite_StateIcon.prototype.updateTurnAndCounter=
function(){this._turnCounterSprite.bitmap.clear();if(!this._battler)return;var group=this._battler.statesAndBuffs();if(group.length<=0)return;var state=group[this._animationIndex];if(typeof state==="number"){if(Yanfly.Param.BSCEnemyBTurn){this.drawBuffTurns(state);if(Yanfly.Param.BSCShowBuffRate)this.drawBuffRate(state)}}else{if(Yanfly.Param.BSCEnemyTurn)this.drawStateTurns(state);if(Yanfly.Param.BSCEnemyCounter)this.drawStateCounter(state)}};Sprite_StateIcon.prototype.textColor=(n)=>SceneManager._scene._statusWindow.textColor(n);
Sprite_StateIcon.prototype.drawStateTurns=function(state){if(!state)return;if(!state.showTurns)return;if(state.autoRemovalTiming<=0)return;var turns=this._battler.stateTurns(state.id);if(turns!==0&&!turns)return;var turns=Yanfly.Util.toGroup(Math.ceil(turns));var wx=state.turnBufferX;var wy=state.turnBufferY-2;var ww=Window_Base._iconWidth;var wh=Window_Base.prototype.lineHeight.call(this);var contents=this._turnCounterSprite.bitmap;contents.fontSize=state.turnFontSize;contents.textColor=this.textColor(state.turnColor);
contents.drawText(turns,wx,wy,ww,wh,state.turnAlign)};Sprite_StateIcon.prototype.drawStateCounter=function(state){var value=this._battler.getStateCounter(state.id);if(value===undefined)return;var settings=state.stateCounterSettings;value=Yanfly.Util.toGroup(value);var wx=settings.bufferX;var wy=settings.bufferY-2;var ww=Window_Base._iconWidth;var wh=Window_Base.prototype.lineHeight.call(this);var contents=this._turnCounterSprite.bitmap;contents.fontSize=settings.size;contents.textColor=this.textColor(settings.color);
contents.drawText(value,wx,wy,ww,wh,settings.align)};Sprite_StateIcon.prototype.drawBuffTurns=function(paramId){if(!Yanfly.Param.BSCShowTurns)return;var turns=this._battler.buffTurns(paramId);turns=Yanfly.Util.toGroup(Math.ceil(turns));var wx=Yanfly.Param.BSCTurnBufferX;var wy=Yanfly.Param.BSCTurnBufferY-2;var ww=Window_Base._iconWidth;var wh=Window_Base.prototype.lineHeight.call(this);var contents=this._turnCounterSprite.bitmap;contents.fontSize=Yanfly.Param.BSCFontSize;if(this._battler.isBuffAffected(paramId))contents.textColor=
this.textColor(Yanfly.Param.BSCBuffColor);else contents.textColor=this.textColor(Yanfly.Param.BSCDebuffColor);contents.drawText(turns,wx,wy,ww,wh,Yanfly.Param.BSCTurnAlign)};Sprite_StateIcon.prototype.drawBuffRate=function(paramId){if(!Yanfly.Param.BSCShowTurns)return;var value=this._battler.paramBuffRate(paramId);var text=`${Math.floor(value*100)}%`;var wx=Yanfly.Param.BSCCounterBufferX||0;var wy=(Yanfly.Param.BSCCounterBufferY||8)-2;var ww=Window_Base._iconWidth;var wh=Window_Base.prototype.lineHeight.call(this);
var contents=this._turnCounterSprite.bitmap;contents.fontSize=Yanfly.Param.BSCFontSize*.75;contents.textColor=this.textColor(0);contents.drawText(text,wx,wy,ww,wh,"center")}}Yanfly.BSC.Window_Base_drawActorIcons=Window_Base.prototype.drawActorIcons;Window_Base.prototype.drawActorIcons=function(actor,wx,wy,ww=144){Yanfly.BSC.Window_Base_drawActorIcons.call(this,actor,wx,wy,ww);this.drawActorIconsTurns(actor,wx,wy,ww)};Window_Base.prototype.drawActorIconsTurns=function(actor,wx,wy,ww){var iw=Window_Base._iconWidth;
var icons=actor.allIcons().slice(0,Math.floor(ww/iw));var max=icons.length;var shownMax=Math.floor(ww/iw);for(let i=0;i<actor.states().length;++i){if(shownMax<=0)break;var state=actor.states()[i];if(state.iconIndex<=0)continue;if(state.autoRemovalTiming>0)this.drawStateTurns(actor,state,wx,wy);this.drawStateCounter(actor,state,wx,wy);wx+=iw;--shownMax}for(let i=0;i<8;++i){if(shownMax<=0)break;if(actor._buffs[i]===0)continue;this.drawBuffTurns(actor,i,wx,wy);if(Yanfly.Param.BSCShowBuffRate)this.drawBuffRate(actor,
i,wx,wy);wx+=iw;--shownMax}this.resetFontSettings();this.resetTextColor()};Window_Base.prototype.drawStateTurns=function(actor,state,wx,wy){if(!state.showTurns)return;var turns=actor.stateTurns(state.id);if(turns!==0&&!turns)return;var turns=Yanfly.Util.toGroup(Math.ceil(turns));wx+=state.turnBufferX;wy+=state.turnBufferY;this.changePaintOpacity(true);this.changeTextColor(this.textColor(state.turnColor));this.contents.fontSize=state.turnFontSize;this.drawText(turns,wx,wy,Window_Base._iconWidth,state.turnAlign);
this.resetFontSettings();this.resetTextColor()};Window_Base.prototype.drawStateCounter=function(actor,state,wx,wy){var value=actor.getStateCounter(state.id);if(value===undefined)return;var settings=state.stateCounterSettings;value=Yanfly.Util.toGroup(value);wx+=settings.bufferX;wy+=settings.bufferY;this.changePaintOpacity(true);this.changeTextColor(this.textColor(settings.color));this.contents.fontSize=settings.size;this.drawText(value,wx,wy,Window_Base._iconWidth,settings.align);this.resetFontSettings();
this.resetTextColor()};Window_Base.prototype.drawBuffTurns=function(actor,paramId,wx,wy){if(!Yanfly.Param.BSCShowTurns)return;var turns=Yanfly.Util.toGroup(Math.ceil(actor.buffTurns(paramId)));wx+=Yanfly.Param.BSCTurnBufferX;wy+=Yanfly.Param.BSCTurnBufferY;this.changePaintOpacity(true);this.contents.fontSize=Yanfly.Param.BSCFontSize;if(actor.isBuffAffected(paramId))this.changeTextColor(this.textColor(Yanfly.Param.BSCBuffColor));else this.changeTextColor(this.textColor(Yanfly.Param.BSCDebuffColor));
var align=Yanfly.Param.BSCTurnAlign;this.drawText(turns,wx,wy,Window_Base._iconWidth,align);this.resetFontSettings();this.resetTextColor()};Window_Base.prototype.drawBuffRate=function(actor,paramId,wx,wy){var value=actor.paramBuffRate(paramId);if(value===undefined)return;value=`${Math.floor(value*100)}%`;this.contents.fontSize=(Yanfly.Param.BSCCounterSize||16)*.75;wx+=Yanfly.Param.BSCCounterBufferX||0;wy+=Yanfly.Param.BSCCounterBufferY||8;this.changePaintOpacity(true);this.drawText(value,wx,wy,Window_Base._iconWidth,
"center");this.resetFontSettings();this.resetTextColor()};if(Imported.YEP_BattleEngineCore){Yanfly.BSC.Window_Help_drawBattler=Window_Help.prototype.drawBattler;Window_Help.prototype.drawBattler=function(battler){this.resetFontSettings();var length=battler.allIcons().length;if(length<=0)Yanfly.BSC.Window_Help_drawBattler.call(this,battler);else this.drawBattlerWithIcons(battler)};Window_Help.prototype.drawBattlerWithIcons=function(battler){var icons=battler.allIcons();var text=battler.name();var wx=
0;var wy=0;this.drawText(text,wx,wy,this.contents.width,"center");wy+=this.lineHeight();var ww=icons.length*Window_Base._iconWidth;ww=Math.min(ww,this.contents.width);wx=(this.contents.width-ww)/2;this.drawActorIcons(battler,wx,wy,ww)}}Yanfly.Util=Yanfly.Util||{};if(!Yanfly.Util.toGroup)Yanfly.Util.toGroup=(inVal)=>inVal;Yanfly.Util.displayError=(e,code,message)=>{console.log(message);console.log(code||"NON-EXISTENT");console.error(e);if(Utils.RPGMAKER_VERSION&&Utils.RPGMAKER_VERSION>="1.6.0")return;
if(Utils.isNwjs()&&Utils.isOptionValid("test"))if(!require("nw.gui").Window.get().isDevToolsOpen())require("nw.gui").Window.get().showDevTools()}})();Imported.YEP_SkillCore=true;Yanfly.Skill=Yanfly.Skill||{};Yanfly.Skill.version=1.13;
(()=>{Yanfly.Parameters=PluginManager.parameters("YEP_SkillCore");Yanfly.Param=Yanfly.Param||{};Yanfly.Icon=Yanfly.Icon||{};Yanfly.Param.SCCCostPadding=Number(Yanfly.Parameters["Cost Padding"]);Yanfly.Param.SCCTextAlign=String(Yanfly.Parameters["Command Alignment"]);Yanfly.Param.SCCWindowCol=Number(Yanfly.Parameters["Window Columns"]);Yanfly.Param.SCCTpFormat=String(Yanfly.Parameters["TP Format"]);Yanfly.Param.SCCTpFontSize=Number(Yanfly.Parameters["TP Font Size"]);Yanfly.Param.SCCTpTextColor=Number(Yanfly.Parameters["TP Text Color"]);
Yanfly.Icon.Tp=Number(Yanfly.Parameters["TP Icon"]);Yanfly.Param.SCCMpFormat=String(Yanfly.Parameters["MP Format"]);Yanfly.Param.SCCMpFontSize=Number(Yanfly.Parameters["MP Font Size"]);Yanfly.Param.SCCMpTextColor=Number(Yanfly.Parameters["MP Text Color"]);Yanfly.Icon.Mp=Number(Yanfly.Parameters["MP Icon"]);Yanfly.Param.SCCHpFormat=String(Yanfly.Parameters["HP Format"]);Yanfly.Param.SCCHpFontSize=Number(Yanfly.Parameters["HP Font Size"]);Yanfly.Param.SCCHpTextColor=Number(Yanfly.Parameters["HP Text Color"]);
Yanfly.Icon.Hp=Number(Yanfly.Parameters["HP Icon"]);Yanfly.Skill.DataManager_isDatabaseLoaded=DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=function(){if(!Yanfly.Skill.DataManager_isDatabaseLoaded.call(this))return false;if(!Yanfly._loaded_YEP_SkillCore){this.processSkillNotetags($dataSkills);this.processObjectNotetags($dataSkills);this.processObjectNotetags($dataItems);this.processGSCNotetags1($dataClasses);this.processGSCNotetags1($dataEnemies);this.processGSCNotetags2($dataWeapons);
this.processGSCNotetags2($dataArmors);this.processGSCNotetags2($dataStates);Yanfly._loaded_YEP_SkillCore=true}return true};DataManager.processSkillNotetags=(group)=>{var note1=/<(?:MP COST):[ ](\d+)>/i;var note2=/<(?:MP COST):[ ](\d+)([%\uff05])>/i;var note3=/<(?:TP COST):[ ](\d+)>/i;var note4=/<(?:TP COST):[ ](\d+)([%\uff05])>/i;var note5=/<(?:HP COST):[ ](\d+)>/i;var note6=/<(?:HP COST):[ ](\d+)([%\uff05])>/i;var note7a=/<(?:HIDE IF LEARNED SKILL):[ ]*(\d+(?:\s*,\s*\d+)*)>/i;var note7b=/<(?:HIDE IF LEARNED SKILL):[ ](\d+)[ ](?:THROUGH|to)[ ](\d+)>/i;
var note8a=/<(?:HIDE IN BATTLE|hide during battle)>/i;var note8b=/<(?:HIDE IN FIELD|hide during field)>/i;var noteMpEval1=/<(?:MP COST EVAL|custom mp cost)>/i;var noteMpEval2=/<\/(?:MP COST EVAL|custom mp cost)>/i;var noteTpEval1=/<(?:TP COST EVAL|custom tp cost)>/i;var noteTpEval2=/<\/(?:TP COST EVAL|custom tp cost)>/i;var noteHpEval1=/<(?:HP COST EVAL|custom hp cost)>/i;var noteHpEval2=/<\/(?:HP COST EVAL|custom hp cost)>/i;var noteEvalReq1=/<(?:EVAL REQUIREMENT|custom requirement)>/i;var noteEvalReq2=
/<\/(?:EVAL REQUIREMENT|custom requirement)>/i;var noteEvalExe1=/<(?:EVAL EXECUTION|custom execution)>/i;var noteEvalExe2=/<\/(?:EVAL EXECUTION|custom execution)>/i;var noteCostEval1=/<(?:COST DISPLAY EVAL|display cost eval)>/i;var noteCostEval2=/<\/(?:COST DISPLAY EVAL|display cost eval)>/i;var noteCostText1=/<(?:CUSTOM COST DISPLAY|custom display cost)>/i;var noteCostText2=/<\/(?:CUSTOM COST DISPLAY|custom display cost)>/i;var noteShowEval1=/<(?:CUSTOM SHOW EVAL)>/i;var noteShowEval2=/<\/(?:CUSTOM SHOW EVAL)>/i;
for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.hpCost=0;obj.hpCostPer=0;obj.mpCostPer=0;obj.tpCostPer=0;obj.hideInBattle=false;obj.hideInField=false;obj.hideIfLearnedSkill=[];var evalMode="none";obj.hpCostEval="";obj.mpCostEval="";obj.tpCostEval="";obj.requireEval="";obj.executeEval="";obj.costdisplayEval="";obj.costShowEval="";obj.customCostText="";for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(note1))obj.mpCost=parseInt(RegExp.$1);
else if(line.match(note2))obj.mpCostPer=parseFloat(RegExp.$1*.01);else if(line.match(note3))obj.tpCost=parseInt(RegExp.$1);else if(line.match(note4))obj.tpCostPer=parseFloat(RegExp.$1*.01);else if(line.match(note5))obj.hpCost=parseInt(RegExp.$1);else if(line.match(note6))obj.hpCostPer=parseFloat(RegExp.$1*.01);else if(line.match(note7a)){var array=JSON.parse(`[${RegExp.$1.match(/\d+/g)}]`);obj.hideIfLearnedSkill=obj.hideIfLearnedSkill.concat(array)}else if(line.match(note7b)){var array=JSON.parse(`[${RegExp.$1.match(/\d+/g)}]`);
var range=Yanfly.Util.getRange(parseInt(RegExp.$1),parseInt(RegExp.$2));obj.hideIfLearnedSkill=obj.hideIfLearnedSkill.concat(range)}else if(line.match(note8a))obj.hideInBattle=true;else if(line.match(note8b))obj.hideInField=true;else if(line.match(noteMpEval1))evalMode="mp";else if(line.match(noteMpEval2))evalMode="none";else if(line.match(noteTpEval1))evalMode="tp";else if(line.match(noteTpEval2))evalMode="none";else if(line.match(noteHpEval1))evalMode="hp";else if(line.match(noteHpEval2))evalMode=
"none";else if(line.match(noteEvalReq1))evalMode="custom requirement";else if(line.match(noteEvalReq2))evalMode="none";else if(line.match(noteEvalExe1))evalMode="custom execute";else if(line.match(noteEvalExe2))evalMode="none";else if(line.match(noteCostEval1))evalMode="display cost eval";else if(line.match(noteCostEval2))evalMode="none";else if(line.match(noteCostText1))evalMode="custom display cost";else if(line.match(noteCostText2))evalMode="none";else if(line.match(noteShowEval1))evalMode="custom show eval";
else if(line.match(noteShowEval2))evalMode="none";else if(evalMode==="mp")obj.mpCostEval=`${obj.mpCostEval+line}\n`;else if(evalMode==="tp")obj.tpCostEval=`${obj.tpCostEval+line}\n`;else if(evalMode==="hp")obj.hpCostEval=`${obj.hpCostEval+line}\n`;else if(evalMode==="custom requirement")obj.requireEval=`${obj.requireEval+line}\n`;else if(evalMode==="custom execute")obj.executeEval=`${obj.executeEval+line}\n`;else if(evalMode==="display cost eval")obj.costdisplayEval=`${obj.costdisplayEval+line}\n`;
else if(evalMode==="custom display cost")obj.customCostText=obj.customCostText+line;else if(evalMode==="custom show eval")obj.costShowEval=`${obj.costShowEval+line}\n`}}};DataManager.processObjectNotetags=(group)=>{var note1=/<(?:BEFORE EVAL)>/i;var note2=/<\/(?:BEFORE EVAL)>/i;var note3=/<(?:PRE-DAMAGE EVAL)>/i;var note4=/<\/(?:PRE-DAMAGE EVAL)>/i;var note5=/<(?:POST-DAMAGE EVAL)>/i;var note6=/<\/(?:POST-DAMAGE EVAL)>/i;var note7=/<(?:AFTER EVAL)>/i;var note8=/<\/(?:AFTER EVAL)>/i;for(let n=1;n<
group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);var customMode="none";obj.customBeforeEval="";obj.customPreDamageEval="";obj.customPostDamageEval="";obj.customAfterEval="";for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(note1))customMode="before";else if(line.match(note2))customMode="none";else if(line.match(note3))customMode="pre-damage";else if(line.match(note4))customMode="none";else if(line.match(note5))customMode="post-damage";else if(line.match(note6))customMode=
"none";else if(line.match(note7))customMode="after";else if(line.match(note8))customMode="none";else if(customMode==="before")obj.customBeforeEval=`${obj.customBeforeEval+line}\n`;else if(customMode==="pre-damage")obj.customPreDamageEval=`${obj.customPreDamageEval+line}\n`;else if(customMode==="post-damage")obj.customPostDamageEval=`${obj.customPostDamageEval+line}\n`;else if(customMode==="after")obj.customAfterEval=`${obj.customAfterEval+line}\n`}}};DataManager.processGSCNotetags1=(group)=>{for(let n=
1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.gauge1="HP";obj.gauge2="MP";obj.gauge3="TP";obj.gaugeIcon1=0;obj.gaugeIcon2=0;obj.gaugeIcon3=0;for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(?:SWAP GAUGE|gauge)[ ](\d+):[ ](.*)>/i)){var gauge=parseInt(RegExp.$1);var text=String(RegExp.$2).toUpperCase();if(["HP","MP","TP","NOTHING","NULL"].contains(text)){if(gauge===1)obj.gauge1=text;if(gauge===2)obj.gauge2=text;if(gauge===3)obj.gauge3=text}}}}};
DataManager.processGSCNotetags2=(group)=>{for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.gauge1="UNDEFINED";obj.gauge2="UNDEFINED";obj.gauge3="UNDEFINED";obj.gaugeIcon1="UNDEFINED";obj.gaugeIcon2="UNDEFINED";obj.gaugeIcon3="UNDEFINED";for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(?:SWAP GAUGE|gauge)[ ](\d+):[ ](.*)>/i)){var gauge=parseInt(RegExp.$1);var text=String(RegExp.$2).toUpperCase();if(["HP","MP","TP","NOTHING","NULL"].contains(text)){if(gauge===
1)obj.gauge1=text;if(gauge===2)obj.gauge2=text;if(gauge===3)obj.gauge3=text}}}}};Yanfly.Skill.Game_BattlerBase_mSC=Game_BattlerBase.prototype.meetsSkillConditions;Game_BattlerBase.prototype.meetsSkillConditions=function(skill){if(!Yanfly.Skill.Game_BattlerBase_mSC.call(this,skill))return false;if(!skill)return false;if(!this.noHiddenSkillConditionsMet(skill))return false;return this.meetsSkillConditionsEval(skill)};Game_BattlerBase.prototype.noHiddenSkillConditionsMet=function(skill){if(!skill)return false;
if(this.isEnemy())return true;if(skill.hideIfLearnedSkill)for(let i=0;i<skill.hideIfLearnedSkill.length;++i){var skillId=skill.hideIfLearnedSkill[i];if(this.isLearnedSkill(skillId))return false}if(skill.hideInBattle&&$gameParty.inBattle())return false;if(skill.hideInField&&!$gameParty.inBattle())return false;if(!this.meetsCustomShowEval(skill))return false;return true};Game_BattlerBase.prototype.meetsCustomShowEval=function(skill){if(skill.costShowEval==="")return true;var visible=true;var item=skill;
var a=this;var user=this;var subject=this;var s=$gameSwitches._data;var v=$gameVariables._data;var code=skill.costShowEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"SKILL CUSTOM SHOW EVAL ERROR")}return visible};Game_BattlerBase.prototype.meetsSkillConditionsEval=function(skill){if(skill.requireEval==="")return true;var value=true;var item=skill;var a=this;var user=this;var subject=this;var s=$gameSwitches._data;var v=$gameVariables._data;var code=skill.requireEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,
code,"SKILL CUSTOM REQUIRE EVAL ERROR")}return value};Game_BattlerBase.prototype.skillHpCost=function(skill){var cost=skill.hpCost;var item=skill;var a=this;var user=this;var subject=this;var s=$gameSwitches._data;var v=$gameVariables._data;cost+=this.mhp*skill.hpCostPer;var code=skill.hpCostEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"SKILL CUSTOM HP COST ERROR")}return Math.max(0,Math.floor(cost))};Game_BattlerBase.prototype.skillMpCost=function(skill){var cost=skill.mpCost;var item=
skill;var a=this;var user=this;var subject=this;var s=$gameSwitches._data;var v=$gameVariables._data;cost+=this.mmp*skill.mpCostPer;var code=skill.mpCostEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"SKILL CUSTOM MP COST ERROR")}return Math.max(0,Math.floor(cost*this.mcr))};Game_BattlerBase.prototype.skillTpCost=function(skill){var cost=skill.tpCost;var item=skill;var a=this;var user=this;var subject=this;var s=$gameSwitches._data;var v=$gameVariables._data;cost+=this.maxTp()*skill.tpCostPer;
var code=skill.tpCostEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"SKILL CUSTOM TP COST ERROR")}return Math.max(0,Math.floor(cost))};Yanfly.Skill.Game_BattlerBase_canPaySkillCost=Game_BattlerBase.prototype.canPaySkillCost;Game_BattlerBase.prototype.canPaySkillCost=function(skill){if(!this.canPaySkillHpCost(skill))return false;return Yanfly.Skill.Game_BattlerBase_canPaySkillCost.call(this,skill)};Game_BattlerBase.prototype.canPaySkillHpCost=function(skill){var cost=this.skillHpCost(skill);
if(cost<=0)return true;return this._hp>cost};Yanfly.Skill.Game_BattlerBase_paySkillCost=Game_BattlerBase.prototype.paySkillCost;Game_BattlerBase.prototype.paySkillCost=function(skill){Yanfly.Skill.Game_BattlerBase_paySkillCost.call(this,skill);this.paySkillHpCost(skill);this.paySkillEvalCost(skill)};Game_BattlerBase.prototype.paySkillHpCost=function(skill){this._hp-=this.skillHpCost(skill)};Game_BattlerBase.prototype.paySkillEvalCost=function(skill){if(skill.executeEval==="")return;var item=skill;
var a=this;var user=this;var subject=this;var s=$gameSwitches._data;var v=$gameVariables._data;var code=skill.executeEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"SKILL PAY COST EVAL ERROR")}};Game_BattlerBase.prototype.gauge1=()=>"HP";Game_BattlerBase.prototype.gauge2=()=>"MP";Game_BattlerBase.prototype.gauge3=()=>"TP";Game_BattlerBase.prototype.gaugeIcon1=()=>0;Game_BattlerBase.prototype.gaugeIcon2=()=>0;Game_BattlerBase.prototype.gaugeIcon3=()=>0;Game_Actor.prototype.gauge1=function(){for(let i=
0;i<this.equips().length;++i){var equip=this.equips()[i];if(!equip)continue;if(equip.gauge1==="UNDEFINED")continue;return equip.gauge1}for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.gauge1==="UNDEFINED")continue;return state.gauge1}return this.currentClass().gauge1};Game_Actor.prototype.gauge2=function(){for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(!equip)continue;if(equip.gauge2==="UNDEFINED")continue;return equip.gauge2}for(let i=
0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.gauge2==="UNDEFINED")continue;return state.gauge2}return this.currentClass().gauge2};Game_Actor.prototype.gauge3=function(){for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(!equip)continue;if(equip.gauge3==="UNDEFINED")continue;return equip.gauge3}for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.gauge3==="UNDEFINED")continue;return state.gauge3}return this.currentClass().gauge3};
Game_Actor.prototype.gaugeIcon1=function(){for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(!equip)continue;if(equip.gaugeIcon1==="UNDEFINED")continue;return equip.gaugeIcon1}for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.gaugeIcon1==="UNDEFINED")continue;return state.gaugeIcon1}return this.currentClass().gaugeIcon1};Game_Actor.prototype.gaugeIcon2=function(){for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(!equip)continue;
if(equip.gaugeIcon2==="UNDEFINED")continue;return equip.gaugeIcon2}for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.gaugeIcon2==="UNDEFINED")continue;return state.gaugeIcon2}return this.currentClass().gaugeIcon2};Game_Actor.prototype.gaugeIcon3=function(){for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(!equip)continue;if(equip.gaugeIcon3==="UNDEFINED")continue;return equip.gaugeIcon3}for(let i=0;i<this.states().length;++i){var state=
this.states()[i];if(!state)continue;if(state.gaugeIcon3==="UNDEFINED")continue;return state.gaugeIcon3}return this.currentClass().gaugeIcon3};Game_Enemy.prototype.gauge1=function(){for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.gauge1==="UNDEFINED")continue;return state.gauge1}return this.enemy().gauge1};Game_Enemy.prototype.gauge2=function(){for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.gauge2==="UNDEFINED")continue;
return state.gauge2}return this.enemy().gauge2};Game_Enemy.prototype.gauge3=function(){for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.gauge1==="UNDEFINED")continue;return state.gauge1}return this.enemy().gauge3};Game_Enemy.prototype.gaugeIcon1=function(){for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.gaugeIcon1==="UNDEFINED")continue;return state.gaugeIcon1}return this.enemy().gaugeIcon1};Game_Enemy.prototype.gaugeIcon2=
function(){for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.gaugeIcon2==="UNDEFINED")continue;return state.gaugeIcon2}return this.enemy().gaugeIcon2};Game_Enemy.prototype.gaugeIcon3=function(){for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.gaugeIcon3==="UNDEFINED")continue;return state.gaugeIcon3}return this.enemy().gaugeIcon3};if(!Game_Enemy.prototype.skills)Game_Enemy.prototype.skills=function(){var skills=
[];for(let i=0;i<this.enemy().actions.length;++i){var skill=$dataSkills[this.enemy().actions[i].skillId];if(skill)skills.push(skill)}return skills};Yanfly.Skill.Game_Action_apply=Game_Action.prototype.apply;Game_Action.prototype.apply=function(target){this.applyBeforeEffect(target);this.applyBeforeEval(target);Yanfly.Skill.Game_Action_apply.call(this,target);this.applyAfterEffect(target);this.applyAfterEval(target)};Game_Action.prototype.applyBeforeEffect=(target)=>{};Game_Action.prototype.applyBeforeEval=
function(target){var item=this.item();var a=this.subject();var b=target;var user=this.subject();var subject=this.subject();var s=$gameSwitches._data;var v=$gameVariables._data;var code=item.customBeforeEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"BEFORE EVAL ERROR")}};Game_Action.prototype.applyAfterEffect=(target)=>{};Game_Action.prototype.applyAfterEval=function(target){var item=this.item();var a=this.subject();var b=target;var user=this.subject();var subject=this.subject();var s=
$gameSwitches._data;var v=$gameVariables._data;var code=item.customAfterEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"AFTER EVAL ERROR")}};Yanfly.Skill.Game_Action_executeDamage=Game_Action.prototype.executeDamage;Game_Action.prototype.executeDamage=function(target,value){this.applyPreDamageEffect(target,value);value=this.applyPreDamageEval(target,value);Yanfly.Skill.Game_Action_executeDamage.call(this,target,value);this.applyPostDamageEffect(target,value);this.applyPostDamageEval(target,
value)};Game_Action.prototype.applyPreDamageEffect=(target,value)=>{};Game_Action.prototype.applyPreDamageEval=function(target,value){var item=this.item();var a=this.subject();var b=target;var user=this.subject();var subject=this.subject();var s=$gameSwitches._data;var v=$gameVariables._data;var code=item.customPreDamageEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"PRE-DAMAGE EVAL ERROR")}return value};Game_Action.prototype.applyPostDamageEffect=(target,value)=>{};Game_Action.prototype.applyPostDamageEval=
function(target,value){var item=this.item();var a=this.subject();var b=target;var user=this.subject();var subject=this.subject();var s=$gameSwitches._data;var v=$gameVariables._data;var code=item.customPostDamageEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"POST-DAMAGE EVAL ERROR")}};Yanfly.Skill.Window_Base_drawActorHp=Window_Base.prototype.drawActorHp;Window_Base.prototype.drawActorHp=function(actor,x,y,width){if(actor.gauge1()==="HP")Yanfly.Skill.Window_Base_drawActorHp.call(this,
actor,x,y,width);else if(actor.gauge1()==="MP")Yanfly.Skill.Window_Base_drawActorMp.call(this,actor,x,y,width);else if(actor.gauge1()==="TP")Yanfly.Skill.Window_Base_drawActorTp.call(this,actor,x,y,width)};Yanfly.Skill.Window_Base_drawActorMp=Window_Base.prototype.drawActorMp;Window_Base.prototype.drawActorMp=function(actor,x,y,width){if(actor.gauge2()==="HP")Yanfly.Skill.Window_Base_drawActorHp.call(this,actor,x,y,width);else if(actor.gauge2()==="MP")Yanfly.Skill.Window_Base_drawActorMp.call(this,
actor,x,y,width);else if(actor.gauge2()==="TP")Yanfly.Skill.Window_Base_drawActorTp.call(this,actor,x,y,width)};Yanfly.Skill.Window_Base_drawActorTp=Window_Base.prototype.drawActorTp;Window_Base.prototype.drawActorTp=function(actor,x,y,width){if(actor.gauge3()==="HP")Yanfly.Skill.Window_Base_drawActorHp.call(this,actor,x,y,width);else if(actor.gauge3()==="MP")Yanfly.Skill.Window_Base_drawActorMp.call(this,actor,x,y,width);else if(actor.gauge3()==="TP")Yanfly.Skill.Window_Base_drawActorTp.call(this,
actor,x,y,width)};Window_SkillType.prototype.itemTextAlign=()=>Yanfly.Param.SCCTextAlign;Window_SkillList.prototype.maxCols=()=>Yanfly.Param.SCCWindowCol;Yanfly.Skill.Window_SkillList_includes=Window_SkillList.prototype.includes;Window_SkillList.prototype.includes=function(item){if(this._actor)if(!this._actor.noHiddenSkillConditionsMet(item))return false;return Yanfly.Skill.Window_SkillList_includes.call(this,item)};Window_SkillList.prototype.drawSkillCost=function(skill,wx,wy,width){var dw=width;
dw=this.drawTpCost(skill,wx,wy,dw);dw=this.drawMpCost(skill,wx,wy,dw);dw=this.drawHpCost(skill,wx,wy,dw);dw=this.drawCustomDisplayCost(skill,wx,wy,dw);dw=this.drawOtherCost(skill,wx,wy,dw);return dw};Window_SkillList.prototype.drawTpCost=function(skill,wx,wy,dw){if(this._actor.skillTpCost(skill)<=0)return dw;if(Yanfly.Icon.Tp>0){var iw=wx+dw-Window_Base._iconWidth;this.drawIcon(Yanfly.Icon.Tp,iw,wy+2);dw-=Window_Base._iconWidth+2}this.changeTextColor(this.textColor(Yanfly.Param.SCCTpTextColor));var fmt=
Yanfly.Param.SCCTpFormat;var text=fmt.format(Yanfly.Util.toGroup(this._actor.skillTpCost(skill)),TextManager.tpA);this.contents.fontSize=Yanfly.Param.SCCTpFontSize;this.drawText(text,wx,wy,dw,"right");var returnWidth=dw-this.textWidth(text)-Yanfly.Param.SCCCostPadding;this.resetFontSettings();return returnWidth};Window_SkillList.prototype.drawMpCost=function(skill,wx,wy,dw){if(this._actor.skillMpCost(skill)<=0)return dw;if(Yanfly.Icon.Mp>0){var iw=wx+dw-Window_Base._iconWidth;this.drawIcon(Yanfly.Icon.Mp,
iw,wy+2);dw-=Window_Base._iconWidth+2}this.changeTextColor(this.textColor(Yanfly.Param.SCCMpTextColor));var fmt=Yanfly.Param.SCCMpFormat;var text=fmt.format(Yanfly.Util.toGroup(this._actor.skillMpCost(skill)),TextManager.mpA);this.contents.fontSize=Yanfly.Param.SCCMpFontSize;this.drawText(text,wx,wy,dw,"right");var returnWidth=dw-this.textWidth(text)-Yanfly.Param.SCCCostPadding;this.resetFontSettings();return returnWidth};Window_SkillList.prototype.drawHpCost=function(skill,wx,wy,dw){if(this._actor.skillHpCost(skill)<=
0)return dw;if(Yanfly.Icon.Hp>0){var iw=wx+dw-Window_Base._iconWidth;this.drawIcon(Yanfly.Icon.Hp,iw,wy+2);dw-=Window_Base._iconWidth+2}this.changeTextColor(this.textColor(Yanfly.Param.SCCHpTextColor));var fmt=Yanfly.Param.SCCHpFormat;var text=fmt.format(Yanfly.Util.toGroup(this._actor.skillHpCost(skill)),TextManager.hpA);this.contents.fontSize=Yanfly.Param.SCCHpFontSize;this.drawText(text,wx,wy,dw,"right");var returnWidth=dw-this.textWidth(text)-Yanfly.Param.SCCCostPadding;this.resetFontSettings();
return returnWidth};Window_SkillList.prototype.textWidthEx=function(text){return this.drawTextEx(text,0,this.contents.height)};Window_SkillList.prototype.drawCustomDisplayCost=function(skill,wx,wy,dw){this.runDisplayEvalCost(skill);if(skill.customCostText==="")return dw;var width=this.textWidthEx(skill.customCostText);this.resetFontSettings();this.drawTextEx(skill.customCostText,wx-width+dw,wy);var returnWidth=dw-width-Yanfly.Param.SCCCostPadding;this.resetFontSettings();return returnWidth};Window_SkillList.prototype.runDisplayEvalCost=
function(skill){if(skill.costdisplayEval==="")return;var item=skill;var a=this._actor;var user=this._actor;var subject=this._actor;var s=$gameSwitches._data;var v=$gameVariables._data;var code=skill.costdisplayEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"SKILL COST DISPLAY EVAL ERROR")}};Window_SkillList.prototype.drawOtherCost=(skill,wx,wy,dw)=>dw;Yanfly.Util=Yanfly.Util||{};if(!Yanfly.Util.toGroup)Yanfly.Util.toGroup=(inVal)=>inVal;Yanfly.Util.displayError=(e,code,message)=>{console.log(message);
console.log(code||"NON-EXISTENT");console.error(e);if(Utils.RPGMAKER_VERSION&&Utils.RPGMAKER_VERSION>="1.6.0")return;if(Utils.isNwjs()&&Utils.isOptionValid("test"))if(!require("nw.gui").Window.get().isDevToolsOpen())require("nw.gui").Window.get().showDevTools()}})();Imported.YEP_X_SkillCooldowns=true;Yanfly.SCD=Yanfly.SCD||{};Yanfly.SCD.version=1.12;
(()=>{Yanfly.Parameters=PluginManager.parameters("YEP_X_SkillCooldowns");Yanfly.Param=Yanfly.Param||{};Yanfly.Icon=Yanfly.Icon||{};Yanfly.Param.CDFmt=String(Yanfly.Parameters["Cooldown Format"]);Yanfly.Param.CDFontSize=Number(Yanfly.Parameters["Cooldown Font Size"]);Yanfly.Param.CDTextColor=Number(Yanfly.Parameters["Cooldown Text Color"]);Yanfly.Icon.Cooldown=Number(Yanfly.Parameters["Cooldown Icon"]);Yanfly.Param.CDAfterBattle=Number(Yanfly.Parameters["Cooldown After Battle"]);Yanfly.Param.CDSteps=
Number(Yanfly.Parameters["Cooldown Steps"]);Yanfly.Param.WUFmt=String(Yanfly.Parameters["Warmup Format"]);Yanfly.Param.WUFontSize=Number(Yanfly.Parameters["Warmup Font Size"]);Yanfly.Param.WUTextColor=Number(Yanfly.Parameters["Warmup Text Color"]);Yanfly.Param.CDTimeBased=String(Yanfly.Parameters["Time Based"]);Yanfly.Param.CDTurnTime=Number(Yanfly.Parameters["Turn Time"]);Yanfly.Icon.Warmup=Number(Yanfly.Parameters["Warmup Icon"]);Yanfly.SetupParameters=()=>{Yanfly.Param.CDBypass=String(Yanfly.Parameters["Cooldown Bypass"]);
Yanfly.Param.CDBypass=Yanfly.Param.CDBypass.split(" ");for(let i=0;i<Yanfly.Param.CDBypass.length;++i)Yanfly.Param.CDBypass[i]=parseInt(Yanfly.Param.CDBypass[i]);var data=JSON.parse(Yanfly.Parameters["Cooldown Bypass List"]||"[]");for(let i=0;i<data.length;++i){var id=parseInt(data[i]);if(id<=0)continue;if(Yanfly.Param.CDBypass.contains(id))continue;Yanfly.Param.CDBypass.push(id)}};Yanfly.SetupParameters();Yanfly.SCD.DataManager_isDatabaseLoaded=DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=
function(){if(!Yanfly.SCD.DataManager_isDatabaseLoaded.call(this))return false;if(!Yanfly._loaded_YEP_X_SkillCooldowns){this.processSCDNotetagsS($dataSkills);this.processSCDNotetags1($dataSkills);this.processSCDNotetags2($dataSkills);this.processSCDNotetags2($dataItems);this.processSCDNotetags2($dataActors);this.processSCDNotetags2($dataClasses);this.processSCDNotetags2($dataEnemies);this.processSCDNotetags2($dataWeapons);this.processSCDNotetags2($dataArmors);this.processSCDNotetags2($dataStates);
this.processSCDNotetags3($dataActors);this.processSCDNotetags3($dataClasses);this.processSCDNotetags3($dataEnemies);this.processSCDNotetags3($dataWeapons);this.processSCDNotetags3($dataArmors);this.processSCDNotetags3($dataStates);Yanfly._loaded_YEP_X_SkillCooldowns=true}return true};DataManager.processSCDNotetagsS=(group)=>{if(Yanfly.SkillIdRef)return;Yanfly.SkillIdRef={};for(let n=1;n<group.length;n++){var obj=group[n];if(obj.name.length<=0)continue;Yanfly.SkillIdRef[obj.name.toUpperCase()]=n}};
DataManager.processSCDNotetags1=(group)=>{for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.cooldown={};obj.stypeCooldown={};obj.globalCooldown=0;obj.afterBattleCooldown=Yanfly.Param.CDAfterBattle;obj.cooldownSteps=Math.max(1,parseInt(Yanfly.Param.CDSteps));obj.warmup=0;obj.bypassCooldown=Yanfly.Param.CDBypass.contains(obj.id);obj.cooldownEval="";obj.warmupEval="";var evalMode="none";for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(/<(?:COOLDOWN):[ ](\d+)>/i))obj.cooldown[obj.id]=
parseInt(RegExp.$1);else if(line.match(/<(?:AFTER BATTLE COOLDOWN):[ ]([\+\-]\d+)>/i))obj.afterBattleCooldown=parseInt(RegExp.$1);else if(line.match(/<(?:COOLDOWN STEPS):[ ](\d+)>/i))obj.cooldownSteps=parseInt(RegExp.$1);else if(line.match(/<(?:WARMUP):[ ](\d+)>/i))obj.warmup=parseInt(RegExp.$1);else if(line.match(/<(?:SKILL)[ ](\d+)[ ](?:COOLDOWN):[ ](\d+)>/i))obj.cooldown[parseInt(RegExp.$1)]=parseInt(RegExp.$2);else if(line.match(/<(?:SKILL)[ ](.*)[ ](?:COOLDOWN):[ ](\d+)>/i)){var name=String(RegExp.$1).toUpperCase();
if(Yanfly.SkillIdRef[name])var id=Yanfly.SkillIdRef[name];else continue;obj.cooldown[id]=parseInt(RegExp.$2)}else if(line.match(/<(?:STYPE)[ ](\d+)[ ](?:COOLDOWN):[ ](\d+)>/i))obj.stypeCooldown[parseInt(RegExp.$1)]=parseInt(RegExp.$2);else if(line.match(/<(?:GLOBAL COOLDOWN):[ ](\d+)>/i))obj.globalCooldown=parseInt(RegExp.$1);else if(line.match(/<(?:BYPASS COOLDOWN)>/i))obj.bypassCooldown=true;else if(line.match(/<(?:COOLDOWN EVAL)>/i)){obj.cooldown[obj.id]=obj.cooldown[obj.id]||0;evalMode="cooldown"}else if(line.match(/<\/(?:COOLDOWN EVAL)>/i))evalMode=
"none";else if(line.match(/<(?:WARMUP EVAL)>/i))evalMode="warmup";else if(line.match(/<\/(?:WARMUP EVAL)>/i))evalMode="none";else if(evalMode==="cooldown")obj.cooldownEval=`${obj.cooldownEval+line}\n`;else if(evalMode==="warmup")obj.warmupEval=`${obj.warmupEval+line}\n`}}};DataManager.processSCDNotetags2=(group)=>{var note1=/<(?:SKILL)[ ](\d+)[ ](?:COOLDOWN):[ ]([\+\-]\d+)>/i;var note1a=/<(?:SKILL)[ ](.*)[ ](?:COOLDOWN):[ ]([\+\-]\d+)>/i;var note2=/<(?:STYPE)[ ](\d+)[ ](?:COOLDOWN):[ ]([\+\-]\d+)>/i;
var note3=/<(?:GLOBAL COOLDOWN):[ ]([\+\-]\d+)>/i;var note4=/<(?:SKILL)[ ](\d+)[ ](?:WARMUP):[ ]([\+\-]\d+)>/i;var note4a=/<(?:SKILL)[ ](.*)[ ](?:WARMUP):[ ]([\+\-]\d+)>/i;var note5=/<(?:STYPE)[ ](\d+)[ ](?:WARMUP):[ ]([\+\-]\d+)>/i;var note6=/<(?:GLOBAL WARMUP):[ ]([\+\-]\d+)>/i;for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);obj.cooldownChange={};obj.stypeCooldownChange={};obj.globalCooldownChange=0;obj.warmupChange={};obj.stypeWarmupChange={};obj.globalWarmupChange=
0;for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(note1))obj.cooldownChange[parseInt(RegExp.$1)]=parseInt(RegExp.$2);else if(line.match(note1a)){var name=String(RegExp.$1).toUpperCase();if(Yanfly.SkillIdRef[name])var id=Yanfly.SkillIdRef[name];else continue;obj.cooldownChange[id]=parseInt(RegExp.$2)}else if(line.match(note2))obj.stypeCooldownChange[parseInt(RegExp.$1)]=parseInt(RegExp.$2);else if(line.match(note3))obj.globalCooldownChange=parseInt(RegExp.$1);else if(line.match(note4))obj.warmupChange[parseInt(RegExp.$1)]=
parseInt(RegExp.$2);else if(line.match(note4a)){var name=String(RegExp.$1).toUpperCase();if(Yanfly.SkillIdRef[name])var id=Yanfly.SkillIdRef[name];else continue;obj.warmupChange[id]=parseInt(RegExp.$2)}else if(line.match(note5))obj.stypeWarmupChange[parseInt(RegExp.$1)]=parseInt(RegExp.$2);else if(line.match(note6))obj.globalWarmupChange=parseInt(RegExp.$1)}}};DataManager.processSCDNotetags3=(group)=>{var note1=/<(?:SKILL)[ ](\d+)[ ](?:COOLDOWN DURATION):[ ](\d+)([%\uff05])>/i;var note1a=/<(?:SKILL)[ ](.*)[ ](?:COOLDOWN DURATION):[ ](\d+)([%\uff05])>/i;
var note2=/<(?:STYPE)[ ](\d+)[ ](?:COOLDOWN DURATION):[ ](\d+)([%\uff05])>/i;var note3=/<(?:GLOBAL COOLDOWN DURATION):[ ](\d+)([%\uff05])>/i;var note4=/<(?:SKILL)[ ](\d+)[ ](?:COOLDOWN RATE):[ ](\d+)([%\uff05])>/i;var note4a=/<(?:SKILL)[ ](.*)[ ](?:COOLDOWN RATE):[ ](\d+)([%\uff05])>/i;var note5=/<(?:STYPE)[ ](\d+)[ ](?:COOLDOWN RATE):[ ](\d+)([%\uff05])>/i;var note6=/<(?:GLOBAL COOLDOWN RATE):[ ](\d+)([%\uff05])>/i;for(let n=1;n<group.length;n++){var obj=group[n];var notedata=obj.note.split(/[\r\n]+/);
obj.cooldownDuration={};obj.stypeCooldownDuration={};obj.globalCooldownDuration=1;obj.cooldownRate={};obj.stypeCooldownRate={};obj.globalCooldownRate=1;for(let i=0;i<notedata.length;i++){var line=notedata[i];if(line.match(note1))obj.cooldownDuration[parseInt(RegExp.$1)]=parseFloat(RegExp.$2)*.01;else if(line.match(note1a)){var name=String(RegExp.$1).toUpperCase();if(Yanfly.SkillIdRef[name])var id=Yanfly.SkillIdRef[name];else continue;obj.cooldownDuration[id]=parseFloat(RegExp.$2)*.01}else if(line.match(note2))obj.stypeCooldownDuration[parseInt(RegExp.$1)]=
parseFloat(RegExp.$2)*.01;else if(line.match(note3))obj.globalCooldownDuration=parseFloat(RegExp.$1)*.01;else if(line.match(note4))obj.cooldownRate[parseInt(RegExp.$1)]=parseFloat(RegExp.$2)*.01;else if(line.match(note4a)){var name=String(RegExp.$1).toUpperCase();if(Yanfly.SkillIdRef[name])var id=Yanfly.SkillIdRef[name];else continue;obj.cooldownRate[id]=parseFloat(RegExp.$2)*.01}else if(line.match(note5))obj.stypeCooldownRate[parseInt(RegExp.$1)]=parseFloat(RegExp.$2)*.01;else if(line.match(note6))obj.globalCooldownRate=
parseFloat(RegExp.$1*.01)}}};Yanfly.SCD.BattleManager_endBattle=BattleManager.endBattle;BattleManager.endBattle=function(result){Yanfly.SCD.BattleManager_endBattle.call(this,result);$gameParty.endBattleCooldowns()};BattleManager.timeBasedCooldowns=function(){if(!$gameParty.inBattle())return false;if(!Imported.YEP_BattleEngineCore)return false;if(this.isTurnBased())return false;if(this._timeBasedCooldowns!==undefined)return this._timeBasedCooldowns;this._timeBasedCooldowns=eval(Yanfly.Param.CDTimeBased);
return this._timeBasedCooldowns};if(Imported.YEP_BattleEngineCore){Yanfly.SCD.BattleManager_processActionSequence=BattleManager.processActionSequence;BattleManager.processActionSequence=function(actionName,actionArgs){if(actionName==="GLOBAL COOLDOWN")return this.actionGlobalCooldown(actionArgs);if(actionName.match(/SKILL[ ](\d+)[ ]COOLDOWN/i))return this.actionSkillCooldown(parseInt(RegExp.$1),actionArgs);if(actionName.match(/SKILL[ ]TYPE[ ](\d+)[ ]COOLDOWN/i))return this.actionSTypeCooldown(parseInt(RegExp.$1),
actionArgs);if(actionName.match(/STYPE[ ](\d+)[ ]COOLDOWN/i))return this.actionSTypeCooldown(parseInt(RegExp.$1),actionArgs);return Yanfly.SCD.BattleManager_processActionSequence.call(this,actionName,actionArgs)}}BattleManager.actionGlobalCooldown=function(actionArgs){var targets=this.makeActionTargets(actionArgs[0]);if(targets.length<1)return true;var cmd=actionArgs[1];if(cmd.match(/([\+\-]\d+)/i)){var value=parseInt(RegExp.$1);for(let t=0;t<targets.length;++t){var target=targets[t];for(let i=0;i<
target.allSkills().length;++i){var skill=target.allSkills()[i];if(skill)target.addCooldown(skill.id,value)}}}else if(cmd.match(/(\d+)/i)){var value=parseInt(RegExp.$1);for(let t=0;t<targets.length;++t){var target=targets[t];for(let i=0;i<target.allSkills().length;++i){var skill=target.allSkills()[i];if(skill)target.setCooldown(skill.id,value)}}}else return true;return true};BattleManager.actionSkillCooldown=function(skillId,actionArgs){var targets=this.makeActionTargets(actionArgs[0]);if(targets.length<
1)return true;var cmd=actionArgs[1];if(cmd.match(/([\+\-]\d+)/i)){var value=parseInt(RegExp.$1);for(let t=0;t<targets.length;++t){var target=targets[t];target.addCooldown(skillId,value)}}else if(cmd.match(/(\d+)/i)){var value=parseInt(RegExp.$1);for(let t=0;t<targets.length;++t){var target=targets[t];target.setCooldown(skillId,value)}}else return true;return true};BattleManager.actionSTypeCooldown=function(stypeId,actionArgs){var targets=this.makeActionTargets(actionArgs[0]);if(targets.length<1)return true;
var cmd=actionArgs[1];if(cmd.match(/([\+\-]\d+)/i)){var value=parseInt(RegExp.$1);for(let t=0;t<targets.length;++t){var target=targets[t];for(let i=0;i<target.allSkills().length;++i){var skill=target.allSkills()[i];if(skill&&skill.stypeId===stypeId)target.addCooldown(skill.id,value)}}}else if(cmd.match(/(\d+)/i)){var value=parseInt(RegExp.$1);for(let t=0;t<targets.length;++t){var target=targets[t];for(let i=0;i<target.allSkills().length;++i){var skill=target.allSkills()[i];if(skill&&skill.stypeId===
stypeId)target.setCooldown(skill.id,value)}}}else return true;return true};Yanfly.SCD.Game_BattlerBase_initMembers=Game_BattlerBase.prototype.initMembers;Game_BattlerBase.prototype.initMembers=function(){Yanfly.SCD.Game_BattlerBase_initMembers.call(this);this.clearCooldowns();this.clearWarmups()};Game_BattlerBase.prototype.clearCooldowns=function(){this._cooldownTurns={}};Game_BattlerBase.prototype.clearWarmups=function(){this._warmupTurns={}};Game_BattlerBase.prototype.cooldown=function(skillId){if(this._cooldownTurns===
undefined)this.clearCooldowns();if(this._cooldownTurns[skillId]===undefined)this._cooldownTurns[skillId]=0;return this._cooldownTurns[skillId]};Game_BattlerBase.prototype.warmup=function(skillId){if(this._warmupTurns===undefined)this.clearWarmups();if(this._warmupTurns[skillId]===undefined)this._warmupTurns[skillId]=0;return this._warmupTurns[skillId]};Game_BattlerBase.prototype.setCooldown=function(skillId,value){if(!$dataSkills[skillId])return;if($dataSkills[skillId].bypassCooldown)return;if(this._cooldownTurns===
undefined)this.clearCooldowns();this._cooldownTurns[skillId]=value};Game_BattlerBase.prototype.addCooldown=function(skillId,value){if(!$dataSkills[skillId])return;if($dataSkills[skillId].bypassCooldown)return;if(this._cooldownTurns===undefined)this.clearCooldowns();if(!this._cooldownTurns[skillId])this._cooldownTurns[skillId]=0;this._cooldownTurns[skillId]+=value};Game_BattlerBase.prototype.setWarmup=function(skillId,value){if(!$dataSkills[skillId])return;if($dataSkills[skillId].bypassCooldown)return;
if(this._warmupTurns===undefined)this.clearWarmups();this._warmupTurns[skillId]=value};Game_BattlerBase.prototype.startWarmups=function(){if(this._warmupTurns===undefined)this.clearWarmups();for(let i=0;i<this.allSkills().length;++i){var skill=this.allSkills()[i];if(!skill)continue;var warmup=skill.warmup;if(skill.warmupEval.length>0){var item=skill;var a=this;var user=this;var subject=this;var s=$gameSwitches._data;var v=$gameVariables._data;var code=skill.warmupEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,
code,"CUSTOM WARMUP EVAL ERROR")}}warmup*=this.cooldownDuration(skill);warmup+=this.getWarmupMods(skill);this.setWarmup(skill.id,warmup)}};Game_BattlerBase.prototype.updateCooldowns=function(){if(this._cooldownTurns===undefined)this.clearCooldowns();for(let skillId in this._cooldownTurns){var skill=$dataSkills[skillId];if(!skill)continue;this._cooldownTurns[skillId]-=this.cooldownRate(skill)}};Game_BattlerBase.prototype.updateWarmups=function(){if(this._warmupTurns===undefined)this.clearWarmups();
for(let skillId in this._warmupTurns){var skill=$dataSkills[skillId];if(!skill)continue;this._warmupTurns[skillId]-=this.cooldownRate(skill)}};Game_BattlerBase.prototype.cooldownRateTick=function(skill){this._cooldownTickRate=this._cooldownTickRate||{};if(!this._cooldownTickRate[skill.id])this._cooldownTickRate[skill.id]=this.cooldownRate(skill);var rate=this._cooldownTickRate[skill.id];rate*=BattleManager.tickRate()/Yanfly.Param.CDTurnTime;return rate};Game_BattlerBase.prototype.updateCooldownTicks=
function(){if(this._cooldownTurns===undefined)this.clearCooldowns();for(let skillId in this._cooldownTurns){var skill=$dataSkills[skillId];if(!skill)continue;if(this._cooldownTurns[skillId]<=0)continue;this._cooldownTurns[skillId]-=this.cooldownRateTick(skill);this._cooldownTurns[skillId]=Math.max(0,this._cooldownTurns[skillId])}};Game_BattlerBase.prototype.updateWarmupTicks=function(){if(this._warmupTurns===undefined)this.clearWarmups();for(let skillId in this._warmupTurns){var skill=$dataSkills[skillId];
if(!skill)continue;if(this._warmupTurns[skillId]<=0)continue;this._warmupTurns[skillId]-=this.cooldownRateTick(skill);this._warmupTurns[skillId]=Math.max(0,this._warmupTurns[skillId])}};Yanfly.SCD.Game_BattlerBase_meetsSkillConditions=Game_BattlerBase.prototype.meetsSkillConditions;Game_BattlerBase.prototype.meetsSkillConditions=function(skill){if(this.cooldown(skill.id)>0)return false;if(this.warmup(skill.id)>0)return false;return Yanfly.SCD.Game_BattlerBase_meetsSkillConditions.call(this,skill)};
Yanfly.SCD.Game_BattlerBase_paySkillCost=Game_BattlerBase.prototype.paySkillCost;Game_BattlerBase.prototype.paySkillCost=function(skill){Yanfly.SCD.Game_BattlerBase_paySkillCost.call(this,skill);this.payGlobalCooldown(skill);this.payStypeCooldownCost(skill);this.payCooldownCost(skill);this.applyCooldownMods(skill)};Game_BattlerBase.prototype.payGlobalCooldown=function(mainSkill){for(let i=0;i<this.allSkills().length;++i){var skill=this.allSkills()[i];if(!skill)continue;var value=mainSkill.globalCooldown;
value*=this.cooldownDuration(mainSkill);value=Math.max(value,this.cooldown(skill.id));this.setCooldown(skill.id,value)}};Game_BattlerBase.prototype.payStypeCooldownCost=function(mainSkill){for(let stypeId in mainSkill.stypeCooldown){stypeId=parseInt(stypeId);for(let i=0;i<this.allSkills().length;++i){var skill=this.allSkills()[i];if(!skill)continue;if(skill.stypeId!==stypeId)continue;var value=mainSkill.stypeCooldown[stypeId];value*=this.cooldownDuration(mainSkill);value=Math.max(value,this.cooldown(skill.id));
this.setCooldown(skill.id,value)}}};Game_BattlerBase.prototype.payCooldownCost=function(skill){for(let skillId in skill.cooldown){skillId=parseInt(skillId);if(!$dataSkills[skillId])continue;var cooldown=skill.cooldown[skillId];if(skill.id===skillId)if(skill.cooldownEval.length>0){var item=skill;var a=this;var user=this;var subject=this;var s=$gameSwitches._data;var v=$gameVariables._data;var code=skill.cooldownEval;try{eval(code)}catch(e){Yanfly.Util.displayError(e,code,"CUSTOM COOLDOWN EVAL ERROR")}}cooldown*=
this.cooldownDuration(skill);cooldown=Math.max(cooldown,this.cooldown(skillId));this.setCooldown(skillId,cooldown)}};Game_BattlerBase.prototype.endBattleCooldowns=function(){this.resetCooldownTickRates();for(let skillId in this._cooldownTurns)this._cooldownTurns[skillId]+=$dataSkills[skillId].afterBattleCooldown};Game_BattlerBase.prototype.resetCooldownTickRates=function(){this._cooldownTickRate={}};Game_BattlerBase.prototype.updateCooldownSteps=function(){for(let skillId in this._cooldownTurns){var skill=
$dataSkills[skillId];if(skill)if($gameParty.steps()%skill.cooldownSteps===0)this._cooldownTurns[skillId]-=this.cooldownRate(skill)}};Game_BattlerBase.prototype.applyCooldownEffect=function(skill){this.applyGlobalCooldownChange(skill);this.applyStypeCooldownChange(skill);this.applyCooldownChange(skill)};Game_BattlerBase.prototype.applyCooldownChange=function(skill){for(let skillId in skill.cooldownChange){skillId=parseInt(skillId);if(!$dataSkills[skillId])continue;if(!skill.cooldownChange[skillId])continue;
var value=skill.cooldownChange[skillId];this.addCooldown(skillId,value)}};Game_BattlerBase.prototype.applyStypeCooldownChange=function(mainSkill){for(let stypeId in mainSkill.stypeCooldownChange){stypeId=parseInt(stypeId);for(let i=0;i<this.allSkills().length;++i){var skill=this.allSkills()[i];if(!skill)continue;if(skill.stypeId!==stypeId)continue;if(!mainSkill.stypeCooldownChange[stypeId])continue;var value=mainSkill.stypeCooldownChange[stypeId];this.addCooldown(skill.id,value)}}};Game_BattlerBase.prototype.applyGlobalCooldownChange=
function(mainSkill){for(let i=0;i<this.allSkills().length;++i){var skill=this.allSkills()[i];if(!skill)continue;var value=mainSkill.globalCooldownChange;this.addCooldown(skill.id,value)}};Game_BattlerBase.prototype.getWarmupMods=function(skill){var value=0;value+=this.flatWarmupChange(skill);return value};Game_BattlerBase.prototype.applyCooldownMods=function(skill){var value=this.cooldown(skill.id);value+=this.flatCooldownChange(skill);this.setCooldown(skill.id,Math.max(0,value))};Game_Battler.prototype.onBattleStartCooldowns=
function(){this.resetCooldownTickRates();this.startWarmups()};Game_Battler.prototype.cooldownDuration=function(skill){var skillId=skill.id;var stypeId=skill.stypeId;var value=1;for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.cooldownDuration[skillId]!==undefined)value*=state.cooldownDuration[skillId];if(state.stypeCooldownDuration[stypeId]!==undefined)value*=state.stypeCooldownDuration[stypeId];value*=state.globalCooldownDuration}return value};Game_Battler.prototype.cooldownRate=
function(skill){var skillId=skill.id;var stypeId=skill.stypeId;var value=1;for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.cooldownRate[skillId]!==undefined)value*=state.cooldownRate[skillId];if(state.stypeCooldownRate[stypeId]!==undefined)value*=state.stypeCooldownRate[stypeId];value*=state.globalCooldownRate}return value};Game_Battler.prototype.flatCooldownChange=function(skill){var skillId=skill.id;var stypeId=skill.stypeId;var value=0;for(let i=0;i<
this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.cooldownChange[skillId]!==undefined)value+=state.cooldownChange[skillId];if(state.stypeCooldownChange[stypeId]!==undefined)value+=state.stypeCooldownChange[stypeId];value+=state.globalCooldownChange}return value};Game_Battler.prototype.flatWarmupChange=function(skill){var skillId=skill.id;var stypeId=skill.stypeId;var value=0;for(let i=0;i<this.states().length;++i){var state=this.states()[i];if(!state)continue;if(state.warmupChange[skillId]!==
undefined)value+=state.warmupChange[skillId];if(state.stypeWarmupChange[stypeId]!==undefined)value+=state.stypeWarmupChange[stypeId];value+=state.globalWarmupChange}return value};Yanfly.SCD.Game_Battler_refresh=Game_Battler.prototype.refresh;Game_Battler.prototype.refresh=function(){Yanfly.SCD.Game_Battler_refresh.call(this);this.resetCooldownTickRates()};if(Imported.YEP_BattleEngineCore){Yanfly.SCD.Game_Battler_onTurnStart=Game_Battler.prototype.onTurnStart;Game_Battler.prototype.onTurnStart=function(){Yanfly.SCD.Game_Battler_onTurnStart.call(this);
if(BattleManager.isTickBased()&&!BattleManager.timeBasedCooldowns()){this.updateCooldowns();this.updateWarmups()}};Yanfly.SCD.Game_Battler_updateTick=Game_Battler.prototype.updateTick;Game_Battler.prototype.updateTick=function(){Yanfly.SCD.Game_Battler_updateTick.call(this);if(BattleManager.isTickBased()&&BattleManager.timeBasedCooldowns()){this.updateCooldownTicks();this.updateWarmupTicks()}}}Game_Battler.prototype.allSkills=function(){var prevCase=$gameTemp._disableBattleSkills;$gameTemp._disableBattleSkills=
true;var skills=this.skills();$gameTemp._disableBattleSkills=prevCase;return skills};Game_Actor.prototype.cooldownDuration=function(skill){var value=Game_Battler.prototype.cooldownDuration.call(this,skill);var skillId=skill.id;var stypeId=skill.stypeId;if(this.actor().cooldownDuration[skillId]!==undefined)value*=this.actor().cooldownDuration[skillId];if(this.currentClass().cooldownDuration[skillId]!==undefined)value*=this.currentClass().cooldownDuration[skillId];if(this.actor().stypeCooldownDuration[stypeId]!==
undefined)value*=this.actor().stypeCooldownDuration[stypeId];if(this.currentClass().stypeCooldownDuration[stypeId]!==undefined)value*=this.currentClass().stypeCooldownDuration[stypeId];value*=this.actor().globalCooldownDuration;value*=this.currentClass().globalCooldownDuration;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(!equip)continue;if(equip.cooldownDuration!==undefined)if(equip.cooldownDuration[skillId]!==undefined)value*=equip.cooldownDuration[skillId];if(equip.stypeCooldownDuration!==
undefined)if(equip.stypeCooldownDuration[stypeId]!==undefined)value*=equip.stypeCooldownDuration[stypeId];if(equip.globalCooldownDuration!==undefined)value*=equip.globalCooldownDuration}return value};Game_Actor.prototype.cooldownRate=function(skill){var value=Game_Battler.prototype.cooldownRate.call(this,skill);var skillId=skill.id;var stypeId=skill.stypeId;if(this.actor().cooldownRate[skillId]!==undefined)value*=this.actor().cooldownRate[skillId];if(this.currentClass().cooldownRate[skillId]!==undefined)value*=
this.currentClass().cooldownRate[skillId];if(this.actor().stypeCooldownRate[stypeId]!==undefined)value*=this.actor().stypeCooldownRate[stypeId];if(this.currentClass().stypeCooldownRate[stypeId]!==undefined)value*=this.currentClass().stypeCooldownRate[stypeId];value*=this.actor().globalCooldownRate;value*=this.currentClass().globalCooldownRate;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(!equip)continue;if(equip.cooldownRate!==undefined)if(equip.cooldownRate[skillId]!==undefined)value*=
equip.cooldownRate[skillId];if(equip.stypeCooldownRate!==undefined)if(equip.stypeCooldownRate[stypeId]!==undefined)value*=equip.stypeCooldownRate[stypeId];if(equip.globalCooldownRate!==undefined)value*=equip.globalCooldownRate}return value};Game_Actor.prototype.flatCooldownChange=function(skill){var skillId=skill.id;var stypeId=skill.stypeId;var value=Game_Battler.prototype.flatCooldownChange.call(this,skill);if(this.actor().cooldownChange[skillId]!==undefined)value+=this.actor().cooldownChange[skillId];
if(this.currentClass().cooldownChange[skillId]!==undefined)value+=this.currentClass().cooldownChange[skillId];if(this.actor().stypeCooldownChange[stypeId]!==undefined)value+=this.actor().stypeCooldownChange[stypeId];if(this.currentClass().stypeCooldownChange[stypeId]!==undefined)value+=this.currentClass().stypeCooldownChange[stypeId];value+=this.actor().globalCooldownChange;value+=this.currentClass().globalCooldownChange;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(!equip)continue;
if(equip.cooldownChange===undefined)continue;if(equip.cooldownChange[skillId]!==undefined)value+=equip.cooldownChange[skillId];if(equip.stypeCooldownChange[stypeId]!==undefined)value+=equip.stypeCooldownChange[stypeId];value+=equip.globalCooldownChange}return value};Game_Actor.prototype.flatWarmupChange=function(skill){var skillId=skill.id;var stypeId=skill.stypeId;var value=Game_Battler.prototype.flatWarmupChange.call(this,skill);if(this.actor().warmupChange[skillId]!==undefined)value+=this.actor().warmupChange[skillId];
if(this.currentClass().warmupChange[skillId]!==undefined)value+=this.currentClass().warmupChange[skillId];if(this.actor().stypeWarmupChange[stypeId]!==undefined)value+=this.actor().stypeWarmupChange[stypeId];if(this.currentClass().stypeWarmupChange[stypeId]!==undefined)value+=this.currentClass().stypeWarmupChange[stypeId];value+=this.actor().globalWarmupChange;value+=this.currentClass().globalWarmupChange;for(let i=0;i<this.equips().length;++i){var equip=this.equips()[i];if(!equip)continue;if(equip.warmupChange===
undefined)continue;if(equip.warmupChange[skillId]!==undefined)value+=equip.warmupChange[skillId];if(equip.stypeWarmupChange[stypeId]!==undefined)value+=equip.stypeWarmupChange[stypeId];value+=equip.globalWarmupChange}return value};if(!Game_Enemy.prototype.skills)Game_Enemy.prototype.skills=function(){var skills=[];for(let i=0;i<this.enemy().actions.length;++i){var skill=$dataSkills[this.enemy().actions[i].skillId];if(skill)skills.push(skill)}return skills};Game_Enemy.prototype.cooldownDuration=function(skill){var value=
Game_Battler.prototype.cooldownDuration.call(this,skill);var skillId=skill.id;var stypeId=skill.stypeId;if(this.enemy().cooldownDuration[skillId]!==undefined)value*=this.enemy().cooldownDuration[skillId];if(this.enemy().stypeCooldownDuration[stypeId]!==undefined)value*=this.enemy().stypeCooldownDuration[stypeId];value*=this.enemy().globalCooldownDuration;return value};Game_Enemy.prototype.cooldownRate=function(skill){var value=Game_Battler.prototype.cooldownRate.call(this,skill);var skillId=skill.id;
var stypeId=skill.stypeId;if(this.enemy().cooldownRate[skillId]!==undefined)value*=this.enemy().cooldownRate[skillId];if(this.enemy().stypeCooldownRate[stypeId]!==undefined)value*=this.enemy().stypeCooldownRate[stypeId];value*=this.enemy().globalCooldownRate;return value};Game_Enemy.prototype.flatCooldownChange=function(skill){var skillId=skill.id;var stypeId=skill.stypeId;var value=Game_Battler.prototype.flatCooldownChange.call(this,skill);if(this.enemy().cooldownChange[skillId]!==undefined)value+=
this.enemy().cooldownChange[skillId];if(this.enemy().stypeCooldownChange[stypeId]!==undefined)value+=this.enemy().stypeCooldownChange[stypeId];value+=this.enemy().globalCooldownChange;return value};Game_Enemy.prototype.flatWarmupChange=function(skill){var skillId=skill.id;var stypeId=skill.stypeId;var value=Game_Battler.prototype.flatWarmupChange.call(this,skill);if(this.enemy().warmupChange[skillId]!==undefined)value+=this.enemy().warmupChange[skillId];if(this.enemy().stypeWarmupChange[stypeId]!==
undefined)value+=this.enemy().stypeWarmupChange[stypeId];value+=this.enemy().globalWarmupChange;return value};Yanfly.SCD.Game_Action_applyItemUserEffect=Game_Action.prototype.applyItemUserEffect;Game_Action.prototype.applyItemUserEffect=function(target){Yanfly.SCD.Game_Action_applyItemUserEffect.call(this,target);if(target)target.applyCooldownEffect(this.item())};Yanfly.SCD.Game_Unit_onBattleStart=Game_Unit.prototype.onBattleStart;Game_Unit.prototype.onBattleStart=function(){Yanfly.SCD.Game_Unit_onBattleStart.call(this);
this.onBattleStartCooldowns()};Game_Unit.prototype.onBattleStartCooldowns=function(){var members=this.cooldownMembers();var length=members.length;for(let i=0;i<length;++i){var member=members[i];if(member)member.onBattleStartCooldowns()}};Game_Unit.prototype.updateCooldowns=function(){if(BattleManager.timeBasedCooldowns())return;var members=this.members();var length=members.length;for(let i=0;i<length;++i){var member=members[i];if(member){member.updateCooldowns();member.updateWarmups()}}};Game_Unit.prototype.endBattleCooldowns=
function(){var members=this.members();var length=members.length;for(let i=0;i<length;++i){var member=members[i];if(member){member.endBattleCooldowns();member.clearWarmups()}}};Game_Unit.prototype.cooldownMembers=function(){return this.members()};Yanfly.SCD.Game_Party_increaseSteps=Game_Party.prototype.increaseSteps;Game_Party.prototype.increaseSteps=function(){Yanfly.SCD.Game_Party_increaseSteps.call(this);this.updateCooldownSteps()};Game_Party.prototype.updateCooldownSteps=function(){return this.members().forEach((member)=>
member.updateCooldownSteps())};Game_Party.prototype.cooldownMembers=function(){return this.allMembers()};Yanfly.SCD.Game_Troop_increaseTurn=Game_Troop.prototype.increaseTurn;Game_Troop.prototype.increaseTurn=function(){Yanfly.SCD.Game_Troop_increaseTurn.call(this);if(Imported.YEP_BattleEngineCore){if(BattleManager.isTurnBased()){this.updateCooldowns();$gameParty.updateCooldowns()}}else{this.updateCooldowns();$gameParty.updateCooldowns()}};Yanfly.SCD.Window_SkillList_drawCost=Window_SkillList.prototype.drawSkillCost;
Window_SkillList.prototype.drawSkillCost=function(skill,wx,wy,ww){if(this._actor.warmup(skill.id)>0)return this.drawWarmup(skill,wx,wy,ww);else if(this._actor.cooldown(skill.id)>0)return this.drawCooldown(skill,wx,wy,ww);else return Yanfly.SCD.Window_SkillList_drawCost.call(this,skill,wx,wy,ww)};Window_SkillList.prototype.drawCooldown=function(skill,wx,wy,dw){if(Yanfly.Icon.Cooldown>0){var iw=wx+dw-Window_Base._iconWidth;this.drawIcon(Yanfly.Icon.Cooldown,iw,wy+2);dw-=Window_Base._iconWidth+2}this.changeTextColor(this.textColor(Yanfly.Param.CDTextColor));
var fmt=Yanfly.Param.CDFmt;var value=this._actor.cooldown(skill.id);if(value%1!==0)value=value.toFixed(2);if(value<=.009)value=.01;var text=fmt.format(Yanfly.Util.toGroup(value));this.contents.fontSize=Yanfly.Param.CDFontSize;this.drawText(text,wx,wy,dw,"right");var returnWidth=dw-this.textWidth(text)-Yanfly.Param.SCCCostPadding;this.resetFontSettings();return returnWidth};Window_SkillList.prototype.drawWarmup=function(skill,wx,wy,dw){if(Yanfly.Icon.Warmup>0){var iw=wx+dw-Window_Base._iconWidth;this.drawIcon(Yanfly.Icon.Warmup,
iw,wy+2);dw-=Window_Base._iconWidth+2}this.changeTextColor(this.textColor(Yanfly.Param.WUTextColor));var fmt=Yanfly.Param.WUFmt;var value=this._actor.warmup(skill.id);if(value%1!==0)value=value.toFixed(2);if(value<=.009)value=.01;var text=fmt.format(Yanfly.Util.toGroup(value));this.contents.fontSize=Yanfly.Param.WUFontSize;this.drawText(text,wx,wy,dw,"right");var returnWidth=dw-this.textWidth(text)-Yanfly.Param.SCCCostPadding;this.resetFontSettings();return returnWidth};Yanfly.Util=Yanfly.Util||{};
if(!Yanfly.Util.toGroup)Yanfly.Util.toGroup=(inVal)=>inVal})();
