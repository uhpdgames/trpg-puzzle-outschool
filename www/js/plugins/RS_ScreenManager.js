'use strict';var Imported=Imported||{};Imported.RS_ScreenManager=true;var RS=RS||{};RS.ScreenManager=RS.ScreenManager||{};RS.ScreenManager.Params=RS.ScreenManager.Params||{};
(($)=>{$.jsonParse=(str)=>JSON.parse(str,(k,v)=>{try{return $.jsonParse(v)}catch(e){return v}});const options={};const settings={};options.resize=true;options.autoScaling=true;options.minWidth=true;options.minHeight=true;options.recreate=true;options.allResolutions=true;options.aspectRatio=true;options.isAutoSyncManifest=true;settings.customAspectRatio="16:9";settings.customAspectRatio=settings.customAspectRatio.trim().split(":");settings.ptCustomScreenSize=String("1280 x 720").split(" x ");settings.defaultScreenSize=
new Point(parseInt(settings.ptCustomScreenSize[0])||1280,parseInt(settings.ptCustomScreenSize[1])||720);settings.pcGraphicsArray=[];settings.pcGraphicsTempArray=[{"width":"640","height":"480"},{"width":"800","height":"600"},{"width":"1024","height":"768"},{"width":"1152","height":"864"},{"width":"1280","height":"720"},{"width":"1280","height":"800"},{"width":"1280","height":"960"},{"width":"1360","height":"768"},{"width":"1360","height":"768"},{"width":"1366","height":"768"},{"width":"1400","height":"1050"},
{"width":"1440","height":"900"},{"width":"1600","height":"900"},{"width":"1600","height":"1200"},{"width":"1680","height":"1050"},{"width":"1920","height":"1080"},{"width":"1920","height":"1200"},{"width":"2048","height":"1152"},{"width":"2560","height":"1440"},{"width":"2560","height":"1600"}];settings.mobileGraphicsArray=[{"width":"120","height":"160"},{"width":"160","height":"240"},{"width":"240","height":"320"},{"width":"240","height":"400"},{"width":"320","height":"480"},{"width":"480","height":"800"},
{"width":"640","height":"960"},{"width":"640","height":"1136"},{"width":"720","height":"1280"},{"width":"750","height":"1334"},{"width":"768","height":"1024"},{"width":"768","height":"1280"},{"width":"800","height":"1280"},{"width":"1080","height":"1920"},{"width":"1200","height":"1920"},{"width":"1242","height":"2208"},{"width":"1440","height":"2560"},{"width":"1536","height":"2048"},{"width":"1600","height":"2560"},{"width":"2048","height":"2732"}];settings.resolutionQualityOnMobile=[{"width":"320",
"height":"480"},{"width":"480","height":"800"},{"width":"720","height":"1280"},{"width":"1080","height":"1920"}];settings.state="ready";$.Params.settings=settings;$.Params.options=options;$.Params.fullscreenFlag=false;$.readManifestFile=()=>{if(Utils.RPGMAKER_VERSION<"1.6.1")return;if(!Utils.isNwjs())return;if(!$.Params.options.isAutoSyncManifest)return;let fs=require("fs");let path=require("path");let dirname=path.dirname(process.mainModule.filename);let packageJsonPath=path.join(dirname,"package.json");
if(fs.existsSync(packageJsonPath)){let packageConfig=JSON.parse(fs.readFileSync(packageJsonPath,"utf8"));let config=packageConfig.window;if(config&&config.fullscreen){RS.ScreenManager.Params.fullscreenFlag=config.fullscreen;settings.defaultScreenSize.x=config.width;settings.defaultScreenSize.y=config.height;settings.ptCustomScreenSize=settings.defaultScreenSize.toString()}}let win=nw.Window.get();win.on("resize",(width,height)=>{let f=$.isFullscreen();RS.ScreenManager.changeManifestFile(width,height,
f)})};$.switchFullScreen=()=>{if(Utils.isNwjs()){let gui=require("nw.gui");let win=gui.Window.get();win.toggleFullscreen()}else Graphics._switchFullScreen()};$.isFullscreen=()=>{if(Utils.isNwjs()){let gui=require("nw.gui");let win=gui.Window.get();return win.appWindow.isFullscreen()}else return Graphics._isFullScreen()};$.changeManifestFile=(width,height,fullscreen)=>{if(Utils.RPGMAKER_VERSION<"1.6.1")return;let fs=require("fs");let path=require("path");let dirname=path.dirname(process.mainModule.filename);
let packageJsonPath=path.join(dirname,"package.json");let templatePackageConfig={"name":"mytest","main":"index.html","js-flags":"--expose-gc","crhomium-args":"--disable-sync","window":{"title":"","toolbar":false,"width":settings.defaultScreenSize.x,"height":settings.defaultScreenSize.y,"icon":"icon/icon.png"}};if(fs.existsSync(packageJsonPath)){let packageConfig=JSON.parse(fs.readFileSync(packageJsonPath,"utf8"));packageConfig.window.width=width;packageConfig.window.height=height;packageConfig.window.fullscreen=
fullscreen;fs.writeFileSync(packageJsonPath,JSON.stringify(packageConfig))}else{fs.writeFileSync(packageJsonPath,JSON.stringify(templatePackageConfig));return $.changeManifestFile(width,height,fullscreen)}};let PrivateLocalization=function(){};let newLocalization=$.jsonParse('{"Language":"navigator.language.slice(0, 2)","Localization":"[\\"{\\\\\\"lang\\\\\\":\\\\\\"en\\\\\\",\\\\\\"Resolutions\\\\\\":\\\\\\"Resolutions\\\\\\",\\\\\\"Aspect Ratio\\\\\\":\\\\\\"Aspect Ratio\\\\\\",\\\\\\"Display Resolutions\\\\\\":\\\\\\"Display Resolutions\\\\\\",\\\\\\"Full Screen\\\\\\":\\\\\\"Full Screen\\\\\\",\\\\\\"NotFoundError\\\\\\":\\\\\\"Couldn\'t find the node library needed to set the resolution\\\\\\",\\\\\\"NotFoundNwExe\\\\\\":\\\\\\"Please you must change the name of the executable file to nw.exe\\\\\\",\\\\\\"MobileResolutions\\\\\\":\\\\\\"[\\\\\\\\\\\\\\"Low\\\\\\\\\\\\\\", \\\\\\\\\\\\\\"Medium\\\\\\\\\\\\\\", \\\\\\\\\\\\\\"High\\\\\\\\\\\\\\", \\\\\\\\\\\\\\"Very High\\\\\\\\\\\\\\"]\\\\\\",\\\\\\"Windowed Mode\\\\\\":\\\\\\"Windowed Mode\\\\\\"}\\",\\"{\\\\\\"lang\\\\\\":\\\\\\"ko\\\\\\",\\\\\\"Resolutions\\\\\\":\\\\\\"\ud574\uc0c1\ub3c4\\\\\\",\\\\\\"Aspect Ratio\\\\\\":\\\\\\"\uc885\ud6a1\ube44\\\\\\",\\\\\\"Display Resolutions\\\\\\":\\\\\\"\ud574\uc0c1\ub3c4 \ubaa9\ub85d\\\\\\",\\\\\\"Full Screen\\\\\\":\\\\\\"\uc804\uccb4 \ud654\uba74\\\\\\",\\\\\\"NotFoundError\\\\\\":\\\\\\"\ud574\uc0c1\ub3c4 \uc124\uc815\uc5d0 \ud544\uc694\ud55c \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \ucc3e\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4\\\\\\",\\\\\\"NotFoundNwExe\\\\\\":\\\\\\"\uc2e4\ud589 \ud30c\uc77c\uba85\uc744 nw.exe\ub85c \ubcc0\uacbd\ud558\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4.\\\\\\",\\\\\\"MobileResolutions\\\\\\":\\\\\\"[\\\\\\\\\\\\\\"\ub0ae\uc74c\\\\\\\\\\\\\\",\\\\\\\\\\\\\\"\ubcf4\ud1b5\\\\\\\\\\\\\\",\\\\\\\\\\\\\\"\ub192\uc74c\\\\\\\\\\\\\\",\\\\\\\\\\\\\\"\ub9e4\uc6b0 \ub192\uc74c\\\\\\\\\\\\\\"]\\\\\\",\\\\\\"Windowed Mode\\\\\\":\\\\\\"\ucc3d \ubaa8\ub4dc\\\\\\"}\\"]"}');
PrivateLocalization.prototype={"code":eval(newLocalization.Language),"get":function(type){let code=this.code;let lang=PrivateLocalization[code];return lang?lang[type]:PrivateLocalization.en[type]}};newLocalization["Localization"].forEach((i)=>{let lang=i.lang;PrivateLocalization[lang]=i});$.localization=new PrivateLocalization;$.restartGame=()=>{let childProcess=require("child_process");let path=require("path");let projectPath=path.dirname(process.mainModule.filename);childProcess.execFile(process.execPath,
[projectPath],(err)=>{if(err)console.warn(err)})};Utils.getAbsolutePath=(defaultPath)=>{let fileName=defaultPath.split("\\");let driveName=fileName.shift();fileName=`${driveName}//${fileName.join("/")}`;return fileName};settings.pcGraphicsArray=settings.pcGraphicsTempArray;function ScreenConfig(){this.initialize.apply(this,arguments)}ScreenConfig.prototype.constructor=ScreenConfig;ScreenConfig.prototype.initialize=function(originWidth,originHeight,orientation){this._originWidth=originWidth;this._originHeight=
originHeight;this._orientation=orientation;this._aspectRatio=this.getRatio(originWidth,originHeight)};ScreenConfig.prototype.gcd=function(p,q){return q===0?p:this.gcd(q,p%q)};ScreenConfig.prototype.getSize=function(virtualWidth){let ret;let w;let h;w=parseInt(virtualWidth);h=parseInt(this.getHeight(virtualWidth));ret=[w,h];return ret};ScreenConfig.prototype.getRatio=function(width,height){width=Number(width)||1280;height=Number(height)||720;let gcd;let ret;if(width===height)return[1,1];gcd=this.gcd(width,
height);ret=[Number(width/gcd),Number(height/gcd)];return ret};ScreenConfig.prototype.getRatioAsString=function(width,height){let gcd;let temp;let ret;width=Number(width)||1280;height=Number(height)||720;if(width===height)return[1,1];if(width<height){temp=width;width=height||1;height=temp}gcd=this.gcd(width,height);ret=`${Number(width/gcd)}:${Number(height/gcd)}`;return ret};ScreenConfig.prototype.getWidth=function(newHeight){let ar=this._aspectRatio;let ratio=parseFloat(ar[0]/ar[1]);return ratio*
newHeight};ScreenConfig.prototype.getHeight=function(newWidth){let ar=this._aspectRatio;let ratio=parseFloat(ar[1]/ar[0]);return ratio*newWidth};function CustomScreenConfig(){this.initialize.apply(this,arguments)}CustomScreenConfig.prototype=Object.create(ScreenConfig.prototype);CustomScreenConfig.prototype.constructor=CustomScreenConfig;CustomScreenConfig.prototype.initialize=function(a,b){ScreenConfig.prototype.initialize.call(this,1600,900,"landscape");a=a||16;b=b||9;this._aspectRatio=[a,b]};Point.prototype.toString=
function(){return`${this.x} x ${this.y}`};$.uniqArray=function(data){let uniqData=[];let foundData={};data.forEach((i)=>{let packData=JSON.stringify(i);if(!foundData[packData]){uniqData.push(i);foundData[packData]=true}},this);return uniqData};Graphics.getAvailGraphicsArray=function(returnType){let data;let tw;let th;let pt;let gArray;let result;let maxSW;let maxSH;let type;let orientation;let config;let aspectRatio;let temp;let ret;gArray=[];result=[];maxSW=Utils.isMobileDevice()?window.outerWidth:
window.screen.availWidth;maxSH=Utils.isMobileDevice()?window.outerHeight:window.screen.availHeight;if(Utils.isNwjs()){type=maxSW>maxSH?"landscape":"portrait";if(maxSW===maxSH)type="landscape"}else type=screen.orientation.type.match(/landscape/)?"landscape":"portrait";data=Utils.isNwjs()?settings.pcGraphicsArray:settings.resolutionQualityOnMobile;if(Utils.isMobileDevice())data=settings.mobileGraphicsArray;config=new CustomScreenConfig(settings.customAspectRatio[0],settings.customAspectRatio[1]);data=
$.uniqArray(data);data.forEach((i)=>{tw=Number(i[0]);th=Number(i[1]);if(type==="portrait"&&maxSW>maxSH){let temp=tw;tw=th;th=temp}if(tw>=0&&tw<=maxSW&&th>=0&&th<=maxSH){if(options.aspectRatio){temp=config.getSize(tw);tw=temp[0];th=temp[1]}pt=new Point(tw,th);gArray.push(pt);result.push(pt.toString())}else if(options.allResolutions){if(options.aspectRatio){temp=config.getSize(tw);tw=temp[0];th=temp[1]}pt=new Point(tw,th);gArray.push(pt);result.push(pt.toString())}},this);return returnType==="String"?
result:gArray};Graphics.getOrientation=(inner)=>{let maxSW=inner===true?window.innerWidth:window.screen.availWidth;let maxSH=inner===true?window.innerHeight:window.screen.availHeight;let orientation="landscape";if(Utils.isNwjs()||!screen.orientation){orientation=maxSW>maxSH?"landscape":"portrait";if(maxSW===maxSH)orientation="landscape"}else orientation=screen.orientation.type.match(/landscape/)?"landscape":"portrait";return orientation};Graphics.setScreenResize=function(newScr){let cx;let cy;let xPadding;
let yPadding;let tw;let th;let minW;let minH;let orientation;let config;let aspectRatio;let temp;orientation=this.getOrientation(false);config=new ScreenConfig(newScr.x,newScr.y,orientation);aspectRatio=config._aspectRatio||[17,13];if(options.aspectRatio){config=new CustomScreenConfig(settings.customAspectRatio[0],settings.customAspectRatio[1]);aspectRatio=config._aspectRatio;temp=config.getSize(newScr.x);newScr.x=temp[0];newScr.y=temp[1]}SceneManager._screenWidth=newScr.x;SceneManager._screenHeight=
newScr.y;SceneManager._boxWidth=newScr.x;SceneManager._boxHeight=newScr.y;cx=window.screen.availWidth/2-newScr.x/2;cy=window.screen.availHeight/2-newScr.y/2;xPadding=window.outerWidth-window.innerWidth;yPadding=window.outerHeight-window.innerHeight;tw=$gameMap&&$gameMap.tileWidth?$gameMap.tileWidth():48;th=$gameMap&&$gameMap.tileHeight?$gameMap.tileHeight():48;minW=tw*aspectRatio[0]||Graphics._renderer.width;minH=th*aspectRatio[1]||Graphics._renderer.height;window.resizeTo(newScr.x+xPadding,newScr.y+
yPadding);window.moveTo(cx,cy);if(options.autoScaling&&tw/th>=1&&tw>=48){if(options.minWidth)Graphics.width=Graphics.boxWidth=Math.max(minW,newScr.x);if(options.minHeight)Graphics.height=Graphics.boxHeight=Math.max(minH,newScr.y);if(!options.minWidth&&!options.minHeight){Graphics.width=Graphics.boxWidth=newScr.x.clamp(minW,window.outerWidth);Graphics.height=Graphics.boxHeight=newScr.x.clamp(minH,window.outerHeight)}}else{Graphics.width=Graphics.boxWidth=newScr.x;Graphics.height=Graphics.boxHeight=
newScr.y}if(options.resize)Graphics._renderer.resize(newScr.x,newScr.y);const scene=SceneManager._scene&&!SceneManager.isScene("Scene_Boot");if(options.recreate&&scene)SceneManager.push(SceneManager._scene.constructor.name)};if(PluginManager.parameters("Community_Basic"))SceneManager.initNwjs=()=>{if(Utils.isNwjs()){let gui=require("nw.gui");let win=gui.Window.get();if(process.platform==="darwin"&&!win.menu){let menubar=new gui.Menu({type:"menubar"});let option={hideEdit:true,hideWindow:true};menubar.createMacBuiltin("Game",
option);win.menu=menubar}}};SceneManager.initResolution=()=>{let size;let orientation;let config;let mobile;let sw;let sh;let maxSW;let maxSH;let defScrWidth;let defScrHeight;$.readManifestFile();maxSW=window.innerWidth;maxSH=window.innerHeight;defScrWidth=settings.defaultScreenSize.x;defScrHeight=settings.defaultScreenSize.y;orientation=Graphics.getOrientation(true);config=new ScreenConfig(maxSW,maxSH,orientation);size=config.getSize(defScrWidth);mobile=Utils.isMobileDevice()||options.aspectRatio;
sw=mobile===true?size[0]:defScrWidth;sh=mobile===true?size[1]:defScrHeight;if(Utils.isNwjs()){let newSize=new Point(sw,sh);Graphics.setScreenResize(newSize);Graphics._switchFullScreen()}Graphics.width=Graphics.boxWidth=sw;Graphics.height=Graphics.boxHeight=sh;window.TempResolution={width:sw,height:sh}};function ScreenManager(){this.initialize.apply(this,arguments)}ScreenManager.prototype=Object.create(Scene_Base.prototype);ScreenManager.prototype.constructor=ScreenManager;ScreenManager.prototype.initialize=
function(){Scene_Base.prototype.initialize.call(this)};ScreenManager.prototype.create=function(){Scene_Base.prototype.create.call(this);this.createWindowLayer();this.createAvailGraphicsList();this.createPanel()};ScreenManager.prototype.makeSpriteForPanel=(height)=>{let color1=Window_Base.prototype.dimColor1();let color2=Window_Base.prototype.dimColor2();let x=0;let y=0;let width=Math.floor(Graphics.boxWidth/3);let sprite=new Sprite(new Bitmap(width,height*2));if(navigator.userAgent.match(/Chrome/))sprite.bitmap.fillAll(color1);
else{sprite.bitmap.gradientFillRect(x,y,Math.floor(width/2),height,color2,color1);sprite.bitmap.gradientFillRect(Math.floor(x+width/2),y,Math.floor(width/2),height,color1,color2)}sprite.bitmap.drawText($.localization.get("Display Resolutions"),x,y,width,height,"center");return sprite};ScreenManager.prototype.createPanel=function(){let height=Math.floor(Graphics.boxHeight/17);let nx=this._availGraphicsList.x;let ny=this._availGraphicsList.y-height-10;this._panel=this.makeSpriteForPanel(height);this.setPosition(this._panel,
nx,ny).addChild(this._panel)};ScreenManager.prototype.setPosition=function(type,x,y){if(!type)return;type.x=x;type.y=y;return this};ScreenManager.prototype.setHandler=function(){if(!this._availGraphicsList)return;this._availGraphicsList.setHandler("ok",this.convertScreenSize.bind(this));this._availGraphicsList.setHandler("cancel",this.popScene.bind(this));return this};ScreenManager.prototype.createDisplayList=(x,y,width,height)=>{return new Window_Base(x,y,width,height)};ScreenManager.prototype.createAvailGraphicsList=
function(){let width=Math.floor(Graphics.boxWidth/3);let height=Math.floor(Graphics.boxWidth/2.5);let nx=Graphics.boxWidth/2-width/2;let ny=Graphics.boxHeight/2-height/2;this._availGraphicsList=this.createDisplayList(0,0,width,height);this.setPosition(this._availGraphicsList,nx,ny).setHandler().addWindow(this._availGraphicsList)};ScreenManager.prototype.convertWithAspectRatio=()=>{let config=new CustomScreenConfig(settings.customAspectRatio[0],settings.customAspectRatio[1]);let insData=parseInt(window.screen.availWidth/
settings.customAspectRatio[0])*settings.customAspectRatio[0];let data=config.getSize(insData);Graphics.setScreenResize(new Point(data[0],data[1]))};ScreenManager.prototype.convertWithNwjs=function(){let scr=this._availGraphicsList.getCurrentItemToPoint();if(scr)Graphics.setScreenResize(scr);else this.convertWithAspectRatio();if(this._availGraphicsList.item()===$.localization.get("Full Screen")||this._availGraphicsList.item()===$.localization.get("Windowed Mode"))$.switchFullScreen()};ScreenManager.prototype.convertWithOther=
function(){let scr=this._availGraphicsList.getCurrentItemToPoint();if(scr){let temp=[];temp.push(options.aspectRatio);temp.push(options.resize);options.resize=true;options.aspectRatio=true;Graphics.setScreenResize(scr);options.resize=temp.pop();options.aspectRatio=temp.pop()}else this.convertWithAspectRatio()};ScreenManager.prototype.flushScreen=function(){$gameSystem._lastScreenManagerItem=this._availGraphicsList.index();this.popScene()};ScreenManager.prototype.convertScreenSize=function(){if(Utils.isNwjs())this.convertWithNwjs();
else this.convertWithOther();this.flushScreen()};(()=>{const alias_Game_System_initialize=Game_System.prototype.initialize;Game_System.prototype.initialize=function(){alias_Game_System_initialize.call(this);this._lastScreenManagerItem=0};Scene_Base.prototype.requestStretch=(sprite)=>{if(!sprite.bitmap)return;const bitmap=sprite.bitmap;if(bitmap.width<=0||bitmap.height<=0)return;let scaleX=Graphics.boxWidth/bitmap.width;let scaleY=Graphics.boxHeight/bitmap.height;this.RS_Scale={width:scaleX,height:scaleY};
sprite.scale=new Point(scaleX,scaleY)};const alias_Scene_MenuBase_start=Scene_MenuBase.prototype.start;Scene_MenuBase.prototype.start=function(){alias_Scene_MenuBase_start.call(this);this.requestStretch(this._backgroundSprite)};const alias_Scene_Title_start=Scene_Title.prototype.start;Scene_Title.prototype.start=function(){alias_Scene_Title_start.call(this);this.requestStretch(this._backSprite1)};const alias_Scene_Gameover_start=Scene_Gameover.prototype.start;Scene_Gameover.prototype.start=function(){alias_Scene_Gameover_start.call(this);
this.requestStretch(this._backSprite)}})();window.ScreenManager=ScreenManager})(RS.ScreenManager);
