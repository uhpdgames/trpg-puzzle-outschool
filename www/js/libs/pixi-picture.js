var __extends=this&&this.__extends||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);function n(){this.constructor=e}e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)};!function(a){function e(e,r,t,n){var i=s[n];o.call(this,e,r.replace(/%SPRITE_UNIFORMS%/gi,i.vertUniforms).replace(/%SPRITE_CODE%/gi,i.vertCode),t.replace(/%SPRITE_UNIFORMS%/gi,i.fragUniforms).replace(/%SPRITE_CODE%/gi,i.fragCode)),this.bind(),this.tilingMode=n,this.tempQuad=new a.Quad(e),this.tempQuad.initVao(this),this.uniforms.uColor=new Float32Array([1,1,1,1]),this.uniforms.uSampler=[0,1]}var r,o,s,t;r=extras=a.extras||(a.extras={}),s=[{vertUniforms:"",vertCode:"vTextureCoord = aTextureCoord;",fragUniforms:"uniform vec4 uTextureClamp;",fragCode:"vec2 textureCoord = clamp(vTextureCoord, uTextureClamp.xy, uTextureClamp.zw);"},{vertUniforms:"uniform mat3 uTransform;",vertCode:"vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;",fragUniforms:"",fragCode:"vec2 textureCoord = vTextureCoord;"},{vertUniforms:"uniform mat3 uTransform;",vertCode:"vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;",fragUniforms:"uniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;",fragCode:"vec2 textureCoord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\ntextureCoord = (uMapCoord * vec3(textureCoord, 1.0)).xy;\ntextureCoord = clamp(textureCoord, uClampFrame.xy, uClampFrame.zw);"}],o=a.Shader,__extends(e,o),e.blendVert="\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 mapMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\n%SPRITE_UNIFORMS%\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    %SPRITE_CODE%\n    vMapCoord = (mapMatrix * vec3(aVertexPosition, 1.0)).xy;\n}\n",t=e,r.PictureShader=t}(PIXI||(PIXI={})),function(e){var t,n,r;function i(e,r){n.call(this,e,t.PictureShader.blendVert,"\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\n%SPRITE_UNIFORMS%\n\nvoid main(void)\n{\n    %SPRITE_CODE%\n    vec4 source = texture2D(uSampler[0], textureCoord) * uColor;\n    vec4 target = texture2D(uSampler[1], vMapCoord);\n\n    //reverse hardlight\n    if (source.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    //yeah, premultiplied\n    vec3 Cb = source.rgb/source.a, Cs;\n    if (target.a > 0.0) {\n        Cs = target.rgb / target.a;\n    }\n    vec3 multiply = Cb * Cs * 2.0;\n    vec3 Cs2 = Cs * 2.0 - 1.0;\n    vec3 screen = Cb + Cs2 - Cb * Cs2;\n    vec3 B;\n    if (Cb.r <= 0.5) {\n        B.r = multiply.r;\n    } else {\n        B.r = screen.r;\n    }\n    if (Cb.g <= 0.5) {\n        B.g = multiply.g;\n    } else {\n        B.g = screen.g;\n    }\n    if (Cb.b <= 0.5) {\n        B.b = multiply.b;\n    } else {\n        B.b = screen.b;\n    }\n    vec4 res;\n    res.xyz = (1.0 - source.a) * Cs + source.a * B;\n    res.a = source.a + target.a * (1.0-source.a);\n    gl_FragColor = vec4(res.xyz * res.a, res.a);\n}\n",r)}t=e.extras||(e.extras={}),n=t.PictureShader,__extends(i,n),r=i,t.HardLightShader=r}(PIXI||(PIXI={})),function(t){var n;(n=t.extras||(t.extras={})).mapFilterBlendModesToPixi=function(e,r){return void 0===r&&(r=[]),r[t.BLEND_MODES.OVERLAY]=[new n.OverlayShader(e,0),new n.OverlayShader(e,1),new n.OverlayShader(e,2)],r[t.BLEND_MODES.HARD_LIGHT]=[new n.HardLightShader(e,0),new n.HardLightShader(e,1),new n.HardLightShader(e,2)],r}}(PIXI||(PIXI={})),function(e){var r,t,n;function i(e,r){t.call(this,e,"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n%SPRITE_UNIFORMS%\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    %SPRITE_CODE%\n}\n","\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\n%SPRITE_UNIFORMS%\n\nvoid main(void)\n{\n    %SPRITE_CODE%\n\n    vec4 sample = texture2D(uSampler[0], textureCoord);\n    gl_FragColor = sample * uColor;\n}\n",r)}r=e.extras||(e.extras={}),t=r.PictureShader,__extends(i,t),n=i,r.NormalShader=n}(PIXI||(PIXI={})),function(e){var t,n,r;function i(e,r){n.call(this,e,t.PictureShader.blendVert,"\nvarying vec2 vTextureCoord;\nvarying vec2 vMapCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler[2];\nuniform vec4 uColor;\n%SPRITE_UNIFORMS%\n\nvoid main(void)\n{\n    %SPRITE_CODE%\n    vec4 source = texture2D(uSampler[0], textureCoord) * uColor;\n    vec4 target = texture2D(uSampler[1], vMapCoord);\n\n    //reverse hardlight\n    if (source.a == 0.0) {\n        gl_FragColor = vec4(0, 0, 0, 0);\n        return;\n    }\n    //yeah, premultiplied\n    vec3 Cb = source.rgb/source.a, Cs;\n    if (target.a > 0.0) {\n        Cs = target.rgb / target.a;\n    }\n    vec3 multiply = Cb * Cs * 2.0;\n    vec3 Cb2 = Cb * 2.0 - 1.0;\n    vec3 screen = Cb2 + Cs - Cb2 * Cs;\n    vec3 B;\n    if (Cs.r <= 0.5) {\n        B.r = multiply.r;\n    } else {\n        B.r = screen.r;\n    }\n    if (Cs.g <= 0.5) {\n        B.g = multiply.g;\n    } else {\n        B.g = screen.g;\n    }\n    if (Cs.b <= 0.5) {\n        B.b = multiply.b;\n    } else {\n        B.b = screen.b;\n    }\n    vec4 res;\n    res.xyz = (1.0 - source.a) * Cs + source.a * B;\n    res.a = source.a + target.a * (1.0-source.a);\n    gl_FragColor = vec4(res.xyz * res.a, res.a);\n}\n",r)}t=e.extras||(e.extras={}),n=t.PictureShader,__extends(i,n),r=i,t.OverlayShader=r}(PIXI||(PIXI={})),function(N){var r,t,e;function n(e){return e+=0===e?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1}function i(e){t.call(this,e)}r=N.extras||(N.extras={}),t=N.ObjectRenderer,__extends(i,t),i.prototype.onContextChange=function(){var e=this.renderer.gl;this.drawModes=r.mapFilterBlendModesToPixi(e),this.normalShader=[new r.NormalShader(e,0),new r.NormalShader(e,1),new r.NormalShader(e,2)],this._tempClamp=new Float32Array(4),this._tempColor=new Float32Array(4),this._tempRect=new N.Rectangle,this._tempRect2=new N.Rectangle,this._tempRect3=new N.Rectangle,this._tempMatrix=new N.Matrix,this._tempMatrix2=new N.Matrix,this._bigBuf=new Uint8Array(1<<20),this._renderTexture=new N.BaseRenderTexture(1024,1024)},i.prototype.start=function(){},i.prototype.flush=function(){},i.prototype._getRenderTexture=function(e,r){return(this._renderTexture.width<e||this._renderTexture.height<r)&&(r=n(r=n(e)),this._renderTexture.resize(e,r)),this._renderTexture},i.prototype._getBuf=function(e){var r=this._bigBuf;return r.length<e&&(e=n(e),r=new Uint8Array(e),this._bigBuf=r),r},i.prototype.render=function(e){if(e.texture.valid){var r=0;e.tileTransform&&(r=this._isSimpleSprite(e)?1:2);var t=this.drawModes[e.blendMode];t?this._renderBlend(e,t[r]):this._renderNormal(e,this.normalShader[r])}},i.prototype._renderNormal=function(e,r){var t=this.renderer;t.bindShader(r),t.state.setBlendMode(e.blendMode),this._renderInner(e,r)},i.prototype._renderBlend=function(e,r){var t=this.renderer,n=e.getBounds(),i=t._activeRenderTarget,a=i.projectionMatrix,o=a.a<0,s=a.d<0,u=i.resolution,d=this._tempRect,h=i.sourceFrame||i.destinationFrame;d.x=0,d.y=0,d.width=h.width,d.height=h.height;var l=this._tempRect2,c=h.width*u,v=h.height*u;l.x=(n.x+a.tx/a.a)*u+c/2,l.y=(n.y+a.ty/a.d)*u+v/2,l.width=n.width*u,l.height=n.height*u,o&&(l.y=c-l.width-l.x),s&&(l.y=v-l.height-l.y),this._tempRect3;var m=Math.floor(Math.max(d.x,l.x)),x=Math.ceil(Math.min(d.x+d.width,l.x+l.width)),p=Math.floor(Math.max(d.y,l.y)),C=x-m,g=Math.ceil(Math.min(d.y+d.height,l.y+l.height))-p;if(!(C<=0||g<=0)){var f=this._getRenderTexture(C,g);t.bindTexture(f,1,!0);var _=t.gl;if(t.renderingToScreen&&i.root?(this._getBuf(C*g*4),_.readPixels(m,p,C,g,_.RGBA,_.UNSIGNED_BYTE,this._bigBuf),_.texSubImage2D(_.TEXTURE_2D,0,0,0,C,g,_.RGBA,_.UNSIGNED_BYTE,this._bigBuf)):_.copyTexSubImage2D(_.TEXTURE_2D,0,0,0,m,p,C,g),t.bindShader(r),t.state.setBlendMode(N.BLEND_MODES.NORMAL),r.uniforms.mapMatrix){var y=this._tempMatrix;y.a=l.width/f.width/n.width,o?(y.a=-y.a,y.tx=(l.x-m)/f.width-(n.x+n.width)*y.a):y.tx=(l.x-m)/f.width-n.x*y.a,y.d=l.height/f.height/n.height,s?(y.d=-y.d,y.ty=(l.y-p)/f.height-(n.y+n.height)*y.d):y.ty=(l.y-p)/f.height-n.y*y.d,r.uniforms.mapMatrix=y.toArray(!0)}this._renderInner(e,r)}},i.prototype._renderInner=function(e,r){this.renderer,0<r.tilingMode?this._renderWithShader(e,1===r.tilingMode,r):this._renderSprite(e,r)},i.prototype._renderWithShader=function(e,r,t){var n=t.tempQuad,i=this.renderer;i.bindVao(n.vao);var a=n.vertices,o=e._width,s=e._height,u=e._anchor._x,d=e._anchor._y,h=o*(1-u),l=o*-u,c=s*(1-d),v=s*-d,m=e.transform.worldTransform,x=m.a,p=m.b,C=m.c,g=m.d,f=m.tx,_=m.ty;a[0]=x*l+C*v+f,a[1]=g*v+p*l+_,a[2]=x*h+C*v+f,a[3]=g*v+p*h+_,a[4]=x*h+C*c+f,a[5]=g*c+p*h+_,a[6]=x*l+C*c+f,a[7]=g*c+p*l+_,(a=n.uvs)[0]=a[6]=-e.anchor.x,a[1]=a[3]=-e.anchor.y,a[2]=a[4]=1-e.anchor.x,a[5]=a[7]=1-e.anchor.y,n.upload();var y=e._texture,S=e.tileTransform.localTransform,T=e.uvTransform,I=T.mapCoord,b=T.uClampFrame,M=T.uClampOffset,w=y.width,P=y.height,R=o,E=s,B=this._tempMatrix2;B.set(S.a*w/R,S.b*w/E,S.c*P/R,S.d*P/E,S.tx/R,S.ty/E),B.invert(),r?B.append(I):(t.uniforms.uMapCoord=I.toArray(!0),t.uniforms.uClampFrame=b,t.uniforms.uClampOffset=M),t.uniforms.uTransform=B.toArray(!0);var O=this._tempColor,D=e.worldAlpha;N.utils.hex2rgb(e.tint,O),O[0]*=D,O[1]*=D,O[2]*=D,O[3]=D,t.uniforms.uColor=O,i.bindTexture(y,0,!0),n.vao.draw(this.renderer.gl.TRIANGLES,6,0)},i.prototype._renderSprite=function(e,r){var t=this.renderer,n=r.tempQuad;t.bindVao(n.vao);for(var i=e.texture._uvs,a=(n.vertices,e.vertexData),o=0;o<8;o++)n.vertices[o]=a[o];n.uvs[0]=i.x0,n.uvs[1]=i.y0,n.uvs[2]=i.x1,n.uvs[3]=i.y1,n.uvs[4]=i.x2,n.uvs[5]=i.y2,n.uvs[6]=i.x3,n.uvs[7]=i.y3,n.upload();var s=e.texture.frame,u=e.texture.baseTexture,d=this._tempClamp,h=.5/u.resolution;d[0]=(s.x+h)/u.width,d[1]=(s.y+h)/u.height,d[2]=(s.x+s.width-h)/u.width,d[3]=(s.y+s.height-h)/u.height,r.uniforms.uTextureClamp=d;var l=this._tempColor;N.utils.hex2rgb(e.tint,l);var c=e.worldAlpha;l[0]*=c,l[1]*=c,l[2]*=c,l[3]=c,r.uniforms.uColor=l,t.bindTexture(u,0,!0),n.vao.draw(this.renderer.gl.TRIANGLES,6,0)},i.prototype._isSimpleSprite=function(e){var r=this.renderer,t=e._texture,n=t.baseTexture,i=n.isPowerOfTwo&&t.frame.width===n.width&&t.frame.height===n.height;return i&&(n._glTextures[r.CONTEXT_UID]?i=n.wrapMode!==N.WRAP_MODES.CLAMP:n.wrapMode===N.WRAP_MODES.CLAMP&&(n.wrapMode=N.WRAP_MODES.REPEAT)),i},e=i,r.PictureRenderer=e,N.WebGLRenderer.registerPlugin("picture",e),N.CanvasRenderer.registerPlugin("picture",N.CanvasSpriteRenderer)}(PIXI||(PIXI={})),function(e){var r,t,n;function i(e){t.call(this,e),this.pluginName="picture"}r=e.extras||(e.extras={}),t=e.Sprite,__extends(i,t),n=i,r.PictureSprite=n}(PIXI||(PIXI={})),function(e){var r,t,n;function i(e){t.call(this,e),this.pluginName="picture"}r=e.extras||(e.extras={}),t=r.TilingSprite,__extends(i,t),n=i,r.PictureTilingSprite=n}(PIXI||(PIXI={}));