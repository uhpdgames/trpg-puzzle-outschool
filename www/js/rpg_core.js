function JsExtensions(){throw Error("This is not a class")}function Utils(){throw Error("This is a static class")}function CacheEntry(t,e,i){this.cache=t,this.key=e,this.item=i,this.cached=!1,this.ttlSeconds=this.ttlTicks=this.touchSeconds=this.touchTicks=0,this.freedByTTL=!1}function CacheMap(t){this.manager=t,this._inner={},this._lastRemovedEntries={},this.lastCheckTTL=this.updateTicks=0,this.delayCheckTTL=100,this.updateSeconds=Date.now()}function ImageCache(){this.initialize.apply(this,arguments)}function RequestQueue(){this.initialize.apply(this,arguments)}function Point(){this.initialize.apply(this,arguments)}function Rectangle(){this.initialize.apply(this,arguments)}function Bitmap(){this.initialize.apply(this,arguments)}function Graphics(){throw Error("This is a static class")}function Input(){throw Error("This is a static class")}function TouchInput(){throw Error("This is a static class")}function Sprite(){this.initialize.apply(this,arguments)}function Tilemap(){this.initialize.apply(this,arguments)}function ShaderTilemap(){Tilemap.apply(this,arguments),this.roundPixels=!0}function TilingSprite(){this.initialize.apply(this,arguments)}function ScreenSprite(){this.initialize.apply(this,arguments)}function Window(){this.initialize.apply(this,arguments)}function WindowLayer(){this.initialize.apply(this,arguments)}function Weather(){this.initialize.apply(this,arguments)}function ToneFilter(){PIXI.filters.ColorMatrixFilter.call(this)}function ToneSprite(){this.initialize.apply(this,arguments)}function Stage(){this.initialize.apply(this,arguments)}function WebAudio(){this.initialize.apply(this,arguments)}function Html5Audio(){throw Error("This is a static class")}function JsonEx(){throw Error("This is a static class")}function Decrypter(){throw Error("This is a static class")}function ResourceHandler(){throw Error("This is a static class")}function DataManager(){throw Error("This is a static class")}Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)},Number.prototype.mod=function(t){return(this%t+t)%t},String.prototype.format=function(){var i=arguments;return this.replace(/%([0-9]+)/g,function(t,e){return i[Number(e)-1]})},String.prototype.padZero=function(t){for(var e=this;e.length<t;)e="0"+e;return e},Number.prototype.padZero=function(t){return String(this).padZero(t)},Object.defineProperties(Array.prototype,{equals:{enumerable:!1,value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.length;e++)if(this[e]instanceof Array&&t[e]instanceof Array){if(!this[e].equals(t[e]))return!1}else if(this[e]!==t[e])return!1;return!0}},clone:{enumerable:!1,value:function(){return this.slice(0)}},contains:{enumerable:!1,value:function(t){return 0<=this.indexOf(t)}}}),String.prototype.contains=function(t){return 0<=this.indexOf(t)},Math.randomInt=function(t){return Math.floor(t*Math.random())},Utils.RPGMAKER_NAME="MV",Utils.RPGMAKER_VERSION="1.6.1",Utils.isOptionValid=function(t){return location.search.slice(1).split("&").contains(t)||"undefined"!=typeof nw&&0<nw.App.argv.length&&nw.App.argv[0].split("&").contains(t)?1:0},Utils.isNwjs=function(){return"function"==typeof require&&"object"==typeof process},Utils.isMobileDevice=function(){return!!navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)},Utils.isMobileSafari=function(){var t=navigator.userAgent;return!(!t.match(/iPhone|iPad|iPod/)||!t.match(/AppleWebKit/)||t.match("CriOS"))},Utils.isAndroidChrome=function(){var t=navigator.userAgent;return!(!t.match(/Android/)||!t.match(/Chrome/))},Utils.canReadGameFiles=function(){var t=document.getElementsByTagName("script");t=t[t.length-1];var e=new XMLHttpRequest;try{return e.open("GET",t.src),e.overrideMimeType("text/javascript"),e.send(),!0}catch(t){return!1}},Utils.rgbToCssColor=function(t,e,i){return"rgb("+(t=Math.round(t))+","+(e=Math.round(e))+","+(i=Math.round(i))+")"},Utils._id=1,Utils.generateRuntimeId=function(){return Utils._id++},Utils._supportPassiveEvent=null,Utils.isSupportPassiveEvent=function(){if("boolean"==typeof Utils._supportPassiveEvent)return Utils._supportPassiveEvent;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});return window.addEventListener("test",null,e),Utils._supportPassiveEvent=t},CacheEntry.prototype.free=function(t){this.freedByTTL=t||!1,this.cached&&(this.cached=!1,delete this.cache._inner[this.key])},CacheEntry.prototype.allocate=function(){return this.cached||((this.cache._inner[this.key]=this).cached=!0),this.touch(),this},CacheEntry.prototype.setTimeToLive=function(t,e){return this.ttlTicks=t||0,this.ttlSeconds=e||0,this},CacheEntry.prototype.isStillAlive=function(){var t=this.cache;return(0==this.ttlTicks||this.touchTicks+this.ttlTicks<t.updateTicks)&&(0==this.ttlSeconds||this.touchSeconds+this.ttlSeconds<t.updateSeconds)},CacheEntry.prototype.touch=function(){var t=this.cache;this.cached?(this.touchTicks=t.updateTicks,this.touchSeconds=t.updateSeconds):this.freedByTTL&&(this.freedByTTL=!1,t._inner[this.key]||(t._inner[this.key]=this))},CacheMap.prototype.checkTTL=function(){var t=this._inner,e=this._lastRemovedEntries;for(var i in e||(this._lastRemovedEntries=e=[]),t){var a=t[i];a.isStillAlive()||e.push(a)}for(t=0;t<e.length;t++)e[t].free(!0);e.length=0},CacheMap.prototype.getItem=function(t){return(t=this._inner[t])?t.item:null},CacheMap.prototype.clear=function(){for(var t=Object.keys(this._inner),e=0;e<t.length;e++)this._inner[t[e]].free()},CacheMap.prototype.setItem=function(t,e){return new CacheEntry(this,t,e).allocate()},CacheMap.prototype.update=function(t,e){this.updateTicks+=t,this.updateSeconds+=e,this.updateSeconds>=this.delayCheckTTL+this.lastCheckTTL&&(this.lastCheckTTL=this.updateSeconds,this.checkTTL())},ImageCache.limit=1e7,ImageCache.prototype.initialize=function(){this._items={}},ImageCache.prototype.add=function(t,e){this._items[t]={bitmap:e,touch:Date.now(),key:t},this._truncateCache()},ImageCache.prototype.get=function(t){return this._items[t]?((t=this._items[t]).touch=Date.now(),t.bitmap):null},ImageCache.prototype.reserve=function(t,e,i){this._items[t]||(this._items[t]={bitmap:e,touch:Date.now(),key:t}),this._items[t].reservationId=i},ImageCache.prototype.releaseReservation=function(e){var i=this._items;Object.keys(i).map(function(t){return i[t]}).forEach(function(t){t.reservationId===e&&delete t.reservationId})},ImageCache.prototype._truncateCache=function(){var e=this._items,i=ImageCache.limit;Object.keys(e).map(function(t){return e[t]}).sort(function(t,e){return e.touch-t.touch}).forEach(function(t){0<i||this._mustBeHeld(t)?(t=t.bitmap,i-=t.width*t.height):delete e[t.key]}.bind(this))},ImageCache.prototype._mustBeHeld=function(t){return!t.bitmap.isRequestOnly()&&!(!t.reservationId&&t.bitmap.isReady())},ImageCache.prototype.isReady=function(){var e=this._items;return!Object.keys(e).some(function(t){return!e[t].bitmap.isRequestOnly()&&!e[t].bitmap.isReady()})},ImageCache.prototype.getErrorBitmap=function(){var e=this._items,i=null;return Object.keys(e).some(function(t){return!!e[t].bitmap.isError()&&(i=e[t].bitmap,!0)})?i:null},RequestQueue.prototype.initialize=function(){this._queue=[]},RequestQueue.prototype.enqueue=function(t,e){this._queue.push({key:t,value:e})},RequestQueue.prototype.update=function(){if(0!==this._queue.length){var t=this._queue[0];t.value.isRequestReady()?(this._queue.shift(),0!==this._queue.length&&this._queue[0].value.startRequest()):t.value.startRequest()}},RequestQueue.prototype.raisePriority=function(t){for(var e=0;e<this._queue.length;e++){var i=this._queue[e];if(i.key===t){this._queue.splice(e,1),this._queue.unshift(i);break}}},RequestQueue.prototype.clear=function(){this._queue.splice(0)},Point.prototype=Object.create(PIXI.Point.prototype),Point.prototype.constructor=Point,Point.prototype.initialize=function(t,e){PIXI.Point.call(this,t,e)},Rectangle.prototype=Object.create(PIXI.Rectangle.prototype),Rectangle.prototype.constructor=Rectangle,Rectangle.prototype.initialize=function(t,e,i,a){PIXI.Rectangle.call(this,t,e,i,a)},Rectangle.emptyRectangle=new Rectangle(0,0,0,0),Bitmap._reuseImages=[],Bitmap.prototype._createCanvas=function(t,e){this.__canvas=this.__canvas||document.createElement("canvas"),this.__context=this.__canvas.getContext("2d"),this.__canvas.width=Math.max(t||0,1),this.__canvas.height=Math.max(e||0,1),this._image&&(t=Math.max(this._image.height||0,1),this.__canvas.width=Math.max(this._image.width||0,1),this.__canvas.height=t,this._createBaseTexture(this._canvas),this.__context.drawImage(this._image,0,0)),this._setDirty()},Bitmap.prototype._createBaseTexture=function(t){this.__baseTexture=new PIXI.BaseTexture(t),this.__baseTexture.mipmap=!1,this.__baseTexture.width=t.width,this.__baseTexture.height=t.height,this._baseTexture.scaleMode=this._smooth?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST},Bitmap.prototype._clearImgInstance=function(){this._image.src="",this._image.onload=null,this._loadListener=this._errorListener=this._image.onerror=null,Bitmap._reuseImages.push(this._image),this._image=null},Object.defineProperties(Bitmap.prototype,{_canvas:{get:function(){return this.__canvas||this._createCanvas(),this.__canvas}},_context:{get:function(){return this.__context||this._createCanvas(),this.__context}},_baseTexture:{get:function(){return this.__baseTexture||this._createBaseTexture(this._image||this.__canvas),this.__baseTexture}}}),Bitmap.prototype._renewCanvas=function(){var t=this._image;t&&this.__canvas&&(this.__canvas.width<t.width||this.__canvas.height<t.height)&&this._createCanvas()},Bitmap.prototype.initialize=function(t,e){this._defer||this._createCanvas(t,e),this._image=null,this._url="",this._paintOpacity=255,this._smooth=!1,this._loadListeners=[],this._loadingState="none",this._decodeAfterRequest=!1,this.cacheEntry=null,this.fontFace="GameFont",this.fontSize=28,this.fontItalic=!1,this.textColor="#ffffff",this.outlineColor="rgba(0, 0, 0, 0.5)",this.outlineWidth=4},Bitmap.load=function(t){var e=Object.create(Bitmap.prototype);return e._defer=!0,e.initialize(),e._decodeAfterRequest=!0,e._requestImage(t),e},Bitmap.snap=function(t){var e=Graphics.width,i=Graphics.height,a=new Bitmap(e,i),n=a._context;return e=PIXI.RenderTexture.create(e,i),t&&(Graphics._renderer.render(t,e),t.worldTransform.identity(),t=Graphics.isWebGL()?Graphics._renderer.extract.canvas(e):e.baseTexture._canvasRenderTarget.canvas,n.drawImage(t,0,0)),e.destroy({destroyBase:!0}),a._setDirty(),a},Bitmap.prototype.isReady=function(){return"loaded"===this._loadingState||"none"===this._loadingState},Bitmap.prototype.isError=function(){return"error"===this._loadingState},Bitmap.prototype.touch=function(){this.cacheEntry&&this.cacheEntry.touch()},Object.defineProperty(Bitmap.prototype,"url",{get:function(){return this._url},configurable:!0}),Object.defineProperty(Bitmap.prototype,"baseTexture",{get:function(){return this._baseTexture},configurable:!0}),Object.defineProperty(Bitmap.prototype,"canvas",{get:function(){return this._canvas},configurable:!0}),Object.defineProperty(Bitmap.prototype,"context",{get:function(){return this._context},configurable:!0}),Object.defineProperty(Bitmap.prototype,"width",{get:function(){return this.isReady()?this._image?this._image.width:this._canvas.width:0},configurable:!0}),Object.defineProperty(Bitmap.prototype,"height",{get:function(){return this.isReady()?this._image?this._image.height:this._canvas.height:0},configurable:!0}),Object.defineProperty(Bitmap.prototype,"rect",{get:function(){return new Rectangle(0,0,this.width,this.height)},configurable:!0}),Object.defineProperty(Bitmap.prototype,"smooth",{get:function(){return this._smooth},set:function(t){this._smooth!==t&&(this._smooth=t,this.__baseTexture&&(this._baseTexture.scaleMode=this._smooth?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST))},configurable:!0}),Object.defineProperty(Bitmap.prototype,"paintOpacity",{get:function(){return this._paintOpacity},set:function(t){this._paintOpacity!==t&&(this._paintOpacity=t,this._context.globalAlpha=this._paintOpacity/255)},configurable:!0}),Bitmap.prototype.resize=function(t,e){t=Math.max(t||0,1),e=Math.max(e||0,1),this._canvas.width=t,this._canvas.height=e,this._baseTexture.width=t,this._baseTexture.height=e},Bitmap.prototype.blt=function(t,e,i,a,n,o,r,s,h){s=s||a,h=h||n,0<=e&&0<=i&&0<a&&0<n&&0<s&&0<h&&e+a<=t.width&&i+n<=t.height&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(t._canvas,e,i,a,n,o,r,s,h),this._setDirty())},Bitmap.prototype.bltImage=function(t,e,i,a,n,o,r,s,h){s=s||a,h=h||n,0<=e&&0<=i&&0<a&&0<n&&0<s&&0<h&&e+a<=t.width&&i+n<=t.height&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(t._image,e,i,a,n,o,r,s,h),this._setDirty())},Bitmap.prototype.getPixel=function(t,e){t=this._context.getImageData(t,e,1,1).data,e="#";for(var i=0;i<3;i++)e+=t[i].toString(16).padZero(2);return e},Bitmap.prototype.getAlphaPixel=function(t,e){return this._context.getImageData(t,e,1,1).data[3]},Bitmap.prototype.clearRect=function(t,e,i,a){this._context.clearRect(t,e,i,a),this._setDirty()},Bitmap.prototype.clear=function(){this.clearRect(0,0,this.width,this.height)},Bitmap.prototype.fillRect=function(t,e,i,a,n){var o=this._context;o.save(),o.fillStyle=n,o.fillRect(t,e,i,a),o.restore(),this._setDirty()},Bitmap.prototype.fillAll=function(t){this.fillRect(0,0,this.width,this.height,t)},Bitmap.prototype.gradientFillRect=function(t,e,i,a,n,o,r){var s=this._context;(r=r?s.createLinearGradient(t,e,t,e+a):s.createLinearGradient(t,e,t+i,e)).addColorStop(0,n),r.addColorStop(1,o),s.save(),s.fillStyle=r,s.fillRect(t,e,i,a),s.restore(),this._setDirty()},Bitmap.prototype.drawCircle=function(t,e,i,a){var n=this._context;n.save(),n.fillStyle=a,n.beginPath(),n.arc(t,e,i,0,2*Math.PI,!1),n.fill(),n.restore(),this._setDirty()},Bitmap.prototype.drawText=function(t,e,i,a,n,o){if(void 0!==t){i=i+n-(n-.7*this.fontSize)/2;var r=(n=this._context).globalAlpha;a=a||4294967295,"center"===o&&(e+=a/2),"right"===o&&(e+=a),n.save(),n.font=this._makeFontNameText(),n.textAlign=o,n.textBaseline="alphabetic",n.globalAlpha=1,this._drawTextOutline(t,e,i,a),n.globalAlpha=r,this._drawTextBody(t,e,i,a),n.restore(),this._setDirty()}},Bitmap.prototype.measureTextWidth=function(t){var e=this._context;return e.save(),e.font=this._makeFontNameText(),t=e.measureText(t).width,e.restore(),t},Bitmap.prototype.adjustTone=function(t,e,i){if((t||e||i)&&0<this.width&&0<this.height){for(var a=this._context,n=a.getImageData(0,0,this.width,this.height),o=n.data,r=0;r<o.length;r+=4)o[r+0]+=t,o[r+1]+=e,o[r+2]+=i;a.putImageData(n,0,0),this._setDirty()}},Bitmap.prototype.rotateHue=function(t){if(t&&0<this.width&&0<this.height){t=(t%360+360)%360;for(var e=this._context,i=e.getImageData(0,0,this.width,this.height),a=i.data,n=0;n<a.length;n+=4){var o=(c=a[n+0],u=a[n+1],l=a[n+2],f=_=d=void 0,d=Math.min(c,u,l),m=Math.max(c,u,l),y=(d+m)/2,(f=_=0)<(d=m-d)&&(_=c===m?((u-l)/d+6)%6*60:u===m?60*((l-c)/d+2):60*((c-u)/d+4),f=d/(255-Math.abs(2*y-255))),[_,f,y]);r=(o[0]+t)%360,s=o[1],h=o[2],void 0,p=(s*=255-Math.abs(2*h-255))+(h-=s/2),s=s*(1-Math.abs(r/60%2-1))+h,o=r<60?[p,s,h]:r<120?[s,p,h]:r<180?[h,p,s]:r<240?[h,s,p]:r<300?[s,h,p]:[p,h,s],a[n+0]=o[0],a[n+1]=o[1],a[n+2]=o[2]}e.putImageData(i,0,0),this._setDirty()}var r,s,h,p,c,u,l,d,m,_,f,y},Bitmap.prototype.blur=function(){for(var t=0;t<2;t++){var e=this.width,i=this.height,a=this._canvas,n=this._context,o=document.createElement("canvas"),r=o.getContext("2d");for(o.width=e+2,o.height=i+2,r.drawImage(a,0,0,e,i,1,1,e,i),r.drawImage(a,0,0,e,1,1,0,e,1),r.drawImage(a,0,0,1,i,0,1,1,i),r.drawImage(a,0,i-1,e,1,1,i+1,e,1),r.drawImage(a,e-1,0,1,i,e+1,1,1,i),n.save(),n.fillStyle="black",n.fillRect(0,0,e,i),n.globalCompositeOperation="lighter",n.globalAlpha=1/9,a=0;a<3;a++)for(r=0;r<3;r++)n.drawImage(o,r,a,e,i,0,0,e,i);n.restore()}this._setDirty()},Bitmap.prototype.addLoadListener=function(t){this.isReady()?t(this):this._loadListeners.push(t)},Bitmap.prototype._makeFontNameText=function(){return(this.fontItalic?"Italic ":"")+this.fontSize+"px "+this.fontFace},Bitmap.prototype._drawTextOutline=function(t,e,i,a){var n=this._context;n.strokeStyle=this.outlineColor,n.lineWidth=this.outlineWidth,n.lineJoin="round",n.strokeText(t,e,i,a)},Bitmap.prototype._drawTextBody=function(t,e,i,a){var n=this._context;n.fillStyle=this.textColor,n.fillText(t,e,i,a)},Bitmap.prototype._onLoad=function(){switch(this._image.removeEventListener("load",this._loadListener),this._image.removeEventListener("error",this._errorListener),this._renewCanvas(),this._loadingState){case"requesting":this._loadingState="requestCompleted",this._decodeAfterRequest?this.decode():(this._loadingState="purged",this._clearImgInstance());break;case"decrypting":window.URL.revokeObjectURL(this._image.src),this._loadingState="decryptCompleted",this._decodeAfterRequest?this.decode():(this._loadingState="purged",this._clearImgInstance())}},Bitmap.prototype.decode=function(){switch(this._loadingState){case"requestCompleted":case"decryptCompleted":this._loadingState="loaded",this.__canvas||this._createBaseTexture(this._image),this._setDirty(),this._callLoadListeners();break;case"requesting":case"decrypting":this._decodeAfterRequest=!0,this._loader||(this._loader=ResourceHandler.createLoader(this._url,this._requestImage.bind(this,this._url),this._onError.bind(this)),this._image.removeEventListener("error",this._errorListener),this._image.addEventListener("error",this._errorListener=this._loader));break;case"pending":case"purged":case"error":this._decodeAfterRequest=!0,this._requestImage(this._url)}},Bitmap.prototype._callLoadListeners=function(){for(;0<this._loadListeners.length;)this._loadListeners.shift()(this)},Bitmap.prototype._onError=function(){this._image.removeEventListener("load",this._loadListener),this._image.removeEventListener("error",this._errorListener),this._loadingState="error"},Bitmap.prototype._setDirty=function(){this._dirty=!0},Bitmap.prototype.checkDirty=function(){this._dirty&&(this._baseTexture.update(),this._dirty=!1)},Bitmap.request=function(t){var e=Object.create(Bitmap.prototype);return e._defer=!0,e.initialize(),e._url=t,e._loadingState="pending",e},Bitmap.prototype._requestImage=function(t){this._image=0!==Bitmap._reuseImages.length?Bitmap._reuseImages.pop():new Image,this._decodeAfterRequest&&!this._loader&&(this._loader=ResourceHandler.createLoader(t,this._requestImage.bind(this,t),this._onError.bind(this))),this._image=new Image,this._url=t,this._loadingState="requesting",!Decrypter.checkImgIgnore(t)&&Decrypter.hasEncryptedImages?(this._loadingState="decrypting",Decrypter.decryptImg(t,this)):(this._image.src=t,this._image.addEventListener("load",this._loadListener=Bitmap.prototype._onLoad.bind(this)),this._image.addEventListener("error",this._errorListener=this._loader||Bitmap.prototype._onError.bind(this)))},Bitmap.prototype.isRequestOnly=function(){return!(this._decodeAfterRequest||this.isReady())},Bitmap.prototype.isRequestReady=function(){return"pending"!==this._loadingState&&"requesting"!==this._loadingState&&"decrypting"!==this._loadingState},Bitmap.prototype.startRequest=function(){"pending"===this._loadingState&&(this._decodeAfterRequest=!1,this._requestImage(this._url))},Graphics._cssFontLoading=document.fonts&&document.fonts.ready,Graphics._fontLoaded=null,Graphics._videoVolume=1,Graphics.initialize=function(t,e,i){this._width=t||800,this._height=e||600,this._rendererType=i||"auto",this._boxWidth=this._width,this._boxHeight=this._height,this._realScale=this._scale=1,this._errorShowed=!1,this._video=this._canvas=this._errorPrinter=null,this._videoLoading=this._videoUnlocked=!1,this._modeBox=this._fpsMeter=this._renderer=this._upperCanvas=null,this._skipCount=0,this._maxSkip=3,this._rendered=!1,this._loadingImage=null,this._loadingCount=0,this._fpsMeterToggled=!1,this._stretchEnabled=this._defaultStretchMode(),this._canUseSaturationBlend=this._canUseDifferenceBlend=!1,this._hiddenCanvas=null,this._testCanvasBlendModes(),this._modifyExistingElements(),this._updateRealScale(),this._createAllElements(),this._disableTextSelection(),this._disableContextMenu(),this._setupEventHandlers(),this._setupCssFontLoading()},Graphics._setupCssFontLoading=function(){Graphics._cssFontLoading&&document.fonts.ready.then(function(t){Graphics._fontLoaded=t}).catch(function(t){SceneManager.onError(t)})},Graphics.canUseCssFontLoading=function(){return!!this._cssFontLoading},Graphics.frameCount=0,Graphics.BLEND_NORMAL=0,Graphics.BLEND_ADD=1,Graphics.BLEND_MULTIPLY=2,Graphics.BLEND_SCREEN=3,Graphics.tickStart=function(){this._fpsMeter&&this._fpsMeter.tickStart()},Graphics.tickEnd=function(){this._fpsMeter&&this._rendered&&this._fpsMeter.tick()},Graphics.render=function(t){if(0===this._skipCount){var e=Date.now();t&&(this._renderer.render(t),this._renderer.gl&&this._renderer.gl.flush&&this._renderer.gl.flush()),t=Date.now(),this._skipCount=Math.min(Math.floor((t-e)/15),this._maxSkip),this._rendered=!0}else this._skipCount--,this._rendered=!1;this.frameCount++},Graphics.isWebGL=function(){return this._renderer&&this._renderer.type===PIXI.RENDERER_TYPE.WEBGL},Graphics.hasWebGL=function(){try{var t=document.createElement("canvas");return!(!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},Graphics.canUseDifferenceBlend=function(){return this._canUseDifferenceBlend},Graphics.canUseSaturationBlend=function(){return this._canUseSaturationBlend},Graphics.setLoadingImage=function(t){this._loadingImage=new Image,this._loadingImage.src=t},Graphics.startLoading=function(){this._loadingCount=0},Graphics.updateLoading=function(){this._loadingCount++,this._paintUpperCanvas(),this._upperCanvas.style.opacity=1},Graphics.endLoading=function(){this._clearUpperCanvas(),this._upperCanvas.style.opacity=0},Graphics.printLoadingError=function(t){this._errorPrinter&&!this._errorShowed&&(this._errorPrinter.innerHTML=this._makeErrorHtml("Loading Error","Failed to load: "+t),(t=document.createElement("button")).innerHTML="Retry",t.style.fontSize="24px",t.style.color="#ffffff",t.style.backgroundColor="#000000",t.onmousedown=t.ontouchstart=function(t){ResourceHandler.retry(),t.stopPropagation()},this._errorPrinter.appendChild(t),this._loadingCount=-1/0)},Graphics.eraseLoadingError=function(){this._errorPrinter&&!this._errorShowed&&(this._errorPrinter.innerHTML="",this.startLoading())},Graphics.printError=function(t,e){this._errorShowed=!0,this._errorPrinter&&(this._errorPrinter.innerHTML=this._makeErrorHtml(t,e)),this._applyCanvasFilter(),this._clearUpperCanvas()},Graphics.showFps=function(){this._fpsMeter&&(this._fpsMeter.show(),this._modeBox.style.opacity=1)},Graphics.hideFps=function(){this._fpsMeter&&(this._fpsMeter.hide(),this._modeBox.style.opacity=0)},Graphics.loadFont=function(t,e){var i=document.createElement("style"),a=document.getElementsByTagName("head");e='@font-face { font-family: "'+t+'"; src: url("'+e+'"); }',i.type="text/css",a.item(0).appendChild(i),i.sheet.insertRule(e,0),this._createFontLoader(t)},Graphics.isFontLoaded=function(t){if(Graphics._cssFontLoading)return!!Graphics._fontLoaded&&Graphics._fontLoaded.check('10px "'+t+'"');this._hiddenCanvas||(this._hiddenCanvas=document.createElement("canvas"));var e=this._hiddenCanvas.getContext("2d");return e.font="40px "+t+", sans-serif",t=e.measureText("abcdefghijklmnopqrstuvwxyz").width,e.font="40px sans-serif",t!==(e=e.measureText("abcdefghijklmnopqrstuvwxyz").width)},Graphics.playVideo=function(t){this._videoLoader=ResourceHandler.createLoader(null,this._playVideo.bind(this,t),this._onVideoError.bind(this)),this._playVideo(t)},Graphics._playVideo=function(t){this._video.src=t,this._video.onloadeddata=this._onVideoLoad.bind(this),this._video.onerror=this._videoLoader,this._video.onended=this._onVideoEnd.bind(this),this._video.load(),this._videoLoading=!0},Graphics.isVideoPlaying=function(){return this._videoLoading||this._isVideoVisible()},Graphics.canPlayVideoType=function(t){return this._video&&this._video.canPlayType(t)},Graphics.setVideoVolume=function(t){this._videoVolume=t,this._video&&(this._video.volume=this._videoVolume)},Graphics.pageToCanvasX=function(t){return this._canvas?Math.round((t-this._canvas.offsetLeft)/this._realScale):0},Graphics.pageToCanvasY=function(t){return this._canvas?Math.round((t-this._canvas.offsetTop)/this._realScale):0},Graphics.isInsideCanvas=function(t,e){return 0<=t&&t<this._width&&0<=e&&e<this._height},Graphics.callGC=function(){Graphics.isWebGL()&&Graphics._renderer.textureGC.run()},Object.defineProperty(Graphics,"width",{get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateAllElements())},configurable:!0}),Object.defineProperty(Graphics,"height",{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this._updateAllElements())},configurable:!0}),Object.defineProperty(Graphics,"boxWidth",{get:function(){return this._boxWidth},set:function(t){this._boxWidth=t},configurable:!0}),Object.defineProperty(Graphics,"boxHeight",{get:function(){return this._boxHeight},set:function(t){this._boxHeight=t},configurable:!0}),Object.defineProperty(Graphics,"scale",{get:function(){return this._scale},set:function(t){this._scale!==t&&(this._scale=t,this._updateAllElements())},configurable:!0}),Graphics._createAllElements=function(){this._createErrorPrinter(),this._createCanvas(),this._createVideo(),this._createUpperCanvas(),this._createRenderer(),this._createFPSMeter(),this._createModeBox(),this._createGameFontLoader()},Graphics._updateAllElements=function(){this._updateRealScale(),this._updateErrorPrinter(),this._updateCanvas(),this._updateVideo(),this._updateUpperCanvas(),this._updateRenderer(),this._paintUpperCanvas()},Graphics._updateRealScale=function(){if(this._stretchEnabled){var t=window.innerWidth/this._width,e=window.innerHeight/this._height;1<=t&&t-.01<=1&&(t=1),1<=e&&e-.01<=1&&(e=1),this._realScale=Math.min(t,e)}else this._realScale=this._scale},Graphics._makeErrorHtml=function(t,e){return'<font color="yellow"><b>'+t+'</b></font><br><font color="white">'+e+"</font><br>"},Graphics._defaultStretchMode=function(){return Utils.isNwjs()||Utils.isMobileDevice()},Graphics._testCanvasBlendModes=function(){var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d");e.globalCompositeOperation="source-over",e.fillStyle="white",e.fillRect(0,0,1,1),e.globalCompositeOperation="difference",e.fillStyle="white",e.fillRect(0,0,1,1),t=e.getImageData(0,0,1,1),e.globalCompositeOperation="source-over",e.fillStyle="black",e.fillRect(0,0,1,1),e.globalCompositeOperation="saturation",e.fillStyle="white",e.fillRect(0,0,1,1),e=e.getImageData(0,0,1,1),this._canUseDifferenceBlend=0===t.data[0],this._canUseSaturationBlend=0===e.data[0]},Graphics._modifyExistingElements=function(){for(var t=document.getElementsByTagName("*"),e=0;e<t.length;e++)0<t[e].style.zIndex&&(t[e].style.zIndex=0)},Graphics._createErrorPrinter=function(){this._errorPrinter=document.createElement("p"),this._errorPrinter.id="ErrorPrinter",this._updateErrorPrinter(),document.body.appendChild(this._errorPrinter)},Graphics._updateErrorPrinter=function(){this._errorPrinter.width=.9*this._width,this._errorPrinter.height=40,this._errorPrinter.style.textAlign="center",this._errorPrinter.style.textShadow="1px 1px 3px #000",this._errorPrinter.style.fontSize="20px",this._errorPrinter.style.zIndex=99,this._centerElement(this._errorPrinter)},Graphics._createCanvas=function(){this._canvas=document.createElement("canvas"),this._canvas.id="GameCanvas",this._updateCanvas(),document.body.appendChild(this._canvas)},Graphics._updateCanvas=function(){this._canvas.width=this._width,this._canvas.height=this._height,this._canvas.style.zIndex=1,this._centerElement(this._canvas)},Graphics._createVideo=function(){this._video=document.createElement("video"),this._video.id="GameVideo",this._video.style.opacity=0,this._video.setAttribute("playsinline",""),this._video.volume=this._videoVolume,this._updateVideo(),makeVideoPlayableInline(this._video),document.body.appendChild(this._video)},Graphics._updateVideo=function(){this._video.width=this._width,this._video.height=this._height,this._video.style.zIndex=2,this._centerElement(this._video)},Graphics._createUpperCanvas=function(){this._upperCanvas=document.createElement("canvas"),this._upperCanvas.id="UpperCanvas",this._updateUpperCanvas(),document.body.appendChild(this._upperCanvas)},Graphics._updateUpperCanvas=function(){this._upperCanvas.width=this._width,this._upperCanvas.height=this._height,this._upperCanvas.style.zIndex=3,this._centerElement(this._upperCanvas)},Graphics._clearUpperCanvas=function(){this._upperCanvas.getContext("2d").clearRect(0,0,this._width,this._height)},Graphics._paintUpperCanvas=function(){if(this._clearUpperCanvas(),this._loadingImage&&20<=this._loadingCount){var t=this._upperCanvas.getContext("2d"),e=(this._width-this._loadingImage.width)/2,i=(this._height-this._loadingImage.height)/2,a=((this._loadingCount-20)/30).clamp(0,1);t.save(),t.globalAlpha=a,t.drawImage(this._loadingImage,e,i),t.restore()}},Graphics._createRenderer=function(){PIXI.dontSayHello=!0;var t=this._width,e=this._height,i={view:this._canvas};try{switch(this._rendererType){case"canvas":this._renderer=new PIXI.CanvasRenderer(t,e,i);break;case"webgl":this._renderer=new PIXI.WebGLRenderer(t,e,i);break;default:this._renderer=PIXI.autoDetectRenderer(t,e,i)}this._renderer&&this._renderer.textureGC&&(this._renderer.textureGC.maxIdle=1)}catch(t){this._renderer=null}},Graphics._updateRenderer=function(){this._renderer&&this._renderer.resize(this._width,this._height)},Graphics._createFPSMeter=function(){this._fpsMeter=new FPSMeter({graph:1,decimals:0,theme:"transparent",toggleOn:null}),this._fpsMeter.hide()},Graphics._createModeBox=function(){var t=document.createElement("div");t.id="modeTextBack",t.style.position="absolute",t.style.left="5px",t.style.top="5px",t.style.width="119px",t.style.height="58px",t.style.background="rgba(0,0,0,0.2)",t.style.zIndex=9,t.style.opacity=0;var e=document.createElement("div");e.id="modeText",e.style.position="absolute",e.style.left="0px",e.style.top="41px",e.style.width="119px",e.style.fontSize="12px",e.style.fontFamily="monospace",e.style.color="white",e.style.textAlign="center",e.style.textShadow="1px 1px 0 rgba(0,0,0,0.5)",e.innerHTML=this.isWebGL()?"WebGL mode":"Canvas mode",document.body.appendChild(t),t.appendChild(e),this._modeBox=t},Graphics._createGameFontLoader=function(){this._createFontLoader("GameFont")},Graphics._createFontLoader=function(t){var e=document.createElement("div"),i=document.createTextNode(".");e.style.fontFamily=t,e.style.fontSize="0px",e.style.color="transparent",e.style.position="absolute",e.style.margin="auto",e.style.top="0px",e.style.left="0px",e.style.width="1px",e.style.height="1px",e.appendChild(i),document.body.appendChild(e)},Graphics._centerElement=function(t){var e=t.width*this._realScale,i=t.height*this._realScale;t.style.position="absolute",t.style.margin="auto",t.style.top=0,t.style.left=0,t.style.right=0,t.style.bottom=0,t.style.width=e+"px",t.style.height=i+"px"},Graphics._disableTextSelection=function(){var t=document.body;t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.mozUserSelect="none"},Graphics._disableContextMenu=function(){function t(){return!1}for(var e=document.body.getElementsByTagName("*"),i=0;i<e.length;i++)e[i].oncontextmenu=t},Graphics._applyCanvasFilter=function(){this._canvas&&(this._canvas.style.opacity=.5,this._canvas.style.filter="blur(8px)",this._canvas.style.webkitFilter="blur(8px)")},Graphics._onVideoLoad=function(){this._video.play(),this._updateVisibility(!0),this._videoLoading=!1},Graphics._onVideoError=function(){this._updateVisibility(!1),this._videoLoading=!1},Graphics._onVideoEnd=function(){this._updateVisibility(!1)},Graphics._updateVisibility=function(t){this._video.style.opacity=t?1:0,this._canvas.style.opacity=t?0:1},Graphics._isVideoVisible=function(){return 0<this._video.style.opacity},Graphics._setupEventHandlers=function(){window.addEventListener("resize",this._onWindowResize.bind(this)),document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keydown",this._onTouchEnd.bind(this)),document.addEventListener("mousedown",this._onTouchEnd.bind(this)),document.addEventListener("touchend",this._onTouchEnd.bind(this))},Graphics._onWindowResize=function(){this._updateAllElements()},Graphics._onKeyDown=function(t){if(!t.ctrlKey&&!t.altKey)switch(t.keyCode){case 113:t.preventDefault(),this._switchFPSMeter();break;case 114:t.preventDefault(),this._switchStretchMode();break;case 115:t.preventDefault(),this._switchFullScreen()}},Graphics._onTouchEnd=function(t){this._videoUnlocked||(this._video.play(),this._videoUnlocked=!0),this._isVideoVisible()&&this._video.paused&&this._video.play()},Graphics._switchFPSMeter=function(){this._fpsMeter.isPaused?(this.showFps(),this._fpsMeter.showFps(),this._fpsMeterToggled=!1):this._fpsMeterToggled?this.hideFps():(this._fpsMeter.showDuration(),this._fpsMeterToggled=!0)},Graphics._switchStretchMode=function(){this._stretchEnabled=!this._stretchEnabled,this._updateAllElements()},Graphics._switchFullScreen=function(){this._isFullScreen()?this._requestFullScreen():this._cancelFullScreen()},Graphics._isFullScreen=function(){return document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitFullscreenElement&&!document.msFullscreenElement},Graphics._requestFullScreen=function(){var t=document.body;t.requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen&&t.msRequestFullscreen()},Graphics._cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},Input.initialize=function(){this.clear(),this._wrapNwjsAlert(),this._setupEventHandlers()},Input.keyRepeatWait=24,Input.keyRepeatInterval=6,Input.keyMapper={9:"tab",13:"ok",16:"shift",17:"control",18:"control",27:"escape",32:"ok",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",45:"escape",81:"pageup",87:"pagedown",88:"escape",90:"ok",96:"escape",98:"down",100:"left",102:"right",104:"up",120:"debug"},Input.gamepadMapper={0:"ok",1:"cancel",2:"shift",3:"menu",4:"pageup",5:"pagedown",12:"up",13:"down",14:"left",15:"right"},Input.clear=function(){this._currentState={},this._previousState={},this._gamepadStates=[],this._latestButton=null,this._dir8=this._dir4=this._pressedTime=0,this._preferredAxis="",this._date=0},Input.update=function(){for(var t in this._pollGamepads(),this._currentState[this._latestButton]?this._pressedTime++:this._latestButton=null,this._currentState)this._currentState[t]&&!this._previousState[t]&&(this._latestButton=t,this._pressedTime=0,this._date=Date.now()),this._previousState[t]=this._currentState[t];this._updateDirection()},Input.isPressed=function(t){return!(!this._isEscapeCompatible(t)||!this.isPressed("escape"))||!!this._currentState[t]},Input.isTriggered=function(t){return!(!this._isEscapeCompatible(t)||!this.isTriggered("escape"))||this._latestButton===t&&0===this._pressedTime},Input.isRepeated=function(t){return!(!this._isEscapeCompatible(t)||!this.isRepeated("escape"))||this._latestButton===t&&(0===this._pressedTime||this._pressedTime>=this.keyRepeatWait&&0==this._pressedTime%this.keyRepeatInterval)},Input.isLongPressed=function(t){return!(!this._isEscapeCompatible(t)||!this.isLongPressed("escape"))||this._latestButton===t&&this._pressedTime>=this.keyRepeatWait},Object.defineProperty(Input,"dir4",{get:function(){return this._dir4},configurable:!0}),Object.defineProperty(Input,"dir8",{get:function(){return this._dir8},configurable:!0}),Object.defineProperty(Input,"date",{get:function(){return this._date},configurable:!0}),Input._wrapNwjsAlert=function(){if(Utils.isNwjs()){var e=window.alert;window.alert=function(){var t=require("nw.gui").Window.get();e.apply(this,arguments),t.focus(),Input.clear()}}},Input._setupEventHandlers=function(){document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keyup",this._onKeyUp.bind(this)),window.addEventListener("blur",this._onLostFocus.bind(this))},Input._onKeyDown=function(t){this._shouldPreventDefault(t.keyCode)&&t.preventDefault(),144===t.keyCode&&this.clear(),t=this.keyMapper[t.keyCode],ResourceHandler.exists()&&"ok"===t?ResourceHandler.retry():t&&(this._currentState[t]=!0)},Input._shouldPreventDefault=function(t){switch(t){case 8:case 33:case 34:case 37:case 38:case 39:case 40:return!0}return!1},Input._onKeyUp=function(t){var e=this.keyMapper[t.keyCode];e&&(this._currentState[e]=!1),0===t.keyCode&&this.clear()},Input._onLostFocus=function(){this.clear()},Input._pollGamepads=function(){if(navigator.getGamepads){var t=navigator.getGamepads();if(t)for(var e=0;e<t.length;e++){var i=t[e];i&&i.connected&&this._updateGamepadState(i)}}},Input._updateGamepadState=function(t){var e=this._gamepadStates[t.index]||[],i=[],a=t.buttons,n=t.axes;i[12]=!1,i[13]=!1,i[14]=!1,i[15]=!1;for(var o=0;o<a.length;o++)i[o]=a[o].pressed;for(n[1]<-.5?i[12]=!0:.5<n[1]&&(i[13]=!0),n[0]<-.5?i[14]=!0:.5<n[0]&&(i[15]=!0),a=0;a<i.length;a++)i[a]!==e[a]&&(n=this.gamepadMapper[a])&&(this._currentState[n]=i[a]);this._gamepadStates[t.index]=i},Input._updateDirection=function(){var t=this._signX(),e=this._signY();this._dir8=this._makeNumpadDirection(t,e),0!==t&&0!==e?"x"===this._preferredAxis?e=0:t=0:0!==t?this._preferredAxis="y":0!==e&&(this._preferredAxis="x"),this._dir4=this._makeNumpadDirection(t,e)},Input._signX=function(){var t=0;return this.isPressed("left")&&t--,this.isPressed("right")&&t++,t},Input._signY=function(){var t=0;return this.isPressed("up")&&t--,this.isPressed("down")&&t++,t},Input._makeNumpadDirection=function(t,e){return 0!==t||0!==e?5-3*e+t:0},Input._isEscapeCompatible=function(t){return"cancel"===t||"menu"===t},TouchInput.initialize=function(){this.clear(),this._setupEventHandlers()},TouchInput.keyRepeatWait=24,TouchInput.keyRepeatInterval=6,TouchInput.clear=function(){this._screenPressed=this._mousePressed=!1,this._pressedTime=0,this._events={},this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this._released=this._moved=this._cancelled=this._triggered=!1,this._date=this._y=this._x=this._wheelY=this._wheelX=0},TouchInput.update=function(){this._triggered=this._events.triggered,this._cancelled=this._events.cancelled,this._moved=this._events.moved,this._released=this._events.released,this._wheelX=this._events.wheelX,this._wheelY=this._events.wheelY,this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this.isPressed()&&this._pressedTime++},TouchInput.isPressed=function(){return this._mousePressed||this._screenPressed},TouchInput.isTriggered=function(){return this._triggered},TouchInput.isRepeated=function(){return this.isPressed()&&(this._triggered||this._pressedTime>=this.keyRepeatWait&&0==this._pressedTime%this.keyRepeatInterval)},TouchInput.isLongPressed=function(){return this.isPressed()&&this._pressedTime>=this.keyRepeatWait},TouchInput.isCancelled=function(){return this._cancelled},TouchInput.isMoved=function(){return this._moved},TouchInput.isReleased=function(){return this._released},Object.defineProperty(TouchInput,"wheelX",{get:function(){return this._wheelX},configurable:!0}),Object.defineProperty(TouchInput,"wheelY",{get:function(){return this._wheelY},configurable:!0}),Object.defineProperty(TouchInput,"x",{get:function(){return this._x},configurable:!0}),Object.defineProperty(TouchInput,"y",{get:function(){return this._y},configurable:!0}),Object.defineProperty(TouchInput,"date",{get:function(){return this._date},configurable:!0}),TouchInput._setupEventHandlers=function(){var t=Utils.isSupportPassiveEvent();document.addEventListener("mousedown",this._onMouseDown.bind(this)),document.addEventListener("mousemove",this._onMouseMove.bind(this)),document.addEventListener("mouseup",this._onMouseUp.bind(this)),document.addEventListener("wheel",this._onWheel.bind(this)),document.addEventListener("touchstart",this._onTouchStart.bind(this),!!t&&{passive:!1}),document.addEventListener("touchmove",this._onTouchMove.bind(this),!!t&&{passive:!1}),document.addEventListener("touchend",this._onTouchEnd.bind(this)),document.addEventListener("touchcancel",this._onTouchCancel.bind(this)),document.addEventListener("pointerdown",this._onPointerDown.bind(this))},TouchInput._onMouseDown=function(t){0===t.button?this._onLeftButtonDown(t):1===t.button?this._onMiddleButtonDown(t):2===t.button&&this._onRightButtonDown(t)},TouchInput._onLeftButtonDown=function(t){var e=Graphics.pageToCanvasX(t.pageX);t=Graphics.pageToCanvasY(t.pageY),Graphics.isInsideCanvas(e,t)&&(this._mousePressed=!0,this._pressedTime=0,this._onTrigger(e,t))},TouchInput._onMiddleButtonDown=function(t){},TouchInput._onRightButtonDown=function(t){var e=Graphics.pageToCanvasX(t.pageX);t=Graphics.pageToCanvasY(t.pageY),Graphics.isInsideCanvas(e,t)&&this._onCancel(e,t)},TouchInput._onMouseMove=function(t){if(this._mousePressed){var e=Graphics.pageToCanvasX(t.pageX);t=Graphics.pageToCanvasY(t.pageY),this._onMove(e,t)}},TouchInput._onMouseUp=function(t){if(0===t.button){var e=Graphics.pageToCanvasX(t.pageX);t=Graphics.pageToCanvasY(t.pageY),this._mousePressed=!1,this._onRelease(e,t)}},TouchInput._onWheel=function(t){this._events.wheelX+=t.deltaX,this._events.wheelY+=t.deltaY,t.preventDefault()},TouchInput._onTouchStart=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],a=Graphics.pageToCanvasX(i.pageX);i=Graphics.pageToCanvasY(i.pageY),Graphics.isInsideCanvas(a,i)&&(this._screenPressed=!0,this._pressedTime=0,2<=t.touches.length?this._onCancel(a,i):this._onTrigger(a,i),t.preventDefault())}(window.cordova||window.navigator.standalone)&&t.preventDefault()},TouchInput._onTouchMove=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],a=Graphics.pageToCanvasX(i.pageX);i=Graphics.pageToCanvasY(i.pageY),this._onMove(a,i)}},TouchInput._onTouchEnd=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],a=Graphics.pageToCanvasX(i.pageX);i=Graphics.pageToCanvasY(i.pageY),this._screenPressed=!1,this._onRelease(a,i)}},TouchInput._onTouchCancel=function(t){this._screenPressed=!1},TouchInput._onPointerDown=function(t){if("touch"===t.pointerType&&!t.isPrimary){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);Graphics.isInsideCanvas(e,i)&&(this._onCancel(e,i),t.preventDefault())}},TouchInput._onTrigger=function(t,e){this._events.triggered=!0,this._x=t,this._y=e,this._date=Date.now()},TouchInput._onCancel=function(t,e){this._events.cancelled=!0,this._x=t,this._y=e},TouchInput._onMove=function(t,e){this._events.moved=!0,this._x=t,this._y=e},TouchInput._onRelease=function(t,e){this._events.released=!0,this._x=t,this._y=e},Sprite.prototype=Object.create(PIXI.Sprite.prototype),Sprite.prototype.constructor=Sprite,Sprite.voidFilter=new PIXI.filters.AlphaFilter,Sprite.prototype.initialize=function(t){var e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.Sprite.call(this,e),this._bitmap=null,this._frame=new Rectangle,this._realFrame=new Rectangle,this._blendColor=[0,0,0,0],this._colorTone=[0,0,0,0],this._tintTexture=this._context=this._canvas=null,this._isPicture=!1,this.spriteId=Sprite._counter++,this.opaque=!1,this.bitmap=t},Sprite._counter=0,Object.defineProperty(Sprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(t){this._bitmap!==t&&((this._bitmap=t)?(this._refreshFrame=!0,t.addLoadListener(this._onBitmapLoad.bind(this))):(this._refreshFrame=!1,this.texture.frame=Rectangle.emptyRectangle))},configurable:!0}),Object.defineProperty(Sprite.prototype,"width",{get:function(){return this._frame.width},set:function(t){this._frame.width=t,this._refresh()},configurable:!0}),Object.defineProperty(Sprite.prototype,"height",{get:function(){return this._frame.height},set:function(t){this._frame.height=t,this._refresh()},configurable:!0}),Object.defineProperty(Sprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),Sprite.prototype.update=function(){this.children.forEach(function(t){t.update&&t.update()})},Sprite.prototype.move=function(t,e){this.x=t,this.y=e},Sprite.prototype.setFrame=function(t,e,i,a){this._refreshFrame=!1;var n=this._frame;t===n.x&&e===n.y&&i===n.width&&a===n.height||(n.x=t,n.y=e,n.width=i,n.height=a,this._refresh())},Sprite.prototype.getBlendColor=function(){return this._blendColor.clone()},Sprite.prototype.setBlendColor=function(t){if(!(t instanceof Array))throw Error("Argument must be an array");this._blendColor.equals(t)||(this._blendColor=t.clone(),this._refresh())},Sprite.prototype.getColorTone=function(){return this._colorTone.clone()},Sprite.prototype.setColorTone=function(t){if(!(t instanceof Array))throw Error("Argument must be an array");this._colorTone.equals(t)||(this._colorTone=t.clone(),this._refresh())},Sprite.prototype._onBitmapLoad=function(t){t===this._bitmap&&this._refreshFrame&&this._bitmap&&(this._refreshFrame=!1,this._frame.width=this._bitmap.width,this._frame.height=this._bitmap.height),this._refresh()},Sprite.prototype._refresh=function(){var t=Math.floor(this._frame.x),e=Math.floor(this._frame.y),i=Math.floor(this._frame.width),a=Math.floor(this._frame.height),n=this._bitmap?this._bitmap.width:0,o=this._bitmap?this._bitmap.height:0,r=t.clamp(0,n),s=e.clamp(0,o);i=(i-r+t).clamp(0,n-r),a=(a-s+e).clamp(0,o-s),this._realFrame.x=r,this._realFrame.y=s,this._realFrame.width=i,this._realFrame.height=a,this.pivot.x=t-r,this.pivot.y=e-s,0<i&&0<a?this._needsTint()?(this._createTinter(i,a),this._executeTint(r,s,i,a),this._tintTexture.update(),this.texture.baseTexture=this._tintTexture,this.texture.frame=new Rectangle(0,0,i,a)):(this._bitmap&&(this.texture.baseTexture=this._bitmap.baseTexture),this.texture.frame=this._realFrame):this._bitmap?this.texture.frame=Rectangle.emptyRectangle:(this.texture.baseTexture.width=Math.max(this.texture.baseTexture.width,this._frame.x+this._frame.width),this.texture.baseTexture.height=Math.max(this.texture.baseTexture.height,this._frame.y+this._frame.height),this.texture.frame=this._frame),this.texture._updateID++},Sprite.prototype._isInBitmapRect=function(t,e,i,a){return this._bitmap&&0<t+i&&0<e+a&&t<this._bitmap.width&&e<this._bitmap.height},Sprite.prototype._needsTint=function(){var t=this._colorTone;return t[0]||t[1]||t[2]||t[3]||0<this._blendColor[3]},Sprite.prototype._createTinter=function(t,e){this._canvas||(this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d")),this._canvas.width=t,this._canvas.height=e,this._tintTexture||(this._tintTexture=new PIXI.BaseTexture(this._canvas)),this._tintTexture.width=t,this._tintTexture.height=e,this._tintTexture.scaleMode=this._bitmap.baseTexture.scaleMode},Sprite.prototype._executeTint=function(t,e,i,a){var n=this._context,o=this._colorTone,r=this._blendColor;if(n.globalCompositeOperation="copy",n.drawImage(this._bitmap.canvas,t,e,i,a,0,0,i,a),Graphics.canUseSaturationBlend()){var s=Math.max(0,o[3]);n.globalCompositeOperation="saturation",n.fillStyle="rgba(255,255,255,"+s/255+")",n.fillRect(0,0,i,a)}s=Math.max(0,o[0]);var h=Math.max(0,o[1]),p=Math.max(0,o[2]);n.globalCompositeOperation="lighter",n.fillStyle=Utils.rgbToCssColor(s,h,p),n.fillRect(0,0,i,a),Graphics.canUseDifferenceBlend()&&(n.globalCompositeOperation="difference",n.fillStyle="white",n.fillRect(0,0,i,a),s=Math.max(0,-o[0]),h=Math.max(0,-o[1]),o=Math.max(0,-o[2]),n.globalCompositeOperation="lighter",n.fillStyle=Utils.rgbToCssColor(s,h,o),n.fillRect(0,0,i,a),n.globalCompositeOperation="difference",n.fillStyle="white",n.fillRect(0,0,i,a)),o=Math.max(0,r[0]),s=Math.max(0,r[1]),h=Math.max(0,r[2]),r=Math.max(0,r[3]),n.globalCompositeOperation="source-atop",n.fillStyle=Utils.rgbToCssColor(o,s,h),n.globalAlpha=r/255,n.fillRect(0,0,i,a),n.globalCompositeOperation="destination-in",n.globalAlpha=1,n.drawImage(this._bitmap.canvas,t,e,i,a,0,0,i,a)},Sprite.prototype._renderCanvas_PIXI=PIXI.Sprite.prototype._renderCanvas,Sprite.prototype._renderWebGL_PIXI=PIXI.Sprite.prototype._renderWebGL,Sprite.prototype._renderCanvas=function(t){this.bitmap&&this.bitmap.touch(),(!this.bitmap||this.bitmap.isReady())&&0<this.texture.frame.width&&0<this.texture.frame.height&&this._renderCanvas_PIXI(t)},Sprite.prototype._speedUpCustomBlendModes=function(t){var e=t.plugins.picture,i=this.blendMode;if(t.renderingToScreen&&t._activeRenderTarget.root&&e.drawModes[i]){var a=t._lastObjectRendered;(t=a._filters)&&t[0]||setTimeout(function(){var t=a._filters;t&&t[0]||(a.filters=[Sprite.voidFilter],a.filterArea=new PIXI.Rectangle(0,0,Graphics.width,Graphics.height))},0)}},Sprite.prototype._renderWebGL=function(t){this.bitmap&&this.bitmap.touch(),(!this.bitmap||this.bitmap.isReady())&&0<this.texture.frame.width&&0<this.texture.frame.height&&(this._bitmap&&this._bitmap.checkDirty(),this.calculateVertices(),"sprite"===this.pluginName&&this._isPicture?(this._speedUpCustomBlendModes(t),t.setObjectRenderer(t.plugins.picture),t.plugins.picture.render(this)):(t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)))},Tilemap.prototype=Object.create(PIXI.Container.prototype),Tilemap.prototype.constructor=Tilemap,Tilemap.prototype.initialize=function(){PIXI.Container.call(this),this._margin=20,this._width=Graphics.width+2*this._margin,this._height=Graphics.height+2*this._margin,this._tileHeight=this._tileWidth=48,this._mapHeight=this._mapWidth=0,this._mapData=null,this._layerHeight=this._layerWidth=0,this._lastTiles=[],this.bitmaps=[],this.origin=new Point,this.flags=[],this.animationCount=0,this.verticalWrap=this.horizontalWrap=!1,this._createLayers(),this.refresh()},Object.defineProperty(Tilemap.prototype,"width",{get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"height",{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"tileWidth",{get:function(){return this._tileWidth},set:function(t){this._tileWidth!==t&&(this._tileWidth=t,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"tileHeight",{get:function(){return this._tileHeight},set:function(t){this._tileHeight!==t&&(this._tileHeight=t,this._createLayers())}}),Tilemap.prototype.setData=function(t,e,i){this._mapWidth=t,this._mapHeight=e,this._mapData=i},Tilemap.prototype.isReady=function(){for(var t=0;t<this.bitmaps.length;t++)if(this.bitmaps[t]&&!this.bitmaps[t].isReady())return!1;return!0},Tilemap.prototype.update=function(){this.animationCount++,this.animationFrame=Math.floor(this.animationCount/30),this.children.forEach(function(t){t.update&&t.update()});for(var t=0;t<this.bitmaps.length;t++)this.bitmaps[t]&&this.bitmaps[t].touch()},Tilemap.prototype.refresh=function(){this._lastTiles.length=0},Tilemap.prototype.refreshTileset=function(){},Tilemap.prototype.updateTransform=function(){var t=Math.floor((Math.floor(this.origin.x)-this._margin)/this._tileWidth),e=Math.floor((Math.floor(this.origin.y)-this._margin)/this._tileHeight);this._updateLayerPositions(t,e),!this._needsRepaint&&this._lastAnimationFrame===this.animationFrame&&this._lastStartX===t&&this._lastStartY===e||(this._frameUpdated=this._lastAnimationFrame!==this.animationFrame,this._lastAnimationFrame=this.animationFrame,this._lastStartX=t,this._lastStartY=e,this._paintAllTiles(t,e),this._needsRepaint=!1),this._sortChildren(),PIXI.Container.prototype.updateTransform.call(this)},Tilemap.prototype._createLayers=function(){var t=this._width,e=this._height,i=this._margin,a=(Math.ceil(t/this._tileWidth)+1)*this._tileWidth,n=(Math.ceil(e/this._tileHeight)+1)*this._tileHeight;for(this._lowerBitmap=new Bitmap(a,n),this._upperBitmap=new Bitmap(a,n),this._layerWidth=a,this._layerHeight=n,this._lowerLayer=new Sprite,this._lowerLayer.move(-i,-i,t,e),this._lowerLayer.z=0,this._upperLayer=new Sprite,this._upperLayer.move(-i,-i,t,e),this._upperLayer.z=4,t=0;t<4;t++)this._lowerLayer.addChild(new Sprite(this._lowerBitmap)),this._upperLayer.addChild(new Sprite(this._upperBitmap));this.addChild(this._lowerLayer),this.addChild(this._upperLayer)},Tilemap.prototype._updateLayerPositions=function(t,e){e=this._margin;var i=Math.floor(this.origin.y);t=(Math.floor(this.origin.x)-e).mod(this._layerWidth),e=(i-e).mod(this._layerHeight),i=this._layerWidth-t;for(var a=this._layerHeight-e,n=this._width-i,o=this._height-a,r=0;r<2;r++){var s=0===r?this._lowerLayer.children:this._upperLayer.children;s[0].move(0,0,i,a),s[0].setFrame(t,e,i,a),s[1].move(i,0,n,a),s[1].setFrame(0,e,n,a),s[2].move(0,a,i,o),s[2].setFrame(t,0,i,o),s[3].move(i,a,n,o),s[3].setFrame(0,0,n,o)}},Tilemap.prototype._paintAllTiles=function(t,e){for(var i=Math.ceil(this._width/this._tileWidth)+1,a=Math.ceil(this._height/this._tileHeight)+1,n=0;n<a;n++)for(var o=0;o<i;o++)this._paintTiles(t,e,o,n)},Tilemap.prototype._paintTiles=function(t,e,i,a){var n=t+i,o=e+a;e=(n*this._tileWidth).mod(this._layerWidth),a=(o*this._tileHeight).mod(this._layerHeight),t=e/this._tileWidth,i=a/this._tileHeight;var r=this._readMapData(n,o,0),s=this._readMapData(n,o,1),h=this._readMapData(n,o,2),p=this._readMapData(n,o,3),c=this._readMapData(n,o,4),u=this._readMapData(n,o-1,1),l=[],d=[];if(this._isHigherTile(r)?d.push(r):l.push(r),this._isHigherTile(s)?d.push(s):l.push(s),l.push(-c),this._isTableTile(u)&&!this._isTableTile(s)&&(Tilemap.isShadowingTile(r)||l.push(1e4+u)),this._isOverpassPosition(n,o)?(d.push(h),d.push(p)):(this._isHigherTile(h)?d.push(h):l.push(h),this._isHigherTile(p)?d.push(p):l.push(p)),n=this._readLastTiles(0,t,i),!l.equals(n)||Tilemap.isTileA1(r)&&this._frameUpdated){for(this._lowerBitmap.clearRect(e,a,this._tileWidth,this._tileHeight),n=0;n<l.length;n++)(r=l[n])<0?this._drawShadow(this._lowerBitmap,c,e,a):1e4<=r?this._drawTableEdge(this._lowerBitmap,u,e,a):this._drawTile(this._lowerBitmap,r,e,a);this._writeLastTiles(0,t,i,l)}if(c=this._readLastTiles(1,t,i),!d.equals(c)){for(this._upperBitmap.clearRect(e,a,this._tileWidth,this._tileHeight),c=0;c<d.length;c++)this._drawTile(this._upperBitmap,d[c],e,a);this._writeLastTiles(1,t,i,d)}},Tilemap.prototype._readLastTiles=function(t,e,i){return(t=this._lastTiles[t])&&(i=t[i])&&(e=i[e])?e:[]},Tilemap.prototype._writeLastTiles=function(t,e,i,a){var n=this._lastTiles[t];n||(n=this._lastTiles[t]=[]),(t=n[i])||(t=n[i]=[]),t[e]=a},Tilemap.prototype._drawTile=function(t,e,i,a){Tilemap.isVisibleTile(e)&&(Tilemap.isAutotile(e)?this._drawAutotile(t,e,i,a):this._drawNormalTile(t,e,i,a))},Tilemap.prototype._drawNormalTile=function(t,e,i,a){var n=Tilemap.isTileA5(e)?4:5+Math.floor(e/256),o=this._tileWidth,r=this._tileHeight,s=(Math.floor(e/128)%2*8+e%8)*o;e=Math.floor(e%256/8)%16*r,(n=this.bitmaps[n])&&t.bltImage(n,s,e,o,r,i,a,o,r)},Tilemap.prototype._drawAutotile=function(t,e,i,a){var n=Tilemap.FLOOR_AUTOTILE_TABLE,o=Tilemap.getAutotileKind(e),r=Tilemap.getAutotileShape(e),s=o%8,h=Math.floor(o/8),p=0,c=0,u=0,l=!1;if(Tilemap.isTileA1(e)?(e=[0,1,2,1][this.animationFrame%4],(u=0)===o?(p=2*e,c=0):1===o?(p=2*e,c=3):2===o?(p=6,c=0):3===o?(p=6,c=3):(p=8*Math.floor(s/4),c=6*h+Math.floor(s/2)%2*3,0==o%2?p+=2*e:(p+=6,n=Tilemap.WATERFALL_AUTOTILE_TABLE,c+=this.animationFrame%3))):Tilemap.isTileA2(e)?(u=1,p=2*s,c=3*(h-2),l=this._isTableTile(e)):Tilemap.isTileA3(e)?(p=(u=2)*s,c=2*(h-6),n=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(e)&&(u=3,p=2*s,c=Math.floor(2.5*(h-10)+(1==h%2?.5:0)),1==h%2&&(n=Tilemap.WALL_AUTOTILE_TABLE)),n=n[r],u=this.bitmaps[u],n&&u)for(o=this._tileWidth/2,r=this._tileHeight/2,s=0;s<4;s++){var d=(2*p+(h=n[s][0]))*o,m=(2*c+(e=n[s][1]))*r,_=i+s%2*o,f=a+Math.floor(s/2)*r;if(!l||1!==e&&5!==e)t.bltImage(u,d,m,o,r,_,f,o,r);else{var y=h;1===e&&(y=[0,3,2,1][h]),t.bltImage(u,(2*p+y)*o,(2*c+3)*r,o,r,_,f,o,r),f+=r/2,t.bltImage(u,d,m,o,r/2,_,f,o,r/2)}}},Tilemap.prototype._drawTableEdge=function(t,e,i,a){if(Tilemap.isTileA2(e)){var n=Tilemap.FLOOR_AUTOTILE_TABLE,o=Tilemap.getAutotileKind(e),r=Tilemap.getAutotileShape(e);if(e=o%8*2,o=3*(Math.floor(o/8)-2),n=n[r]){r=this.bitmaps[1];for(var s=this._tileWidth/2,h=this._tileHeight/2,p=0;p<2;p++)t.bltImage(r,(2*e+n[2+p][0])*s,(2*o+n[2+p][1])*h+h/2,s,h/2,i+p%2*s,a+Math.floor(p/2)*h,s,h/2)}}},Tilemap.prototype._drawShadow=function(t,e,i,a){if(15&e)for(var n=this._tileWidth/2,o=this._tileHeight/2,r=0;r<4;r++)e&1<<r&&t.fillRect(i+r%2*n,a+Math.floor(r/2)*o,n,o,"rgba(0,0,0,0.5)")},Tilemap.prototype._readMapData=function(t,e,i){if(this._mapData){var a=this._mapWidth,n=this._mapHeight;return this.horizontalWrap&&(t=t.mod(a)),this.verticalWrap&&(e=e.mod(n)),0<=t&&t<a&&0<=e&&e<n&&this._mapData[(i*n+e)*a+t]||0}return 0},Tilemap.prototype._isHigherTile=function(t){return 16&this.flags[t]},Tilemap.prototype._isTableTile=function(t){return Tilemap.isTileA2(t)&&128&this.flags[t]},Tilemap.prototype._isOverpassPosition=function(t,e){return!1},Tilemap.prototype._sortChildren=function(){this.children.sort(this._compareChildOrder.bind(this))},Tilemap.prototype._compareChildOrder=function(t,e){return t.z!==e.z?t.z-e.z:t.y!==e.y?t.y-e.y:t.spriteId-e.spriteId},Tilemap.TILE_ID_B=0,Tilemap.TILE_ID_C=256,Tilemap.TILE_ID_D=512,Tilemap.TILE_ID_E=768,Tilemap.TILE_ID_A5=1536,Tilemap.TILE_ID_A1=2048,Tilemap.TILE_ID_A2=2816,Tilemap.TILE_ID_A3=4352,Tilemap.TILE_ID_A4=5888,Tilemap.TILE_ID_MAX=8192,Tilemap.isVisibleTile=function(t){return 0<t&&t<this.TILE_ID_MAX},Tilemap.isAutotile=function(t){return t>=this.TILE_ID_A1},Tilemap.getAutotileKind=function(t){return Math.floor((t-this.TILE_ID_A1)/48)},Tilemap.getAutotileShape=function(t){return(t-this.TILE_ID_A1)%48},Tilemap.makeAutotileId=function(t,e){return this.TILE_ID_A1+48*t+e},Tilemap.isSameKindTile=function(t,e){return this.isAutotile(t)&&this.isAutotile(e)?this.getAutotileKind(t)===this.getAutotileKind(e):t===e},Tilemap.isTileA1=function(t){return t>=this.TILE_ID_A1&&t<this.TILE_ID_A2},Tilemap.isTileA2=function(t){return t>=this.TILE_ID_A2&&t<this.TILE_ID_A3},Tilemap.isTileA3=function(t){return t>=this.TILE_ID_A3&&t<this.TILE_ID_A4},Tilemap.isTileA4=function(t){return t>=this.TILE_ID_A4&&t<this.TILE_ID_MAX},Tilemap.isTileA5=function(t){return t>=this.TILE_ID_A5&&t<this.TILE_ID_A1},Tilemap.isWaterTile=function(t){return!!this.isTileA1(t)&&!(t>=this.TILE_ID_A1+96&&t<this.TILE_ID_A1+192)},Tilemap.isWaterfallTile=function(t){return t>=this.TILE_ID_A1+192&&t<this.TILE_ID_A2&&1==this.getAutotileKind(t)%2},Tilemap.isGroundTile=function(t){return this.isTileA1(t)||this.isTileA2(t)||this.isTileA5(t)},Tilemap.isShadowingTile=function(t){return this.isTileA3(t)||this.isTileA4(t)},Tilemap.isRoofTile=function(t){return this.isTileA3(t)&&this.getAutotileKind(t)%16<8},Tilemap.isWallTopTile=function(t){return this.isTileA4(t)&&this.getAutotileKind(t)%16<8},Tilemap.isWallSideTile=function(t){return(this.isTileA3(t)||this.isTileA4(t))&&8<=this.getAutotileKind(t)%16},Tilemap.isWallTile=function(t){return this.isWallTopTile(t)||this.isWallSideTile(t)},Tilemap.isFloorTypeAutotile=function(t){return this.isTileA1(t)&&!this.isWaterfallTile(t)||this.isTileA2(t)||this.isWallTopTile(t)},Tilemap.isWallTypeAutotile=function(t){return this.isRoofTile(t)||this.isWallSideTile(t)},Tilemap.isWaterfallTypeAutotile=function(t){return this.isWaterfallTile(t)},Tilemap.FLOOR_AUTOTILE_TABLE=[[[2,4],[1,4],[2,3],[1,3]],[[2,0],[1,4],[2,3],[1,3]],[[2,4],[3,0],[2,3],[1,3]],[[2,0],[3,0],[2,3],[1,3]],[[2,4],[1,4],[2,3],[3,1]],[[2,0],[1,4],[2,3],[3,1]],[[2,4],[3,0],[2,3],[3,1]],[[2,0],[3,0],[2,3],[3,1]],[[2,4],[1,4],[2,1],[1,3]],[[2,0],[1,4],[2,1],[1,3]],[[2,4],[3,0],[2,1],[1,3]],[[2,0],[3,0],[2,1],[1,3]],[[2,4],[1,4],[2,1],[3,1]],[[2,0],[1,4],[2,1],[3,1]],[[2,4],[3,0],[2,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,4],[1,4],[0,3],[1,3]],[[0,4],[3,0],[0,3],[1,3]],[[0,4],[1,4],[0,3],[3,1]],[[0,4],[3,0],[0,3],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[2,2],[1,2],[2,3],[3,1]],[[2,2],[1,2],[2,1],[1,3]],[[2,2],[1,2],[2,1],[3,1]],[[2,4],[3,4],[2,3],[3,3]],[[2,4],[3,4],[2,1],[3,3]],[[2,0],[3,4],[2,3],[3,3]],[[2,0],[3,4],[2,1],[3,3]],[[2,4],[1,4],[2,5],[1,5]],[[2,0],[1,4],[2,5],[1,5]],[[2,4],[3,0],[2,5],[1,5]],[[2,0],[3,0],[2,5],[1,5]],[[0,4],[3,4],[0,3],[3,3]],[[2,2],[1,2],[2,5],[1,5]],[[0,2],[1,2],[0,3],[1,3]],[[0,2],[1,2],[0,3],[3,1]],[[2,2],[3,2],[2,3],[3,3]],[[2,2],[3,2],[2,1],[3,3]],[[2,4],[3,4],[2,5],[3,5]],[[2,0],[3,4],[2,5],[3,5]],[[0,4],[1,4],[0,5],[1,5]],[[0,4],[3,0],[0,5],[1,5]],[[0,2],[3,2],[0,3],[3,3]],[[0,2],[1,2],[0,5],[1,5]],[[0,4],[3,4],[0,5],[3,5]],[[2,2],[3,2],[2,5],[3,5]],[[0,2],[3,2],[0,5],[3,5]],[[0,0],[1,0],[0,1],[1,1]]],Tilemap.WALL_AUTOTILE_TABLE=[[[2,2],[1,2],[2,1],[1,1]],[[0,2],[1,2],[0,1],[1,1]],[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,2],[3,2],[2,1],[3,1]],[[0,2],[3,2],[0,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[0,2],[1,2],[0,3],[1,3]],[[2,0],[1,0],[2,3],[1,3]],[[0,0],[1,0],[0,3],[1,3]],[[2,2],[3,2],[2,3],[3,3]],[[0,2],[3,2],[0,3],[3,3]],[[2,0],[3,0],[2,3],[3,3]],[[0,0],[3,0],[0,3],[3,3]]],Tilemap.WATERFALL_AUTOTILE_TABLE=[[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]]],ShaderTilemap.prototype=Object.create(Tilemap.prototype),ShaderTilemap.prototype.constructor=ShaderTilemap,PIXI.glCore.VertexArrayObject.FORCE_NATIVE=!0,PIXI.settings.GC_MODE=PIXI.GC_MODES.AUTO,PIXI.tilemap.TileRenderer.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,PIXI.tilemap.TileRenderer.DO_CLEAR=!0,ShaderTilemap.prototype._hackRenderer=function(t){var e=this.animationFrame%4;return 3==e&&(e=1),t.plugins.tilemap.tileAnim[0]=e*this._tileWidth,t.plugins.tilemap.tileAnim[1]=this.animationFrame%3*this._tileHeight,t},ShaderTilemap.prototype.renderCanvas=function(t){this._hackRenderer(t),PIXI.Container.prototype.renderCanvas.call(this,t)},ShaderTilemap.prototype.renderWebGL=function(t){this._hackRenderer(t),PIXI.Container.prototype.renderWebGL.call(this,t)},ShaderTilemap.prototype.refresh=function(){this._lastBitmapLength!==this.bitmaps.length&&(this._lastBitmapLength=this.bitmaps.length,this.refreshTileset()),this._needsRepaint=!0},ShaderTilemap.prototype.refreshTileset=function(){var t=this.bitmaps.map(function(t){return t._baseTexture?new PIXI.Texture(t._baseTexture):t});this.lowerLayer.setBitmaps(t),this.upperLayer.setBitmaps(t)},ShaderTilemap.prototype.updateTransform=function(){if(this.roundPixels)var t=Math.floor(this.origin.x),e=Math.floor(this.origin.y);else t=this.origin.x,e=this.origin.y;t=Math.floor((t-this._margin)/this._tileWidth),e=Math.floor((e-this._margin)/this._tileHeight),this._updateLayerPositions(t,e),!this._needsRepaint&&this._lastStartX===t&&this._lastStartY===e||(this._lastStartX=t,this._lastStartY=e,this._paintAllTiles(t,e),this._needsRepaint=!1),this._sortChildren(),PIXI.Container.prototype.updateTransform.call(this)},ShaderTilemap.prototype._createLayers=function(){var t=Math.ceil(this._height/this._tileHeight)+1;this._layerWidth=(Math.ceil(this._width/this._tileWidth)+1)*this._tileWidth,this._layerHeight=t*this._tileHeight,this._needsRepaint=!0,this.lowerZLayer||(this.addChild(this.lowerZLayer=new PIXI.tilemap.ZLayer(this,0)),this.addChild(this.upperZLayer=new PIXI.tilemap.ZLayer(this,4)),t=PluginManager.parameters("ShaderTilemap"),t=Number(t.hasOwnProperty("squareShader")?t.squareShader:0),this.lowerZLayer.addChild(this.lowerLayer=new PIXI.tilemap.CompositeRectTileLayer(0,[],t)),this.lowerLayer.shadowColor=new Float32Array([0,0,0,.5]),this.upperZLayer.addChild(this.upperLayer=new PIXI.tilemap.CompositeRectTileLayer(4,[],t)))},ShaderTilemap.prototype._updateLayerPositions=function(t,e){if(this.roundPixels)var i=Math.floor(this.origin.x),a=Math.floor(this.origin.y);else i=this.origin.x,a=this.origin.y;this.lowerZLayer.position.x=t*this._tileWidth-i,this.lowerZLayer.position.y=e*this._tileHeight-a,this.upperZLayer.position.x=t*this._tileWidth-i,this.upperZLayer.position.y=e*this._tileHeight-a},ShaderTilemap.prototype._paintAllTiles=function(t,e){this.lowerZLayer.clear(),this.upperZLayer.clear();for(var i=Math.ceil(this._width/this._tileWidth)+1,a=Math.ceil(this._height/this._tileHeight)+1,n=0;n<a;n++)for(var o=0;o<i;o++)this._paintTiles(t,e,o,n)},ShaderTilemap.prototype._paintTiles=function(t,e,i,a){t+=i,e+=a,i*=this._tileWidth,a*=this._tileHeight;var n=this._readMapData(t,e,0),o=this._readMapData(t,e,1),r=this._readMapData(t,e,2),s=this._readMapData(t,e,3),h=this._readMapData(t,e,4),p=this._readMapData(t,e-1,1),c=this.lowerLayer.children[0],u=this.upperLayer.children[0];this._isHigherTile(n)?this._drawTile(u,n,i,a):this._drawTile(c,n,i,a),this._isHigherTile(o)?this._drawTile(u,o,i,a):this._drawTile(c,o,i,a),this._drawShadow(c,h,i,a),this._isTableTile(p)&&!this._isTableTile(o)&&(Tilemap.isShadowingTile(n)||this._drawTableEdge(c,p,i,a)),this._isOverpassPosition(t,e)?(this._drawTile(u,r,i,a),this._drawTile(u,s,i,a)):(this._isHigherTile(r)?this._drawTile(u,r,i,a):this._drawTile(c,r,i,a),this._isHigherTile(s)?this._drawTile(u,s,i,a):this._drawTile(c,s,i,a))},ShaderTilemap.prototype._drawTile=function(t,e,i,a){Tilemap.isVisibleTile(e)&&(Tilemap.isAutotile(e)?this._drawAutotile(t,e,i,a):this._drawNormalTile(t,e,i,a))},ShaderTilemap.prototype._drawNormalTile=function(t,e,i,a){var n=Tilemap.isTileA5(e)?4:5+Math.floor(e/256),o=this._tileWidth,r=this._tileHeight;t.addRect(n,(Math.floor(e/128)%2*8+e%8)*o,Math.floor(e%256/8)%16*r,i,a,o,r)},ShaderTilemap.prototype._drawAutotile=function(t,e,i,a){var n=Tilemap.FLOOR_AUTOTILE_TABLE,o=Tilemap.getAutotileKind(e),r=Tilemap.getAutotileShape(e),s=o%8,h=Math.floor(o/8),p=0,c=0,u=0,l=!1,d=0,m=0;for(Tilemap.isTileA1(e)?(u=0)===o?(d=2,c=0):1===o?(d=2,c=3):2===o?(p=6,c=0):3===o?(p=6,c=3):(p=8*Math.floor(s/4),c=6*h+Math.floor(s/2)%2*3,0==o%2?d=2:(p+=6,n=Tilemap.WATERFALL_AUTOTILE_TABLE,m=1)):Tilemap.isTileA2(e)?(u=1,p=2*s,c=3*(h-2),l=this._isTableTile(e)):Tilemap.isTileA3(e)?(p=(u=2)*s,c=2*(h-6),n=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(e)&&(u=3,p=2*s,c=Math.floor(2.5*(h-10)+(1==h%2?.5:0)),1==h%2&&(n=Tilemap.WALL_AUTOTILE_TABLE)),e=n[r],n=this._tileWidth/2,o=this._tileHeight/2,r=0;r<4;r++){var _=(2*p+(s=e[r][0]))*n,f=(2*c+(h=e[r][1]))*o,y=i+r%2*n,g=a+Math.floor(r/2)*o;if(!l||1!==h&&5!==h)t.addRect(u,_,f,y,g,n,o,d,m);else{var w=s;1===h&&(w=(4-s)%4),t.addRect(u,(2*p+w)*n,(2*c+3)*o,y,g,n,o,d,m),t.addRect(u,_,f,y,g+o/2,n,o/2,d,m)}}},ShaderTilemap.prototype._drawTableEdge=function(t,e,i,a){if(Tilemap.isTileA2(e)){var n=Tilemap.FLOOR_AUTOTILE_TABLE,o=Tilemap.getAutotileKind(e),r=Tilemap.getAutotileShape(e);e=o%8*2,o=3*(Math.floor(o/8)-2),n=n[r],r=this._tileWidth/2;for(var s=this._tileHeight/2,h=0;h<2;h++)t.addRect(1,(2*e+n[2+h][0])*r,(2*o+n[2+h][1])*s+s/2,i+h%2*r,a+Math.floor(h/2)*s,r,s/2)}},ShaderTilemap.prototype._drawShadow=function(t,e,i,a){if(15&e)for(var n=this._tileWidth/2,o=this._tileHeight/2,r=0;r<4;r++)e&1<<r&&t.addRect(-1,0,0,i+r%2*n,a+Math.floor(r/2)*o,n,o)},TilingSprite.prototype=Object.create(PIXI.extras.PictureTilingSprite.prototype),TilingSprite.prototype.constructor=TilingSprite,TilingSprite.prototype.initialize=function(t){var e=new PIXI.Texture(new PIXI.BaseTexture);PIXI.extras.PictureTilingSprite.call(this,e),this._bitmap=null,this._height=this._width=0,this._frame=new Rectangle,this.spriteId=Sprite._counter++,this.origin=new Point,this.bitmap=t},TilingSprite.prototype._renderCanvas_PIXI=PIXI.extras.PictureTilingSprite.prototype._renderCanvas,TilingSprite.prototype._renderWebGL_PIXI=PIXI.extras.PictureTilingSprite.prototype._renderWebGL,TilingSprite.prototype._renderCanvas=function(t){this._bitmap&&this._bitmap.touch(),0<this.texture.frame.width&&0<this.texture.frame.height&&this._renderCanvas_PIXI(t)},TilingSprite.prototype._renderWebGL=function(t){this._bitmap&&this._bitmap.touch(),0<this.texture.frame.width&&0<this.texture.frame.height&&(this._bitmap&&this._bitmap.checkDirty(),this._renderWebGL_PIXI(t))},Object.defineProperty(TilingSprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(t){this._bitmap!==t&&((this._bitmap=t)?this._bitmap.addLoadListener(this._onBitmapLoad.bind(this)):this.texture.frame=Rectangle.emptyRectangle)},configurable:!0}),Object.defineProperty(TilingSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),TilingSprite.prototype.update=function(){this.children.forEach(function(t){t.update&&t.update()})},TilingSprite.prototype.move=function(t,e,i,a){this.x=t||0,this.y=e||0,this._width=i||0,this._height=a||0},TilingSprite.prototype.setFrame=function(t,e,i,a){this._frame.x=t,this._frame.y=e,this._frame.width=i,this._frame.height=a,this._refresh()},TilingSprite.prototype.updateTransform=function(){this.tilePosition.x=Math.round(-this.origin.x),this.tilePosition.y=Math.round(-this.origin.y),this.updateTransformTS()},TilingSprite.prototype.updateTransformTS=PIXI.extras.TilingSprite.prototype.updateTransform,TilingSprite.prototype._onBitmapLoad=function(){this.texture.baseTexture=this._bitmap.baseTexture,this._refresh()},TilingSprite.prototype._refresh=function(){var t=this._frame.clone();0===t.width&&0===t.height&&this._bitmap&&(t.width=this._bitmap.width,t.height=this._bitmap.height),this.texture.frame=t,this.texture._updateID++,this.tilingTexture=null},TilingSprite.prototype._speedUpCustomBlendModes=Sprite.prototype._speedUpCustomBlendModes,TilingSprite.prototype._renderWebGL=function(t){this._bitmap&&(this._bitmap.touch(),this._bitmap.checkDirty()),this._speedUpCustomBlendModes(t),this._renderWebGL_PIXI(t)},ScreenSprite.prototype=Object.create(PIXI.Container.prototype),ScreenSprite.prototype.constructor=ScreenSprite,ScreenSprite.prototype.initialize=function(){PIXI.Container.call(this),this._graphics=new PIXI.Graphics,this.addChild(this._graphics),this.opacity=0,this._blue=this._green=this._red=-1,this._colorText="",this.setBlack()},Object.defineProperty(ScreenSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),ScreenSprite.YEPWarned=!1,ScreenSprite.warnYep=function(){ScreenSprite.YEPWarned||(console.log("Deprecation warning. Please update YEP_CoreEngine. ScreenSprite is not a sprite, it has graphics inside."),ScreenSprite.YEPWarned=!0)},Object.defineProperty(ScreenSprite.prototype,"anchor",{get:function(){return ScreenSprite.warnYep(),this.scale.x=1,this.scale.y=1,{x:0,y:0}},set:function(t){this.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(ScreenSprite.prototype,"blendMode",{get:function(){return this._graphics.blendMode},set:function(t){this._graphics.blendMode=t},configurable:!0}),ScreenSprite.prototype.setBlack=function(){this.setColor(0,0,0)},ScreenSprite.prototype.setWhite=function(){this.setColor(255,255,255)},ScreenSprite.prototype.setColor=function(t,e,i){if(this._red!==t||this._green!==e||this._blue!==i){t=Math.round(t||0).clamp(0,255),e=Math.round(e||0).clamp(0,255),i=Math.round(i||0).clamp(0,255),this._red=t,this._green=e,this._blue=i,this._colorText=Utils.rgbToCssColor(t,e,i);var a=this._graphics;a.clear(),a.beginFill(t<<16|e<<8|i,1),a.drawRect(5*-Graphics.width,5*-Graphics.height,10*Graphics.width,10*Graphics.height)}},Window.prototype=Object.create(PIXI.Container.prototype),Window.prototype.constructor=Window,Window.prototype.initialize=function(){PIXI.Container.call(this),this._isWindow=!0,this._windowskin=null,this._height=this._width=0,this._cursorRect=new Rectangle,this._openness=255,this._animationCount=0,this._padding=18,this._margin=4,this._colorTone=[0,0,0],this._windowContentsSprite=this._windowFrameSprite=this._windowCursorSprite=this._windowBackSprite=this._windowSpriteContainer=null,this._windowArrowSprites=[],this._windowPauseSignSprite=null,this._createAllParts(),this.origin=new Point,this.active=!0,this.pause=this.upArrowVisible=this.downArrowVisible=!1},Object.defineProperty(Window.prototype,"windowskin",{get:function(){return this._windowskin},set:function(t){this._windowskin!==t&&(this._windowskin=t,this._windowskin.addLoadListener(this._onWindowskinLoad.bind(this)))},configurable:!0}),Object.defineProperty(Window.prototype,"contents",{get:function(){return this._windowContentsSprite.bitmap},set:function(t){this._windowContentsSprite.bitmap=t},configurable:!0}),Object.defineProperty(Window.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"margin",{get:function(){return this._margin},set:function(t){this._margin=t,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"opacity",{get:function(){return 255*this._windowSpriteContainer.alpha},set:function(t){this._windowSpriteContainer.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"backOpacity",{get:function(){return 255*this._windowBackSprite.alpha},set:function(t){this._windowBackSprite.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"contentsOpacity",{get:function(){return 255*this._windowContentsSprite.alpha},set:function(t){this._windowContentsSprite.alpha=t.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"openness",{get:function(){return this._openness},set:function(t){this._openness!==t&&(this._openness=t.clamp(0,255),this._windowSpriteContainer.scale.y=this._openness/255,this._windowSpriteContainer.y=this.height/2*(1-this._openness/255))},configurable:!0}),Window.prototype.update=function(){this.active&&this._animationCount++,this.children.forEach(function(t){t.update&&t.update()})},Window.prototype.move=function(t,e,i,a){this.x=t||0,this.y=e||0,this._width===i&&this._height===a||(this._width=i||0,this._height=a||0,this._refreshAllParts())},Window.prototype.isOpen=function(){return 255<=this._openness},Window.prototype.isClosed=function(){return this._openness<=0},Window.prototype.setCursorRect=function(t,e,i,a){t=Math.floor(t||0),e=Math.floor(e||0),i=Math.floor(i||0),a=Math.floor(a||0);var n=this._cursorRect;n.x===t&&n.y===e&&n.width===i&&n.height===a||(this._cursorRect.x=t,this._cursorRect.y=e,this._cursorRect.width=i,this._cursorRect.height=a,this._refreshCursor())},Window.prototype.setTone=function(t,e,i){var a=this._colorTone;t===a[0]&&e===a[1]&&i===a[2]||(this._colorTone=[t,e,i],this._refreshBack())},Window.prototype.addChildToBack=function(t){var e=this.children.indexOf(this._windowSpriteContainer);return this.addChildAt(t,e+1)},Window.prototype.updateTransform=function(){this._updateCursor(),this._updateArrows(),this._updatePauseSign(),this._updateContents(),PIXI.Container.prototype.updateTransform.call(this)},Window.prototype._createAllParts=function(){this._windowSpriteContainer=new PIXI.Container,this._windowBackSprite=new Sprite,this._windowCursorSprite=new Sprite,this._windowFrameSprite=new Sprite,this._windowContentsSprite=new Sprite,this._downArrowSprite=new Sprite,this._upArrowSprite=new Sprite,this._windowPauseSignSprite=new Sprite,this._windowBackSprite.bitmap=new Bitmap(1,1),this._windowBackSprite.alpha=192/255,this.addChild(this._windowSpriteContainer),this._windowSpriteContainer.addChild(this._windowBackSprite),this._windowSpriteContainer.addChild(this._windowFrameSprite),this.addChild(this._windowCursorSprite),this.addChild(this._windowContentsSprite),this.addChild(this._downArrowSprite),this.addChild(this._upArrowSprite),this.addChild(this._windowPauseSignSprite)},Window.prototype._onWindowskinLoad=function(){this._refreshAllParts()},Window.prototype._refreshAllParts=function(){this._refreshBack(),this._refreshFrame(),this._refreshCursor(),this._refreshContents(),this._refreshArrows(),this._refreshPauseSign()},Window.prototype._refreshBack=function(){var t=this._margin,e=this._width-2*t,i=this._height-2*t,a=new Bitmap(e,i);if(this._windowBackSprite.bitmap=a,this._windowBackSprite.setFrame(0,0,e,i),this._windowBackSprite.move(t,t),0<e&&0<i&&this._windowskin){for(a.blt(this._windowskin,0,0,96,96,0,0,e,i),t=0;t<i;t+=96)for(var n=0;n<e;n+=96)a.blt(this._windowskin,0,96,96,96,n,t,96,96);e=this._colorTone,a.adjustTone(e[0],e[1],e[2])}},Window.prototype._refreshFrame=function(){var t=this._width,e=this._height,i=new Bitmap(t,e);if(this._windowFrameSprite.bitmap=i,this._windowFrameSprite.setFrame(0,0,t,e),0<t&&0<e&&this._windowskin){var a=this._windowskin;i.blt(a,120,0,48,24,24,0,t-48,24),i.blt(a,120,72,48,24,24,e-24,t-48,24),i.blt(a,96,24,24,48,0,24,24,e-48),i.blt(a,168,24,24,48,t-24,24,24,e-48),i.blt(a,96,0,24,24,0,0,24,24),i.blt(a,168,0,24,24,t-24,0,24,24),i.blt(a,96,72,24,24,0,e-24,24,24),i.blt(a,168,72,24,24,t-24,e-24,24,24)}},Window.prototype._refreshCursor=function(){var t=this._padding,e=this._cursorRect.x+t-this.origin.x,i=this._cursorRect.y+t-this.origin.y,a=this._cursorRect.width,n=this._cursorRect.height,o=Math.max(e,t),r=Math.max(i,t);e-=o,i-=r;var s=Math.min(a,this._width-t-o),h=Math.min(n,this._height-t-r);t=new Bitmap(s,h),this._windowCursorSprite.bitmap=t,this._windowCursorSprite.setFrame(0,0,s,h),this._windowCursorSprite.move(o,r),0<a&&0<n&&this._windowskin&&(o=this._windowskin,t.blt(o,100,100,40,40,e+4,i+4,a-8,n-8),t.blt(o,100,96,40,4,e+4,i+0,a-8,4),t.blt(o,100,140,40,4,e+4,i+n-4,a-8,4),t.blt(o,96,100,4,40,e+0,i+4,4,n-8),t.blt(o,140,100,4,40,e+a-4,i+4,4,n-8),t.blt(o,96,96,4,4,e+0,i+0,4,4),t.blt(o,140,96,4,4,e+a-4,i+0,4,4),t.blt(o,96,140,4,4,e+0,i+n-4,4,4),t.blt(o,140,140,4,4,e+a-4,i+n-4,4,4))},Window.prototype._refreshContents=function(){this._windowContentsSprite.move(this.padding,this.padding)},Window.prototype._refreshArrows=function(){var t=this._width,e=this._height;this._downArrowSprite.bitmap=this._windowskin,this._downArrowSprite.anchor.x=.5,this._downArrowSprite.anchor.y=.5,this._downArrowSprite.setFrame(132,60,24,12),this._downArrowSprite.move(t/2,e-12),this._upArrowSprite.bitmap=this._windowskin,this._upArrowSprite.anchor.x=.5,this._upArrowSprite.anchor.y=.5,this._upArrowSprite.setFrame(132,24,24,12),this._upArrowSprite.move(t/2,12)},Window.prototype._refreshPauseSign=function(){this._windowPauseSignSprite.bitmap=this._windowskin,this._windowPauseSignSprite.anchor.x=.5,this._windowPauseSignSprite.anchor.y=1,this._windowPauseSignSprite.move(this._width/2,this._height),this._windowPauseSignSprite.setFrame(144,96,24,24),this._windowPauseSignSprite.alpha=0},Window.prototype._updateCursor=function(){var t=this._animationCount%40,e=this.contentsOpacity;this.active&&(e=t<20?e-8*t:e-8*(40-t)),this._windowCursorSprite.alpha=e/255,this._windowCursorSprite.visible=this.isOpen()},Window.prototype._updateContents=function(){var t=this._width-2*this._padding,e=this._height-2*this._padding;0<t&&0<e?(this._windowContentsSprite.setFrame(this.origin.x,this.origin.y,t,e),this._windowContentsSprite.visible=this.isOpen()):this._windowContentsSprite.visible=!1},Window.prototype._updateArrows=function(){this._downArrowSprite.visible=this.isOpen()&&this.downArrowVisible,this._upArrowSprite.visible=this.isOpen()&&this.upArrowVisible},Window.prototype._updatePauseSign=function(){var t=this._windowPauseSignSprite,e=Math.floor(this._animationCount/16)%2,i=Math.floor(this._animationCount/16/2)%2;this.pause?t.alpha<1&&(t.alpha=Math.min(t.alpha+.1,1)):t.alpha=0,t.setFrame(144+24*e,96+24*i,24,24),t.visible=this.isOpen()},WindowLayer.prototype=Object.create(PIXI.Container.prototype),WindowLayer.prototype.constructor=WindowLayer,WindowLayer.prototype.initialize=function(){PIXI.Container.call(this),this._height=this._width=0,this._tempCanvas=null,this._translationMatrix=[1,0,0,0,1,0,0,0,1],this._windowMask=new PIXI.Graphics,this._windowMask.beginFill(16777215,1),this._windowMask.drawRect(0,0,0,0),this._windowMask.endFill(),this._windowRect=this._windowMask.graphicsData[0].shape,this._renderSprite=null,this.filterArea=new PIXI.Rectangle,this.filters=[WindowLayer.voidFilter],this.on("removed",this.onRemoveAsAChild)},WindowLayer.prototype.onRemoveAsAChild=function(){this.removeChildren()},WindowLayer.voidFilter=new PIXI.filters.AlphaFilter,Object.defineProperty(WindowLayer.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},configurable:!0}),Object.defineProperty(WindowLayer.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},configurable:!0}),WindowLayer.prototype.move=function(t,e,i,a){this.x=t,this.y=e,this.width=i,this.height=a},WindowLayer.prototype.update=function(){this.children.forEach(function(t){t.update&&t.update()})},WindowLayer.prototype.renderCanvas=function(t){if(this.visible&&this.renderable){this._tempCanvas||(this._tempCanvas=document.createElement("canvas")),this._tempCanvas.width=Graphics.width,this._tempCanvas.height=Graphics.height;var e=t.context,i=this._tempCanvas.getContext("2d");i.save(),i.clearRect(0,0,Graphics.width,Graphics.height),i.beginPath(),i.rect(this.x,this.y,this.width,this.height),i.closePath(),i.clip(),t.context=i;for(var a=0;a<this.children.length;a++){var n=this.children[a];n._isWindow&&n.visible&&0<n.openness&&(this._canvasClearWindowRect(t,n),i.save(),n.renderCanvas(t),i.restore())}for(i.restore(),t.context=e,t.context.setTransform(1,0,0,1,0,0),t.context.globalCompositeOperation="source-over",t.context.globalAlpha=1,t.context.drawImage(this._tempCanvas,0,0),e=0;e<this.children.length;e++)this.children[e]._isWindow||this.children[e].renderCanvas(t)}},WindowLayer.prototype._canvasClearWindowRect=function(t,e){t.context.clearRect(this.x+e.x,this.y+e.y+e.height/2*(1-e._openness/255),e.width,e.height*e._openness/255)},WindowLayer.prototype.renderWebGL=function(t){if(this.visible&&this.renderable&&0!=this.children.length){t.flush(),this.filterArea.copy(this),t.filterManager.pushFilter(this,this.filters),t.currentRenderer.start();var e=new PIXI.Point,i=t._activeRenderTarget,a=i.projectionMatrix;for(e.x=Math.round((a.tx+1)/2*i.sourceFrame.width),e.y=Math.round((a.ty+1)/2*i.sourceFrame.height),i=0;i<this.children.length;i++)(a=this.children[i])._isWindow&&a.visible&&0<a.openness&&(this._maskWindow(a,e),t.maskManager.pushScissorMask(this,this._windowMask),t.clear(),t.maskManager.popScissorMask(),t.currentRenderer.start(),a.renderWebGL(t),t.currentRenderer.flush());for(t.flush(),t.filterManager.popFilter(),t.maskManager.popScissorMask(),e=0;e<this.children.length;e++)this.children[e]._isWindow||this.children[e].renderWebGL(t)}},WindowLayer.prototype._maskWindow=function(t,e){this._windowMask._currentBounds=null,this._windowMask.boundsDirty=!0;var i=this._windowRect;i.x=this.x+e.x+t.x,i.y=this.x+e.y+t.y+t.height/2*(1-t._openness/255),i.width=t.width,i.height=t.height*t._openness/255},Weather.prototype=Object.create(PIXI.Container.prototype),Weather.prototype.constructor=Weather,Weather.prototype.initialize=function(){PIXI.Container.call(this),this._width=Graphics.width,this._height=Graphics.height,this._sprites=[],this._createBitmaps(),this._createDimmer(),this.type="none",this.power=0,this.origin=new Point},Weather.prototype.update=function(){this._updateDimmer(),this._updateAllSprites()},Weather.prototype._createBitmaps=function(){this._rainBitmap=new Bitmap(1,60),this._rainBitmap.fillAll("white"),this._stormBitmap=new Bitmap(2,100),this._stormBitmap.fillAll("white"),this._snowBitmap=new Bitmap(9,9),this._snowBitmap.drawCircle(4,4,4,"white")},Weather.prototype._createDimmer=function(){this._dimmerSprite=new ScreenSprite,this._dimmerSprite.setColor(80,80,80),this.addChild(this._dimmerSprite)},Weather.prototype._updateDimmer=function(){this._dimmerSprite.opacity=Math.floor(6*this.power)},Weather.prototype._updateAllSprites=function(){for(var t=Math.floor(10*this.power);this._sprites.length<t;)this._addSprite();for(;this._sprites.length>t;)this._removeSprite();this._sprites.forEach(function(t){this._updateSprite(t),t.x=t.ax-this.origin.x,t.y=t.ay-this.origin.y},this)},Weather.prototype._addSprite=function(){var t=new Sprite(this.viewport);t.opacity=0,this._sprites.push(t),this.addChild(t)},Weather.prototype._removeSprite=function(){this.removeChild(this._sprites.pop())},Weather.prototype._updateSprite=function(t){switch(this.type){case"rain":this._updateRainSprite(t);break;case"storm":this._updateStormSprite(t);break;case"snow":this._updateSnowSprite(t)}t.opacity<40&&this._rebornSprite(t)},Weather.prototype._updateRainSprite=function(t){t.bitmap=this._rainBitmap,t.rotation=Math.PI/16,t.ax-=6*Math.sin(t.rotation),t.ay+=6*Math.cos(t.rotation),t.opacity-=6},Weather.prototype._updateStormSprite=function(t){t.bitmap=this._stormBitmap,t.rotation=Math.PI/8,t.ax-=8*Math.sin(t.rotation),t.ay+=8*Math.cos(t.rotation),t.opacity-=8},Weather.prototype._updateSnowSprite=function(t){t.bitmap=this._snowBitmap,t.rotation=Math.PI/16,t.ax-=3*Math.sin(t.rotation),t.ay+=3*Math.cos(t.rotation),t.opacity-=3},Weather.prototype._rebornSprite=function(t){t.ax=Math.randomInt(Graphics.width+100)-100+this.origin.x,t.ay=Math.randomInt(Graphics.height+200)-200+this.origin.y,t.opacity=160+Math.randomInt(60)},ToneFilter.prototype=Object.create(PIXI.filters.ColorMatrixFilter.prototype),ToneFilter.prototype.constructor=ToneFilter,ToneFilter.prototype.adjustHue=function(t){this.hue(t,!0)},ToneFilter.prototype.adjustSaturation=function(t){t=(t||0).clamp(-255,255)/255,this.saturate(t,!0)},ToneFilter.prototype.adjustTone=function(t,e,i){t=(t||0).clamp(-255,255)/255,e=(e||0).clamp(-255,255)/255,i=(i||0).clamp(-255,255)/255,0===t&&0===e&&0===i||this._loadMatrix([1,0,0,t,0,0,1,0,e,0,0,0,1,i,0,0,0,0,1,0],!0)},ToneSprite.prototype=Object.create(PIXI.Container.prototype),ToneSprite.prototype.constructor=ToneSprite,ToneSprite.prototype.initialize=function(){PIXI.Container.call(this),this.clear()},ToneSprite.prototype.clear=function(){this._gray=this._blue=this._green=this._red=0},ToneSprite.prototype.setTone=function(t,e,i,a){this._red=Math.round(t||0).clamp(-255,255),this._green=Math.round(e||0).clamp(-255,255),this._blue=Math.round(i||0).clamp(-255,255),this._gray=Math.round(a||0).clamp(0,255)},ToneSprite.prototype._renderCanvas=function(t){if(this.visible){var e=t.context,i=this.worldTransform,a=t.resolution;t=Graphics.width;var n=Graphics.height;e.save(),e.setTransform(i.a,i.b,i.c,i.d,i.tx*a,i.ty*a),Graphics.canUseSaturationBlend()&&0<this._gray&&(e.globalCompositeOperation="saturation",e.globalAlpha=this._gray/255,e.fillStyle="#ffffff",e.fillRect(0,0,t,n)),e.globalAlpha=1,i=Math.max(0,this._red),a=Math.max(0,this._green);var o=Math.max(0,this._blue);(i||a||o)&&(e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(i,a,o),e.fillRect(0,0,t,n)),Graphics.canUseDifferenceBlend()&&(i=Math.max(0,-this._red),a=Math.max(0,-this._green),o=Math.max(0,-this._blue),i||a||o)&&(e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,t,n),e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(i,a,o),e.fillRect(0,0,t,n),e.globalCompositeOperation="difference",e.fillStyle="#ffffff",e.fillRect(0,0,t,n)),e.restore()}},ToneSprite.prototype._renderWebGL=function(t){},Stage.prototype=Object.create(PIXI.Container.prototype),Stage.prototype.constructor=Stage,Stage.prototype.initialize=function(){PIXI.Container.call(this),this.interactive=!1},WebAudio._standAlone=function(t){return!t.ResourceHandler}(this),WebAudio.prototype.initialize=function(t){WebAudio._initialized||WebAudio.initialize(),this.clear(),WebAudio._standAlone||(this._loader=ResourceHandler.createLoader(t,this._load.bind(this,t),function(){this._hasError=!0}.bind(this))),this._load(t),this._url=t},WebAudio._masterVolume=1,WebAudio._context=null,WebAudio._masterGainNode=null,WebAudio._initialized=!1,WebAudio._unlocked=!1,WebAudio.initialize=function(t){return this._initialized||(t||(this._createContext(),this._detectCodecs(),this._createMasterGainNode(),this._setupEventHandlers()),this._initialized=!0),!!this._context},WebAudio.canPlayOgg=function(){return this._initialized||this.initialize(),!!this._canPlayOgg},WebAudio.canPlayM4a=function(){return this._initialized||this.initialize(),!!this._canPlayM4a},WebAudio.setMasterVolume=function(t){this._masterVolume=t,this._masterGainNode&&this._masterGainNode.gain.setValueAtTime(this._masterVolume,this._context.currentTime)},WebAudio._createContext=function(){try{"undefined"!=typeof AudioContext?this._context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this._context=new webkitAudioContext)}catch(t){this._context=null}},WebAudio._detectCodecs=function(){var t=document.createElement("audio");t.canPlayType&&(this._canPlayOgg=t.canPlayType("audio/ogg"),this._canPlayM4a=t.canPlayType("audio/mp4"))},WebAudio._createMasterGainNode=function(){var t=WebAudio._context;t&&(this._masterGainNode=t.createGain(),this._masterGainNode.gain.setValueAtTime(this._masterVolume,t.currentTime),this._masterGainNode.connect(t.destination))},WebAudio._setupEventHandlers=function(){function t(){var t=WebAudio._context;t&&"suspended"===t.state&&"function"==typeof t.resume?t.resume().then(function(){WebAudio._onTouchStart()}):WebAudio._onTouchStart()}document.addEventListener("keydown",t),document.addEventListener("mousedown",t),document.addEventListener("touchend",t),document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this))},WebAudio._onTouchStart=function(){var t=WebAudio._context;t&&!this._unlocked&&(t.createBufferSource().start(0),this._unlocked=!0)},WebAudio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()},WebAudio._onHide=function(){this._shouldMuteOnHide()&&this._fadeOut(1)},WebAudio._onShow=function(){this._shouldMuteOnHide()&&this._fadeIn(.5)},WebAudio._shouldMuteOnHide=function(){return Utils.isMobileDevice()},WebAudio._fadeIn=function(t){if(this._masterGainNode){var e=this._masterGainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(0,i),e.linearRampToValueAtTime(this._masterVolume,i+t)}},WebAudio._fadeOut=function(t){if(this._masterGainNode){var e=this._masterGainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(this._masterVolume,i),e.linearRampToValueAtTime(0,i+t)}},WebAudio.prototype.clear=function(){this.stop(),this._pannerNode=this._gainNode=this._sourceNode=this._buffer=null,this._startTime=this._loopLength=this._loopStart=this._sampleRate=this._totalTime=0,this._pitch=this._volume=1,this._pan=0,this._endTimer=null,this._loadListeners=[],this._stopListeners=[],this._autoPlay=this._hasError=!1},Object.defineProperty(WebAudio.prototype,"url",{get:function(){return this._url},configurable:!0}),Object.defineProperty(WebAudio.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this._gainNode&&this._gainNode.gain.setValueAtTime(this._volume,WebAudio._context.currentTime)},configurable:!0}),Object.defineProperty(WebAudio.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._pitch!==t&&(this._pitch=t,this.isPlaying()&&this.play(this._sourceNode.loop,0))},configurable:!0}),Object.defineProperty(WebAudio.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan=t,this._updatePanner()},configurable:!0}),WebAudio.prototype.isReady=function(){return!!this._buffer},WebAudio.prototype.isError=function(){return this._hasError},WebAudio.prototype.isPlaying=function(){return!!this._sourceNode},WebAudio.prototype.play=function(t,e){this.isReady()?(e=e||0,this._startPlaying(t,e)):WebAudio._context&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&this.play(t,e)}.bind(this)))},WebAudio.prototype.stop=function(){if(this._autoPlay=!1,this._removeEndTimer(),this._removeNodes(),this._stopListeners)for(;0<this._stopListeners.length;)this._stopListeners.shift()()},WebAudio.prototype.fadeIn=function(t){if(this.isReady()){if(this._gainNode){var e=this._gainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(0,i),e.linearRampToValueAtTime(this._volume,i+t)}}else this._autoPlay&&this.addLoadListener(function(){this.fadeIn(t)}.bind(this))},WebAudio.prototype.fadeOut=function(t){if(this._gainNode){var e=this._gainNode.gain,i=WebAudio._context.currentTime;e.setValueAtTime(this._volume,i),e.linearRampToValueAtTime(0,i+t)}this._autoPlay=!1},WebAudio.prototype.seek=function(){if(WebAudio._context){var t=(WebAudio._context.currentTime-this._startTime)*this._pitch;if(0<this._loopLength)for(;t>=this._loopStart+this._loopLength;)t-=this._loopLength;return t}return 0},WebAudio.prototype.addLoadListener=function(t){this._loadListeners.push(t)},WebAudio.prototype.addStopListener=function(t){this._stopListeners.push(t)},WebAudio.prototype._load=function(t){if(WebAudio._context){var e=new XMLHttpRequest;Decrypter.hasEncryptedAudio&&(t=Decrypter.extToEncryptExt(t)),e.open("GET",t),e.responseType="arraybuffer",e.onload=function(){e.status<400&&this._onXhrLoad(e)}.bind(this),e.onerror=this._loader||function(){this._hasError=!0}.bind(this),e.send()}},WebAudio.prototype._onXhrLoad=function(t){t=t.response,Decrypter.hasEncryptedAudio&&(t=Decrypter.decryptArrayBuffer(t)),this._readLoopComments(new Uint8Array(t)),WebAudio._context.decodeAudioData(t,function(t){this._buffer=t,this._totalTime=t.duration,0<this._loopLength&&0<this._sampleRate?(this._loopStart/=this._sampleRate,this._loopLength/=this._sampleRate):(this._loopStart=0,this._loopLength=this._totalTime),this._onLoad()}.bind(this))},WebAudio.prototype._startPlaying=function(t,e){if(0<this._loopLength)for(;e>=this._loopStart+this._loopLength;)e-=this._loopLength;this._removeEndTimer(),this._removeNodes(),this._createNodes(),this._connectNodes(),this._sourceNode.loop=t,this._sourceNode.start(0,e),this._startTime=WebAudio._context.currentTime-e/this._pitch,this._createEndTimer()},WebAudio.prototype._createNodes=function(){var t=WebAudio._context;this._sourceNode=t.createBufferSource(),this._sourceNode.buffer=this._buffer,this._sourceNode.loopStart=this._loopStart,this._sourceNode.loopEnd=this._loopStart+this._loopLength,this._sourceNode.playbackRate.setValueAtTime(this._pitch,t.currentTime),this._gainNode=t.createGain(),this._gainNode.gain.setValueAtTime(this._volume,t.currentTime),this._pannerNode=t.createPanner(),this._pannerNode.panningModel="equalpower",this._updatePanner()},WebAudio.prototype._connectNodes=function(){this._sourceNode.connect(this._gainNode),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(WebAudio._masterGainNode)},WebAudio.prototype._removeNodes=function(){this._sourceNode&&(this._sourceNode.stop(0),this._pannerNode=this._gainNode=this._sourceNode=null)},WebAudio.prototype._createEndTimer=function(){if(this._sourceNode&&!this._sourceNode.loop){var t=this._startTime+this._totalTime/this._pitch-WebAudio._context.currentTime;this._endTimer=setTimeout(function(){this.stop()}.bind(this),1e3*t)}},WebAudio.prototype._removeEndTimer=function(){this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null)},WebAudio.prototype._updatePanner=function(){if(this._pannerNode){var t=this._pan;this._pannerNode.setPosition(t,0,1-Math.abs(t))}},WebAudio.prototype._onLoad=function(){for(;0<this._loadListeners.length;)this._loadListeners.shift()()},WebAudio.prototype._readLoopComments=function(t){this._readOgg(t),this._readMp4(t)},WebAudio.prototype._readOgg=function(t){for(var e=0;e<t.length&&"OggS"===this._readFourCharacters(t,e);){e+=26;for(var i=!1,a=t[e++],n=[],o=0;o<a;o++)n.push(t[e++]);for(o=0;o<a;o++)"vorb"===this._readFourCharacters(t,e+1)&&(1===(i=t[e])?this._sampleRate=this._readLittleEndian(t,e+12):3===i&&this._readMetaData(t,e,n[o]),i=!0),e+=n[o];if(!i)break}},WebAudio.prototype._readMp4=function(t){if("ftyp"===this._readFourCharacters(t,4))for(var e=0;e<t.length;){var i=this._readBigEndian(t,e),a=this._readFourCharacters(t,e+4);if("moov"===a)e+=8;else if("mvhd"===a&&(this._sampleRate=this._readBigEndian(t,e+20)),"udta"!==a&&"meta"!==a||this._readMetaData(t,e,i),e+=i,i<=1)break}},WebAudio.prototype._readMetaData=function(t,e,i){for(var a=e;a<e+i-10;a++)if("LOOP"===this._readFourCharacters(t,a)){for(var n="";0<t[a];)n+=String.fromCharCode(t[a++]);if(n.match(/LOOPSTART=([0-9]+)/)&&(this._loopStart=parseInt(RegExp.$1)),n.match(/LOOPLENGTH=([0-9]+)/)&&(this._loopLength=parseInt(RegExp.$1)),"LOOPSTART"==n||"LOOPLENGTH"==n){var o="";for(a+=16;0<t[a];)o+=String.fromCharCode(t[a++]);"LOOPSTART"==n?this._loopStart=parseInt(o):this._loopLength=parseInt(o)}}},WebAudio.prototype._readLittleEndian=function(t,e){return 16777216*t[e+3]+65536*t[e+2]+256*t[e+1]+t[e+0]},WebAudio.prototype._readBigEndian=function(t,e){return 16777216*t[e+0]+65536*t[e+1]+256*t[e+2]+t[e+3]},WebAudio.prototype._readFourCharacters=function(t,e){for(var i="",a=0;a<4;a++)i+=String.fromCharCode(t[e+a]);return i},Html5Audio._initialized=!1,Html5Audio._unlocked=!1,Html5Audio._audioElement=null,Html5Audio._gainTweenInterval=null,Html5Audio._tweenGain=0,Html5Audio._tweenTargetGain=0,Html5Audio._tweenGainStep=0,Html5Audio._staticSePath=null,Html5Audio.setup=function(t){this._initialized||this.initialize(),this.clear(),Decrypter.hasEncryptedAudio&&this._audioElement.src&&window.URL.revokeObjectURL(this._audioElement.src),this._url=t},Html5Audio.initialize=function(){if(!this._initialized){if(!this._audioElement)try{this._audioElement=new Audio}catch(t){this._audioElement=null}this._audioElement&&this._setupEventHandlers(),this._initialized=!0}return!!this._audioElement},Html5Audio._setupEventHandlers=function(){document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this)),this._audioElement.addEventListener("loadeddata",this._onLoadedData.bind(this)),this._audioElement.addEventListener("error",this._onError.bind(this)),this._audioElement.addEventListener("ended",this._onEnded.bind(this))},Html5Audio._onTouchStart=function(){this._audioElement&&!this._unlocked&&(this._isLoading?(this._load(this._url),this._unlocked=!0):this._staticSePath&&(this._audioElement.src=this._staticSePath,this._audioElement.volume=0,this._audioElement.loop=!1,this._audioElement.play(),this._unlocked=!0))},Html5Audio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()},Html5Audio._onLoadedData=function(){this._buffered=!0,this._unlocked&&this._onLoad()},Html5Audio._onError=function(){this._hasError=!0},Html5Audio._onEnded=function(){this._audioElement.loop||this.stop()},Html5Audio._onHide=function(){this._tweenGain=this._audioElement.volume=0},Html5Audio._onShow=function(){this.fadeIn(.5)},Html5Audio.clear=function(){this.stop(),this._volume=1,this._loadListeners=[],this._buffered=this._isLoading=this._autoPlay=this._hasError=!1},Html5Audio.setStaticSe=function(t){this._initialized||(this.initialize(),this.clear()),this._staticSePath=t},Object.defineProperty(Html5Audio,"url",{get:function(){return Html5Audio._url},configurable:!0}),Object.defineProperty(Html5Audio,"volume",{get:function(){return Html5Audio._volume}.bind(this),set:function(t){Html5Audio._volume=t,Html5Audio._audioElement&&(Html5Audio._audioElement.volume=this._volume)},configurable:!0}),Html5Audio.isReady=function(){return this._buffered},Html5Audio.isError=function(){return this._hasError},Html5Audio.isPlaying=function(){return!this._audioElement.paused},Html5Audio.play=function(t,e){this.isReady()?(e=e||0,this._startPlaying(t,e)):Html5Audio._audioElement&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&(this.play(t,e),this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null))}.bind(this)),this._isLoading||this._load(this._url))},Html5Audio.stop=function(){this._audioElement&&this._audioElement.pause(),this._autoPlay=!1,this._tweenInterval&&(clearInterval(this._tweenInterval),this._tweenInterval=null,this._audioElement.volume=0)},Html5Audio.fadeIn=function(t){this.isReady()?this._audioElement&&(this._tweenTargetGain=this._volume,this._tweenGain=0,this._startGainTween(t)):this._autoPlay&&this.addLoadListener(function(){this.fadeIn(t)}.bind(this))},Html5Audio.fadeOut=function(t){this._audioElement&&(this._tweenTargetGain=0,this._tweenGain=this._volume,this._startGainTween(t))},Html5Audio.seek=function(){return this._audioElement?this._audioElement.currentTime:0},Html5Audio.addLoadListener=function(t){this._loadListeners.push(t)},Html5Audio._load=function(t){this._audioElement&&(this._isLoading=!0,this._audioElement.src=t,this._audioElement.load())},Html5Audio._startPlaying=function(t,e){this._audioElement.loop=t,this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null),this._audioElement&&(this._audioElement.volume=this._volume,this._audioElement.currentTime=e,this._audioElement.play())},Html5Audio._onLoad=function(){for(this._isLoading=!1;0<this._loadListeners.length;)this._loadListeners.shift()()},Html5Audio._startGainTween=function(t){this._audioElement.volume=this._tweenGain,this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null),this._tweenGainStep=(this._tweenTargetGain-this._tweenGain)/(60*t),this._gainTweenInterval=setInterval(function(){Html5Audio._applyTweenValue(Html5Audio._tweenTargetGain)},1e3/60)},Html5Audio._applyTweenValue=function(t){Html5Audio._tweenGain+=Html5Audio._tweenGainStep,Html5Audio._tweenGain<0&&Html5Audio._tweenGainStep<0?Html5Audio._tweenGain=0:Html5Audio._tweenGain>t&&0<Html5Audio._tweenGainStep&&(Html5Audio._tweenGain=t),Math.abs(Html5Audio._tweenTargetGain-Html5Audio._tweenGain)<.01&&(Html5Audio._tweenGain=Html5Audio._tweenTargetGain,clearInterval(Html5Audio._gainTweenInterval),Html5Audio._gainTweenInterval=null),Html5Audio._audioElement.volume=Html5Audio._tweenGain},JsonEx.maxDepth=100,JsonEx._id=1,JsonEx._generateId=function(){return JsonEx._id++},JsonEx.stringify=function(t){var e=[];JsonEx._id=1;var i=JSON.stringify(this._encode(t,e,0));return this._cleanMetadata(t),this._restoreCircularReference(e),i},JsonEx._restoreCircularReference=function(t){t.forEach(function(t){t[1][t[0]]=t[2]})},JsonEx.parse=function(t){var e=[],i={};return t=this._decode(JSON.parse(t),e,i),this._cleanMetadata(t),this._linkCircularReference(t,e,i),t},JsonEx._linkCircularReference=function(t,e,i){e.forEach(function(t){t[1][t[0]]=i[t[2]]})},JsonEx._cleanMetadata=function(e){e&&(delete e["@"],delete e["@c"],"object"==typeof e&&Object.keys(e).forEach(function(t){"object"==typeof(t=e[t])&&JsonEx._cleanMetadata(t)}))},JsonEx.makeDeepCopy=function(t){return this.parse(this.stringify(t))},JsonEx._encode=function(t,e,i){if(i=i||0,++i>=this.maxDepth)throw Error("Object too deep");var a=Object.prototype.toString.call(t);if("[object Object]"===a||"[object Array]"===a)for(var n in t["@c"]=JsonEx._generateId(),"Object"!==(a=this._getConstructorName(t))&&"Array"!==a&&(t["@"]=a),t)t.hasOwnProperty(n)&&!n.match(/^@./)&&(t[n]&&"object"==typeof t[n]?t[n]["@c"]?(e.push([n,t,t[n]]),t[n]={"@r":t[n]["@c"]}):(t[n]=this._encode(t[n],e,i+1),t[n]instanceof Array&&(e.push([n,t,t[n]]),t[n]={"@c":t[n]["@c"],"@a":t[n]})):t[n]=this._encode(t[n],e,i+1));return t},JsonEx._decode=function(t,e,i){var a=Object.prototype.toString.call(t);if("[object Object]"===a||"[object Array]"===a)for(var n in(i[t["@c"]]=t)["@"]&&(a=window[t["@"]])&&(t=this._resetPrototype(t,a.prototype)),t)t.hasOwnProperty(n)&&(t[n]&&t[n]["@a"]&&((a=t[n]["@a"])["@c"]=t[n]["@c"],t[n]=a),t[n]&&t[n]["@r"]&&e.push([n,t,t[n]["@r"]]),t[n]=this._decode(t[n],e,i));return t},JsonEx._getConstructorName=function(t){var e=t.constructor.name;return void 0===e&&(e=/^\s*function\s*([A-Za-z0-9_$]*)/.exec(t.constructor)[1]),e},JsonEx._resetPrototype=function(t,e){if(void 0!==Object.setPrototypeOf)Object.setPrototypeOf(t,e);else if("__proto__"in t)t.__proto__=e;else{for(var i in e=Object.create(e),t)t.hasOwnProperty(i)&&(e[i]=t[i]);t=e}return t},Decrypter.hasEncryptedImages=!1,Decrypter.hasEncryptedAudio=!1,Decrypter._requestImgFile=[],Decrypter._headerlength=16,Decrypter._xhrOk=400,Decrypter._encryptionKey="",Decrypter._ignoreList=["img/system/Window.png"],Decrypter.SIGNATURE="5250474d56000000",Decrypter.VER="000301",Decrypter.REMAIN="0000000000",Decrypter.checkImgIgnore=function(t){for(var e=0;e<this._ignoreList.length;e++)if(t===this._ignoreList[e])return!0;return!1},Decrypter.decryptImg=function(t,e){t=this.extToEncryptExt(t);var i=new XMLHttpRequest;i.open("GET",t),i.responseType="arraybuffer",i.send(),i.onload=function(){if(this.status<Decrypter._xhrOk){var t=Decrypter.decryptArrayBuffer(i.response);e._image.src=Decrypter.createBlobUrl(t),e._image.addEventListener("load",e._loadListener=Bitmap.prototype._onLoad.bind(e)),e._image.addEventListener("error",e._errorListener=e._loader||Bitmap.prototype._onError.bind(e))}},i.onerror=function(){e._loader?e._loader():e._onError()}},Decrypter.decryptHTML5Audio=function(t,e,i){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="arraybuffer",a.send(),a.onload=function(){if(this.status<Decrypter._xhrOk){var t=Decrypter.decryptArrayBuffer(a.response);t=Decrypter.createBlobUrl(t),AudioManager.createDecryptBuffer(t,e,i)}}},Decrypter.cutArrayHeader=function(t,e){return t.slice(e)},Decrypter.decryptArrayBuffer=function(t){if(!t)return null;var e,i=new Uint8Array(t,0,this._headerlength),a=this.SIGNATURE+this.VER+this.REMAIN,n=new Uint8Array(16);for(e=0;e<this._headerlength;e++)n[e]=parseInt("0x"+a.substr(2*e,2),16);for(e=0;e<this._headerlength;e++)if(i[e]!==n[e])throw Error("Header is wrong");if(t=this.cutArrayHeader(t,Decrypter._headerlength),i=new DataView(t),this.readEncryptionkey(),t)for(a=new Uint8Array(t),e=0;e<this._headerlength;e++)a[e]^=parseInt(Decrypter._encryptionKey[e],16),i.setUint8(e,a[e]);return t},Decrypter.createBlobUrl=function(t){return t=new Blob([t]),window.URL.createObjectURL(t)},Decrypter.extToEncryptExt=function(t){var e=t.split(".").pop(),i="ogg"===e?".rpgmvo":"m4a"===e?".rpgmvm":"png"===e?".rpgmvp":e;return t.slice(0,t.lastIndexOf(e)-1)+i},Decrypter.readEncryptionkey=function(){this._encryptionKey=game_outschool.encryptionKey().split(/(.{2})/).filter(Boolean)},ResourceHandler._reloaders=[],ResourceHandler._defaultRetryInterval=[500,1e3,3e3],ResourceHandler.createLoader=function(t,e,i,a){a=a||this._defaultRetryInterval;var n=this._reloaders,o=0;return function(){o<a.length?(setTimeout(e,a[o]),o++):(i&&i(),t&&(0===n.length&&(Graphics.printLoadingError(t),SceneManager.stop()),n.push(function(){o=0,e()})))}},ResourceHandler.exists=function(){return 0<this._reloaders.length},ResourceHandler.retry=function(){0<this._reloaders.length&&(Graphics.eraseLoadingError(),SceneManager.resume(),this._reloaders.forEach(function(t){t()}),this._reloaders.length=0)};var $dataActors=null,$dataClasses=null,$dataSkills=null,$dataItems=null,$dataWeapons=null,$dataArmors=null,$dataEnemies=null,$dataTroops=null,$dataStates=null,$dataAnimations=null,$dataTilesets=null,$dataCommonEvents=null,$dataSystem=null,$dataMapInfos=null,$dataMap=null,$gameTemp=null,$gameSystem=null,$gameScreen=null,$gameTimer=null,$gameMessage=null,$gameSwitches=null,$gameVariables=null,$gameSelfSwitches=null,$gameActors=null,$gameParty=null,$gameTroop=null,$gameMap=null,$gamePlayer=null,$testEvent=null;function ConfigManager(){throw Error("This is a static class")}function StorageManager(){throw Error("This is a static class")}function ImageManager(){throw Error("This is a static class")}function AudioManager(){throw Error("This is a static class")}function SoundManager(){throw Error("This is a static class")}function TextManager(){throw Error("This is a static class")}function SceneManager(){throw Error("This is a static class")}function BattleManager(){throw Error("This is a static class")}function PluginManager(){throw Error("This is a static class")}function Game_Temp(){this.initialize.apply(this,arguments)}function Game_System(){this.initialize.apply(this,arguments)}function Game_Timer(){this.initialize.apply(this,arguments)}function Game_Message(){this.initialize.apply(this,arguments)}function Game_Switches(){this.initialize.apply(this,arguments)}function Game_Variables(){this.initialize.apply(this,arguments)}function Game_SelfSwitches(){this.initialize.apply(this,arguments)}function Game_Screen(){this.initialize.apply(this,arguments)}function Game_Picture(){this.initialize.apply(this,arguments)}function Game_Item(){this.initialize.apply(this,arguments)}function Game_Action(){this.initialize.apply(this,arguments)}function Game_ActionResult(){this.initialize.apply(this,arguments)}function Game_BattlerBase(){this.initialize.apply(this,arguments)}function Game_Battler(){this.initialize.apply(this,arguments)}function Game_Actor(){this.initialize.apply(this,arguments)}function Game_Enemy(){this.initialize.apply(this,arguments)}function Game_Actors(){this.initialize.apply(this,arguments)}function Game_Unit(){this.initialize.apply(this,arguments)}function Game_Party(){this.initialize.apply(this,arguments)}function Game_Troop(){this.initialize.apply(this,arguments)}function Game_Map(){this.initialize.apply(this,arguments)}function Game_CommonEvent(){this.initialize.apply(this,arguments)}function Game_CharacterBase(){this.initialize.apply(this,arguments)}function Game_Character(){this.initialize.apply(this,arguments)}function Game_Player(){this.initialize.apply(this,arguments)}DataManager._globalId="RPGMV",DataManager._lastAccessedId=1,DataManager._errorUrl=null,DataManager._databaseFiles=[{name:"$dataActors",src:"Actors.json"},{name:"$dataClasses",src:"Classes.json"},{name:"$dataSkills",src:"Skills.json"},{name:"$dataItems",src:"Items.json"},{name:"$dataWeapons",src:"Weapons.json"},{name:"$dataArmors",src:"Armors.json"},{name:"$dataEnemies",src:"Enemies.json"},{name:"$dataTroops",src:"Troops.json"},{name:"$dataStates",src:"States.json"},{name:"$dataAnimations",src:"Animations.json"},{name:"$dataTilesets",src:"Tilesets.json"},{name:"$dataCommonEvents",src:"CommonEvents.json"},{name:"$dataSystem",src:"System.json"},{name:"$dataMapInfos",src:"MapInfos.json"}],DataManager.loadDatabase=function(){for(var t=this.isBattleTest()||this.isEventTest()?"Test_":"",e=0;e<this._databaseFiles.length;e++)this.loadDataFile(this._databaseFiles[e].name,t+this._databaseFiles[e].src);this.isEventTest()&&this.loadDataFile("$testEvent",t+"Event.json")},DataManager.loadDataFile=function(t,e){var i=new XMLHttpRequest,a="data/"+e;i.open("GET",a),i.overrideMimeType("application/json"),i.onload=function(){i.status<400&&(window[t]=JSON.parse(i.responseText),DataManager.onLoad(window[t]))},i.onerror=this._mapLoader||function(){DataManager._errorUrl=DataManager._errorUrl||a},window[t]=null,i.send()},DataManager.isDatabaseLoaded=function(){this.checkError();for(var t=0;t<this._databaseFiles.length;t++)if(!window[this._databaseFiles[t].name])return!1;return!0},DataManager.loadMapData=function(t){0<t?(t="Map%1.json".format(t.padZero(3)),this._mapLoader=ResourceHandler.createLoader("data/"+t,this.loadDataFile.bind(this,"$dataMap",t)),this.loadDataFile("$dataMap",t)):this.makeEmptyMap()},DataManager.makeEmptyMap=function(){$dataMap={data:[],events:[],width:100,height:100,scrollType:3}},DataManager.isMapLoaded=function(){return this.checkError(),!!$dataMap},DataManager.onLoad=function(t){if(t===$dataMap){this.extractMetadata(t);var e=t.events}else e=t;if(Array.isArray(e))for(var i=0;i<e.length;i++){var a=e[i];a&&void 0!==a.note&&this.extractMetadata(a)}t===$dataSystem&&(Decrypter.hasEncryptedImages=!0,Decrypter.hasEncryptedAudio=!0,Scene_Boot.loadSystemImages())},DataManager.extractMetadata=function(t){var e=/<([^<>:]+)(:?)([^>]*)>/g;for(t.meta={};;){var i=e.exec(t.note);if(!i)break;t.meta[i[1]]=":"!==i[2]||i[3]}},DataManager.checkError=function(){if(DataManager._errorUrl)throw Error("Failed to load: "+DataManager._errorUrl)},DataManager.isBattleTest=function(){return Utils.isOptionValid("btest")},DataManager.isEventTest=function(){return Utils.isOptionValid("etest")},DataManager.isSkill=function(t){return t&&$dataSkills.contains(t)},DataManager.isItem=function(t){return t&&$dataItems.contains(t)},DataManager.isWeapon=function(t){return t&&$dataWeapons.contains(t)},DataManager.isArmor=function(t){return t&&$dataArmors.contains(t)},DataManager.createGameObjects=function(){$gameTemp=new Game_Temp,$gameSystem=new Game_System,$gameScreen=new Game_Screen,$gameTimer=new Game_Timer,$gameMessage=new Game_Message,$gameSwitches=new Game_Switches,$gameVariables=new Game_Variables,$gameSelfSwitches=new Game_SelfSwitches,$gameActors=new Game_Actors,$gameParty=new Game_Party,$gameTroop=new Game_Troop,$gameMap=new Game_Map,$gamePlayer=new Game_Player},DataManager.setupNewGame=function(){this.createGameObjects(),this.selectSavefileForNewGame(),$gameParty.setupStartingMembers(),$gamePlayer.reserveTransfer($dataSystem.startMapId,$dataSystem.startX,$dataSystem.startY),Graphics.frameCount=0},DataManager.setupBattleTest=function(){this.createGameObjects(),$gameParty.setupBattleTest(),BattleManager.setup($dataSystem.testTroopId,!0,!1),BattleManager.setBattleTest(!0),BattleManager.playBattleBgm()},DataManager.setupEventTest=function(){this.createGameObjects(),this.selectSavefileForNewGame(),$gameParty.setupStartingMembers(),$gamePlayer.reserveTransfer(-1,8,6),$gamePlayer.setTransparent(!1)},DataManager.loadGlobalInfo=function(){try{var t=StorageManager.load(0)}catch(t){return console.error(t),[]}if(t){t=JSON.parse(t);for(var e=1;e<=this.maxSavefiles();e++)StorageManager.exists(e)||delete t[e];return t}return[]},DataManager.saveGlobalInfo=function(t){StorageManager.save(0,JSON.stringify(t))},DataManager.isThisGameFile=function(t){var e=this.loadGlobalInfo();return!(!e||!e[t])&&(!!StorageManager.isLocalMode()||(t=e[t]).globalId===this._globalId&&t.title===$dataSystem.gameTitle)},DataManager.isAnySavefileExists=function(){var t=this.loadGlobalInfo();if(t)for(var e=1;e<t.length;e++)if(this.isThisGameFile(e))return!0;return!1},DataManager.latestSavefileId=function(){var t=this.loadGlobalInfo(),e=1,i=0;if(t)for(var a=1;a<t.length;a++)this.isThisGameFile(a)&&t[a].timestamp>i&&(i=t[a].timestamp,e=a);return e},DataManager.loadAllSavefileImages=function(){var t=this.loadGlobalInfo();if(t)for(var e=1;e<t.length;e++)this.isThisGameFile(e)&&this.loadSavefileImages(t[e])},DataManager.loadSavefileImages=function(t){if(t.characters)for(var e=0;e<t.characters.length;e++)ImageManager.reserveCharacter(t.characters[e][0]);if(t.faces)for(e=0;e<t.faces.length;e++)ImageManager.reserveFace(t.faces[e][0])},DataManager.maxSavefiles=function(){return 20},DataManager.saveGame=function(e){try{return StorageManager.backup(e),this.saveGameWithoutRescue(e)}catch(t){console.error(t);try{StorageManager.remove(e),StorageManager.restoreBackup(e)}catch(t){}return!1}},DataManager.loadGame=function(t){try{return this.loadGameWithoutRescue(t)}catch(t){return console.error(t),!1}},DataManager.loadSavefileInfo=function(t){var e=this.loadGlobalInfo();return e&&e[t]?e[t]:null},DataManager.lastAccessedSavefileId=function(){return this._lastAccessedId},DataManager.saveGameWithoutRescue=function(t){var e=JsonEx.stringify(this.makeSaveContents());return 2e5<=e.length&&console.warn("Save data too big!"),StorageManager.save(t,e),this._lastAccessedId=t,(e=this.loadGlobalInfo()||[])[t]=this.makeSavefileInfo(),this.saveGlobalInfo(e),!0},DataManager.loadGameWithoutRescue=function(t){if(this.loadGlobalInfo(),this.isThisGameFile(t)){var e=StorageManager.load(t);return this.createGameObjects(),this.extractSaveContents(JsonEx.parse(e)),this._lastAccessedId=t,!0}return!1},DataManager.selectSavefileForNewGame=function(){var t=this.loadGlobalInfo();if(this._lastAccessedId=1,t){var e=Math.max(0,t.length-1);if(e<this.maxSavefiles())this._lastAccessedId=e+1;else{e=Number.MAX_VALUE;for(var i=1;i<t.length;i++){if(!t[i]){this._lastAccessedId=i;break}t[i].timestamp<e&&(e=t[i].timestamp,this._lastAccessedId=i)}}}},DataManager.makeSavefileInfo=function(){var t={};return t.globalId=this._globalId,t.title=$dataSystem.gameTitle,t.characters=$gameParty.charactersForSavefile(),t.faces=$gameParty.facesForSavefile(),t.playtime=$gameSystem.playtimeText(),t.timestamp=Date.now(),t},DataManager.makeSaveContents=function(){var t={};return t.system=$gameSystem,t.screen=$gameScreen,t.timer=$gameTimer,t.switches=$gameSwitches,t.variables=$gameVariables,t.selfSwitches=$gameSelfSwitches,t.actors=$gameActors,t.party=$gameParty,t.map=$gameMap,t.player=$gamePlayer,t},DataManager.extractSaveContents=function(t){$gameSystem=t.system,$gameScreen=t.screen,$gameTimer=t.timer,$gameSwitches=t.switches,$gameVariables=t.variables,$gameSelfSwitches=t.selfSwitches,$gameActors=t.actors,$gameParty=t.party,$gameMap=t.map,$gamePlayer=t.player},ConfigManager.alwaysDash=!1,ConfigManager.commandRemember=!1,Object.defineProperty(ConfigManager,"bgmVolume",{get:function(){return AudioManager._bgmVolume},set:function(t){AudioManager.bgmVolume=t},configurable:!0}),Object.defineProperty(ConfigManager,"bgsVolume",{get:function(){return AudioManager.bgsVolume},set:function(t){AudioManager.bgsVolume=t},configurable:!0}),Object.defineProperty(ConfigManager,"meVolume",{get:function(){return AudioManager.meVolume},set:function(t){AudioManager.meVolume=t},configurable:!0}),Object.defineProperty(ConfigManager,"seVolume",{get:function(){return AudioManager.seVolume},set:function(t){AudioManager.seVolume=t},configurable:!0}),ConfigManager.load=function(){var t={};try{var e=StorageManager.load(-1)}catch(t){console.error(t)}e&&(t=JSON.parse(e)),this.applyData(t)},ConfigManager.save=function(){StorageManager.save(-1,JSON.stringify(this.makeData()))},ConfigManager.makeData=function(){var t={};return t.alwaysDash=this.alwaysDash,t.commandRemember=this.commandRemember,t.bgmVolume=this.bgmVolume,t.bgsVolume=this.bgsVolume,t.meVolume=this.meVolume,t.seVolume=this.seVolume,t},ConfigManager.applyData=function(t){this.alwaysDash=this.readFlag(t,"alwaysDash"),this.commandRemember=this.readFlag(t,"commandRemember"),this.bgmVolume=this.readVolume(t,"bgmVolume"),this.bgsVolume=this.readVolume(t,"bgsVolume"),this.meVolume=this.readVolume(t,"meVolume"),this.seVolume=this.readVolume(t,"seVolume")},ConfigManager.readFlag=function(t,e){return!!t[e]},ConfigManager.readVolume=function(t,e){return void 0!==(t=t[e])?Number(t).clamp(0,100):100},StorageManager.save=function(t,e){this.isLocalMode()?this.saveToLocalFile(t,e):this.saveToWebStorage(t,e)},StorageManager.load=function(t){return this.isLocalMode()?this.loadFromLocalFile(t):this.loadFromWebStorage(t)},StorageManager.exists=function(t){return this.isLocalMode()?this.localFileExists(t):this.webStorageExists(t)},StorageManager.remove=function(t){this.isLocalMode()?this.removeLocalFile(t):this.removeWebStorage(t)},StorageManager.backup=function(t){if(this.exists(t))if(this.isLocalMode()){var e=this.loadFromLocalFile(t);e=LZString.compressToBase64(e);var i=require("fs"),a=this.localFileDirectoryPath();t=this.localFilePath(t)+".bak",i.existsSync(a)||i.mkdirSync(a),i.writeFileSync(t,e)}else e=this.loadFromWebStorage(t),e=LZString.compressToBase64(e),t=this.webStorageKey(t)+"bak",localStorage.setItem(t,e)},StorageManager.backupExists=function(t){return this.isLocalMode()?this.localFileBackupExists(t):this.webStorageBackupExists(t)},StorageManager.cleanBackup=function(t){if(this.backupExists(t))if(this.isLocalMode()){var e=require("fs");this.localFileDirectoryPath(),t=this.localFilePath(t),e.unlinkSync(t+".bak")}else e=this.webStorageKey(t),localStorage.removeItem(e+"bak")},StorageManager.restoreBackup=function(t){if(this.backupExists(t))if(this.isLocalMode()){var e=this.loadFromLocalBackupFile(t);e=LZString.compressToBase64(e);var i=require("fs"),a=this.localFileDirectoryPath();t=this.localFilePath(t),i.existsSync(a)||i.mkdirSync(a),i.writeFileSync(t,e),i.unlinkSync(t+".bak")}else e=this.loadFromWebStorageBackup(t),e=LZString.compressToBase64(e),t=this.webStorageKey(t),localStorage.setItem(t,e),localStorage.removeItem(t+"bak")},StorageManager.isLocalMode=function(){return Utils.isNwjs()},StorageManager.saveToLocalFile=function(t,e){e=LZString.compressToBase64(e);var i=require("fs"),a=this.localFileDirectoryPath();t=this.localFilePath(t),i.existsSync(a)||i.mkdirSync(a),i.writeFileSync(t,e)},StorageManager.loadFromLocalFile=function(t){var e=null,i=require("fs");return t=this.localFilePath(t),i.existsSync(t)&&(e=i.readFileSync(t,{encoding:"utf8"})),LZString.decompressFromBase64(e)},StorageManager.loadFromLocalBackupFile=function(t){var e=null,i=require("fs");return t=this.localFilePath(t)+".bak",i.existsSync(t)&&(e=i.readFileSync(t,{encoding:"utf8"})),LZString.decompressFromBase64(e)},StorageManager.localFileBackupExists=function(t){return require("fs").existsSync(this.localFilePath(t)+".bak")},StorageManager.localFileExists=function(t){return require("fs").existsSync(this.localFilePath(t))},StorageManager.removeLocalFile=function(t){var e=require("fs");t=this.localFilePath(t),e.existsSync(t)&&e.unlinkSync(t)},StorageManager.saveToWebStorage=function(t,e){t=this.webStorageKey(t),e=LZString.compressToBase64(e),localStorage.setItem(t,e)},StorageManager.loadFromWebStorage=function(t){return t=this.webStorageKey(t),t=localStorage.getItem(t),LZString.decompressFromBase64(t)},StorageManager.loadFromWebStorageBackup=function(t){return t=this.webStorageKey(t)+"bak",t=localStorage.getItem(t),LZString.decompressFromBase64(t)},StorageManager.webStorageBackupExists=function(t){return t=this.webStorageKey(t)+"bak",!!localStorage.getItem(t)},StorageManager.webStorageExists=function(t){return t=this.webStorageKey(t),!!localStorage.getItem(t)},StorageManager.removeWebStorage=function(t){t=this.webStorageKey(t),localStorage.removeItem(t)},StorageManager.localFileDirectoryPath=function(){var t=require("path"),e=t.dirname(process.mainModule.filename);return t.join(e,"save/")},StorageManager.localFilePath=function(t){return t=t<0?"config.rpgsave":0===t?"global.rpgsave":"file%1.rpgsave".format(t),this.localFileDirectoryPath()+t},StorageManager.webStorageKey=function(t){return t<0?"RPG Config":0===t?"RPG Global":"RPG File%1".format(t)},ImageManager.cache=new CacheMap(ImageManager),ImageManager._imageCache=new ImageCache,ImageManager._requestQueue=new RequestQueue,ImageManager._systemReservationId=Utils.generateRuntimeId(),ImageManager._generateCacheKey=function(t,e){return t+":"+e},ImageManager.loadAnimation=function(t,e){return this.loadBitmap("img/animations/",t,e,!0)},ImageManager.loadBattleback1=function(t,e){return this.loadBitmap("img/battlebacks1/",t,e,!0)},ImageManager.loadBattleback2=function(t,e){return this.loadBitmap("img/battlebacks2/",t,e,!0)},ImageManager.loadEnemy=function(t,e){return this.loadBitmap("img/enemies/",t,e,!0)},ImageManager.loadCharacter=function(t,e){return this.loadBitmap("img/characters/",t,e,!1)},ImageManager.loadFace=function(t,e){return this.loadBitmap("img/faces/",t,e,!0)},ImageManager.loadParallax=function(t,e){return this.loadBitmap("img/parallaxes/",t,e,!0)},ImageManager.loadPicture=function(t,e){return this.loadBitmap("img/pictures/",t,e,!0)},ImageManager.loadSvActor=function(t,e){return this.loadBitmap("img/sv_actors/",t,e,!1)},ImageManager.loadSvEnemy=function(t,e){return this.loadBitmap("img/sv_enemies/",t,e,!0)},ImageManager.loadSystem=function(t,e){return this.loadBitmap("img/system/",t,e,!1)},ImageManager.loadTileset=function(t,e){return this.loadBitmap("img/tilesets/",t,e,!1)},ImageManager.loadTitle1=function(t,e){return this.loadBitmap("img/titles1/",t,e,!0)},ImageManager.loadTitle2=function(t,e){return this.loadBitmap("img/titles2/",t,e,!0)},ImageManager.loadBitmap=function(t,e,i,a){return e?(t=t+encodeURIComponent(e)+".png",(i=this.loadNormalBitmap(t,i||0)).smooth=a,i):this.loadEmptyBitmap()},ImageManager.loadEmptyBitmap=function(){var t=this._imageCache.get("empty");return t||(t=new Bitmap,this._imageCache.add("empty",t),this._imageCache.reserve("empty",t,this._systemReservationId)),t},ImageManager.loadNormalBitmap=function(t,e){var i=this._generateCacheKey(t,e),a=this._imageCache.get(i);return a?a.isReady()||a.decode():((a=Bitmap.load(decodeURIComponent(t))).addLoadListener(function(){a.rotateHue(e)}),this._imageCache.add(i,a)),a},ImageManager.clear=function(){this._imageCache=new ImageCache},ImageManager.isReady=function(){return this._imageCache.isReady()},ImageManager.isObjectCharacter=function(t){return(t=t.match(/^[!\$]+/))&&t[0].contains("!")},ImageManager.isBigCharacter=function(t){return(t=t.match(/^[!\$]+/))&&t[0].contains("$")},ImageManager.isZeroParallax=function(t){return"!"===t.charAt(0)},ImageManager.reserveAnimation=function(t,e,i){return this.reserveBitmap("img/animations/",t,e,!0,i)},ImageManager.reserveBattleback1=function(t,e,i){return this.reserveBitmap("img/battlebacks1/",t,e,!0,i)},ImageManager.reserveBattleback2=function(t,e,i){return this.reserveBitmap("img/battlebacks2/",t,e,!0,i)},ImageManager.reserveEnemy=function(t,e,i){return this.reserveBitmap("img/enemies/",t,e,!0,i)},ImageManager.reserveCharacter=function(t,e,i){return this.reserveBitmap("img/characters/",t,e,!1,i)},ImageManager.reserveFace=function(t,e,i){return this.reserveBitmap("img/faces/",t,e,!0,i)},ImageManager.reserveParallax=function(t,e,i){return this.reserveBitmap("img/parallaxes/",t,e,!0,i)},ImageManager.reservePicture=function(t,e,i){return this.reserveBitmap("img/pictures/",t,e,!0,i)},ImageManager.reserveSvActor=function(t,e,i){return this.reserveBitmap("img/sv_actors/",t,e,!1,i)},ImageManager.reserveSvEnemy=function(t,e,i){return this.reserveBitmap("img/sv_enemies/",t,e,!0,i)},ImageManager.reserveSystem=function(t,e,i){return this.reserveBitmap("img/system/",t,e,!1,i||this._systemReservationId)},ImageManager.reserveTileset=function(t,e,i){return this.reserveBitmap("img/tilesets/",t,e,!1,i)},ImageManager.reserveTitle1=function(t,e,i){return this.reserveBitmap("img/titles1/",t,e,!0,i)},ImageManager.reserveTitle2=function(t,e,i){return this.reserveBitmap("img/titles2/",t,e,!0,i)},ImageManager.reserveBitmap=function(t,e,i,a,n){return e?(t=t+encodeURIComponent(e)+".png",(i=this.reserveNormalBitmap(t,i||0,n||this._defaultReservationId)).smooth=a,i):this.loadEmptyBitmap()},ImageManager.reserveNormalBitmap=function(t,e,i){var a=this.loadNormalBitmap(t,e);return this._imageCache.reserve(this._generateCacheKey(t,e),a,i),a},ImageManager.releaseReservation=function(t){this._imageCache.releaseReservation(t)},ImageManager.setDefaultReservationId=function(t){this._defaultReservationId=t},ImageManager.requestAnimation=function(t,e){return this.requestBitmap("img/animations/",t,e,!0)},ImageManager.requestBattleback1=function(t,e){return this.requestBitmap("img/battlebacks1/",t,e,!0)},ImageManager.requestBattleback2=function(t,e){return this.requestBitmap("img/battlebacks2/",t,e,!0)},ImageManager.requestEnemy=function(t,e){return this.requestBitmap("img/enemies/",t,e,!0)},ImageManager.requestCharacter=function(t,e){return this.requestBitmap("img/characters/",t,e,!1)},ImageManager.requestFace=function(t,e){return this.requestBitmap("img/faces/",t,e,!0)},ImageManager.requestParallax=function(t,e){return this.requestBitmap("img/parallaxes/",t,e,!0)},ImageManager.requestPicture=function(t,e){return this.requestBitmap("img/pictures/",t,e,!0)},ImageManager.requestSvActor=function(t,e){return this.requestBitmap("img/sv_actors/",t,e,!1)},ImageManager.requestSvEnemy=function(t,e){return this.requestBitmap("img/sv_enemies/",t,e,!0)},ImageManager.requestSystem=function(t,e){return this.requestBitmap("img/system/",t,e,!1)},ImageManager.requestTileset=function(t,e){return this.requestBitmap("img/tilesets/",t,e,!1)},ImageManager.requestTitle1=function(t,e){return this.requestBitmap("img/titles1/",t,e,!0)},ImageManager.requestTitle2=function(t,e){return this.requestBitmap("img/titles2/",t,e,!0)},ImageManager.requestBitmap=function(t,e,i,a){return e?(t=t+encodeURIComponent(e)+".png",(i=this.requestNormalBitmap(t,i||0)).smooth=a,i):this.loadEmptyBitmap()},ImageManager.requestNormalBitmap=function(t,e){var i=this._generateCacheKey(t,e),a=this._imageCache.get(i);return a?this._requestQueue.raisePriority(i):((a=Bitmap.request(t)).addLoadListener(function(){a.rotateHue(e)}),this._imageCache.add(i,a),this._requestQueue.enqueue(i,a)),a},ImageManager.update=function(){this._requestQueue.update()},ImageManager.clearRequest=function(){this._requestQueue.clear()},AudioManager._masterVolume=1,AudioManager._bgmVolume=100,AudioManager._bgsVolume=100,AudioManager._meVolume=100,AudioManager._seVolume=100,AudioManager._currentBgm=null,AudioManager._currentBgs=null,AudioManager._bgmBuffer=null,AudioManager._bgsBuffer=null,AudioManager._meBuffer=null,AudioManager._seBuffers=[],AudioManager._staticBuffers=[],AudioManager._replayFadeTime=.5,AudioManager._path="audio/",AudioManager._blobUrl=null,Object.defineProperty(AudioManager,"masterVolume",{get:function(){return this._masterVolume},set:function(t){this._masterVolume=t,WebAudio.setMasterVolume(this._masterVolume),Graphics.setVideoVolume(this._masterVolume)},configurable:!0}),Object.defineProperty(AudioManager,"bgmVolume",{get:function(){return this._bgmVolume},set:function(t){this._bgmVolume=t,this.updateBgmParameters(this._currentBgm)},configurable:!0}),Object.defineProperty(AudioManager,"bgsVolume",{get:function(){return this._bgsVolume},set:function(t){this._bgsVolume=t,this.updateBgsParameters(this._currentBgs)},configurable:!0}),Object.defineProperty(AudioManager,"meVolume",{get:function(){return this._meVolume},set:function(t){this._meVolume=t,this.updateMeParameters(this._currentMe)},configurable:!0}),Object.defineProperty(AudioManager,"seVolume",{get:function(){return this._seVolume},set:function(t){this._seVolume=t},configurable:!0}),AudioManager.playBgm=function(t,e){this.isCurrentBgm(t)?this.updateBgmParameters(t):(this.stopBgm(),t.name&&(Decrypter.hasEncryptedAudio&&this.shouldUseHtml5Audio()?this.playEncryptedBgm(t,e):(this._bgmBuffer=this.createBuffer("bgm",t.name),this.updateBgmParameters(t),this._meBuffer||this._bgmBuffer.play(!0,e||0)))),this.updateCurrentBgm(t,e)},AudioManager.playEncryptedBgm=function(t,e){var i=this.audioFileExt();i=this._path+"bgm/"+encodeURIComponent(t.name)+i,i=Decrypter.extToEncryptExt(i),Decrypter.decryptHTML5Audio(i,t,e)},AudioManager.createDecryptBuffer=function(t,e,i){this._blobUrl=t,this._bgmBuffer=this.createBuffer("bgm",e.name),this.updateBgmParameters(e),this._meBuffer||this._bgmBuffer.play(!0,i||0),this.updateCurrentBgm(e,i)},AudioManager.replayBgm=function(t){this.isCurrentBgm(t)?this.updateBgmParameters(t):(this.playBgm(t,t.pos),this._bgmBuffer&&this._bgmBuffer.fadeIn(this._replayFadeTime))},AudioManager.isCurrentBgm=function(t){return this._currentBgm&&this._bgmBuffer&&this._currentBgm.name===t.name},AudioManager.updateBgmParameters=function(t){this.updateBufferParameters(this._bgmBuffer,this._bgmVolume,t)},AudioManager.updateCurrentBgm=function(t,e){this._currentBgm={name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:e}},AudioManager.stopBgm=function(){this._bgmBuffer&&(this._bgmBuffer.stop(),this._currentBgm=this._bgmBuffer=null)},AudioManager.fadeOutBgm=function(t){this._bgmBuffer&&this._currentBgm&&(this._bgmBuffer.fadeOut(t),this._currentBgm=null)},AudioManager.fadeInBgm=function(t){this._bgmBuffer&&this._currentBgm&&this._bgmBuffer.fadeIn(t)},AudioManager.playBgs=function(t,e){this.isCurrentBgs(t)?this.updateBgsParameters(t):(this.stopBgs(),t.name&&(this._bgsBuffer=this.createBuffer("bgs",t.name),this.updateBgsParameters(t),this._bgsBuffer.play(!0,e||0))),this.updateCurrentBgs(t,e)},AudioManager.replayBgs=function(t){this.isCurrentBgs(t)?this.updateBgsParameters(t):(this.playBgs(t,t.pos),this._bgsBuffer&&this._bgsBuffer.fadeIn(this._replayFadeTime))},AudioManager.isCurrentBgs=function(t){return this._currentBgs&&this._bgsBuffer&&this._currentBgs.name===t.name},AudioManager.updateBgsParameters=function(t){this.updateBufferParameters(this._bgsBuffer,this._bgsVolume,t)},AudioManager.updateCurrentBgs=function(t,e){this._currentBgs={name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:e}},AudioManager.stopBgs=function(){this._bgsBuffer&&(this._bgsBuffer.stop(),this._currentBgs=this._bgsBuffer=null)},AudioManager.fadeOutBgs=function(t){this._bgsBuffer&&this._currentBgs&&(this._bgsBuffer.fadeOut(t),this._currentBgs=null)},AudioManager.fadeInBgs=function(t){this._bgsBuffer&&this._currentBgs&&this._bgsBuffer.fadeIn(t)},AudioManager.playMe=function(t){this.stopMe(),t.name&&(this._bgmBuffer&&this._currentBgm&&(this._currentBgm.pos=this._bgmBuffer.seek(),this._bgmBuffer.stop()),this._meBuffer=this.createBuffer("me",t.name),this.updateMeParameters(t),this._meBuffer.play(!1),this._meBuffer.addStopListener(this.stopMe.bind(this)))},AudioManager.updateMeParameters=function(t){this.updateBufferParameters(this._meBuffer,this._meVolume,t)},AudioManager.fadeOutMe=function(t){this._meBuffer&&this._meBuffer.fadeOut(t)},AudioManager.stopMe=function(){this._meBuffer&&(this._meBuffer.stop(),this._meBuffer=null,this._bgmBuffer&&this._currentBgm&&!this._bgmBuffer.isPlaying()&&(this._bgmBuffer.play(!0,this._currentBgm.pos),this._bgmBuffer.fadeIn(this._replayFadeTime)))},AudioManager.playSe=function(t){if(t.name){this._seBuffers=this._seBuffers.filter(function(t){return t.isPlaying()});var e=this.createBuffer("se",t.name);this.updateSeParameters(e,t),e.play(!1),this._seBuffers.push(e)}},AudioManager.updateSeParameters=function(t,e){this.updateBufferParameters(t,this._seVolume,e)},AudioManager.stopSe=function(){this._seBuffers.forEach(function(t){t.stop()}),this._seBuffers=[]},AudioManager.playStaticSe=function(t){if(t.name){this.loadStaticSe(t);for(var e=0;e<this._staticBuffers.length;e++){var i=this._staticBuffers[e];if(i._reservedSeName===t.name){i.stop(),this.updateSeParameters(i,t),i.play(!1);break}}}},AudioManager.loadStaticSe=function(t){if(t.name&&!this.isStaticSe(t)){var e=this.createBuffer("se",t.name);e._reservedSeName=t.name,this._staticBuffers.push(e),this.shouldUseHtml5Audio()&&Html5Audio.setStaticSe(e._url)}},AudioManager.isStaticSe=function(t){for(var e=0;e<this._staticBuffers.length;e++)if(this._staticBuffers[e]._reservedSeName===t.name)return!0;return!1},AudioManager.stopAll=function(){this.stopMe(),this.stopBgm(),this.stopBgs(),this.stopSe()},AudioManager.saveBgm=function(){if(this._currentBgm){var t=this._currentBgm;return{name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:this._bgmBuffer?this._bgmBuffer.seek():0}}return this.makeEmptyAudioObject()},AudioManager.saveBgs=function(){if(this._currentBgs){var t=this._currentBgs;return{name:t.name,volume:t.volume,pitch:t.pitch,pan:t.pan,pos:this._bgsBuffer?this._bgsBuffer.seek():0}}return this.makeEmptyAudioObject()},AudioManager.makeEmptyAudioObject=function(){return{name:"",volume:0,pitch:0}},AudioManager.createBuffer=function(t,e){var i=this.audioFileExt();return e=this._path+t+"/"+encodeURIComponent(e)+i,this.shouldUseHtml5Audio()&&"bgm"===t?(this._blobUrl?Html5Audio.setup(this._blobUrl):Html5Audio.setup(e),Html5Audio):new WebAudio(e)},AudioManager.updateBufferParameters=function(t,e,i){t&&i&&(t.volume=e*(i.volume||0)/1e4,t.pitch=(i.pitch||0)/100,t.pan=(i.pan||0)/100)},AudioManager.audioFileExt=function(){return WebAudio.canPlayOgg()&&!Utils.isMobileDevice()?".ogg":".m4a"},AudioManager.shouldUseHtml5Audio=function(){return!1},AudioManager.checkErrors=function(){this.checkWebAudioError(this._bgmBuffer),this.checkWebAudioError(this._bgsBuffer),this.checkWebAudioError(this._meBuffer),this._seBuffers.forEach(function(t){this.checkWebAudioError(t)}.bind(this)),this._staticBuffers.forEach(function(t){this.checkWebAudioError(t)}.bind(this))},AudioManager.checkWebAudioError=function(t){if(t&&t.isError())throw Error("Failed to load: "+t.url)},SoundManager.preloadImportantSounds=function(){this.loadSystemSound(0),this.loadSystemSound(1),this.loadSystemSound(2),this.loadSystemSound(3)},SoundManager.loadSystemSound=function(t){$dataSystem&&AudioManager.loadStaticSe($dataSystem.sounds[t])},SoundManager.playSystemSound=function(t){$dataSystem&&AudioManager.playStaticSe($dataSystem.sounds[t])},SoundManager.playCursor=function(){this.playSystemSound(0)},SoundManager.playOk=function(){this.playSystemSound(1)},SoundManager.playCancel=function(){this.playSystemSound(2)},SoundManager.playBuzzer=function(){this.playSystemSound(3)},SoundManager.playEquip=function(){this.playSystemSound(4)},SoundManager.playSave=function(){this.playSystemSound(5)},SoundManager.playLoad=function(){this.playSystemSound(6)},SoundManager.playBattleStart=function(){this.playSystemSound(7)},SoundManager.playEscape=function(){this.playSystemSound(8)},SoundManager.playEnemyAttack=function(){this.playSystemSound(9)},SoundManager.playEnemyDamage=function(){this.playSystemSound(10)},SoundManager.playEnemyCollapse=function(){this.playSystemSound(11)},SoundManager.playBossCollapse1=function(){this.playSystemSound(12)},SoundManager.playBossCollapse2=function(){this.playSystemSound(13)},SoundManager.playActorDamage=function(){this.playSystemSound(14)},SoundManager.playActorCollapse=function(){this.playSystemSound(15)},SoundManager.playRecovery=function(){this.playSystemSound(16)},SoundManager.playMiss=function(){this.playSystemSound(17)},SoundManager.playEvasion=function(){this.playSystemSound(18)},SoundManager.playMagicEvasion=function(){this.playSystemSound(19)},SoundManager.playReflection=function(){this.playSystemSound(20)},SoundManager.playShop=function(){this.playSystemSound(21)},SoundManager.playUseItem=function(){this.playSystemSound(22)},SoundManager.playUseSkill=function(){this.playSystemSound(23)},TextManager.basic=function(t){return $dataSystem.terms.basic[t]||""},TextManager.param=function(t){return $dataSystem.terms.params[t]||""},TextManager.command=function(t){return $dataSystem.terms.commands[t]||""},TextManager.message=function(t){return $dataSystem.terms.messages[t]||""},TextManager.getter=function(t,e){return{get:function(){return this[t](e)},configurable:!0}},Object.defineProperty(TextManager,"currencyUnit",{get:function(){return $dataSystem.currencyUnit},configurable:!0}),Object.defineProperties(TextManager,{level:TextManager.getter("basic",0),levelA:TextManager.getter("basic",1),hp:TextManager.getter("basic",2),hpA:TextManager.getter("basic",3),mp:TextManager.getter("basic",4),mpA:TextManager.getter("basic",5),tp:TextManager.getter("basic",6),tpA:TextManager.getter("basic",7),exp:TextManager.getter("basic",8),expA:TextManager.getter("basic",9),fight:TextManager.getter("command",0),escape:TextManager.getter("command",1),attack:TextManager.getter("command",2),guard:TextManager.getter("command",3),item:TextManager.getter("command",4),skill:TextManager.getter("command",5),equip:TextManager.getter("command",6),status:TextManager.getter("command",7),formation:TextManager.getter("command",8),save:TextManager.getter("command",9),gameEnd:TextManager.getter("command",10),options:TextManager.getter("command",11),weapon:TextManager.getter("command",12),armor:TextManager.getter("command",13),keyItem:TextManager.getter("command",14),equip2:TextManager.getter("command",15),optimize:TextManager.getter("command",16),clear:TextManager.getter("command",17),newGame:TextManager.getter("command",18),continue_:TextManager.getter("command",19),toTitle:TextManager.getter("command",21),cancel:TextManager.getter("command",22),buy:TextManager.getter("command",24),sell:TextManager.getter("command",25),alwaysDash:TextManager.getter("message","alwaysDash"),commandRemember:TextManager.getter("message","commandRemember"),bgmVolume:TextManager.getter("message","bgmVolume"),bgsVolume:TextManager.getter("message","bgsVolume"),meVolume:TextManager.getter("message","meVolume"),seVolume:TextManager.getter("message","seVolume"),possession:TextManager.getter("message","possession"),expTotal:TextManager.getter("message","expTotal"),expNext:TextManager.getter("message","expNext"),saveMessage:TextManager.getter("message","saveMessage"),loadMessage:TextManager.getter("message","loadMessage"),file:TextManager.getter("message","file"),partyName:TextManager.getter("message","partyName"),emerge:TextManager.getter("message","emerge"),preemptive:TextManager.getter("message","preemptive"),surprise:TextManager.getter("message","surprise"),escapeStart:TextManager.getter("message","escapeStart"),escapeFailure:TextManager.getter("message","escapeFailure"),victory:TextManager.getter("message","victory"),defeat:TextManager.getter("message","defeat"),obtainExp:TextManager.getter("message","obtainExp"),obtainGold:TextManager.getter("message","obtainGold"),obtainItem:TextManager.getter("message","obtainItem"),levelUp:TextManager.getter("message","levelUp"),obtainSkill:TextManager.getter("message","obtainSkill"),useItem:TextManager.getter("message","useItem"),criticalToEnemy:TextManager.getter("message","criticalToEnemy"),criticalToActor:TextManager.getter("message","criticalToActor"),actorDamage:TextManager.getter("message","actorDamage"),actorRecovery:TextManager.getter("message","actorRecovery"),actorGain:TextManager.getter("message","actorGain"),actorLoss:TextManager.getter("message","actorLoss"),actorDrain:TextManager.getter("message","actorDrain"),actorNoDamage:TextManager.getter("message","actorNoDamage"),actorNoHit:TextManager.getter("message","actorNoHit"),enemyDamage:TextManager.getter("message","enemyDamage"),enemyRecovery:TextManager.getter("message","enemyRecovery"),enemyGain:TextManager.getter("message","enemyGain"),enemyLoss:TextManager.getter("message","enemyLoss"),enemyDrain:TextManager.getter("message","enemyDrain"),enemyNoDamage:TextManager.getter("message","enemyNoDamage"),enemyNoHit:TextManager.getter("message","enemyNoHit"),evasion:TextManager.getter("message","evasion"),magicEvasion:TextManager.getter("message","magicEvasion"),magicReflection:TextManager.getter("message","magicReflection"),counterAttack:TextManager.getter("message","counterAttack"),substitute:TextManager.getter("message","substitute"),buffAdd:TextManager.getter("message","buffAdd"),debuffAdd:TextManager.getter("message","debuffAdd"),buffRemove:TextManager.getter("message","buffRemove"),actionFailure:TextManager.getter("message","actionFailure")}),SceneManager._getTimeInMsWithoutMobileSafari=function(){return performance.now()},SceneManager._scene=null,SceneManager._nextScene=null,SceneManager._stack=[],SceneManager._stopped=!1,SceneManager._sceneStarted=!1,SceneManager._exiting=!1,SceneManager._previousClass=null,SceneManager._backgroundBitmap=null,SceneManager._screenWidth=816,SceneManager._screenHeight=624,SceneManager._boxWidth=816,SceneManager._boxHeight=624,SceneManager._deltaTime=1/60,Utils.isMobileSafari()||(SceneManager._currentTime=SceneManager._getTimeInMsWithoutMobileSafari()),SceneManager._accumulator=0,SceneManager.run=function(t){try{this.initialize(),this.goto(t),this.requestUpdate()}catch(t){this.catchException(t)}},SceneManager.initialize=function(){this.initGraphics(),this.checkFileAccess(),this.initAudio(),this.initInput(),this.initNwjs(),this.checkPluginErrors(),this.setupErrorHandlers()},SceneManager.initGraphics=function(){var t=this.preferableRendererType();Graphics.initialize(this._screenWidth,this._screenHeight,t),Graphics.boxWidth=this._boxWidth,Graphics.boxHeight=this._boxHeight,Graphics.setLoadingImage("img/system/Loading.png"),Utils.isOptionValid("showfps")&&Graphics.showFps(),"webgl"===t&&this.checkWebGL()},SceneManager.preferableRendererType=function(){return Utils.isOptionValid("canvas")?"canvas":Utils.isOptionValid("webgl")?"webgl":"auto"},SceneManager.shouldUseCanvasRenderer=function(){return Utils.isMobileDevice()},SceneManager.checkWebGL=function(){if(!Graphics.hasWebGL())throw Error("Your browser does not support WebGL.")},SceneManager.checkFileAccess=function(){if(!Utils.canReadGameFiles())throw Error("Your browser does not allow to read local files.")},SceneManager.initAudio=function(){var t=Utils.isOptionValid("noaudio");if(!WebAudio.initialize(t)&&!t)throw Error("Your browser does not support Web Audio API.")},SceneManager.initInput=function(){Input.initialize(),TouchInput.initialize()},SceneManager.initNwjs=function(){if(Utils.isNwjs()){var t=require("nw.gui"),e=t.Window.get();"darwin"!==process.platform||e.menu||((t=new t.Menu({type:"menubar"})).createMacBuiltin("Game",{hideEdit:!0,hideWindow:!0}),e.menu=t)}},SceneManager.checkPluginErrors=function(){PluginManager.checkErrors()},SceneManager.setupErrorHandlers=function(){window.addEventListener("error",this.onError.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this))},SceneManager.requestUpdate=function(){this._stopped||requestAnimationFrame(this.update.bind(this))},SceneManager.update=function(){try{this.tickStart(),Utils.isMobileSafari()&&this.updateInputData(),this.updateManagers(),this.updateMain(),this.tickEnd()}catch(t){this.catchException(t)}},SceneManager.terminate=function(){window.close()},SceneManager.onError=function(t){console.error(t.message),console.error(t.filename,t.lineno);try{this.stop(),Graphics.printError("Error",t.message),AudioManager.stopAll()}catch(t){}},SceneManager.onKeyDown=function(t){if(!t.ctrlKey&&!t.altKey)switch(t.keyCode){case 116:Utils.isNwjs()&&location.reload();break;case 119:Utils.isNwjs()&&Utils.isOptionValid("test")&&require("nw.gui").Window.get().showDevTools()}},SceneManager.catchException=function(t){t instanceof Error?(Graphics.printError(t.name,t.message),console.error(t.stack)):Graphics.printError("UnknownError",t),AudioManager.stopAll(),this.stop()},SceneManager.tickStart=function(){Graphics.tickStart()},SceneManager.tickEnd=function(){Graphics.tickEnd()},SceneManager.updateInputData=function(){Input.update(),TouchInput.update()},SceneManager.updateMain=function(){if(Utils.isMobileSafari())this.changeScene(),this.updateScene();else{var t=this._getTimeInMsWithoutMobileSafari(),e=(t-this._currentTime)/1e3;for(.25<e&&(e=.25),this._currentTime=t,this._accumulator+=e;this._accumulator>=this._deltaTime;)this.updateInputData(),this.changeScene(),this.updateScene(),this._accumulator-=this._deltaTime}this.renderScene(),this.requestUpdate()},SceneManager.updateManagers=function(){ImageManager.update()},SceneManager.changeScene=function(){this.isSceneChanging()&&!this.isCurrentSceneBusy()&&(this._scene&&(this._scene.terminate(),this._scene.detachReservation(),this._previousClass=this._scene.constructor),(this._scene=this._nextScene)&&(this._scene.attachReservation(),this._scene.create(),this._nextScene=null,this._sceneStarted=!1,this.onSceneCreate()),this._exiting&&this.terminate())},SceneManager.updateScene=function(){this._scene&&(!this._sceneStarted&&this._scene.isReady()&&(this._scene.start(),this._sceneStarted=!0,this.onSceneStart()),this.isCurrentSceneStarted()&&this._scene.update())},SceneManager.renderScene=function(){this.isCurrentSceneStarted()?Graphics.render(this._scene):this._scene&&this.onSceneLoading()},SceneManager.onSceneCreate=function(){Graphics.startLoading()},SceneManager.onSceneStart=function(){Graphics.endLoading()},SceneManager.onSceneLoading=function(){Graphics.updateLoading()},SceneManager.isSceneChanging=function(){return this._exiting||!!this._nextScene},SceneManager.isCurrentSceneBusy=function(){return this._scene&&this._scene.isBusy()},SceneManager.isCurrentSceneStarted=function(){return this._scene&&this._sceneStarted},SceneManager.isNextScene=function(t){return this._nextScene&&this._nextScene.constructor===t},SceneManager.isPreviousScene=function(t){return this._previousClass===t},SceneManager.goto=function(t){t&&(this._nextScene=new t),this._scene&&this._scene.stop()},SceneManager.push=function(t){this._stack.push(this._scene.constructor),this.goto(t)},SceneManager.pop=function(){0<this._stack.length?this.goto(this._stack.pop()):this.exit()},SceneManager.exit=function(){this.goto(null),this._exiting=!0},SceneManager.clearStack=function(){this._stack=[]},SceneManager.stop=function(){this._stopped=!0},SceneManager.prepareNextScene=function(){this._nextScene.prepare.apply(this._nextScene,arguments)},SceneManager.snap=function(){return Bitmap.snap(this._scene)},SceneManager.snapForBackground=function(){this._backgroundBitmap=this.snap(),this._backgroundBitmap.blur()},SceneManager.backgroundBitmap=function(){return this._backgroundBitmap},SceneManager.resume=function(){this._stopped=!1,this.requestUpdate(),Utils.isMobileSafari()||(this._currentTime=this._getTimeInMsWithoutMobileSafari(),this._accumulator=0)},BattleManager.setup=function(t,e,i){this.initMembers(),this._canEscape=e,this._canLose=i,$gameTroop.setup(t),$gameScreen.onBattleStart(),this.makeEscapeRatio()},BattleManager.initMembers=function(){this._phase="init",this._battleTest=this._canLose=this._canEscape=!1,this._eventCallback=null,this._surprise=this._preemptive=!1,this._actorIndex=-1,this._mapBgs=this._mapBgm=this._actionForcedBattler=null,this._actionBattlers=[],this._action=this._subject=null,this._targets=[],this._spriteset=this._statusWindow=this._logWindow=null,this._escapeRatio=0,this._escaped=!1,this._rewards={},this._turnForced=!1},BattleManager.isBattleTest=function(){return this._battleTest},BattleManager.setBattleTest=function(t){this._battleTest=t},BattleManager.setEventCallback=function(t){this._eventCallback=t},BattleManager.setLogWindow=function(t){this._logWindow=t},BattleManager.setStatusWindow=function(t){this._statusWindow=t},BattleManager.setSpriteset=function(t){this._spriteset=t},BattleManager.onEncounter=function(){this._preemptive=Math.random()<this.ratePreemptive(),this._surprise=Math.random()<this.rateSurprise()&&!this._preemptive},BattleManager.ratePreemptive=function(){return $gameParty.ratePreemptive($gameTroop.agility())},BattleManager.rateSurprise=function(){return $gameParty.rateSurprise($gameTroop.agility())},BattleManager.saveBgmAndBgs=function(){this._mapBgm=AudioManager.saveBgm(),this._mapBgs=AudioManager.saveBgs()},BattleManager.playBattleBgm=function(){AudioManager.playBgm($gameSystem.battleBgm()),AudioManager.stopBgs()},BattleManager.playVictoryMe=function(){AudioManager.playMe($gameSystem.victoryMe())},BattleManager.playDefeatMe=function(){AudioManager.playMe($gameSystem.defeatMe())},BattleManager.replayBgmAndBgs=function(){this._mapBgm?AudioManager.replayBgm(this._mapBgm):AudioManager.stopBgm(),this._mapBgs&&AudioManager.replayBgs(this._mapBgs)},BattleManager.makeEscapeRatio=function(){this._escapeRatio=.5*$gameParty.agility()/$gameTroop.agility()},BattleManager.update=function(){if(!this.isBusy()&&!this.updateEvent())switch(this._phase){case"start":this.startInput();break;case"turn":this.updateTurn();break;case"action":this.updateAction();break;case"turnEnd":this.updateTurnEnd();break;case"battleEnd":this.updateBattleEnd()}},BattleManager.updateEvent=function(){switch(this._phase){case"start":case"turn":case"turnEnd":return this.isActionForced()?(this.processForcedAction(),!0):this.updateEventMain()}return this.checkAbort()},BattleManager.updateEventMain=function(){return $gameTroop.updateInterpreter(),$gameParty.requestMotionRefresh(),!(!$gameTroop.isEventRunning()&&!this.checkBattleEnd())||($gameTroop.setupBattleEvent(),!(!$gameTroop.isEventRunning()&&!SceneManager.isSceneChanging()))},BattleManager.isBusy=function(){return $gameMessage.isBusy()||this._spriteset.isBusy()||this._logWindow.isBusy()},BattleManager.isInputting=function(){return"input"===this._phase},BattleManager.isInTurn=function(){return"turn"===this._phase},BattleManager.isTurnEnd=function(){return"turnEnd"===this._phase},BattleManager.isAborting=function(){return"aborting"===this._phase},BattleManager.isBattleEnd=function(){return"battleEnd"===this._phase},BattleManager.canEscape=function(){return this._canEscape},BattleManager.canLose=function(){return this._canLose},BattleManager.isEscaped=function(){return this._escaped},BattleManager.actor=function(){return 0<=this._actorIndex?$gameParty.members()[this._actorIndex]:null},BattleManager.clearActor=function(){this.changeActor(-1,"")},BattleManager.changeActor=function(t,e){var i=this.actor();this._actorIndex=t,t=this.actor(),i&&i.setActionState(e),t&&t.setActionState("inputting")},BattleManager.startBattle=function(){this._phase="start",$gameSystem.onBattleStart(),$gameParty.onBattleStart(),$gameTroop.onBattleStart(),this.displayStartMessages()},BattleManager.displayStartMessages=function(){$gameTroop.enemyNames().forEach(function(t){$gameMessage.add(TextManager.emerge.format(t))}),this._preemptive?$gameMessage.add(TextManager.preemptive.format($gameParty.name())):this._surprise&&$gameMessage.add(TextManager.surprise.format($gameParty.name()))},BattleManager.startInput=function(){this._phase="input",$gameParty.makeActions(),$gameTroop.makeActions(),this.clearActor(),!this._surprise&&$gameParty.canInput()||this.startTurn()},BattleManager.inputtingAction=function(){return this.actor()?this.actor().inputtingAction():null},BattleManager.selectNextCommand=function(){do{if((!this.actor()||!this.actor().selectNextCommand())&&(this.changeActor(this._actorIndex+1,"waiting"),this._actorIndex>=$gameParty.size())){this.startTurn();break}}while(!this.actor().canInput())},BattleManager.selectPreviousCommand=function(){do{if((!this.actor()||!this.actor().selectPreviousCommand())&&(this.changeActor(this._actorIndex-1,"undecided"),this._actorIndex<0))break}while(!this.actor().canInput())},BattleManager.refreshStatus=function(){this._statusWindow.refresh()},BattleManager.startTurn=function(){this._phase="turn",this.clearActor(),$gameTroop.increaseTurn(),this.makeActionOrders(),$gameParty.requestMotionRefresh(),this._logWindow.startTurn()},BattleManager.updateTurn=function(){$gameParty.requestMotionRefresh(),this._subject||(this._subject=this.getNextSubject()),this._subject?this.processTurn():this.endTurn()},BattleManager.processTurn=function(){var t=this._subject,e=t.currentAction();e?(e.prepare(),e.isValid()&&this.startAction(),t.removeCurrentAction()):(t.onAllActionsEnd(),this.refreshStatus(),this._logWindow.displayAutoAffectedStatus(t),this._logWindow.displayCurrentState(t),this._logWindow.displayRegeneration(t),this._subject=this.getNextSubject())},BattleManager.endTurn=function(){this._phase="turnEnd",this._surprise=this._preemptive=!1,this.allBattleMembers().forEach(function(t){t.onTurnEnd(),this.refreshStatus(),this._logWindow.displayAutoAffectedStatus(t),this._logWindow.displayRegeneration(t)},this),this.isForcedTurn()&&(this._turnForced=!1)},BattleManager.isForcedTurn=function(){return this._turnForced},BattleManager.updateTurnEnd=function(){this.startInput()},BattleManager.getNextSubject=function(){for(;;){var t=this._actionBattlers.shift();if(!t)return null;if(t.isBattleMember()&&t.isAlive())return t}},BattleManager.allBattleMembers=function(){return $gameParty.members().concat($gameTroop.members())},BattleManager.makeActionOrders=function(){var t=[];this._surprise||(t=t.concat($gameParty.members())),this._preemptive||(t=t.concat($gameTroop.members())),t.forEach(function(t){t.makeSpeed()}),t.sort(function(t,e){return e.speed()-t.speed()}),this._actionBattlers=t},BattleManager.startAction=function(){var t=this._subject,e=t.currentAction(),i=e.makeTargets();this._phase="action",this._action=e,this._targets=i,t.useItem(e.item()),this._action.applyGlobal(),this.refreshStatus(),this._logWindow.startAction(t,e,i)},BattleManager.updateAction=function(){var t=this._targets.shift();t?this.invokeAction(this._subject,t):this.endAction()},BattleManager.endAction=function(){this._logWindow.endAction(this._subject),this._phase="turn"},BattleManager.invokeAction=function(t,e){this._logWindow.push("pushBaseLine"),Math.random()<this._action.itemCnt(e)?this.invokeCounterAttack(t,e):Math.random()<this._action.itemMrf(e)?this.invokeMagicReflection(t,e):this.invokeNormalAction(t,e),t.setLastTarget(e),this._logWindow.push("popBaseLine"),this.refreshStatus()},BattleManager.invokeNormalAction=function(t,e){e=this.applySubstitute(e),this._action.apply(e),this._logWindow.displayActionResults(t,e)},BattleManager.invokeCounterAttack=function(t,e){var i=new Game_Action(e);i.setAttack(),i.apply(t),this._logWindow.displayCounter(e),this._logWindow.displayActionResults(e,t)},BattleManager.invokeMagicReflection=function(t,e){this._action._reflectionTarget=e,this._logWindow.displayReflection(e),this._action.apply(t),this._logWindow.displayActionResults(e,t)},BattleManager.applySubstitute=function(t){if(this.checkSubstitute(t)){var e=t.friendsUnit().substituteBattler();if(e&&t!==e)return this._logWindow.displaySubstitute(e,t),e}return t},BattleManager.checkSubstitute=function(t){return t.isDying()&&!this._action.isCertainHit()},BattleManager.isActionForced=function(){return!!this._actionForcedBattler},BattleManager.forceAction=function(t){this._actionForcedBattler=t,0<=(t=this._actionBattlers.indexOf(t))&&this._actionBattlers.splice(t,1)},BattleManager.processForcedAction=function(){this._actionForcedBattler&&(this._turnForced=!0,this._subject=this._actionForcedBattler,this._actionForcedBattler=null,this.startAction(),this._subject.removeCurrentAction())},BattleManager.abort=function(){this._phase="aborting"},BattleManager.checkBattleEnd=function(){if(this._phase){if(this.checkAbort())return!0;if($gameParty.isAllDead())return this.processDefeat(),!0;if($gameTroop.isAllDead())return this.processVictory(),!0}return!1},BattleManager.checkAbort=function(){return($gameParty.isEmpty()||this.isAborting())&&(SoundManager.playEscape(),this._escaped=!0,this.processAbort()),!1},BattleManager.processVictory=function(){$gameParty.removeBattleStates(),$gameParty.performVictory(),this.playVictoryMe(),this.replayBgmAndBgs(),this.makeRewards(),this.displayVictoryMessage(),this.displayRewards(),this.gainRewards(),this.endBattle(0)},BattleManager.processEscape=function(){$gameParty.performEscape(),SoundManager.playEscape();var t=!!this._preemptive||Math.random()<this._escapeRatio;return t?(this.displayEscapeSuccessMessage(),this._escaped=!0,this.processAbort()):(this.displayEscapeFailureMessage(),this._escapeRatio+=.1,$gameParty.clearActions(),this.startTurn()),t},BattleManager.processAbort=function(){$gameParty.removeBattleStates(),this.replayBgmAndBgs(),this.endBattle(1)},BattleManager.processDefeat=function(){this.displayDefeatMessage(),this.playDefeatMe(),this._canLose?this.replayBgmAndBgs():AudioManager.stopBgm(),this.endBattle(2)},BattleManager.endBattle=function(t){this._phase="battleEnd",this._eventCallback&&this._eventCallback(t),0===t?$gameSystem.onBattleWin():this._escaped&&$gameSystem.onBattleEscape()},BattleManager.updateBattleEnd=function(){this.isBattleTest()?(AudioManager.stopBgm(),SceneManager.exit()):!this._escaped&&$gameParty.isAllDead()?this._canLose?($gameParty.reviveBattleMembers(),SceneManager.pop()):SceneManager.goto(Scene_Gameover):SceneManager.pop(),this._phase=null},BattleManager.makeRewards=function(){this._rewards={},this._rewards.gold=$gameTroop.goldTotal(),this._rewards.exp=$gameTroop.expTotal(),this._rewards.items=$gameTroop.makeDropItems()},BattleManager.displayVictoryMessage=function(){$gameMessage.add(TextManager.victory.format($gameParty.name()))},BattleManager.displayDefeatMessage=function(){$gameMessage.add(TextManager.defeat.format($gameParty.name()))},BattleManager.displayEscapeSuccessMessage=function(){$gameMessage.add(TextManager.escapeStart.format($gameParty.name()))},BattleManager.displayEscapeFailureMessage=function(){$gameMessage.add(TextManager.escapeStart.format($gameParty.name())),$gameMessage.add("\\."+TextManager.escapeFailure)},BattleManager.displayRewards=function(){this.displayExp(),this.displayGold(),this.displayDropItems()},BattleManager.displayExp=function(){var t=this._rewards.exp;0<t&&(t=TextManager.obtainExp.format(t,TextManager.exp),$gameMessage.add("\\."+t))},BattleManager.displayGold=function(){var t=this._rewards.gold;0<t&&$gameMessage.add("\\."+TextManager.obtainGold.format(t))},BattleManager.displayDropItems=function(){var t=this._rewards.items;0<t.length&&($gameMessage.newPage(),t.forEach(function(t){$gameMessage.add(TextManager.obtainItem.format(t.name))}))},BattleManager.gainRewards=function(){this.gainExp(),this.gainGold(),this.gainDropItems()},BattleManager.gainExp=function(){var e=this._rewards.exp;$gameParty.allMembers().forEach(function(t){t.gainExp(e)})},BattleManager.gainGold=function(){$gameParty.gainGold(this._rewards.gold)},BattleManager.gainDropItems=function(){this._rewards.items.forEach(function(t){$gameParty.gainItem(t,1)})},PluginManager._path="js/plugins/",PluginManager._scripts=[],PluginManager._errorUrls=[],PluginManager._parameters={},PluginManager.setup=function(t){t.forEach(function(t){t.status&&!this._scripts.contains(t.name)&&(this.setParameters(t.name,t.parameters),this.loadScript(t.name+".js"),this._scripts.push(t.name))},this)},PluginManager.checkErrors=function(){var t=this._errorUrls.shift();if(t)throw Error("Failed to load: "+t)},PluginManager.parameters=function(t){return this._parameters[t.toLowerCase()]||{}},PluginManager.setParameters=function(t,e){this._parameters[t.toLowerCase()]=e},PluginManager.loadScript=function(t){t=this._path+t;var e=document.createElement("script");e.type="text/javascript",e.src=t,e.async=!1,e.onerror=this.onError.bind(this),e._url=t,document.body.appendChild(e)},PluginManager.onError=function(t){this._errorUrls.push(t.target._url)},Game_Temp.prototype.initialize=function(){this._isPlaytest=Utils.isOptionValid("test"),this._commonEventId=0,this._destinationY=this._destinationX=null},Game_Temp.prototype.isPlaytest=function(){return this._isPlaytest},Game_Temp.prototype.reserveCommonEvent=function(t){this._commonEventId=t},Game_Temp.prototype.clearCommonEvent=function(){this._commonEventId=0},Game_Temp.prototype.isCommonEventReserved=function(){return 0<this._commonEventId},Game_Temp.prototype.reservedCommonEvent=function(){return $dataCommonEvents[this._commonEventId]},Game_Temp.prototype.setDestination=function(t,e){this._destinationX=t,this._destinationY=e},Game_Temp.prototype.clearDestination=function(){this._destinationY=this._destinationX=null},Game_Temp.prototype.isDestinationValid=function(){return null!==this._destinationX},Game_Temp.prototype.destinationX=function(){return this._destinationX},Game_Temp.prototype.destinationY=function(){return this._destinationY},Game_System.prototype.initialize=function(){this._formationEnabled=this._encounterEnabled=this._menuEnabled=this._saveEnabled=!0,this._framesOnSave=this._versionId=this._saveCount=this._escapeCount=this._winCount=this._battleCount=0,this._walkingBgm=this._savedBgm=this._defeatMe=this._victoryMe=this._battleBgm=this._windowTone=this._bgsOnSave=this._bgmOnSave=null},Game_System.prototype.isJapanese=function(){return $dataSystem.locale.match(/^ja/)},Game_System.prototype.isChinese=function(){return $dataSystem.locale.match(/^zh/)},Game_System.prototype.isKorean=function(){return $dataSystem.locale.match(/^ko/)},Game_System.prototype.isCJK=function(){return $dataSystem.locale.match(/^(ja|zh|ko)/)},Game_System.prototype.isRussian=function(){return $dataSystem.locale.match(/^ru/)},Game_System.prototype.isSideView=function(){return $dataSystem.optSideView},Game_System.prototype.isSaveEnabled=function(){return this._saveEnabled},Game_System.prototype.disableSave=function(){this._saveEnabled=!1},Game_System.prototype.enableSave=function(){this._saveEnabled=!0},Game_System.prototype.isMenuEnabled=function(){return this._menuEnabled},Game_System.prototype.disableMenu=function(){this._menuEnabled=!1},Game_System.prototype.enableMenu=function(){this._menuEnabled=!0},Game_System.prototype.isEncounterEnabled=function(){return this._encounterEnabled},Game_System.prototype.disableEncounter=function(){this._encounterEnabled=!1},Game_System.prototype.enableEncounter=function(){this._encounterEnabled=!0},Game_System.prototype.isFormationEnabled=function(){return this._formationEnabled},Game_System.prototype.disableFormation=function(){this._formationEnabled=!1},Game_System.prototype.enableFormation=function(){this._formationEnabled=!0},Game_System.prototype.battleCount=function(){return this._battleCount},Game_System.prototype.winCount=function(){return this._winCount},Game_System.prototype.escapeCount=function(){return this._escapeCount},Game_System.prototype.saveCount=function(){return this._saveCount},Game_System.prototype.versionId=function(){return this._versionId},Game_System.prototype.windowTone=function(){return this._windowTone||$dataSystem.windowTone},Game_System.prototype.setWindowTone=function(t){this._windowTone=t},Game_System.prototype.battleBgm=function(){return this._battleBgm||$dataSystem.battleBgm},Game_System.prototype.setBattleBgm=function(t){this._battleBgm=t},Game_System.prototype.victoryMe=function(){return this._victoryMe||$dataSystem.victoryMe},Game_System.prototype.setVictoryMe=function(t){this._victoryMe=t},Game_System.prototype.defeatMe=function(){return this._defeatMe||$dataSystem.defeatMe},Game_System.prototype.setDefeatMe=function(t){this._defeatMe=t},Game_System.prototype.onBattleStart=function(){this._battleCount++},Game_System.prototype.onBattleWin=function(){this._winCount++},Game_System.prototype.onBattleEscape=function(){this._escapeCount++},Game_System.prototype.onBeforeSave=function(){this._saveCount++,this._versionId=$dataSystem.versionId,this._framesOnSave=Graphics.frameCount,this._bgmOnSave=AudioManager.saveBgm(),this._bgsOnSave=AudioManager.saveBgs()},Game_System.prototype.onAfterLoad=function(){Graphics.frameCount=this._framesOnSave,AudioManager.playBgm(this._bgmOnSave),AudioManager.playBgs(this._bgsOnSave)},Game_System.prototype.playtime=function(){return Math.floor(Graphics.frameCount/60)},Game_System.prototype.playtimeText=function(){var t=Math.floor(this.playtime()/60/60),e=Math.floor(this.playtime()/60)%60,i=this.playtime()%60;return t.padZero(2)+":"+e.padZero(2)+":"+i.padZero(2)},Game_System.prototype.saveBgm=function(){this._savedBgm=AudioManager.saveBgm()},Game_System.prototype.replayBgm=function(){this._savedBgm&&AudioManager.replayBgm(this._savedBgm)},Game_System.prototype.saveWalkingBgm=function(){this._walkingBgm=AudioManager.saveBgm()},Game_System.prototype.replayWalkingBgm=function(){this._walkingBgm&&AudioManager.playBgm(this._walkingBgm)},Game_System.prototype.saveWalkingBgm2=function(){this._walkingBgm=$dataMap.bgm},Game_Timer.prototype.initialize=function(){this._frames=0,this._working=!1},Game_Timer.prototype.update=function(t){t&&this._working&&0<this._frames&&(this._frames--,0===this._frames)&&this.onExpire()},Game_Timer.prototype.start=function(t){this._frames=t,this._working=!0},Game_Timer.prototype.stop=function(){this._working=!1},Game_Timer.prototype.isWorking=function(){return this._working},Game_Timer.prototype.seconds=function(){return Math.floor(this._frames/60)},Game_Timer.prototype.onExpire=function(){BattleManager.abort()},Game_Message.prototype.initialize=function(){this.clear()},Game_Message.prototype.clear=function(){this._texts=[],this._choices=[],this._faceName="",this._background=this._faceIndex=0,this._positionType=2,this._choiceBackground=this._choiceCancelType=this._choiceDefaultType=0,this._choicePositionType=2,this._itemChoiceItypeId=this._itemChoiceVariableId=this._numInputMaxDigits=this._numInputVariableId=0,this._scrollMode=!1,this._scrollSpeed=2,this._scrollNoFast=!1,this._choiceCallback=null},Game_Message.prototype.choices=function(){return this._choices},Game_Message.prototype.faceName=function(){return this._faceName},Game_Message.prototype.faceIndex=function(){return this._faceIndex},Game_Message.prototype.background=function(){return this._background},Game_Message.prototype.positionType=function(){return this._positionType},Game_Message.prototype.choiceDefaultType=function(){return this._choiceDefaultType},Game_Message.prototype.choiceCancelType=function(){return this._choiceCancelType},Game_Message.prototype.choiceBackground=function(){return this._choiceBackground},Game_Message.prototype.choicePositionType=function(){return this._choicePositionType},Game_Message.prototype.numInputVariableId=function(){return this._numInputVariableId},Game_Message.prototype.numInputMaxDigits=function(){return this._numInputMaxDigits},Game_Message.prototype.itemChoiceVariableId=function(){return this._itemChoiceVariableId},Game_Message.prototype.itemChoiceItypeId=function(){return this._itemChoiceItypeId},Game_Message.prototype.scrollMode=function(){return this._scrollMode},Game_Message.prototype.scrollSpeed=function(){return this._scrollSpeed},Game_Message.prototype.scrollNoFast=function(){return this._scrollNoFast},Game_Message.prototype.add=function(t){this._texts.push(t)},Game_Message.prototype.setFaceImage=function(t,e){this._faceName=t,this._faceIndex=e},Game_Message.prototype.setBackground=function(t){this._background=t},Game_Message.prototype.setPositionType=function(t){this._positionType=t},Game_Message.prototype.setChoices=function(t,e,i){this._choices=t,this._choiceDefaultType=e,this._choiceCancelType=i},Game_Message.prototype.setChoiceBackground=function(t){this._choiceBackground=t},Game_Message.prototype.setChoicePositionType=function(t){this._choicePositionType=t},Game_Message.prototype.setNumberInput=function(t,e){this._numInputVariableId=t,this._numInputMaxDigits=e},Game_Message.prototype.setItemChoice=function(t,e){this._itemChoiceVariableId=t,this._itemChoiceItypeId=e},Game_Message.prototype.setScroll=function(t,e){this._scrollMode=!0,this._scrollSpeed=t,this._scrollNoFast=e},Game_Message.prototype.setChoiceCallback=function(t){this._choiceCallback=t},Game_Message.prototype.onChoice=function(t){this._choiceCallback&&(this._choiceCallback(t),this._choiceCallback=null)},Game_Message.prototype.hasText=function(){return 0<this._texts.length},Game_Message.prototype.isChoice=function(){return 0<this._choices.length},Game_Message.prototype.isNumberInput=function(){return 0<this._numInputVariableId},Game_Message.prototype.isItemChoice=function(){return 0<this._itemChoiceVariableId},Game_Message.prototype.isBusy=function(){return this.hasText()||this.isChoice()||this.isNumberInput()||this.isItemChoice()},Game_Message.prototype.newPage=function(){0<this._texts.length&&(this._texts[this._texts.length-1]+="\f")},Game_Message.prototype.allText=function(){return this._texts.join("\n")},Game_Switches.prototype.initialize=function(){this.clear()},Game_Switches.prototype.clear=function(){this._data=[]},Game_Switches.prototype.value=function(t){return!!this._data[t]},Game_Switches.prototype.setValue=function(t,e){0<t&&t<$dataSystem.switches.length&&(this._data[t]=e,this.onChange())},Game_Switches.prototype.onChange=function(){$gameMap.requestRefresh()},Game_Variables.prototype.initialize=function(){this.clear()},Game_Variables.prototype.clear=function(){this._data=[]},Game_Variables.prototype.value=function(t){return this._data[t]||0},Game_Variables.prototype.setValue=function(t,e){0<t&&t<$dataSystem.variables.length&&("number"==typeof e&&(e=Math.floor(e)),this._data[t]=e,this.onChange())},Game_Variables.prototype.onChange=function(){$gameMap.requestRefresh()},Game_SelfSwitches.prototype.initialize=function(){this.clear()},Game_SelfSwitches.prototype.clear=function(){this._data={}},Game_SelfSwitches.prototype.value=function(t){return!!this._data[t]},Game_SelfSwitches.prototype.setValue=function(t,e){e?this._data[t]=!0:delete this._data[t],this.onChange()},Game_SelfSwitches.prototype.onChange=function(){$gameMap.requestRefresh()},Game_Screen.prototype.initialize=function(){this.clear()},Game_Screen.prototype.clear=function(){this.clearFade(),this.clearTone(),this.clearFlash(),this.clearShake(),this.clearZoom(),this.clearWeather(),this.clearPictures()},Game_Screen.prototype.onBattleStart=function(){this.clearFade(),this.clearFlash(),this.clearShake(),this.clearZoom(),this.eraseBattlePictures()},Game_Screen.prototype.brightness=function(){return this._brightness},Game_Screen.prototype.tone=function(){return this._tone},Game_Screen.prototype.flashColor=function(){return this._flashColor},Game_Screen.prototype.shake=function(){return this._shake},Game_Screen.prototype.zoomX=function(){return this._zoomX},Game_Screen.prototype.zoomY=function(){return this._zoomY},Game_Screen.prototype.zoomScale=function(){return this._zoomScale},Game_Screen.prototype.weatherType=function(){return this._weatherType},Game_Screen.prototype.weatherPower=function(){return this._weatherPower},Game_Screen.prototype.picture=function(t){return t=this.realPictureId(t),this._pictures[t]},Game_Screen.prototype.realPictureId=function(t){return $gameParty.inBattle()?t+this.maxPictures():t},Game_Screen.prototype.clearFade=function(){this._brightness=255,this._fadeInDuration=this._fadeOutDuration=0},Game_Screen.prototype.clearTone=function(){this._tone=[0,0,0,0],this._toneTarget=[0,0,0,0],this._toneDuration=0},Game_Screen.prototype.clearFlash=function(){this._flashColor=[0,0,0,0],this._flashDuration=0},Game_Screen.prototype.clearShake=function(){this._shakeDuration=this._shakeSpeed=this._shakePower=0,this._shakeDirection=1,this._shake=0},Game_Screen.prototype.clearZoom=function(){this._zoomY=this._zoomX=0,this._zoomScaleTarget=this._zoomScale=1,this._zoomDuration=0},Game_Screen.prototype.clearWeather=function(){this._weatherType="none",this._weatherDuration=this._weatherPowerTarget=this._weatherPower=0},Game_Screen.prototype.clearPictures=function(){this._pictures=[]},Game_Screen.prototype.eraseBattlePictures=function(){this._pictures=this._pictures.slice(0,this.maxPictures()+1)},Game_Screen.prototype.maxPictures=function(){return 100},Game_Screen.prototype.startFadeOut=function(t){this._fadeOutDuration=t,this._fadeInDuration=0},Game_Screen.prototype.startFadeIn=function(t){this._fadeInDuration=t,this._fadeOutDuration=0},Game_Screen.prototype.startTint=function(t,e){this._toneTarget=t.clone(),this._toneDuration=e,0===this._toneDuration&&(this._tone=this._toneTarget.clone())},Game_Screen.prototype.startFlash=function(t,e){this._flashColor=t.clone(),this._flashDuration=e},Game_Screen.prototype.startShake=function(t,e,i){this._shakePower=t,this._shakeSpeed=e,this._shakeDuration=i},Game_Screen.prototype.startZoom=function(t,e,i,a){this._zoomX=t,this._zoomY=e,this._zoomScaleTarget=i,this._zoomDuration=a},Game_Screen.prototype.setZoom=function(t,e,i){this._zoomX=t,this._zoomY=e,this._zoomScale=i},Game_Screen.prototype.changeWeather=function(t,e,i){"none"===t&&0!==i||(this._weatherType=t),this._weatherPowerTarget="none"===t?0:e,0===(this._weatherDuration=i)&&(this._weatherPower=this._weatherPowerTarget)},Game_Screen.prototype.update=function(){this.updateFadeOut(),this.updateFadeIn(),this.updateTone(),this.updateFlash(),this.updateShake(),this.updateZoom(),this.updateWeather(),this.updatePictures()},Game_Screen.prototype.updateFadeOut=function(){if(0<this._fadeOutDuration){var t=this._fadeOutDuration;this._brightness=this._brightness*(t-1)/t,this._fadeOutDuration--}},Game_Screen.prototype.updateFadeIn=function(){if(0<this._fadeInDuration){var t=this._fadeInDuration;this._brightness=(this._brightness*(t-1)+255)/t,this._fadeInDuration--}},Game_Screen.prototype.updateTone=function(){if(0<this._toneDuration){for(var t=this._toneDuration,e=0;e<4;e++)this._tone[e]=(this._tone[e]*(t-1)+this._toneTarget[e])/t;this._toneDuration--}},Game_Screen.prototype.updateFlash=function(){if(0<this._flashDuration){var t=this._flashDuration;this._flashColor[3]*=(t-1)/t,this._flashDuration--}},Game_Screen.prototype.updateShake=function(){if(0<this._shakeDuration||0!==this._shake){var t=this._shakePower*this._shakeSpeed*this._shakeDirection/10;this._shake=this._shakeDuration<=1&&this._shake*(this._shake+t)<0?0:this._shake+t,this._shake>2*this._shakePower&&(this._shakeDirection=-1),this._shake<2*-this._shakePower&&(this._shakeDirection=1),this._shakeDuration--}},Game_Screen.prototype.updateZoom=function(){if(0<this._zoomDuration){var t=this._zoomDuration;this._zoomScale=(this._zoomScale*(t-1)+this._zoomScaleTarget)/t,this._zoomDuration--}},Game_Screen.prototype.updateWeather=function(){if(0<this._weatherDuration){var t=this._weatherDuration;this._weatherPower=(this._weatherPower*(t-1)+this._weatherPowerTarget)/t,this._weatherDuration--,0===this._weatherDuration&&0===this._weatherPowerTarget&&(this._weatherType="none")}},Game_Screen.prototype.updatePictures=function(){this._pictures.forEach(function(t){t&&t.update()})},Game_Screen.prototype.startFlashForDamage=function(){this.startFlash([255,0,0,128],8)},Game_Screen.prototype.showPicture=function(t,e,i,a,n,o,r,s,h){t=this.realPictureId(t);var p=new Game_Picture;p.show(e,i,a,n,o,r,s,h),this._pictures[t]=p},Game_Screen.prototype.movePicture=function(t,e,i,a,n,o,r,s,h){(t=this.picture(t))&&t.move(e,i,a,n,o,r,s,h)},Game_Screen.prototype.rotatePicture=function(t,e){(t=this.picture(t))&&t.rotate(e)},Game_Screen.prototype.tintPicture=function(t,e,i){(t=this.picture(t))&&t.tint(e,i)},Game_Screen.prototype.erasePicture=function(t){t=this.realPictureId(t),this._pictures[t]=null},Game_Picture.prototype.initialize=function(){this.initBasic(),this.initTarget(),this.initTone(),this.initRotation()},Game_Picture.prototype.name=function(){return this._name},Game_Picture.prototype.origin=function(){return this._origin},Game_Picture.prototype.x=function(){return this._x},Game_Picture.prototype.y=function(){return this._y},Game_Picture.prototype.scaleX=function(){return this._scaleX},Game_Picture.prototype.scaleY=function(){return this._scaleY},Game_Picture.prototype.opacity=function(){return this._opacity},Game_Picture.prototype.blendMode=function(){return this._blendMode},Game_Picture.prototype.tone=function(){return this._tone},Game_Picture.prototype.angle=function(){return this._angle},Game_Picture.prototype.initBasic=function(){this._name="",this._y=this._x=this._origin=0,this._scaleY=this._scaleX=100,this._opacity=255,this._blendMode=0},Game_Picture.prototype.initTarget=function(){this._targetX=this._x,this._targetY=this._y,this._targetScaleX=this._scaleX,this._targetScaleY=this._scaleY,this._targetOpacity=this._opacity,this._duration=0},Game_Picture.prototype.initTone=function(){this._toneTarget=this._tone=null,this._toneDuration=0},Game_Picture.prototype.initRotation=function(){this._rotationSpeed=this._angle=0},Game_Picture.prototype.show=function(t,e,i,a,n,o,r,s){this._name=t,this._origin=e,this._x=i,this._y=a,this._scaleX=n,this._scaleY=o,this._opacity=r,this._blendMode=s,this.initTarget(),this.initTone(),this.initRotation()},Game_Picture.prototype.move=function(t,e,i,a,n,o,r,s){this._origin=t,this._targetX=e,this._targetY=i,this._targetScaleX=a,this._targetScaleY=n,this._targetOpacity=o,this._blendMode=r,this._duration=s},Game_Picture.prototype.rotate=function(t){this._rotationSpeed=t},Game_Picture.prototype.tint=function(t,e){this._tone||(this._tone=[0,0,0,0]),this._toneTarget=t.clone(),this._toneDuration=e,0===this._toneDuration&&(this._tone=this._toneTarget.clone())},Game_Picture.prototype.erase=function(){this._name="",this._origin=0,this.initTarget(),this.initTone(),this.initRotation()},Game_Picture.prototype.update=function(){this.updateMove(),this.updateTone(),this.updateRotation()},Game_Picture.prototype.updateMove=function(){if(0<this._duration){var t=this._duration;this._x=(this._x*(t-1)+this._targetX)/t,this._y=(this._y*(t-1)+this._targetY)/t,this._scaleX=(this._scaleX*(t-1)+this._targetScaleX)/t,this._scaleY=(this._scaleY*(t-1)+this._targetScaleY)/t,this._opacity=(this._opacity*(t-1)+this._targetOpacity)/t,this._duration--}},Game_Picture.prototype.updateTone=function(){if(0<this._toneDuration){for(var t=this._toneDuration,e=0;e<4;e++)this._tone[e]=(this._tone[e]*(t-1)+this._toneTarget[e])/t;this._toneDuration--}},Game_Picture.prototype.updateRotation=function(){0!==this._rotationSpeed&&(this._angle+=this._rotationSpeed/2)},Game_Item.prototype.initialize=function(t){this._dataClass="",this._itemId=0,t&&this.setObject(t)},Game_Item.prototype.isSkill=function(){return"skill"===this._dataClass},Game_Item.prototype.isItem=function(){return"item"===this._dataClass},Game_Item.prototype.isUsableItem=function(){return this.isSkill()||this.isItem()},Game_Item.prototype.isWeapon=function(){return"weapon"===this._dataClass},Game_Item.prototype.isArmor=function(){return"armor"===this._dataClass},Game_Item.prototype.isEquipItem=function(){return this.isWeapon()||this.isArmor()},Game_Item.prototype.isNull=function(){return""===this._dataClass},Game_Item.prototype.itemId=function(){return this._itemId},Game_Item.prototype.object=function(){return this.isSkill()?$dataSkills[this._itemId]:this.isItem()?$dataItems[this._itemId]:this.isWeapon()?$dataWeapons[this._itemId]:this.isArmor()?$dataArmors[this._itemId]:null},Game_Item.prototype.setObject=function(t){DataManager.isSkill(t)?this._dataClass="skill":DataManager.isItem(t)?this._dataClass="item":DataManager.isWeapon(t)?this._dataClass="weapon":DataManager.isArmor(t)?this._dataClass="armor":this._dataClass="",this._itemId=t?t.id:0},Game_Item.prototype.setEquip=function(t,e){this._dataClass=t?"weapon":"armor",this._itemId=e},Game_Action.EFFECT_RECOVER_HP=11,Game_Action.EFFECT_RECOVER_MP=12,Game_Action.EFFECT_GAIN_TP=13,Game_Action.EFFECT_ADD_STATE=21,Game_Action.EFFECT_REMOVE_STATE=22,Game_Action.EFFECT_ADD_BUFF=31,Game_Action.EFFECT_ADD_DEBUFF=32,Game_Action.EFFECT_REMOVE_BUFF=33,Game_Action.EFFECT_REMOVE_DEBUFF=34,Game_Action.EFFECT_SPECIAL=41,Game_Action.EFFECT_GROW=42,Game_Action.EFFECT_LEARN_SKILL=43,Game_Action.EFFECT_COMMON_EVENT=44,Game_Action.SPECIAL_EFFECT_ESCAPE=0,Game_Action.HITTYPE_CERTAIN=0,Game_Action.HITTYPE_PHYSICAL=1,Game_Action.HITTYPE_MAGICAL=2,Game_Action.prototype.initialize=function(t,e){this._subjectActorId=0,this._subjectEnemyIndex=-1,this._forcing=e||!1,this.setSubject(t),this.clear()},Game_Action.prototype.clear=function(){this._item=new Game_Item,this._targetIndex=-1},Game_Action.prototype.setSubject=function(t){t.isActor()?(this._subjectActorId=t.actorId(),this._subjectEnemyIndex=-1):(this._subjectEnemyIndex=t.index(),this._subjectActorId=0)},Game_Action.prototype.subject=function(){return 0<this._subjectActorId?$gameActors.actor(this._subjectActorId):$gameTroop.members()[this._subjectEnemyIndex]},Game_Action.prototype.friendsUnit=function(){return this.subject().friendsUnit()},Game_Action.prototype.opponentsUnit=function(){return this.subject().opponentsUnit()},Game_Action.prototype.setEnemyAction=function(t){t?this.setSkill(t.skillId):this.clear()},Game_Action.prototype.setAttack=function(){this.setSkill(this.subject().attackSkillId())},Game_Action.prototype.setGuard=function(){this.setSkill(this.subject().guardSkillId())},Game_Action.prototype.setSkill=function(t){this._item.setObject($dataSkills[t])},Game_Action.prototype.setItem=function(t){this._item.setObject($dataItems[t])},Game_Action.prototype.setItemObject=function(t){this._item.setObject(t)},Game_Action.prototype.setTarget=function(t){this._targetIndex=t},Game_Action.prototype.item=function(){return this._item.object()},Game_Action.prototype.isSkill=function(){return this._item.isSkill()},Game_Action.prototype.isItem=function(){return this._item.isItem()},Game_Action.prototype.numRepeats=function(){var t=this.item().repeats;return this.isAttack()&&(t+=this.subject().attackTimesAdd()),Math.floor(t)},Game_Action.prototype.checkItemScope=function(t){return t.contains(this.item().scope)},Game_Action.prototype.isForOpponent=function(){return this.checkItemScope([1,2,3,4,5,6])},Game_Action.prototype.isForFriend=function(){return this.checkItemScope([7,8,9,10,11])},Game_Action.prototype.isForDeadFriend=function(){return this.checkItemScope([9,10])},Game_Action.prototype.isForUser=function(){return this.checkItemScope([11])},Game_Action.prototype.isForOne=function(){return this.checkItemScope([1,3,7,9,11])},Game_Action.prototype.isForRandom=function(){return this.checkItemScope([3,4,5,6])},Game_Action.prototype.isForAll=function(){return this.checkItemScope([2,8,10])},Game_Action.prototype.needsSelection=function(){return this.checkItemScope([1,7,9])},Game_Action.prototype.numTargets=function(){return this.isForRandom()?this.item().scope-2:0},Game_Action.prototype.checkDamageType=function(t){return t.contains(this.item().damage.type)},Game_Action.prototype.isHpEffect=function(){return this.checkDamageType([1,3,5])},Game_Action.prototype.isMpEffect=function(){return this.checkDamageType([2,4,6])},Game_Action.prototype.isDamage=function(){return this.checkDamageType([1,2])},Game_Action.prototype.isRecover=function(){return this.checkDamageType([3,4])},Game_Action.prototype.isDrain=function(){return this.checkDamageType([5,6])},Game_Action.prototype.isHpRecover=function(){return this.checkDamageType([3])},Game_Action.prototype.isMpRecover=function(){return this.checkDamageType([4])},Game_Action.prototype.isCertainHit=function(){return this.item().hitType===Game_Action.HITTYPE_CERTAIN},Game_Action.prototype.isPhysical=function(){return this.item().hitType===Game_Action.HITTYPE_PHYSICAL},Game_Action.prototype.isMagical=function(){return this.item().hitType===Game_Action.HITTYPE_MAGICAL},Game_Action.prototype.isAttack=function(){return this.item()===$dataSkills[this.subject().attackSkillId()]},Game_Action.prototype.isGuard=function(){return this.item()===$dataSkills[this.subject().guardSkillId()]},Game_Action.prototype.isMagicSkill=function(){return!!this.isSkill()&&$dataSystem.magicSkills.contains(this.item().stypeId)},Game_Action.prototype.decideRandomTarget=function(){var t;(t=this.isForDeadFriend()?this.friendsUnit().randomDeadTarget():this.isForFriend()?this.friendsUnit().randomTarget():this.opponentsUnit().randomTarget())?this._targetIndex=t.index():this.clear()},Game_Action.prototype.setConfusion=function(){this.setAttack()},Game_Action.prototype.prepare=function(){this.subject().isConfused()&&!this._forcing&&this.setConfusion()},Game_Action.prototype.isValid=function(){return this._forcing&&this.item()||this.subject().canUse(this.item())},Game_Action.prototype.speed=function(){var t=this.subject().agi;return t+=Math.randomInt(Math.floor(5+t/4)),this.item()&&(t+=this.item().speed),this.isAttack()&&(t+=this.subject().attackSpeed()),t},Game_Action.prototype.makeTargets=function(){var t=[];return!this._forcing&&this.subject().isConfused()?t=[this.confusionTarget()]:this.isForOpponent()?t=this.targetsForOpponents():this.isForFriend()&&(t=this.targetsForFriends()),this.repeatTargets(t)},Game_Action.prototype.repeatTargets=function(t){for(var e=[],i=this.numRepeats(),a=0;a<t.length;a++){var n=t[a];if(n)for(var o=0;o<i;o++)e.push(n)}return e},Game_Action.prototype.confusionTarget=function(){switch(this.subject().confusionLevel()){case 1:return this.opponentsUnit().randomTarget();case 2:return 0===Math.randomInt(2)?this.opponentsUnit().randomTarget():this.friendsUnit().randomTarget();default:return this.friendsUnit().randomTarget()}},Game_Action.prototype.targetsForOpponents=function(){var t=[],e=this.opponentsUnit();if(this.isForRandom())for(var i=0;i<this.numTargets();i++)t.push(e.randomTarget());else this.isForOne()?this._targetIndex<0?t.push(e.randomTarget()):t.push(e.smoothTarget(this._targetIndex)):t=e.aliveMembers();return t},Game_Action.prototype.targetsForFriends=function(){var t=[],e=this.friendsUnit();return this.isForUser()?[this.subject()]:(this.isForDeadFriend()?this.isForOne()?t.push(e.smoothDeadTarget(this._targetIndex)):t=e.deadMembers():this.isForOne()?this._targetIndex<0?t.push(e.randomTarget()):t.push(e.smoothTarget(this._targetIndex)):t=e.aliveMembers(),t)},Game_Action.prototype.evaluate=function(){var i=0;return this.itemTargetCandidates().forEach(function(t){var e=this.evaluateWithTarget(t);this.isForAll()?i+=e:i<e&&(i=e,this._targetIndex=t.index())},this),0<(i*=this.numRepeats())&&(i+=Math.random()),i},Game_Action.prototype.itemTargetCandidates=function(){return this.isValid()?this.isForOpponent()?this.opponentsUnit().aliveMembers():this.isForUser()?[this.subject()]:this.isForDeadFriend()?this.friendsUnit().deadMembers():this.friendsUnit().aliveMembers():[]},Game_Action.prototype.evaluateWithTarget=function(t){if(this.isHpEffect()){var e=this.makeDamageValue(t,!1);return this.isForOpponent()?e/Math.max(t.hp,1):Math.min(-e,t.mhp-t.hp)/t.mhp}},Game_Action.prototype.testApply=function(t){return this.isForDeadFriend()===t.isDead()&&($gameParty.inBattle()||this.isForOpponent()||this.isHpRecover()&&t.hp<t.mhp||this.isMpRecover()&&t.mp<t.mmp||this.hasItemAnyValidEffects(t))},Game_Action.prototype.hasItemAnyValidEffects=function(e){return this.item().effects.some(function(t){return this.testItemEffect(e,t)},this)},Game_Action.prototype.testItemEffect=function(t,e){switch(e.code){case Game_Action.EFFECT_RECOVER_HP:return t.hp<t.mhp||e.value1<0||e.value2<0;case Game_Action.EFFECT_RECOVER_MP:return t.mp<t.mmp||e.value1<0||e.value2<0;case Game_Action.EFFECT_ADD_STATE:return!t.isStateAffected(e.dataId);case Game_Action.EFFECT_REMOVE_STATE:return t.isStateAffected(e.dataId);case Game_Action.EFFECT_ADD_BUFF:return!t.isMaxBuffAffected(e.dataId);case Game_Action.EFFECT_ADD_DEBUFF:return!t.isMaxDebuffAffected(e.dataId);case Game_Action.EFFECT_REMOVE_BUFF:return t.isBuffAffected(e.dataId);case Game_Action.EFFECT_REMOVE_DEBUFF:return t.isDebuffAffected(e.dataId);case Game_Action.EFFECT_LEARN_SKILL:return t.isActor()&&!t.isLearnedSkill(e.dataId);default:return!0}},Game_Action.prototype.itemCnt=function(t){return this.isPhysical()&&t.canMove()?t.cnt:0},Game_Action.prototype.itemMrf=function(t){return this.isMagical()?t.mrf:0},Game_Action.prototype.itemHit=function(t){return this.isPhysical()?.01*this.item().successRate*this.subject().hit:.01*this.item().successRate},Game_Action.prototype.itemEva=function(t){return this.isPhysical()?t.eva:this.isMagical()?t.mev:0},Game_Action.prototype.itemCri=function(t){return this.item().damage.critical?this.subject().cri*(1-t.cev):0},Game_Action.prototype.apply=function(e){var t=e.result();this.subject().clearResult(),t.clear(),t.used=this.testApply(e),t.missed=t.used&&Math.random()>=this.itemHit(e),t.evaded=!t.missed&&Math.random()<this.itemEva(e),t.physical=this.isPhysical(),t.drain=this.isDrain(),t.isHit()&&(0<this.item().damage.type&&(t.critical=Math.random()<this.itemCri(e),t=this.makeDamageValue(e,t.critical),this.executeDamage(e,t)),this.item().effects.forEach(function(t){this.applyItemEffect(e,t)},this),this.applyItemUserEffect(e))},Game_Action.prototype.makeDamageValue=function(t,e){var i=this.item(),a=this.evalDamageFormula(t),n=a*this.calcElementRate(t);return this.isPhysical()&&(n*=t.pdr),this.isMagical()&&(n*=t.mdr),a<0&&(n*=t.rec),e&&(n=this.applyCritical(n)),n=this.applyVariance(n,i.damage.variance),n=this.applyGuard(n,t),Math.round(n)},Game_Action.prototype.evalDamageFormula=function(a){try{var b=this.item();this.subject();var c=[3,4].contains(b.damage.type)?-1:1,d=Math.max(eval(b.damage.formula),0)*c;return isNaN(d)&&(d=0),d}catch(t){return 0}},Game_Action.prototype.calcElementRate=function(t){return this.item().damage.elementId<0?this.elementsMaxRate(t,this.subject().attackElements()):t.elementRate(this.item().damage.elementId)},Game_Action.prototype.elementsMaxRate=function(e,t){return 0<t.length?Math.max.apply(null,t.map(function(t){return e.elementRate(t)},this)):1},Game_Action.prototype.applyCritical=function(t){return 3*t},Game_Action.prototype.applyVariance=function(t,e){return e=Math.floor(Math.max(Math.abs(t)*e/100,0)),e=Math.randomInt(e+1)+Math.randomInt(e+1)-e,0<=t?t+e:t-e},Game_Action.prototype.applyGuard=function(t,e){return t/(0<t&&e.isGuard()?2*e.grd:1)},Game_Action.prototype.executeDamage=function(t,e){var i=t.result();0===e&&(i.critical=!1),this.isHpEffect()&&this.executeHpDamage(t,e),this.isMpEffect()&&this.executeMpDamage(t,e)},Game_Action.prototype.executeHpDamage=function(t,e){this.isDrain()&&(e=Math.min(t.hp,e)),this.makeSuccess(t),t.gainHp(-e),0<e&&t.onDamage(e),this.gainDrainedHp(e)},Game_Action.prototype.executeMpDamage=function(t,e){this.isMpRecover()||(e=Math.min(t.mp,e)),0!==e&&this.makeSuccess(t),t.gainMp(-e),this.gainDrainedMp(e)},Game_Action.prototype.gainDrainedHp=function(t){if(this.isDrain()){var e=this.subject();void 0!==this._reflectionTarget&&(e=this._reflectionTarget),e.gainHp(t)}},Game_Action.prototype.gainDrainedMp=function(t){if(this.isDrain()){var e=this.subject();void 0!==this._reflectionTarget&&(e=this._reflectionTarget),e.gainMp(t)}},Game_Action.prototype.applyItemEffect=function(t,e){switch(e.code){case Game_Action.EFFECT_RECOVER_HP:this.itemEffectRecoverHp(t,e);break;case Game_Action.EFFECT_RECOVER_MP:this.itemEffectRecoverMp(t,e);break;case Game_Action.EFFECT_GAIN_TP:this.itemEffectGainTp(t,e);break;case Game_Action.EFFECT_ADD_STATE:this.itemEffectAddState(t,e);break;case Game_Action.EFFECT_REMOVE_STATE:this.itemEffectRemoveState(t,e);break;case Game_Action.EFFECT_ADD_BUFF:this.itemEffectAddBuff(t,e);break;case Game_Action.EFFECT_ADD_DEBUFF:this.itemEffectAddDebuff(t,e);break;case Game_Action.EFFECT_REMOVE_BUFF:this.itemEffectRemoveBuff(t,e);break;case Game_Action.EFFECT_REMOVE_DEBUFF:this.itemEffectRemoveDebuff(t,e);break;case Game_Action.EFFECT_SPECIAL:this.itemEffectSpecial(t,e);break;case Game_Action.EFFECT_GROW:this.itemEffectGrow(t,e);break;case Game_Action.EFFECT_LEARN_SKILL:this.itemEffectLearnSkill(t,e);break;case Game_Action.EFFECT_COMMON_EVENT:this.itemEffectCommonEvent(t,e)}},Game_Action.prototype.itemEffectRecoverHp=function(t,e){e=(t.mhp*e.value1+e.value2)*t.rec,this.isItem()&&(e*=this.subject().pha),0!==(e=Math.floor(e))&&(t.gainHp(e),this.makeSuccess(t))},Game_Action.prototype.itemEffectRecoverMp=function(t,e){e=(t.mmp*e.value1+e.value2)*t.rec,this.isItem()&&(e*=this.subject().pha),0!==(e=Math.floor(e))&&(t.gainMp(e),this.makeSuccess(t))},Game_Action.prototype.itemEffectGainTp=function(t,e){0!==(e=Math.floor(e.value1))&&(t.gainTp(e),this.makeSuccess(t))},Game_Action.prototype.itemEffectAddState=function(t,e){0===e.dataId?this.itemEffectAddAttackState(t,e):this.itemEffectAddNormalState(t,e)},Game_Action.prototype.itemEffectAddAttackState=function(i,a){this.subject().attackStates().forEach(function(t){var e=a.value1;e*=i.stateRate(t),e*=this.subject().attackStatesRate(t),e*=this.lukEffectRate(i),Math.random()<e&&(i.addState(t),this.makeSuccess(i))}.bind(this),i)},Game_Action.prototype.itemEffectAddNormalState=function(t,e){var i=e.value1;this.isCertainHit()||(i*=t.stateRate(e.dataId),i*=this.lukEffectRate(t)),Math.random()<i&&(t.addState(e.dataId),this.makeSuccess(t))},Game_Action.prototype.itemEffectRemoveState=function(t,e){Math.random()<e.value1&&(t.removeState(e.dataId),this.makeSuccess(t))},Game_Action.prototype.itemEffectAddBuff=function(t,e){t.addBuff(e.dataId,e.value1),this.makeSuccess(t)},Game_Action.prototype.itemEffectAddDebuff=function(t,e){var i=t.debuffRate(e.dataId)*this.lukEffectRate(t);Math.random()<i&&(t.addDebuff(e.dataId,e.value1),this.makeSuccess(t))},Game_Action.prototype.itemEffectRemoveBuff=function(t,e){t.isBuffAffected(e.dataId)&&(t.removeBuff(e.dataId),this.makeSuccess(t))},Game_Action.prototype.itemEffectRemoveDebuff=function(t,e){t.isDebuffAffected(e.dataId)&&(t.removeBuff(e.dataId),this.makeSuccess(t))},Game_Action.prototype.itemEffectSpecial=function(t,e){e.dataId===Game_Action.SPECIAL_EFFECT_ESCAPE&&(t.escape(),this.makeSuccess(t))},Game_Action.prototype.itemEffectGrow=function(t,e){t.addParam(e.dataId,Math.floor(e.value1)),this.makeSuccess(t)},Game_Action.prototype.itemEffectLearnSkill=function(t,e){t.isActor()&&(t.learnSkill(e.dataId),this.makeSuccess(t))},Game_Action.prototype.itemEffectCommonEvent=function(t,e){},Game_Action.prototype.makeSuccess=function(t){t.result().success=!0},Game_Action.prototype.applyItemUserEffect=function(t){t=Math.floor(this.item().tpGain*this.subject().tcr),this.subject().gainSilentTp(t)},Game_Action.prototype.lukEffectRate=function(t){return Math.max(1+.001*(this.subject().luk-t.luk),0)},Game_Action.prototype.applyGlobal=function(){this.item().effects.forEach(function(t){t.code===Game_Action.EFFECT_COMMON_EVENT&&$gameTemp.reserveCommonEvent(t.dataId)},this)},Game_ActionResult.prototype.initialize=function(){this.clear()},Game_ActionResult.prototype.clear=function(){this.hpAffected=this.success=this.critical=this.drain=this.physical=this.evaded=this.missed=this.used=!1,this.tpDamage=this.mpDamage=this.hpDamage=0,this.addedStates=[],this.removedStates=[],this.addedBuffs=[],this.addedDebuffs=[],this.removedBuffs=[]},Game_ActionResult.prototype.addedStateObjects=function(){return this.addedStates.map(function(t){return $dataStates[t]})},Game_ActionResult.prototype.removedStateObjects=function(){return this.removedStates.map(function(t){return $dataStates[t]})},Game_ActionResult.prototype.isStatusAffected=function(){return 0<this.addedStates.length||0<this.removedStates.length||0<this.addedBuffs.length||0<this.addedDebuffs.length||0<this.removedBuffs.length},Game_ActionResult.prototype.isHit=function(){return this.used&&!this.missed&&!this.evaded},Game_ActionResult.prototype.isStateAdded=function(t){return this.addedStates.contains(t)},Game_ActionResult.prototype.pushAddedState=function(t){this.isStateAdded(t)||this.addedStates.push(t)},Game_ActionResult.prototype.isStateRemoved=function(t){return this.removedStates.contains(t)},Game_ActionResult.prototype.pushRemovedState=function(t){this.isStateRemoved(t)||this.removedStates.push(t)},Game_ActionResult.prototype.isBuffAdded=function(t){return this.addedBuffs.contains(t)},Game_ActionResult.prototype.pushAddedBuff=function(t){this.isBuffAdded(t)||this.addedBuffs.push(t)},Game_ActionResult.prototype.isDebuffAdded=function(t){return this.addedDebuffs.contains(t)},Game_ActionResult.prototype.pushAddedDebuff=function(t){this.isDebuffAdded(t)||this.addedDebuffs.push(t)},Game_ActionResult.prototype.isBuffRemoved=function(t){return this.removedBuffs.contains(t)},Game_ActionResult.prototype.pushRemovedBuff=function(t){this.isBuffRemoved(t)||this.removedBuffs.push(t)},Game_BattlerBase.TRAIT_ELEMENT_RATE=11,Game_BattlerBase.TRAIT_DEBUFF_RATE=12,Game_BattlerBase.TRAIT_STATE_RATE=13,Game_BattlerBase.TRAIT_STATE_RESIST=14,Game_BattlerBase.TRAIT_PARAM=21,Game_BattlerBase.TRAIT_XPARAM=22,Game_BattlerBase.TRAIT_SPARAM=23,Game_BattlerBase.TRAIT_ATTACK_ELEMENT=31,Game_BattlerBase.TRAIT_ATTACK_STATE=32,Game_BattlerBase.TRAIT_ATTACK_SPEED=33,Game_BattlerBase.TRAIT_ATTACK_TIMES=34,Game_BattlerBase.TRAIT_STYPE_ADD=41,Game_BattlerBase.TRAIT_STYPE_SEAL=42,Game_BattlerBase.TRAIT_SKILL_ADD=43,Game_BattlerBase.TRAIT_SKILL_SEAL=44,Game_BattlerBase.TRAIT_EQUIP_WTYPE=51,Game_BattlerBase.TRAIT_EQUIP_ATYPE=52,Game_BattlerBase.TRAIT_EQUIP_LOCK=53,Game_BattlerBase.TRAIT_EQUIP_SEAL=54,Game_BattlerBase.TRAIT_SLOT_TYPE=55,Game_BattlerBase.TRAIT_ACTION_PLUS=61,Game_BattlerBase.TRAIT_SPECIAL_FLAG=62,Game_BattlerBase.TRAIT_COLLAPSE_TYPE=63,Game_BattlerBase.TRAIT_PARTY_ABILITY=64,Game_BattlerBase.FLAG_ID_AUTO_BATTLE=0,Game_BattlerBase.FLAG_ID_GUARD=1,Game_BattlerBase.FLAG_ID_SUBSTITUTE=2,Game_BattlerBase.FLAG_ID_PRESERVE_TP=3,Game_BattlerBase.ICON_BUFF_START=32,Game_BattlerBase.ICON_DEBUFF_START=48,Object.defineProperties(Game_BattlerBase.prototype,{hp:{get:function(){return this._hp},configurable:!0},mp:{get:function(){return this._mp},configurable:!0},tp:{get:function(){return this._tp},configurable:!0},mhp:{get:function(){return this.param(0)},configurable:!0},mmp:{get:function(){return this.param(1)},configurable:!0},atk:{get:function(){return this.param(2)},configurable:!0},def:{get:function(){return this.param(3)},configurable:!0},mat:{get:function(){return this.param(4)},configurable:!0},mdf:{get:function(){return this.param(5)},configurable:!0},agi:{get:function(){return this.param(6)},configurable:!0},luk:{get:function(){return this.param(7)},configurable:!0},hit:{get:function(){return this.xparam(0)},configurable:!0},eva:{get:function(){return this.xparam(1)},configurable:!0},cri:{get:function(){return this.xparam(2)},configurable:!0},cev:{get:function(){return this.xparam(3)},configurable:!0},mev:{get:function(){return this.xparam(4)},configurable:!0},mrf:{get:function(){return this.xparam(5)},configurable:!0},cnt:{get:function(){return this.xparam(6)},configurable:!0},hrg:{get:function(){return this.xparam(7)},configurable:!0},mrg:{get:function(){return this.xparam(8)},configurable:!0},trg:{get:function(){return this.xparam(9)},configurable:!0},tgr:{get:function(){return this.sparam(0)},configurable:!0},grd:{get:function(){return this.sparam(1)},configurable:!0},rec:{get:function(){return this.sparam(2)},configurable:!0},pha:{get:function(){return this.sparam(3)},configurable:!0},mcr:{get:function(){return this.sparam(4)},configurable:!0},tcr:{get:function(){return this.sparam(5)},configurable:!0},pdr:{get:function(){return this.sparam(6)},configurable:!0},mdr:{get:function(){return this.sparam(7)},configurable:!0},fdr:{get:function(){return this.sparam(8)},configurable:!0},exr:{get:function(){return this.sparam(9)},configurable:!0}}),Game_BattlerBase.prototype.initialize=function(){this.initMembers()},Game_BattlerBase.prototype.initMembers=function(){this._hp=1,this._tp=this._mp=0,this._hidden=!1,this.clearParamPlus(),this.clearStates(),this.clearBuffs()},Game_BattlerBase.prototype.clearParamPlus=function(){this._paramPlus=[0,0,0,0,0,0,0,0]},Game_BattlerBase.prototype.clearStates=function(){this._states=[],this._stateTurns={}},Game_BattlerBase.prototype.eraseState=function(t){var e=this._states.indexOf(t);0<=e&&this._states.splice(e,1),delete this._stateTurns[t]},Game_BattlerBase.prototype.isStateAffected=function(t){return this._states.contains(t)},Game_BattlerBase.prototype.isDeathStateAffected=function(){return this.isStateAffected(this.deathStateId())},Game_BattlerBase.prototype.deathStateId=function(){return 1},Game_BattlerBase.prototype.resetStateCounts=function(t){var e=$dataStates[t];this._stateTurns[t]=e.minTurns+Math.randomInt(1+Math.max(e.maxTurns-e.minTurns,0))},Game_BattlerBase.prototype.isStateExpired=function(t){return 0===this._stateTurns[t]},Game_BattlerBase.prototype.updateStateTurns=function(){this._states.forEach(function(t){0<this._stateTurns[t]&&this._stateTurns[t]--},this)},Game_BattlerBase.prototype.clearBuffs=function(){this._buffs=[0,0,0,0,0,0,0,0],this._buffTurns=[0,0,0,0,0,0,0,0]},Game_BattlerBase.prototype.eraseBuff=function(t){this._buffs[t]=0,this._buffTurns[t]=0},Game_BattlerBase.prototype.buffLength=function(){return this._buffs.length},Game_BattlerBase.prototype.buff=function(t){return this._buffs[t]},Game_BattlerBase.prototype.isBuffAffected=function(t){return 0<this._buffs[t]},Game_BattlerBase.prototype.isDebuffAffected=function(t){return this._buffs[t]<0},Game_BattlerBase.prototype.isBuffOrDebuffAffected=function(t){return 0!==this._buffs[t]},Game_BattlerBase.prototype.isMaxBuffAffected=function(t){return 2===this._buffs[t]},Game_BattlerBase.prototype.isMaxDebuffAffected=function(t){return-2===this._buffs[t]},Game_BattlerBase.prototype.increaseBuff=function(t){this.isMaxBuffAffected(t)||this._buffs[t]++},Game_BattlerBase.prototype.decreaseBuff=function(t){this.isMaxDebuffAffected(t)||this._buffs[t]--},Game_BattlerBase.prototype.overwriteBuffTurns=function(t,e){this._buffTurns[t]<e&&(this._buffTurns[t]=e)},Game_BattlerBase.prototype.isBuffExpired=function(t){return 0===this._buffTurns[t]},Game_BattlerBase.prototype.updateBuffTurns=function(){for(var t=0;t<this._buffTurns.length;t++)0<this._buffTurns[t]&&this._buffTurns[t]--},Game_BattlerBase.prototype.die=function(){this._hp=0,this.clearStates(),this.clearBuffs()},Game_BattlerBase.prototype.revive=function(){0===this._hp&&(this._hp=1)},Game_BattlerBase.prototype.states=function(){return this._states.map(function(t){return $dataStates[t]})},Game_BattlerBase.prototype.stateIcons=function(){return this.states().map(function(t){return t.iconIndex}).filter(function(t){return 0<t})},Game_BattlerBase.prototype.buffIcons=function(){for(var t=[],e=0;e<this._buffs.length;e++)0!==this._buffs[e]&&t.push(this.buffIconIndex(this._buffs[e],e));return t},Game_BattlerBase.prototype.buffIconIndex=function(t,e){return 0<t?Game_BattlerBase.ICON_BUFF_START+8*(t-1)+e:t<0?Game_BattlerBase.ICON_DEBUFF_START+8*(-t-1)+e:0},Game_BattlerBase.prototype.allIcons=function(){return this.stateIcons().concat(this.buffIcons())},Game_BattlerBase.prototype.traitObjects=function(){return this.states()},Game_BattlerBase.prototype.allTraits=function(){return this.traitObjects().reduce(function(t,e){return t.concat(e.traits)},[])},Game_BattlerBase.prototype.traits=function(e){return this.allTraits().filter(function(t){return t.code===e})},Game_BattlerBase.prototype.traitsWithId=function(e,i){return this.allTraits().filter(function(t){return t.code===e&&t.dataId===i})},Game_BattlerBase.prototype.traitsPi=function(t,e){return this.traitsWithId(t,e).reduce(function(t,e){return t*e.value},1)},Game_BattlerBase.prototype.traitsSum=function(t,e){return this.traitsWithId(t,e).reduce(function(t,e){return t+e.value},0)},Game_BattlerBase.prototype.traitsSumAll=function(t){return this.traits(t).reduce(function(t,e){return t+e.value},0)},Game_BattlerBase.prototype.traitsSet=function(t){return this.traits(t).reduce(function(t,e){return t.concat(e.dataId)},[])},Game_BattlerBase.prototype.paramBase=function(t){return 0},Game_BattlerBase.prototype.paramPlus=function(t){return this._paramPlus[t]},Game_BattlerBase.prototype.paramMin=function(t){return 1===t?0:1},Game_BattlerBase.prototype.paramMax=function(t){return 0===t?999999:1===t?9999:999},Game_BattlerBase.prototype.paramRate=function(t){return this.traitsPi(Game_BattlerBase.TRAIT_PARAM,t)},Game_BattlerBase.prototype.paramBuffRate=function(t){return.25*this._buffs[t]+1},Game_BattlerBase.prototype.param=function(t){var e=this.paramBase(t)+this.paramPlus(t);e*=this.paramRate(t)*this.paramBuffRate(t);var i=this.paramMax(t);return t=this.paramMin(t),Math.round(e.clamp(t,i))},Game_BattlerBase.prototype.xparam=function(t){return this.traitsSum(Game_BattlerBase.TRAIT_XPARAM,t)},Game_BattlerBase.prototype.sparam=function(t){return this.traitsPi(Game_BattlerBase.TRAIT_SPARAM,t)},Game_BattlerBase.prototype.elementRate=function(t){return this.traitsPi(Game_BattlerBase.TRAIT_ELEMENT_RATE,t)},Game_BattlerBase.prototype.debuffRate=function(t){return this.traitsPi(Game_BattlerBase.TRAIT_DEBUFF_RATE,t)},Game_BattlerBase.prototype.stateRate=function(t){return this.traitsPi(Game_BattlerBase.TRAIT_STATE_RATE,t)},Game_BattlerBase.prototype.stateResistSet=function(){return this.traitsSet(Game_BattlerBase.TRAIT_STATE_RESIST)},Game_BattlerBase.prototype.isStateResist=function(t){return this.stateResistSet().contains(t)},Game_BattlerBase.prototype.attackElements=function(){return this.traitsSet(Game_BattlerBase.TRAIT_ATTACK_ELEMENT)},Game_BattlerBase.prototype.attackStates=function(){return this.traitsSet(Game_BattlerBase.TRAIT_ATTACK_STATE)},Game_BattlerBase.prototype.attackStatesRate=function(t){return this.traitsSum(Game_BattlerBase.TRAIT_ATTACK_STATE,t)},Game_BattlerBase.prototype.attackSpeed=function(){return this.traitsSumAll(Game_BattlerBase.TRAIT_ATTACK_SPEED)},Game_BattlerBase.prototype.attackTimesAdd=function(){return Math.max(this.traitsSumAll(Game_BattlerBase.TRAIT_ATTACK_TIMES),0)},Game_BattlerBase.prototype.addedSkillTypes=function(){return this.traitsSet(Game_BattlerBase.TRAIT_STYPE_ADD)};function Game_Follower(){this.initialize.apply(this,arguments)}function Game_Followers(){this.initialize.apply(this,arguments)}function Game_Vehicle(){this.initialize.apply(this,arguments)}function Game_Event(){this.initialize.apply(this,arguments)}function Game_Interpreter(){this.initialize.apply(this,arguments)}function Scene_Base(){this.initialize.apply(this,arguments)}function Scene_Boot(){this.initialize.apply(this,arguments)}function Scene_Title(){this.initialize.apply(this,arguments)}function Scene_Map(){this.initialize.apply(this,arguments)}function Scene_MenuBase(){this.initialize.apply(this,arguments)}function Scene_Menu(){this.initialize.apply(this,arguments)}function Scene_ItemBase(){this.initialize.apply(this,arguments)}function Scene_Item(){this.initialize.apply(this,arguments)}function Scene_Skill(){this.initialize.apply(this,arguments)}function Scene_Equip(){this.initialize.apply(this,arguments)}function Scene_Status(){this.initialize.apply(this,arguments)}function Scene_Options(){this.initialize.apply(this,arguments)}function Scene_File(){this.initialize.apply(this,arguments)}function Scene_Save(){this.initialize.apply(this,arguments)}function Scene_Load(){this.initialize.apply(this,arguments)}function Scene_GameEnd(){this.initialize.apply(this,arguments)}function Scene_Shop(){this.initialize.apply(this,arguments)}function Scene_Name(){this.initialize.apply(this,arguments)}function Scene_Debug(){this.initialize.apply(this,arguments)}function Scene_Battle(){this.initialize.apply(this,arguments)}function Scene_Gameover(){this.initialize.apply(this,arguments)}function Sprite_Base(){this.initialize.apply(this,arguments)}function Sprite_Button(){this.initialize.apply(this,arguments)}function Sprite_Character(){this.initialize.apply(this,arguments)}function Sprite_Battler(){this.initialize.apply(this,arguments)}function Sprite_Actor(){this.initialize.apply(this,arguments)}function Sprite_Enemy(){this.initialize.apply(this,arguments)}function Sprite_Animation(){this.initialize.apply(this,arguments)}Game_BattlerBase.prototype.isSkillTypeSealed=function(t){return this.traitsSet(Game_BattlerBase.TRAIT_STYPE_SEAL).contains(t)},Game_BattlerBase.prototype.addedSkills=function(){return this.traitsSet(Game_BattlerBase.TRAIT_SKILL_ADD)},Game_BattlerBase.prototype.isSkillSealed=function(t){return this.traitsSet(Game_BattlerBase.TRAIT_SKILL_SEAL).contains(t)},Game_BattlerBase.prototype.isEquipWtypeOk=function(t){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_WTYPE).contains(t)},Game_BattlerBase.prototype.isEquipAtypeOk=function(t){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_ATYPE).contains(t)},Game_BattlerBase.prototype.isEquipTypeLocked=function(t){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_LOCK).contains(t)},Game_BattlerBase.prototype.isEquipTypeSealed=function(t){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_SEAL).contains(t)},Game_BattlerBase.prototype.slotType=function(){var t=this.traitsSet(Game_BattlerBase.TRAIT_SLOT_TYPE);return 0<t.length?Math.max.apply(null,t):0},Game_BattlerBase.prototype.isDualWield=function(){return 1===this.slotType()},Game_BattlerBase.prototype.actionPlusSet=function(){return this.traits(Game_BattlerBase.TRAIT_ACTION_PLUS).map(function(t){return t.value})},Game_BattlerBase.prototype.specialFlag=function(e){return this.traits(Game_BattlerBase.TRAIT_SPECIAL_FLAG).some(function(t){return t.dataId===e})},Game_BattlerBase.prototype.collapseType=function(){var t=this.traitsSet(Game_BattlerBase.TRAIT_COLLAPSE_TYPE);return 0<t.length?Math.max.apply(null,t):0},Game_BattlerBase.prototype.partyAbility=function(e){return this.traits(Game_BattlerBase.TRAIT_PARTY_ABILITY).some(function(t){return t.dataId===e})},Game_BattlerBase.prototype.isAutoBattle=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_AUTO_BATTLE)},Game_BattlerBase.prototype.isGuard=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_GUARD)&&this.canMove()},Game_BattlerBase.prototype.isSubstitute=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_SUBSTITUTE)&&this.canMove()},Game_BattlerBase.prototype.isPreserveTp=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_PRESERVE_TP)},Game_BattlerBase.prototype.addParam=function(t,e){this._paramPlus[t]+=e,this.refresh()},Game_BattlerBase.prototype.setHp=function(t){this._hp=t,this.refresh()},Game_BattlerBase.prototype.setMp=function(t){this._mp=t,this.refresh()},Game_BattlerBase.prototype.setTp=function(t){this._tp=t,this.refresh()},Game_BattlerBase.prototype.maxTp=function(){return 100},Game_BattlerBase.prototype.refresh=function(){this.stateResistSet().forEach(function(t){this.eraseState(t)},this),this._hp=this._hp.clamp(0,this.mhp),this._mp=this._mp.clamp(0,this.mmp),this._tp=this._tp.clamp(0,this.maxTp())},Game_BattlerBase.prototype.recoverAll=function(){this.clearStates(),this._hp=this.mhp,this._mp=this.mmp},Game_BattlerBase.prototype.hpRate=function(){return this.hp/this.mhp},Game_BattlerBase.prototype.mpRate=function(){return 0<this.mmp?this.mp/this.mmp:0},Game_BattlerBase.prototype.tpRate=function(){return this.tp/this.maxTp()},Game_BattlerBase.prototype.hide=function(){this._hidden=!0},Game_BattlerBase.prototype.appear=function(){this._hidden=!1},Game_BattlerBase.prototype.isHidden=function(){return this._hidden},Game_BattlerBase.prototype.isAppeared=function(){return!this.isHidden()},Game_BattlerBase.prototype.isDead=function(){return this.isAppeared()&&this.isDeathStateAffected()},Game_BattlerBase.prototype.isAlive=function(){return this.isAppeared()&&!this.isDeathStateAffected()},Game_BattlerBase.prototype.isDying=function(){return this.isAlive()&&this._hp<this.mhp/4},Game_BattlerBase.prototype.isRestricted=function(){return this.isAppeared()&&0<this.restriction()},Game_BattlerBase.prototype.canInput=function(){return this.isAppeared()&&!this.isRestricted()&&!this.isAutoBattle()},Game_BattlerBase.prototype.canMove=function(){return this.isAppeared()&&this.restriction()<4},Game_BattlerBase.prototype.isConfused=function(){return this.isAppeared()&&1<=this.restriction()&&this.restriction()<=3},Game_BattlerBase.prototype.confusionLevel=function(){return this.isConfused()?this.restriction():0},Game_BattlerBase.prototype.isActor=function(){return!1},Game_BattlerBase.prototype.isEnemy=function(){return!1},Game_BattlerBase.prototype.sortStates=function(){this._states.sort(function(t,e){var i=$dataStates[t].priority,a=$dataStates[e].priority;return i!==a?a-i:t-e})},Game_BattlerBase.prototype.restriction=function(){return Math.max.apply(null,this.states().map(function(t){return t.restriction}).concat(0))},Game_BattlerBase.prototype.addNewState=function(t){t===this.deathStateId()&&this.die();var e=this.isRestricted();this._states.push(t),this.sortStates(),!e&&this.isRestricted()&&this.onRestrict()},Game_BattlerBase.prototype.onRestrict=function(){},Game_BattlerBase.prototype.mostImportantStateText=function(){for(var t=this.states(),e=0;e<t.length;e++)if(t[e].message3)return t[e].message3;return""},Game_BattlerBase.prototype.stateMotionIndex=function(){var t=this.states();return 0<t.length?t[0].motion:0},Game_BattlerBase.prototype.stateOverlayIndex=function(){var t=this.states();return 0<t.length?t[0].overlay:0},Game_BattlerBase.prototype.isSkillWtypeOk=function(t){return!0},Game_BattlerBase.prototype.skillMpCost=function(t){return Math.floor(t.mpCost*this.mcr)},Game_BattlerBase.prototype.skillTpCost=function(t){return t.tpCost},Game_BattlerBase.prototype.canPaySkillCost=function(t){return this._tp>=this.skillTpCost(t)&&this._mp>=this.skillMpCost(t)},Game_BattlerBase.prototype.paySkillCost=function(t){this._mp-=this.skillMpCost(t),this._tp-=this.skillTpCost(t)},Game_BattlerBase.prototype.isOccasionOk=function(t){return $gameParty.inBattle()?0===t.occasion||1===t.occasion:0===t.occasion||2===t.occasion},Game_BattlerBase.prototype.meetsUsableItemConditions=function(t){return this.canMove()&&this.isOccasionOk(t)},Game_BattlerBase.prototype.meetsSkillConditions=function(t){return this.meetsUsableItemConditions(t)&&this.isSkillWtypeOk(t)&&this.canPaySkillCost(t)&&!this.isSkillSealed(t.id)&&!this.isSkillTypeSealed(t.stypeId)},Game_BattlerBase.prototype.meetsItemConditions=function(t){return this.meetsUsableItemConditions(t)&&$gameParty.hasItem(t)},Game_BattlerBase.prototype.canUse=function(t){return!!t&&(DataManager.isSkill(t)?this.meetsSkillConditions(t):!!DataManager.isItem(t)&&this.meetsItemConditions(t))},Game_BattlerBase.prototype.canEquip=function(t){return!!t&&(DataManager.isWeapon(t)?this.canEquipWeapon(t):!!DataManager.isArmor(t)&&this.canEquipArmor(t))},Game_BattlerBase.prototype.canEquipWeapon=function(t){return this.isEquipWtypeOk(t.wtypeId)&&!this.isEquipTypeSealed(t.etypeId)},Game_BattlerBase.prototype.canEquipArmor=function(t){return this.isEquipAtypeOk(t.atypeId)&&!this.isEquipTypeSealed(t.etypeId)},Game_BattlerBase.prototype.attackSkillId=function(){return 1},Game_BattlerBase.prototype.guardSkillId=function(){return 2},Game_BattlerBase.prototype.canAttack=function(){return this.canUse($dataSkills[this.attackSkillId()])},Game_BattlerBase.prototype.canGuard=function(){return this.canUse($dataSkills[this.guardSkillId()])},Game_Battler.prototype=Object.create(Game_BattlerBase.prototype),Game_Battler.prototype.constructor=Game_Battler,Game_Battler.prototype.initialize=function(){Game_BattlerBase.prototype.initialize.call(this)},Game_Battler.prototype.initMembers=function(){Game_BattlerBase.prototype.initMembers.call(this),this._actions=[],this._speed=0,this._result=new Game_ActionResult,this._actionState="",this._lastTargetIndex=0,this._animations=[],this._damagePopup=!1,this._motionType=this._effectType=null,this._weaponImageId=0,this._selected=this._motionRefresh=!1},Game_Battler.prototype.clearAnimations=function(){this._animations=[]},Game_Battler.prototype.clearDamagePopup=function(){this._damagePopup=!1},Game_Battler.prototype.clearWeaponAnimation=function(){this._weaponImageId=0},Game_Battler.prototype.clearEffect=function(){this._effectType=null},Game_Battler.prototype.clearMotion=function(){this._motionType=null,this._motionRefresh=!1},Game_Battler.prototype.requestEffect=function(t){this._effectType=t},Game_Battler.prototype.requestMotion=function(t){this._motionType=t},Game_Battler.prototype.requestMotionRefresh=function(){this._motionRefresh=!0},Game_Battler.prototype.select=function(){this._selected=!0},Game_Battler.prototype.deselect=function(){this._selected=!1},Game_Battler.prototype.isAnimationRequested=function(){return 0<this._animations.length},Game_Battler.prototype.isDamagePopupRequested=function(){return this._damagePopup},Game_Battler.prototype.isEffectRequested=function(){return!!this._effectType},Game_Battler.prototype.isMotionRequested=function(){return!!this._motionType},Game_Battler.prototype.isWeaponAnimationRequested=function(){return 0<this._weaponImageId},Game_Battler.prototype.isMotionRefreshRequested=function(){return this._motionRefresh},Game_Battler.prototype.isSelected=function(){return this._selected},Game_Battler.prototype.effectType=function(){return this._effectType},Game_Battler.prototype.motionType=function(){return this._motionType},Game_Battler.prototype.weaponImageId=function(){return this._weaponImageId},Game_Battler.prototype.shiftAnimation=function(){return this._animations.shift()},Game_Battler.prototype.startAnimation=function(t,e,i){this._animations.push({animationId:t,mirror:e,delay:i})},Game_Battler.prototype.startDamagePopup=function(){this._damagePopup=!0},Game_Battler.prototype.startWeaponAnimation=function(t){this._weaponImageId=t},Game_Battler.prototype.action=function(t){return this._actions[t]},Game_Battler.prototype.setAction=function(t,e){this._actions[t]=e},Game_Battler.prototype.numActions=function(){return this._actions.length},Game_Battler.prototype.clearActions=function(){this._actions=[]},Game_Battler.prototype.result=function(){return this._result},Game_Battler.prototype.clearResult=function(){this._result.clear()},Game_Battler.prototype.refresh=function(){Game_BattlerBase.prototype.refresh.call(this),0===this.hp?this.addState(this.deathStateId()):this.removeState(this.deathStateId())},Game_Battler.prototype.addState=function(t){this.isStateAddable(t)&&(this.isStateAffected(t)||(this.addNewState(t),this.refresh()),this.resetStateCounts(t),this._result.pushAddedState(t))},Game_Battler.prototype.isStateAddable=function(t){return this.isAlive()&&$dataStates[t]&&!this.isStateResist(t)&&!this._result.isStateRemoved(t)&&!this.isStateRestrict(t)},Game_Battler.prototype.isStateRestrict=function(t){return $dataStates[t].removeByRestriction&&this.isRestricted()},Game_Battler.prototype.onRestrict=function(){Game_BattlerBase.prototype.onRestrict.call(this),this.clearActions(),this.states().forEach(function(t){t.removeByRestriction&&this.removeState(t.id)},this)},Game_Battler.prototype.removeState=function(t){this.isStateAffected(t)&&(t===this.deathStateId()&&this.revive(),this.eraseState(t),this.refresh(),this._result.pushRemovedState(t))},Game_Battler.prototype.escape=function(){$gameParty.inBattle()&&this.hide(),this.clearActions(),this.clearStates(),SoundManager.playEscape()},Game_Battler.prototype.addBuff=function(t,e){this.isAlive()&&(this.increaseBuff(t),this.isBuffAffected(t)&&this.overwriteBuffTurns(t,e),this._result.pushAddedBuff(t),this.refresh())},Game_Battler.prototype.addDebuff=function(t,e){this.isAlive()&&(this.decreaseBuff(t),this.isDebuffAffected(t)&&this.overwriteBuffTurns(t,e),this._result.pushAddedDebuff(t),this.refresh())},Game_Battler.prototype.removeBuff=function(t){this.isAlive()&&this.isBuffOrDebuffAffected(t)&&(this.eraseBuff(t),this._result.pushRemovedBuff(t),this.refresh())},Game_Battler.prototype.removeBattleStates=function(){this.states().forEach(function(t){t.removeAtBattleEnd&&this.removeState(t.id)},this)},Game_Battler.prototype.removeAllBuffs=function(){for(var t=0;t<this.buffLength();t++)this.removeBuff(t)},Game_Battler.prototype.removeStatesAuto=function(e){this.states().forEach(function(t){this.isStateExpired(t.id)&&t.autoRemovalTiming===e&&this.removeState(t.id)},this)},Game_Battler.prototype.removeBuffsAuto=function(){for(var t=0;t<this.buffLength();t++)this.isBuffExpired(t)&&this.removeBuff(t)},Game_Battler.prototype.removeStatesByDamage=function(){this.states().forEach(function(t){t.removeByDamage&&Math.randomInt(100)<t.chanceByDamage&&this.removeState(t.id)},this)},Game_Battler.prototype.makeActionTimes=function(){return this.actionPlusSet().reduce(function(t,e){return Math.random()<e?t+1:t},1)},Game_Battler.prototype.makeActions=function(){if(this.clearActions(),this.canMove()){var t=this.makeActionTimes();this._actions=[];for(var e=0;e<t;e++)this._actions.push(new Game_Action(this))}},Game_Battler.prototype.speed=function(){return this._speed},Game_Battler.prototype.makeSpeed=function(){this._speed=Math.min.apply(null,this._actions.map(function(t){return t.speed()}))||0},Game_Battler.prototype.currentAction=function(){return this._actions[0]},Game_Battler.prototype.removeCurrentAction=function(){this._actions.shift()},Game_Battler.prototype.setLastTarget=function(t){this._lastTargetIndex=t?t.index():0},Game_Battler.prototype.forceAction=function(t,e){this.clearActions();var i=new Game_Action(this,!0);i.setSkill(t),-2===e?i.setTarget(this._lastTargetIndex):-1===e?i.decideRandomTarget():i.setTarget(e),this._actions.push(i)},Game_Battler.prototype.useItem=function(t){DataManager.isSkill(t)?this.paySkillCost(t):DataManager.isItem(t)&&this.consumeItem(t)},Game_Battler.prototype.consumeItem=function(t){$gameParty.consumeItem(t)},Game_Battler.prototype.gainHp=function(t){this._result.hpDamage=-t,this._result.hpAffected=!0,this.setHp(this.hp+t)},Game_Battler.prototype.gainMp=function(t){this._result.mpDamage=-t,this.setMp(this.mp+t)},Game_Battler.prototype.gainTp=function(t){this._result.tpDamage=-t,this.setTp(this.tp+t)},Game_Battler.prototype.gainSilentTp=function(t){this.setTp(this.tp+t)},Game_Battler.prototype.initTp=function(){this.setTp(Math.randomInt(25))},Game_Battler.prototype.clearTp=function(){this.setTp(0)},Game_Battler.prototype.chargeTpByDamage=function(t){this.gainSilentTp(Math.floor(50*t*this.tcr))},Game_Battler.prototype.regenerateHp=function(){var t=Math.floor(this.mhp*this.hrg);0!==(t=Math.max(t,-this.maxSlipDamage()))&&this.gainHp(t)},Game_Battler.prototype.maxSlipDamage=function(){return $dataSystem.optSlipDeath?this.hp:Math.max(this.hp-1,0)},Game_Battler.prototype.regenerateMp=function(){var t=Math.floor(this.mmp*this.mrg);0!==t&&this.gainMp(t)},Game_Battler.prototype.regenerateTp=function(){this.gainSilentTp(Math.floor(100*this.trg))},Game_Battler.prototype.regenerateAll=function(){this.isAlive()&&(this.regenerateHp(),this.regenerateMp(),this.regenerateTp())},Game_Battler.prototype.onBattleStart=function(){this.setActionState("undecided"),this.clearMotion(),this.isPreserveTp()||this.initTp()},Game_Battler.prototype.onAllActionsEnd=function(){this.clearResult(),this.removeStatesAuto(1),this.removeBuffsAuto()},Game_Battler.prototype.onTurnEnd=function(){this.clearResult(),this.regenerateAll(),BattleManager.isForcedTurn()||(this.updateStateTurns(),this.updateBuffTurns()),this.removeStatesAuto(2)},Game_Battler.prototype.onBattleEnd=function(){this.clearResult(),this.removeBattleStates(),this.removeAllBuffs(),this.clearActions(),this.isPreserveTp()||this.clearTp(),this.appear()},Game_Battler.prototype.onDamage=function(t){this.removeStatesByDamage(),this.chargeTpByDamage(t/this.mhp)},Game_Battler.prototype.setActionState=function(t){this._actionState=t,this.requestMotionRefresh()},Game_Battler.prototype.isUndecided=function(){return"undecided"===this._actionState},Game_Battler.prototype.isInputting=function(){return"inputting"===this._actionState},Game_Battler.prototype.isWaiting=function(){return"waiting"===this._actionState},Game_Battler.prototype.isActing=function(){return"acting"===this._actionState},Game_Battler.prototype.isChanting=function(){return!!this.isWaiting()&&this._actions.some(function(t){return t.isMagicSkill()})},Game_Battler.prototype.isGuardWaiting=function(){return!!this.isWaiting()&&this._actions.some(function(t){return t.isGuard()})},Game_Battler.prototype.performActionStart=function(t){t.isGuard()||this.setActionState("acting")},Game_Battler.prototype.performAction=function(t){},Game_Battler.prototype.performActionEnd=function(){this.setActionState("done")},Game_Battler.prototype.performDamage=function(){},Game_Battler.prototype.performMiss=function(){SoundManager.playMiss()},Game_Battler.prototype.performRecovery=function(){SoundManager.playRecovery()},Game_Battler.prototype.performEvasion=function(){SoundManager.playEvasion()},Game_Battler.prototype.performMagicEvasion=function(){SoundManager.playMagicEvasion()},Game_Battler.prototype.performCounter=function(){SoundManager.playEvasion()},Game_Battler.prototype.performReflection=function(){SoundManager.playReflection()},Game_Battler.prototype.performSubstitute=function(t){},Game_Battler.prototype.performCollapse=function(){},Game_Actor.prototype=Object.create(Game_Battler.prototype),Game_Actor.prototype.constructor=Game_Actor,Object.defineProperty(Game_Actor.prototype,"level",{get:function(){return this._level},configurable:!0}),Game_Actor.prototype.initialize=function(t){Game_Battler.prototype.initialize.call(this),this.setup(t)},Game_Actor.prototype.initMembers=function(){Game_Battler.prototype.initMembers.call(this),this._actorId=0,this._nickname=this._name="",this._level=this._classId=0,this._characterName="",this._characterIndex=0,this._faceName="",this._faceIndex=0,this._battlerName="",this._exp={},this._skills=[],this._equips=[],this._actionInputIndex=0,this._lastMenuSkill=new Game_Item,this._lastBattleSkill=new Game_Item,this._lastCommandSymbol=""},Game_Actor.prototype.setup=function(t){var e=$dataActors[t];this._actorId=t,this._name=e.name,this._nickname=e.nickname,this._profile=e.profile,this._classId=e.classId,this._level=e.initialLevel,this.initImages(),this.initExp(),this.initSkills(),this.initEquips(e.equips),this.clearParamPlus(),this.recoverAll()},Game_Actor.prototype.actorId=function(){return this._actorId},Game_Actor.prototype.actor=function(){return $dataActors[this._actorId]},Game_Actor.prototype.name=function(){return this._name},Game_Actor.prototype.setName=function(t){this._name=t},Game_Actor.prototype.nickname=function(){return this._nickname},Game_Actor.prototype.setNickname=function(t){this._nickname=t},Game_Actor.prototype.profile=function(){return this._profile},Game_Actor.prototype.setProfile=function(t){this._profile=t},Game_Actor.prototype.characterName=function(){return this._characterName},Game_Actor.prototype.characterIndex=function(){return this._characterIndex},Game_Actor.prototype.faceName=function(){return this._faceName},Game_Actor.prototype.faceIndex=function(){return this._faceIndex},Game_Actor.prototype.battlerName=function(){return this._battlerName},Game_Actor.prototype.clearStates=function(){Game_Battler.prototype.clearStates.call(this),this._stateSteps={}},Game_Actor.prototype.eraseState=function(t){Game_Battler.prototype.eraseState.call(this,t),delete this._stateSteps[t]},Game_Actor.prototype.resetStateCounts=function(t){Game_Battler.prototype.resetStateCounts.call(this,t),this._stateSteps[t]=$dataStates[t].stepsToRemove},Game_Actor.prototype.initImages=function(){var t=this.actor();this._characterName=t.characterName,this._characterIndex=t.characterIndex,this._faceName=t.faceName,this._faceIndex=t.faceIndex,this._battlerName=t.battlerName},Game_Actor.prototype.expForLevel=function(t){var e=this.currentClass();return Math.round(e.expParams[0]*Math.pow(t-1,.9+e.expParams[2]/250)*t*(t+1)/(6+Math.pow(t,2)/50/e.expParams[3])+(t-1)*e.expParams[1])},Game_Actor.prototype.initExp=function(){this._exp[this._classId]=this.currentLevelExp()},Game_Actor.prototype.currentExp=function(){return this._exp[this._classId]},Game_Actor.prototype.currentLevelExp=function(){return this.expForLevel(this._level)},Game_Actor.prototype.nextLevelExp=function(){return this.expForLevel(this._level+1)},Game_Actor.prototype.nextRequiredExp=function(){return this.nextLevelExp()-this.currentExp()},Game_Actor.prototype.maxLevel=function(){return this.actor().maxLevel},Game_Actor.prototype.isMaxLevel=function(){return this._level>=this.maxLevel()},Game_Actor.prototype.initSkills=function(){this._skills=[],this.currentClass().learnings.forEach(function(t){t.level<=this._level&&this.learnSkill(t.skillId)},this)},Game_Actor.prototype.initEquips=function(t){var e=this.equipSlots(),i=e.length;this._equips=[];for(var a=0;a<i;a++)this._equips[a]=new Game_Item;for(a=0;a<t.length;a++)a<i&&this._equips[a].setEquip(1===e[a],t[a]);this.releaseUnequippableItems(!0),this.refresh()},Game_Actor.prototype.equipSlots=function(){for(var t=[],e=1;e<$dataSystem.equipTypes.length;e++)t.push(e);return 2<=t.length&&this.isDualWield()&&(t[1]=1),t},Game_Actor.prototype.equips=function(){return this._equips.map(function(t){return t.object()})},Game_Actor.prototype.weapons=function(){return this.equips().filter(function(t){return t&&DataManager.isWeapon(t)})},Game_Actor.prototype.armors=function(){return this.equips().filter(function(t){return t&&DataManager.isArmor(t)})},Game_Actor.prototype.hasWeapon=function(t){return this.weapons().contains(t)},Game_Actor.prototype.hasArmor=function(t){return this.armors().contains(t)},Game_Actor.prototype.isEquipChangeOk=function(t){return!this.isEquipTypeLocked(this.equipSlots()[t])&&!this.isEquipTypeSealed(this.equipSlots()[t])},Game_Actor.prototype.changeEquip=function(t,e){!this.tradeItemWithParty(e,this.equips()[t])||e&&this.equipSlots()[t]!==e.etypeId||(this._equips[t].setObject(e),this.refresh())},Game_Actor.prototype.forceChangeEquip=function(t,e){this._equips[t].setObject(e),this.releaseUnequippableItems(!0),this.refresh()},Game_Actor.prototype.tradeItemWithParty=function(t,e){return!(t&&!$gameParty.hasItem(t))&&($gameParty.gainItem(e,1),$gameParty.loseItem(t,1),!0)},Game_Actor.prototype.changeEquipById=function(t,e){--t,1===this.equipSlots()[t]?this.changeEquip(t,$dataWeapons[e]):this.changeEquip(t,$dataArmors[e])},Game_Actor.prototype.isEquipped=function(t){return this.equips().contains(t)},Game_Actor.prototype.discardEquip=function(t){0<=(t=this.equips().indexOf(t))&&this._equips[t].setObject(null)},Game_Actor.prototype.releaseUnequippableItems=function(t){for(;;){for(var e=this.equipSlots(),i=this.equips(),a=!1,n=0;n<i.length;n++){var o=i[n];!o||this.canEquip(o)&&o.etypeId===e[n]||(t||this.tradeItemWithParty(null,o),this._equips[n].setObject(null),a=!0)}if(!a)break}},Game_Actor.prototype.clearEquipments=function(){for(var t=this.equipSlots().length,e=0;e<t;e++)this.isEquipChangeOk(e)&&this.changeEquip(e,null)},Game_Actor.prototype.optimizeEquipments=function(){var t=this.equipSlots().length;this.clearEquipments();for(var e=0;e<t;e++)this.isEquipChangeOk(e)&&this.changeEquip(e,this.bestEquipItem(e))},Game_Actor.prototype.bestEquipItem=function(t){var e=this.equipSlots()[t];t=$gameParty.equipItems().filter(function(t){return t.etypeId===e&&this.canEquip(t)},this);for(var i=null,a=-1e3,n=0;n<t.length;n++){var o=this.calcEquipItemPerformance(t[n]);a<o&&(a=o,i=t[n])}return i},Game_Actor.prototype.calcEquipItemPerformance=function(t){return t.params.reduce(function(t,e){return t+e})},Game_Actor.prototype.isSkillWtypeOk=function(t){var e=t.requiredWtypeId1;return t=t.requiredWtypeId2,!!(0===e&&0===t||0<e&&this.isWtypeEquipped(e)||0<t&&this.isWtypeEquipped(t))},Game_Actor.prototype.isWtypeEquipped=function(e){return this.weapons().some(function(t){return t.wtypeId===e})},Game_Actor.prototype.refresh=function(){this.releaseUnequippableItems(!1),Game_Battler.prototype.refresh.call(this)},Game_Actor.prototype.isActor=function(){return!0},Game_Actor.prototype.friendsUnit=function(){return $gameParty},Game_Actor.prototype.opponentsUnit=function(){return $gameTroop},Game_Actor.prototype.index=function(){return $gameParty.members().indexOf(this)},Game_Actor.prototype.isBattleMember=function(){return $gameParty.battleMembers().contains(this)},Game_Actor.prototype.isFormationChangeOk=function(){return!0},Game_Actor.prototype.currentClass=function(){return $dataClasses[this._classId]},Game_Actor.prototype.isClass=function(t){return t&&this._classId===t.id},Game_Actor.prototype.skills=function(){var e=[];return this._skills.concat(this.addedSkills()).forEach(function(t){e.contains($dataSkills[t])||e.push($dataSkills[t])}),e},Game_Actor.prototype.usableSkills=function(){return this.skills().filter(function(t){return this.canUse(t)},this)},Game_Actor.prototype.traitObjects=function(){var t=Game_Battler.prototype.traitObjects.call(this);t=t.concat([this.actor(),this.currentClass()]);for(var e=this.equips(),i=0;i<e.length;i++){var a=e[i];a&&t.push(a)}return t},Game_Actor.prototype.attackElements=function(){var t=Game_Battler.prototype.attackElements.call(this);return this.hasNoWeapons()&&!t.contains(this.bareHandsElementId())&&t.push(this.bareHandsElementId()),t},Game_Actor.prototype.hasNoWeapons=function(){return 0===this.weapons().length},Game_Actor.prototype.bareHandsElementId=function(){return 1},Game_Actor.prototype.paramMax=function(t){return 0===t?9999:Game_Battler.prototype.paramMax.call(this,t)},Game_Actor.prototype.paramBase=function(t){return this.currentClass().params[t][this._level]},Game_Actor.prototype.paramPlus=function(t){for(var e=Game_Battler.prototype.paramPlus.call(this,t),i=this.equips(),a=0;a<i.length;a++){var n=i[a];n&&(e+=n.params[t])}return e},Game_Actor.prototype.attackAnimationId1=function(){if(this.hasNoWeapons())return this.bareHandsAnimationId();var t=this.weapons();return t[0]?t[0].animationId:0},Game_Actor.prototype.attackAnimationId2=function(){var t=this.weapons();return t[1]?t[1].animationId:0},Game_Actor.prototype.bareHandsAnimationId=function(){return 1},Game_Actor.prototype.changeExp=function(t,e){this._exp[this._classId]=Math.max(t,0),t=this._level;for(var i=this.skills();!this.isMaxLevel()&&this.currentExp()>=this.nextLevelExp();)this.levelUp();for(;this.currentExp()<this.currentLevelExp();)this.levelDown();e&&this._level>t&&this.displayLevelUp(this.findNewSkills(i)),this.refresh()},Game_Actor.prototype.levelUp=function(){this._level++,this.currentClass().learnings.forEach(function(t){t.level===this._level&&this.learnSkill(t.skillId)},this)},Game_Actor.prototype.levelDown=function(){this._level--},Game_Actor.prototype.findNewSkills=function(t){for(var e=this.skills(),i=0;i<t.length;i++){var a=e.indexOf(t[i]);0<=a&&e.splice(a,1)}return e},Game_Actor.prototype.displayLevelUp=function(t){var e=TextManager.levelUp.format(this._name,TextManager.level,this._level);$gameMessage.newPage(),$gameMessage.add(e),t.forEach(function(t){$gameMessage.add(TextManager.obtainSkill.format(t.name))})},Game_Actor.prototype.gainExp=function(t){t=this.currentExp()+Math.round(t*this.finalExpRate()),this.changeExp(t,this.shouldDisplayLevelUp())},Game_Actor.prototype.finalExpRate=function(){return this.exr*(this.isBattleMember()?1:this.benchMembersExpRate())},Game_Actor.prototype.benchMembersExpRate=function(){return $dataSystem.optExtraExp?1:0},Game_Actor.prototype.shouldDisplayLevelUp=function(){return!0},Game_Actor.prototype.changeLevel=function(t,e){t=t.clamp(1,this.maxLevel()),this.changeExp(this.expForLevel(t),e)},Game_Actor.prototype.learnSkill=function(t){this.isLearnedSkill(t)||(this._skills.push(t),this._skills.sort(function(t,e){return t-e}))},Game_Actor.prototype.forgetSkill=function(t){0<=(t=this._skills.indexOf(t))&&this._skills.splice(t,1)},Game_Actor.prototype.isLearnedSkill=function(t){return this._skills.contains(t)},Game_Actor.prototype.hasSkill=function(t){return this.skills().contains($dataSkills[t])},Game_Actor.prototype.changeClass=function(t,e){e&&(this._exp[t]=this.currentExp()),this._classId=t,this.changeExp(this._exp[this._classId]||0,!1),this.refresh()},Game_Actor.prototype.setCharacterImage=function(t,e){this._characterName=t,this._characterIndex=e},Game_Actor.prototype.setFaceImage=function(t,e){this._faceName=t,this._faceIndex=e},Game_Actor.prototype.setBattlerImage=function(t){this._battlerName=t},Game_Actor.prototype.isSpriteVisible=function(){return $gameSystem.isSideView()},Game_Actor.prototype.startAnimation=function(t,e,i){Game_Battler.prototype.startAnimation.call(this,t,!e,i)},Game_Actor.prototype.performActionStart=function(t){Game_Battler.prototype.performActionStart.call(this,t)},Game_Actor.prototype.performAction=function(t){Game_Battler.prototype.performAction.call(this,t),t.isAttack()?this.performAttack():t.isGuard()?this.requestMotion("guard"):t.isMagicSkill()?this.requestMotion("spell"):t.isSkill()?this.requestMotion("skill"):t.isItem()&&this.requestMotion("item")},Game_Actor.prototype.performActionEnd=function(){Game_Battler.prototype.performActionEnd.call(this)},Game_Actor.prototype.performAttack=function(){var t=this.weapons();(t=$dataSystem.attackMotions[t[0]?t[0].wtypeId:0])&&(0===t.type?this.requestMotion("thrust"):1===t.type?this.requestMotion("swing"):2===t.type&&this.requestMotion("missile"),this.startWeaponAnimation(t.weaponImageId))},Game_Actor.prototype.performDamage=function(){Game_Battler.prototype.performDamage.call(this),this.isSpriteVisible()?this.requestMotion("damage"):$gameScreen.startShake(5,5,10),SoundManager.playActorDamage()},Game_Actor.prototype.performEvasion=function(){Game_Battler.prototype.performEvasion.call(this),this.requestMotion("evade")},Game_Actor.prototype.performMagicEvasion=function(){Game_Battler.prototype.performMagicEvasion.call(this),this.requestMotion("evade")},Game_Actor.prototype.performCounter=function(){Game_Battler.prototype.performCounter.call(this),this.performAttack()},Game_Actor.prototype.performCollapse=function(){Game_Battler.prototype.performCollapse.call(this),$gameParty.inBattle()&&SoundManager.playActorCollapse()},Game_Actor.prototype.performVictory=function(){this.canMove()&&this.requestMotion("victory")},Game_Actor.prototype.performEscape=function(){this.canMove()&&this.requestMotion("escape")},Game_Actor.prototype.makeActionList=function(){var e=[],i=new Game_Action(this);return i.setAttack(),e.push(i),this.usableSkills().forEach(function(t){(i=new Game_Action(this)).setSkill(t.id),e.push(i)},this),e},Game_Actor.prototype.makeAutoBattleActions=function(){for(var t=0;t<this.numActions();t++)for(var e=this.makeActionList(),i=Number.MIN_VALUE,a=0;a<e.length;a++){var n=e[a].evaluate();i<n&&(i=n,this.setAction(t,e[a]))}this.setActionState("waiting")},Game_Actor.prototype.makeConfusionActions=function(){for(var t=0;t<this.numActions();t++)this.action(t).setConfusion();this.setActionState("waiting")},Game_Actor.prototype.makeActions=function(){Game_Battler.prototype.makeActions.call(this),0<this.numActions()?this.setActionState("undecided"):this.setActionState("waiting"),this.isAutoBattle()?this.makeAutoBattleActions():this.isConfused()&&this.makeConfusionActions()},Game_Actor.prototype.onPlayerWalk=function(){this.clearResult(),this.checkFloorEffect(),$gamePlayer.isNormal()&&(this.turnEndOnMap(),this.states().forEach(function(t){this.updateStateSteps(t)},this),this.showAddedStates(),this.showRemovedStates())},Game_Actor.prototype.updateStateSteps=function(t){t.removeByWalking&&0<this._stateSteps[t.id]&&0==--this._stateSteps[t.id]&&this.removeState(t.id)},Game_Actor.prototype.showAddedStates=function(){this.result().addedStateObjects().forEach(function(t){t.message1&&$gameMessage.add(this._name+t.message1)},this)},Game_Actor.prototype.showRemovedStates=function(){this.result().removedStateObjects().forEach(function(t){t.message4&&$gameMessage.add(this._name+t.message4)},this)},Game_Actor.prototype.stepsForTurn=function(){return 20},Game_Actor.prototype.turnEndOnMap=function(){0==$gameParty.steps()%this.stepsForTurn()&&(this.onTurnEnd(),0<this.result().hpDamage&&this.performMapDamage())},Game_Actor.prototype.checkFloorEffect=function(){$gamePlayer.isOnDamageFloor()&&this.executeFloorDamage()},Game_Actor.prototype.executeFloorDamage=function(){var t=Math.floor(this.basicFloorDamage()*this.fdr);t=Math.min(t,this.maxFloorDamage()),this.gainHp(-t),0<t&&this.performMapDamage()},Game_Actor.prototype.basicFloorDamage=function(){return 10},Game_Actor.prototype.maxFloorDamage=function(){return $dataSystem.optFloorDeath?this.hp:Math.max(this.hp-1,0)},Game_Actor.prototype.performMapDamage=function(){$gameParty.inBattle()||$gameScreen.startFlashForDamage()},Game_Actor.prototype.clearActions=function(){Game_Battler.prototype.clearActions.call(this),this._actionInputIndex=0},Game_Actor.prototype.inputtingAction=function(){return this.action(this._actionInputIndex)},Game_Actor.prototype.selectNextCommand=function(){return this._actionInputIndex<this.numActions()-1&&(this._actionInputIndex++,!0)},Game_Actor.prototype.selectPreviousCommand=function(){return 0<this._actionInputIndex&&(this._actionInputIndex--,!0)},Game_Actor.prototype.lastMenuSkill=function(){return this._lastMenuSkill.object()},Game_Actor.prototype.setLastMenuSkill=function(t){this._lastMenuSkill.setObject(t)},Game_Actor.prototype.lastBattleSkill=function(){return this._lastBattleSkill.object()},Game_Actor.prototype.setLastBattleSkill=function(t){this._lastBattleSkill.setObject(t)},Game_Actor.prototype.lastCommandSymbol=function(){return this._lastCommandSymbol},Game_Actor.prototype.setLastCommandSymbol=function(t){this._lastCommandSymbol=t},Game_Actor.prototype.testEscape=function(t){return t.effects.some(function(t,e,i){return t&&t.code===Game_Action.EFFECT_SPECIAL})},Game_Actor.prototype.meetsUsableItemConditions=function(t){return!($gameParty.inBattle()&&!BattleManager.canEscape()&&this.testEscape(t))&&Game_BattlerBase.prototype.meetsUsableItemConditions.call(this,t)},Game_Enemy.prototype=Object.create(Game_Battler.prototype),Game_Enemy.prototype.constructor=Game_Enemy,Game_Enemy.prototype.initialize=function(t,e,i){Game_Battler.prototype.initialize.call(this),this.setup(t,e,i)},Game_Enemy.prototype.initMembers=function(){Game_Battler.prototype.initMembers.call(this),this._enemyId=0,this._letter="",this._plural=!1,this._screenY=this._screenX=0},Game_Enemy.prototype.setup=function(t,e,i){this._enemyId=t,this._screenX=e,this._screenY=i,this.recoverAll()},Game_Enemy.prototype.isEnemy=function(){return!0},Game_Enemy.prototype.friendsUnit=function(){return $gameTroop},Game_Enemy.prototype.opponentsUnit=function(){return $gameParty},Game_Enemy.prototype.index=function(){return $gameTroop.members().indexOf(this)},Game_Enemy.prototype.isBattleMember=function(){return 0<=this.index()},Game_Enemy.prototype.enemyId=function(){return this._enemyId},Game_Enemy.prototype.enemy=function(){return $dataEnemies[this._enemyId]},Game_Enemy.prototype.traitObjects=function(){return Game_Battler.prototype.traitObjects.call(this).concat(this.enemy())},Game_Enemy.prototype.paramBase=function(t){return this.enemy().params[t]},Game_Enemy.prototype.exp=function(){return this.enemy().exp},Game_Enemy.prototype.gold=function(){return this.enemy().gold},Game_Enemy.prototype.makeDropItems=function(){return this.enemy().dropItems.reduce(function(t,e){return 0<e.kind&&Math.random()*e.denominator<this.dropItemRate()?t.concat(this.itemObject(e.kind,e.dataId)):t}.bind(this),[])},Game_Enemy.prototype.dropItemRate=function(){return $gameParty.hasDropItemDouble()?2:1},Game_Enemy.prototype.itemObject=function(t,e){return 1===t?$dataItems[e]:2===t?$dataWeapons[e]:3===t?$dataArmors[e]:null},Game_Enemy.prototype.isSpriteVisible=function(){return!0},Game_Enemy.prototype.screenX=function(){return this._screenX},Game_Enemy.prototype.screenY=function(){return this._screenY},Game_Enemy.prototype.battlerName=function(){return this.enemy().battlerName},Game_Enemy.prototype.battlerHue=function(){return this.enemy().battlerHue},Game_Enemy.prototype.originalName=function(){return this.enemy().name},Game_Enemy.prototype.name=function(){return this.originalName()+(this._plural?this._letter:"")},Game_Enemy.prototype.isLetterEmpty=function(){return""===this._letter},Game_Enemy.prototype.setLetter=function(t){this._letter=t},Game_Enemy.prototype.setPlural=function(t){this._plural=t},Game_Enemy.prototype.performActionStart=function(t){Game_Battler.prototype.performActionStart.call(this,t),this.requestEffect("whiten")},Game_Enemy.prototype.performAction=function(t){Game_Battler.prototype.performAction.call(this,t)},Game_Enemy.prototype.performActionEnd=function(){Game_Battler.prototype.performActionEnd.call(this)},Game_Enemy.prototype.performDamage=function(){Game_Battler.prototype.performDamage.call(this),SoundManager.playEnemyDamage(),this.requestEffect("blink")},Game_Enemy.prototype.performCollapse=function(){switch(Game_Battler.prototype.performCollapse.call(this),this.collapseType()){case 0:this.requestEffect("collapse"),SoundManager.playEnemyCollapse();break;case 1:this.requestEffect("bossCollapse"),SoundManager.playBossCollapse1();break;case 2:this.requestEffect("instantCollapse")}},Game_Enemy.prototype.transform=function(t){var e=this.originalName();this._enemyId=t,this.originalName()!==e&&(this._letter="",this._plural=!1),this.refresh(),0<this.numActions()&&this.makeActions()},Game_Enemy.prototype.meetsCondition=function(t){var e=t.conditionParam1,i=t.conditionParam2;switch(t.conditionType){case 1:return this.meetsTurnCondition(e,i);case 2:return this.meetsHpCondition(e,i);case 3:return this.meetsMpCondition(e,i);case 4:return this.meetsStateCondition(e);case 5:return this.meetsPartyLevelCondition(e);case 6:return this.meetsSwitchCondition(e);default:return!0}},Game_Enemy.prototype.meetsTurnCondition=function(t,e){var i=$gameTroop.turnCount();return 0===e?i===t:0<i&&t<=i&&i%e==t%e},Game_Enemy.prototype.meetsHpCondition=function(t,e){return this.hpRate()>=t&&this.hpRate()<=e},Game_Enemy.prototype.meetsMpCondition=function(t,e){return this.mpRate()>=t&&this.mpRate()<=e},Game_Enemy.prototype.meetsStateCondition=function(t){return this.isStateAffected(t)},Game_Enemy.prototype.meetsPartyLevelCondition=function(t){return $gameParty.highestLevel()>=t},Game_Enemy.prototype.meetsSwitchCondition=function(t){return $gameSwitches.value(t)},Game_Enemy.prototype.isActionValid=function(t){return this.meetsCondition(t)&&this.canUse($dataSkills[t.skillId])},Game_Enemy.prototype.selectAction=function(t,i){var e=t.reduce(function(t,e){return t+e.rating-i},0);if(!(0<e))return null;e=Math.randomInt(e);for(var a=0;a<t.length;a++){var n=t[a];if((e-=n.rating-i)<0)return n}},Game_Enemy.prototype.selectAllActions=function(t){var e=Math.max.apply(null,t.map(function(t){return t.rating}))-3;t=t.filter(function(t){return t.rating>e});for(var i=0;i<this.numActions();i++)this.action(i).setEnemyAction(this.selectAction(t,e))},Game_Enemy.prototype.makeActions=function(){if(Game_Battler.prototype.makeActions.call(this),0<this.numActions()){var t=this.enemy().actions.filter(function(t){return this.isActionValid(t)},this);0<t.length&&this.selectAllActions(t)}this.setActionState("waiting")},Game_Actors.prototype.initialize=function(){this._data=[]},Game_Actors.prototype.actor=function(t){return $dataActors[t]?(this._data[t]||(this._data[t]=new Game_Actor(t)),this._data[t]):null},Game_Unit.prototype.initialize=function(){this._inBattle=!1},Game_Unit.prototype.inBattle=function(){return this._inBattle},Game_Unit.prototype.members=function(){return[]},Game_Unit.prototype.aliveMembers=function(){return this.members().filter(function(t){return t.isAlive()})},Game_Unit.prototype.deadMembers=function(){return this.members().filter(function(t){return t.isDead()})},Game_Unit.prototype.movableMembers=function(){return this.members().filter(function(t){return t.canMove()})},Game_Unit.prototype.clearActions=function(){return this.members().forEach(function(t){return t.clearActions()})},Game_Unit.prototype.agility=function(){var t=this.members();return 0===t.length?1:t.reduce(function(t,e){return t+e.agi},0)/t.length},Game_Unit.prototype.tgrSum=function(){return this.aliveMembers().reduce(function(t,e){return t+e.tgr},0)},Game_Unit.prototype.randomTarget=function(){var e=Math.random()*this.tgrSum(),i=null;return this.aliveMembers().forEach(function(t){(e-=t.tgr)<=0&&!i&&(i=t)}),i},Game_Unit.prototype.randomDeadTarget=function(){var t=this.deadMembers();return 0===t.length?null:t[Math.floor(Math.random()*t.length)]},Game_Unit.prototype.smoothTarget=function(t){return t<0&&(t=0),(t=this.members()[t])&&t.isAlive()?t:this.aliveMembers()[0]},Game_Unit.prototype.smoothDeadTarget=function(t){return t<0&&(t=0),(t=this.members()[t])&&t.isDead()?t:this.deadMembers()[0]},Game_Unit.prototype.clearResults=function(){this.members().forEach(function(t){t.clearResult()})},Game_Unit.prototype.onBattleStart=function(){this.members().forEach(function(t){t.onBattleStart()}),this._inBattle=!0},Game_Unit.prototype.onBattleEnd=function(){this._inBattle=!1,this.members().forEach(function(t){t.onBattleEnd()})},Game_Unit.prototype.makeActions=function(){this.members().forEach(function(t){t.makeActions()})},Game_Unit.prototype.select=function(e){this.members().forEach(function(t){t===e?t.select():t.deselect()})},Game_Unit.prototype.isAllDead=function(){return 0===this.aliveMembers().length},Game_Unit.prototype.substituteBattler=function(){for(var t=this.members(),e=0;e<t.length;e++)if(t[e].isSubstitute())return t[e]},Game_Party.prototype=Object.create(Game_Unit.prototype),Game_Party.prototype.constructor=Game_Party,Game_Party.ABILITY_ENCOUNTER_HALF=0,Game_Party.ABILITY_ENCOUNTER_NONE=1,Game_Party.ABILITY_CANCEL_SURPRISE=2,Game_Party.ABILITY_RAISE_PREEMPTIVE=3,Game_Party.ABILITY_GOLD_DOUBLE=4,Game_Party.ABILITY_DROP_ITEM_DOUBLE=5,Game_Party.prototype.initialize=function(){Game_Unit.prototype.initialize.call(this),this._steps=this._gold=0,this._lastItem=new Game_Item,this._targetActorId=this._menuActorId=0,this._actors=[],this.initAllItems()},Game_Party.prototype.initAllItems=function(){this._items={},this._weapons={},this._armors={}},Game_Party.prototype.exists=function(){return 0<this._actors.length},Game_Party.prototype.size=function(){return this.members().length},Game_Party.prototype.isEmpty=function(){return 0===this.size()},Game_Party.prototype.members=function(){return this.inBattle()?this.battleMembers():this.allMembers()},Game_Party.prototype.allMembers=function(){return this._actors.map(function(t){return $gameActors.actor(t)})},Game_Party.prototype.battleMembers=function(){return this.allMembers().slice(0,this.maxBattleMembers()).filter(function(t){return t.isAppeared()})},Game_Party.prototype.maxBattleMembers=function(){return 4},Game_Party.prototype.leader=function(){return this.battleMembers()[0]},Game_Party.prototype.reviveBattleMembers=function(){this.battleMembers().forEach(function(t){t.isDead()&&t.setHp(1)})},Game_Party.prototype.items=function(){var t,e=[];for(t in this._items)e.push($dataItems[t]);return e},Game_Party.prototype.weapons=function(){var t,e=[];for(t in this._weapons)e.push($dataWeapons[t]);return e},Game_Party.prototype.armors=function(){var t,e=[];for(t in this._armors)e.push($dataArmors[t]);return e},Game_Party.prototype.equipItems=function(){return this.weapons().concat(this.armors())},Game_Party.prototype.allItems=function(){return this.items().concat(this.equipItems())},Game_Party.prototype.itemContainer=function(t){return t?DataManager.isItem(t)?this._items:DataManager.isWeapon(t)?this._weapons:DataManager.isArmor(t)?this._armors:null:null},Game_Party.prototype.setupStartingMembers=function(){this._actors=[],$dataSystem.partyMembers.forEach(function(t){$gameActors.actor(t)&&this._actors.push(t)},this)},Game_Party.prototype.name=function(){var t=this.battleMembers().length;return 0===t?"":1===t?this.leader().name():TextManager.partyName.format(this.leader().name())},Game_Party.prototype.setupBattleTest=function(){this.setupBattleTestMembers(),this.setupBattleTestItems()},Game_Party.prototype.setupBattleTestMembers=function(){$dataSystem.testBattlers.forEach(function(t){var e=$gameActors.actor(t.actorId);e&&(e.changeLevel(t.level,!1),e.initEquips(t.equips),e.recoverAll(),this.addActor(t.actorId))},this)},Game_Party.prototype.setupBattleTestItems=function(){$dataItems.forEach(function(t){t&&0<t.name.length&&this.gainItem(t,this.maxItems(t))},this)},Game_Party.prototype.highestLevel=function(){return Math.max.apply(null,this.members().map(function(t){return t.level}))},Game_Party.prototype.addActor=function(t){this._actors.contains(t)||(this._actors.push(t),$gamePlayer.refresh(),$gameMap.requestRefresh())},Game_Party.prototype.removeActor=function(t){this._actors.contains(t)&&(this._actors.splice(this._actors.indexOf(t),1),$gamePlayer.refresh(),$gameMap.requestRefresh())},Game_Party.prototype.gold=function(){return this._gold},Game_Party.prototype.gainGold=function(t){this._gold=(this._gold+t).clamp(0,this.maxGold())},Game_Party.prototype.loseGold=function(t){this.gainGold(-t)},Game_Party.prototype.maxGold=function(){return 99999999},Game_Party.prototype.steps=function(){return this._steps},Game_Party.prototype.increaseSteps=function(){this._steps++},Game_Party.prototype.numItems=function(t){var e=this.itemContainer(t);return e&&e[t.id]||0},Game_Party.prototype.maxItems=function(t){return 99},Game_Party.prototype.hasMaxItems=function(t){return this.numItems(t)>=this.maxItems(t)},Game_Party.prototype.hasItem=function(t,e){return void 0===e&&(e=!1),0<this.numItems(t)||!(!e||!this.isAnyMemberEquipped(t))},Game_Party.prototype.isAnyMemberEquipped=function(e){return this.members().some(function(t){return t.equips().contains(e)})},Game_Party.prototype.gainItem=function(t,e,i){var a=this.itemContainer(t);a&&(e=this.numItems(t)+e,a[t.id]=e.clamp(0,this.maxItems(t)),0===a[t.id]&&delete a[t.id],i&&e<0&&this.discardMembersEquip(t,-e),$gameMap.requestRefresh())},Game_Party.prototype.discardMembersEquip=function(e,t){var i=t;this.members().forEach(function(t){for(;0<i&&t.isEquipped(e);)t.discardEquip(e),i--})},Game_Party.prototype.loseItem=function(t,e,i){this.gainItem(t,-e,i)},Game_Party.prototype.consumeItem=function(t){DataManager.isItem(t)&&t.consumable&&this.loseItem(t,1)},Game_Party.prototype.canUse=function(e){return this.members().some(function(t){return t.canUse(e)})},Game_Party.prototype.canInput=function(){return this.members().some(function(t){return t.canInput()})},Game_Party.prototype.isAllDead=function(){return!!Game_Unit.prototype.isAllDead.call(this)&&(this.inBattle()||!this.isEmpty())},Game_Party.prototype.onPlayerWalk=function(){this.members().forEach(function(t){return t.onPlayerWalk()})},Game_Party.prototype.menuActor=function(){var t=$gameActors.actor(this._menuActorId);return this.members().contains(t)||(t=this.members()[0]),t},Game_Party.prototype.setMenuActor=function(t){this._menuActorId=t.actorId()},Game_Party.prototype.makeMenuActorNext=function(){var t=this.members().indexOf(this.menuActor());0<=t?(t=(t+1)%this.members().length,this.setMenuActor(this.members()[t])):this.setMenuActor(this.members()[0])},Game_Party.prototype.makeMenuActorPrevious=function(){var t=this.members().indexOf(this.menuActor());0<=t?(t=(t+this.members().length-1)%this.members().length,this.setMenuActor(this.members()[t])):this.setMenuActor(this.members()[0])},Game_Party.prototype.targetActor=function(){var t=$gameActors.actor(this._targetActorId);return this.members().contains(t)||(t=this.members()[0]),t},Game_Party.prototype.setTargetActor=function(t){this._targetActorId=t.actorId()},Game_Party.prototype.lastItem=function(){return this._lastItem.object()},Game_Party.prototype.setLastItem=function(t){this._lastItem.setObject(t)},Game_Party.prototype.swapOrder=function(t,e){var i=this._actors[t];this._actors[t]=this._actors[e],this._actors[e]=i,$gamePlayer.refresh()},Game_Party.prototype.charactersForSavefile=function(){return this.battleMembers().map(function(t){return[t.characterName(),t.characterIndex()]})},Game_Party.prototype.facesForSavefile=function(){return this.battleMembers().map(function(t){return[t.faceName(),t.faceIndex()]})},Game_Party.prototype.partyAbility=function(e){return this.battleMembers().some(function(t){return t.partyAbility(e)})},Game_Party.prototype.hasEncounterHalf=function(){return this.partyAbility(Game_Party.ABILITY_ENCOUNTER_HALF)},Game_Party.prototype.hasEncounterNone=function(){return this.partyAbility(Game_Party.ABILITY_ENCOUNTER_NONE)},Game_Party.prototype.hasCancelSurprise=function(){return this.partyAbility(Game_Party.ABILITY_CANCEL_SURPRISE)},Game_Party.prototype.hasRaisePreemptive=function(){return this.partyAbility(Game_Party.ABILITY_RAISE_PREEMPTIVE)},Game_Party.prototype.hasGoldDouble=function(){return this.partyAbility(Game_Party.ABILITY_GOLD_DOUBLE)},Game_Party.prototype.hasDropItemDouble=function(){return this.partyAbility(Game_Party.ABILITY_DROP_ITEM_DOUBLE)},Game_Party.prototype.ratePreemptive=function(t){return t=this.agility()>=t?.05:.03,this.hasRaisePreemptive()&&(t*=4),t},Game_Party.prototype.rateSurprise=function(t){return t=this.agility()>=t?.03:.05,this.hasCancelSurprise()&&(t=0),t},Game_Party.prototype.performVictory=function(){this.members().forEach(function(t){t.performVictory()})},Game_Party.prototype.performEscape=function(){this.members().forEach(function(t){t.performEscape()})},Game_Party.prototype.removeBattleStates=function(){this.members().forEach(function(t){t.removeBattleStates()})},Game_Party.prototype.requestMotionRefresh=function(){this.members().forEach(function(t){t.requestMotionRefresh()})},Game_Troop.prototype=Object.create(Game_Unit.prototype),Game_Troop.prototype.constructor=Game_Troop,Game_Troop.LETTER_TABLE_HALF=" A; B; C; D; E; F; G; H; I; J; K; L; M; N; O; P; Q; R; S; T; U; V; W; X; Y; Z".split(";"),Game_Troop.LETTER_TABLE_FULL="ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ".split(""),Game_Troop.prototype.initialize=function(){Game_Unit.prototype.initialize.call(this),this._interpreter=new Game_Interpreter,this.clear()},Game_Troop.prototype.isEventRunning=function(){return this._interpreter.isRunning()},Game_Troop.prototype.updateInterpreter=function(){this._interpreter.update()},Game_Troop.prototype.turnCount=function(){return this._turnCount},Game_Troop.prototype.members=function(){return this._enemies},Game_Troop.prototype.clear=function(){this._interpreter.clear(),this._troopId=0,this._eventFlags={},this._enemies=[],this._turnCount=0,this._namesCount={}},Game_Troop.prototype.troop=function(){return $dataTroops[this._troopId]},Game_Troop.prototype.setup=function(t){this.clear(),this._troopId=t,this._enemies=[],this.troop().members.forEach(function(t){if($dataEnemies[t.enemyId]){var e=new Game_Enemy(t.enemyId,t.x,t.y);t.hidden&&e.hide(),this._enemies.push(e)}},this),this.makeUniqueNames()},Game_Troop.prototype.makeUniqueNames=function(){var a=this.letterTable();this.members().forEach(function(t){if(t.isAlive()&&t.isLetterEmpty()){var e=t.originalName(),i=this._namesCount[e]||0;t.setLetter(a[i%a.length]),this._namesCount[e]=i+1}},this),this.members().forEach(function(t){var e=t.originalName();2<=this._namesCount[e]&&t.setPlural(!0)},this)},Game_Troop.prototype.letterTable=function(){return $gameSystem.isCJK()?Game_Troop.LETTER_TABLE_FULL:Game_Troop.LETTER_TABLE_HALF},Game_Troop.prototype.enemyNames=function(){var i=[];return this.members().forEach(function(t){var e=t.originalName();t.isAlive()&&!i.contains(e)&&i.push(e)}),i},Game_Troop.prototype.meetsConditions=function(t){if(!((t=t.conditions).turnEnding||t.turnValid||t.enemyValid||t.actorValid||t.switchValid)||t.turnEnding&&!BattleManager.isTurnEnd())return!1;if(t.turnValid){var e=this._turnCount,i=t.turnA,a=t.turnB;if(0===a&&e!==i||0<a&&(e<1||e<i||e%a!=i%a))return!1}return!(t.enemyValid&&(!(e=$gameTroop.members()[t.enemyIndex])||100*e.hpRate()>t.enemyHp)||t.actorValid&&(!(e=$gameActors.actor(t.actorId))||100*e.hpRate()>t.actorHp))&&!(t.switchValid&&!$gameSwitches.value(t.switchId))},Game_Troop.prototype.setupBattleEvent=function(){if(!this._interpreter.isRunning()&&!this._interpreter.setupReservedCommonEvent())for(var t=this.troop().pages,e=0;e<t.length;e++){var i=t[e];if(this.meetsConditions(i)&&!this._eventFlags[e]){this._interpreter.setup(i.list),i.span<=1&&(this._eventFlags[e]=!0);break}}},Game_Troop.prototype.increaseTurn=function(){for(var t=this.troop().pages,e=0;e<t.length;e++)1===t[e].span&&(this._eventFlags[e]=!1);this._turnCount++},Game_Troop.prototype.expTotal=function(){return this.deadMembers().reduce(function(t,e){return t+e.exp()},0)},Game_Troop.prototype.goldTotal=function(){return this.deadMembers().reduce(function(t,e){return t+e.gold()},0)*this.goldRate()},Game_Troop.prototype.goldRate=function(){return $gameParty.hasGoldDouble()?2:1},Game_Troop.prototype.makeDropItems=function(){return this.deadMembers().reduce(function(t,e){return t.concat(e.makeDropItems())},[])},Game_Map.prototype.initialize=function(){this._interpreter=new Game_Interpreter,this._tilesetId=this._mapId=0,this._events=[],this._commonEvents=[],this._vehicles=[],this._displayY=this._displayX=0,this._nameDisplay=!0,this._scrollDirection=2,this._scrollRest=0,this._scrollSpeed=4,this._parallaxName="",this._parallaxLoopY=this._parallaxLoopX=this._parallaxZero=!1,this._parallaxY=this._parallaxX=this._parallaxSy=this._parallaxSx=0,this._battleback2Name=this._battleback1Name=null,this.createVehicles()},Game_Map.prototype.setup=function(t){if(!$dataMap)throw Error("The map data is not available");this._mapId=t,this._tilesetId=$dataMap.tilesetId,this._displayY=this._displayX=0,this.refereshVehicles(),this.setupEvents(),this.setupScroll(),this.setupParallax(),this.setupBattleback(),this._needsRefresh=!1},Game_Map.prototype.isEventRunning=function(){return this._interpreter.isRunning()||this.isAnyEventStarting()},Game_Map.prototype.tileWidth=function(){return 48},Game_Map.prototype.tileHeight=function(){return 48},Game_Map.prototype.mapId=function(){return this._mapId},Game_Map.prototype.tilesetId=function(){return this._tilesetId},Game_Map.prototype.displayX=function(){return this._displayX},Game_Map.prototype.displayY=function(){return this._displayY},Game_Map.prototype.parallaxName=function(){return this._parallaxName},Game_Map.prototype.battleback1Name=function(){return this._battleback1Name},Game_Map.prototype.battleback2Name=function(){return this._battleback2Name},Game_Map.prototype.requestRefresh=function(t){this._needsRefresh=!0},Game_Map.prototype.isNameDisplayEnabled=function(){return this._nameDisplay},Game_Map.prototype.disableNameDisplay=function(){this._nameDisplay=!1},Game_Map.prototype.enableNameDisplay=function(){this._nameDisplay=!0},Game_Map.prototype.createVehicles=function(){this._vehicles=[],this._vehicles[0]=new Game_Vehicle("boat"),this._vehicles[1]=new Game_Vehicle("ship"),this._vehicles[2]=new Game_Vehicle("airship")},Game_Map.prototype.refereshVehicles=function(){this._vehicles.forEach(function(t){t.refresh()})},Game_Map.prototype.vehicles=function(){return this._vehicles},Game_Map.prototype.vehicle=function(t){return 0===t||"boat"===t?this.boat():1===t||"ship"===t?this.ship():2===t||"airship"===t?this.airship():null},Game_Map.prototype.boat=function(){return this._vehicles[0]},Game_Map.prototype.ship=function(){return this._vehicles[1]},Game_Map.prototype.airship=function(){return this._vehicles[2]},Game_Map.prototype.setupEvents=function(){this._events=[];for(var t=0;t<$dataMap.events.length;t++)$dataMap.events[t]&&(this._events[t]=new Game_Event(this._mapId,t));this._commonEvents=this.parallelCommonEvents().map(function(t){return new Game_CommonEvent(t.id)}),this.refreshTileEvents()},Game_Map.prototype.events=function(){return this._events.filter(function(t){return!!t})},Game_Map.prototype.event=function(t){return this._events[t]},Game_Map.prototype.eraseEvent=function(t){this._events[t].erase()},Game_Map.prototype.parallelCommonEvents=function(){return $dataCommonEvents.filter(function(t){return t&&2===t.trigger})},Game_Map.prototype.setupScroll=function(){this._scrollDirection=2,this._scrollRest=0,this._scrollSpeed=4},Game_Map.prototype.setupParallax=function(){this._parallaxName=$dataMap.parallaxName||"",this._parallaxZero=ImageManager.isZeroParallax(this._parallaxName),this._parallaxLoopX=$dataMap.parallaxLoopX,this._parallaxLoopY=$dataMap.parallaxLoopY,this._parallaxSx=$dataMap.parallaxSx,this._parallaxSy=$dataMap.parallaxSy,this._parallaxY=this._parallaxX=0},Game_Map.prototype.setupBattleback=function(){$dataMap.specifyBattleback?(this._battleback1Name=$dataMap.battleback1Name,this._battleback2Name=$dataMap.battleback2Name):this._battleback2Name=this._battleback1Name=null},Game_Map.prototype.setDisplayPos=function(t,e){if(this.isLoopHorizontal())this._displayX=t.mod(this.width()),this._parallaxX=t;else{var i=this.width()-this.screenTileX();this._parallaxX=this._displayX=i<0?i/2:t.clamp(0,i)}this.isLoopVertical()?(this._displayY=e.mod(this.height()),this._parallaxY=e):(t=this.height()-this.screenTileY(),this._parallaxY=this._displayY=t<0?t/2:e.clamp(0,t))},Game_Map.prototype.parallaxOx=function(){return this._parallaxZero?this._parallaxX*this.tileWidth():this._parallaxLoopX?this._parallaxX*this.tileWidth()/2:0},Game_Map.prototype.parallaxOy=function(){return this._parallaxZero?this._parallaxY*this.tileHeight():this._parallaxLoopY?this._parallaxY*this.tileHeight()/2:0},Game_Map.prototype.tileset=function(){return $dataTilesets[this._tilesetId]},Game_Map.prototype.tilesetFlags=function(){var t=this.tileset();return t?t.flags:[]},Game_Map.prototype.displayName=function(){return $dataMap.displayName},Game_Map.prototype.width=function(){return $dataMap.width},Game_Map.prototype.height=function(){return $dataMap.height},Game_Map.prototype.data=function(){return $dataMap.data},Game_Map.prototype.isLoopHorizontal=function(){return 2===$dataMap.scrollType||3===$dataMap.scrollType},Game_Map.prototype.isLoopVertical=function(){return 1===$dataMap.scrollType||3===$dataMap.scrollType},Game_Map.prototype.isDashDisabled=function(){return $dataMap.disableDashing},Game_Map.prototype.encounterList=function(){return $dataMap.encounterList},Game_Map.prototype.encounterStep=function(){return $dataMap.encounterStep},Game_Map.prototype.isOverworld=function(){return this.tileset()&&0===this.tileset().mode},Game_Map.prototype.screenTileX=function(){return Graphics.width/this.tileWidth()},Game_Map.prototype.screenTileY=function(){return Graphics.height/this.tileHeight()},Game_Map.prototype.adjustX=function(t){return this.isLoopHorizontal()&&t<this._displayX-(this.width()-this.screenTileX())/2?t-this._displayX+$dataMap.width:t-this._displayX},Game_Map.prototype.adjustY=function(t){return this.isLoopVertical()&&t<this._displayY-(this.height()-this.screenTileY())/2?t-this._displayY+$dataMap.height:t-this._displayY},Game_Map.prototype.roundX=function(t){return this.isLoopHorizontal()?t.mod(this.width()):t},Game_Map.prototype.roundY=function(t){return this.isLoopVertical()?t.mod(this.height()):t},Game_Map.prototype.xWithDirection=function(t,e){return t+(6===e?1:4===e?-1:0)},Game_Map.prototype.yWithDirection=function(t,e){return t+(2===e?1:8===e?-1:0)},Game_Map.prototype.roundXWithDirection=function(t,e){return this.roundX(t+(6===e?1:4===e?-1:0))},Game_Map.prototype.roundYWithDirection=function(t,e){return this.roundY(t+(2===e?1:8===e?-1:0))},Game_Map.prototype.deltaX=function(t,e){return t-=e,this.isLoopHorizontal()&&Math.abs(t)>this.width()/2&&(t=t<0?t+this.width():t-this.width()),t},Game_Map.prototype.deltaY=function(t,e){return t-=e,this.isLoopVertical()&&Math.abs(t)>this.height()/2&&(t=t<0?t+this.height():t-this.height()),t},Game_Map.prototype.distance=function(t,e,i,a){return Math.abs(this.deltaX(t,i))+Math.abs(this.deltaY(e,a))},Game_Map.prototype.canvasToMapX=function(t){var e=this.tileWidth();return this.roundX(Math.floor((this._displayX*e+t)/e))},Game_Map.prototype.canvasToMapY=function(t){var e=this.tileHeight();return this.roundY(Math.floor((this._displayY*e+t)/e))},Game_Map.prototype.autoplay=function(){$dataMap.autoplayBgm&&($gamePlayer.isInVehicle()?$gameSystem.saveWalkingBgm2():AudioManager.playBgm($dataMap.bgm)),$dataMap.autoplayBgs&&AudioManager.playBgs($dataMap.bgs)},Game_Map.prototype.refreshIfNeeded=function(){this._needsRefresh&&this.refresh()},Game_Map.prototype.refresh=function(){this.events().forEach(function(t){t.refresh()}),this._commonEvents.forEach(function(t){t.refresh()}),this.refreshTileEvents(),this._needsRefresh=!1},Game_Map.prototype.refreshTileEvents=function(){this.tileEvents=this.events().filter(function(t){return t.isTile()})},Game_Map.prototype.eventsXy=function(e,i){return this.events().filter(function(t){return t.pos(e,i)})},Game_Map.prototype.eventsXyNt=function(e,i){return this.events().filter(function(t){return t.posNt(e,i)})},Game_Map.prototype.tileEventsXy=function(e,i){return this.tileEvents.filter(function(t){return t.posNt(e,i)})},Game_Map.prototype.eventIdXy=function(t,e){return 0===(t=this.eventsXy(t,e)).length?0:t[0].eventId()},Game_Map.prototype.scrollDown=function(t){if(this.isLoopVertical())this._displayY+=t,this._displayY%=$dataMap.height,this._parallaxLoopY&&(this._parallaxY+=t);else if(this.height()>=this.screenTileY()){var e=this._displayY;this._displayY=Math.min(this._displayY+t,this.height()-this.screenTileY()),this._parallaxY+=this._displayY-e}},Game_Map.prototype.scrollLeft=function(t){if(this.isLoopHorizontal())this._displayX+=$dataMap.width-t,this._displayX%=$dataMap.width,this._parallaxLoopX&&(this._parallaxX-=t);else if(this.width()>=this.screenTileX()){var e=this._displayX;this._displayX=Math.max(this._displayX-t,0),this._parallaxX+=this._displayX-e}},Game_Map.prototype.scrollRight=function(t){if(this.isLoopHorizontal())this._displayX+=t,this._displayX%=$dataMap.width,this._parallaxLoopX&&(this._parallaxX+=t);else if(this.width()>=this.screenTileX()){var e=this._displayX;this._displayX=Math.min(this._displayX+t,this.width()-this.screenTileX()),this._parallaxX+=this._displayX-e}},Game_Map.prototype.scrollUp=function(t){if(this.isLoopVertical())this._displayY+=$dataMap.height-t,this._displayY%=$dataMap.height,this._parallaxLoopY&&(this._parallaxY-=t);else if(this.height()>=this.screenTileY()){var e=this._displayY;this._displayY=Math.max(this._displayY-t,0),this._parallaxY+=this._displayY-e}},Game_Map.prototype.isValid=function(t,e){return 0<=t&&t<this.width()&&0<=e&&e<this.height()},Game_Map.prototype.checkPassage=function(t,e,i){var a=this.tilesetFlags();for(t=this.allTiles(t,e),e=0;e<t.length;e++){var n=a[t[e]];if(0==(16&n)){if(0==(n&i))return!0;if((n&i)===i)break}}return!1},Game_Map.prototype.tileId=function(t,e,i){return $dataMap.data[(i*$dataMap.height+e)*$dataMap.width+t]||0},Game_Map.prototype.layeredTiles=function(t,e){for(var i=[],a=0;a<4;a++)i.push(this.tileId(t,e,3-a));return i},Game_Map.prototype.allTiles=function(t,e){return this.tileEventsXy(t,e).map(function(t){return t.tileId()}).concat(this.layeredTiles(t,e))},Game_Map.prototype.autotileType=function(t,e,i){return 2048<=(t=this.tileId(t,e,i))?Math.floor((t-2048)/48):-1},Game_Map.prototype.isPassable=function(t,e,i){return this.checkPassage(t,e,1<<i/2-1&15)},Game_Map.prototype.isBoatPassable=function(t,e){return this.checkPassage(t,e,512)},Game_Map.prototype.isShipPassable=function(t,e){return this.checkPassage(t,e,1024)},Game_Map.prototype.isAirshipLandOk=function(t,e){return this.checkPassage(t,e,2048)&&this.checkPassage(t,e,15)},Game_Map.prototype.checkLayeredTilesFlags=function(t,e,i){var a=this.tilesetFlags();return this.layeredTiles(t,e).some(function(t){return 0!=(a[t]&i)})},Game_Map.prototype.isLadder=function(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,32)},Game_Map.prototype.isBush=function(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,64)},Game_Map.prototype.isCounter=function(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,128)},Game_Map.prototype.isDamageFloor=function(t,e){return this.isValid(t,e)&&this.checkLayeredTilesFlags(t,e,256)},Game_Map.prototype.terrainTag=function(t,e){if(this.isValid(t,e)){var i=this.tilesetFlags();for(t=this.layeredTiles(t,e),e=0;e<t.length;e++){var a=i[t[e]]>>12;if(0<a)return a}}return 0},Game_Map.prototype.regionId=function(t,e){return this.isValid(t,e)?this.tileId(t,e,5):0},Game_Map.prototype.startScroll=function(t,e,i){this._scrollDirection=t,this._scrollRest=e,this._scrollSpeed=i},Game_Map.prototype.isScrolling=function(){return 0<this._scrollRest},Game_Map.prototype.update=function(t){this.refreshIfNeeded(),t&&this.updateInterpreter(),this.updateScroll(),this.updateEvents(),this.updateVehicles(),this.updateParallax()},Game_Map.prototype.updateScroll=function(){if(this.isScrolling()){var t=this._displayX,e=this._displayY;this.doScroll(this._scrollDirection,this.scrollDistance()),this._scrollRest=this._displayX===t&&this._displayY===e?0:this._scrollRest-this.scrollDistance()}},Game_Map.prototype.scrollDistance=function(){return Math.pow(2,this._scrollSpeed)/256},Game_Map.prototype.doScroll=function(t,e){switch(t){case 2:this.scrollDown(e);break;case 4:this.scrollLeft(e);break;case 6:this.scrollRight(e);break;case 8:this.scrollUp(e)}},Game_Map.prototype.updateEvents=function(){this.events().forEach(function(t){t.update()}),this._commonEvents.forEach(function(t){t.update()})},Game_Map.prototype.updateVehicles=function(){this._vehicles.forEach(function(t){t.update()})},Game_Map.prototype.updateParallax=function(){this._parallaxLoopX&&(this._parallaxX+=this._parallaxSx/this.tileWidth()/2),this._parallaxLoopY&&(this._parallaxY+=this._parallaxSy/this.tileHeight()/2)},Game_Map.prototype.changeTileset=function(t){this._tilesetId=t,this.refresh()},Game_Map.prototype.changeBattleback=function(t,e){this._battleback1Name=t,this._battleback2Name=e},Game_Map.prototype.changeParallax=function(t,e,i,a,n){this._parallaxName=t,this._parallaxZero=ImageManager.isZeroParallax(this._parallaxName),this._parallaxLoopX&&!e&&(this._parallaxX=0),this._parallaxLoopY&&!i&&(this._parallaxY=0),this._parallaxLoopX=e,this._parallaxLoopY=i,this._parallaxSx=a,this._parallaxSy=n},Game_Map.prototype.updateInterpreter=function(){for(;(this._interpreter.update(),!this._interpreter.isRunning())&&(0<this._interpreter.eventId()&&(this.unlockEvent(this._interpreter.eventId()),this._interpreter.clear()),this.setupStartingEvent()););},Game_Map.prototype.unlockEvent=function(t){this._events[t]&&this._events[t].unlock()},Game_Map.prototype.setupStartingEvent=function(){return this.refreshIfNeeded(),!!(this._interpreter.setupReservedCommonEvent()||this.setupTestEvent()||this.setupStartingMapEvent()||this.setupAutorunCommonEvent())},Game_Map.prototype.setupTestEvent=function(){return!!$testEvent&&(this._interpreter.setup($testEvent,0),!($testEvent=null))},Game_Map.prototype.setupStartingMapEvent=function(){for(var t=this.events(),e=0;e<t.length;e++){var i=t[e];if(i.isStarting())return i.clearStartingFlag(),this._interpreter.setup(i.list(),i.eventId()),!0}return!1},Game_Map.prototype.setupAutorunCommonEvent=function(){for(var t=0;t<$dataCommonEvents.length;t++){var e=$dataCommonEvents[t];if(e&&1===e.trigger&&$gameSwitches.value(e.switchId))return this._interpreter.setup(e.list),!0}return!1},Game_Map.prototype.isAnyEventStarting=function(){return this.events().some(function(t){return t.isStarting()})},Game_CommonEvent.prototype.initialize=function(t){this._commonEventId=t,this.refresh()},Game_CommonEvent.prototype.event=function(){return $dataCommonEvents[this._commonEventId]},Game_CommonEvent.prototype.list=function(){return this.event().list},Game_CommonEvent.prototype.refresh=function(){this.isActive()?this._interpreter||(this._interpreter=new Game_Interpreter):this._interpreter=null},Game_CommonEvent.prototype.isActive=function(){var t=this.event();return 2===t.trigger&&$gameSwitches.value(t.switchId)},Game_CommonEvent.prototype.update=function(){this._interpreter&&(this._interpreter.isRunning()||this._interpreter.setup(this.list()),this._interpreter.update())},Object.defineProperties(Game_CharacterBase.prototype,{x:{get:function(){return this._x},configurable:!0},y:{get:function(){return this._y},configurable:!0}}),Game_CharacterBase.prototype.initialize=function(){this.initMembers()},Game_CharacterBase.prototype.initMembers=function(){this._realY=this._realX=this._y=this._x=0,this._moveSpeed=4,this._moveFrequency=6,this._opacity=255,this._blendMode=0,this._direction=2,this._priorityType=this._pattern=1,this._tileId=0,this._characterName="",this._characterIndex=0,this._isObjectCharacter=!1,this._walkAnime=!0,this._transparent=this._through=this._directionFix=this._stepAnime=!1,this._balloonId=this._animationId=this._bushDepth=0,this._balloonPlaying=this._animationPlaying=!1,this._jumpPeak=this._jumpCount=this._stopCount=this._animationCount=0,this._movementSuccess=!0},Game_CharacterBase.prototype.pos=function(t,e){return this._x===t&&this._y===e},Game_CharacterBase.prototype.posNt=function(t,e){return this.pos(t,e)&&!this.isThrough()},Game_CharacterBase.prototype.moveSpeed=function(){return this._moveSpeed},Game_CharacterBase.prototype.setMoveSpeed=function(t){this._moveSpeed=t},Game_CharacterBase.prototype.moveFrequency=function(){return this._moveFrequency},Game_CharacterBase.prototype.setMoveFrequency=function(t){this._moveFrequency=t},Game_CharacterBase.prototype.opacity=function(){return this._opacity},Game_CharacterBase.prototype.setOpacity=function(t){this._opacity=t},Game_CharacterBase.prototype.blendMode=function(){return this._blendMode},Game_CharacterBase.prototype.setBlendMode=function(t){this._blendMode=t},Game_CharacterBase.prototype.isNormalPriority=function(){return 1===this._priorityType},Game_CharacterBase.prototype.setPriorityType=function(t){this._priorityType=t},Game_CharacterBase.prototype.isMoving=function(){return this._realX!==this._x||this._realY!==this._y},Game_CharacterBase.prototype.isJumping=function(){return 0<this._jumpCount},Game_CharacterBase.prototype.jumpHeight=function(){return(this._jumpPeak*this._jumpPeak-Math.pow(Math.abs(this._jumpCount-this._jumpPeak),2))/2},Game_CharacterBase.prototype.isStopping=function(){return!this.isMoving()&&!this.isJumping()},Game_CharacterBase.prototype.checkStop=function(t){return this._stopCount>t},Game_CharacterBase.prototype.resetStopCount=function(){this._stopCount=0},Game_CharacterBase.prototype.realMoveSpeed=function(){return this._moveSpeed+(this.isDashing()?1:0)},Game_CharacterBase.prototype.distancePerFrame=function(){return Math.pow(2,this.realMoveSpeed())/256},Game_CharacterBase.prototype.isDashing=function(){return!1},Game_CharacterBase.prototype.isDebugThrough=function(){return!1},Game_CharacterBase.prototype.straighten=function(){(this.hasWalkAnime()||this.hasStepAnime())&&(this._pattern=1),this._animationCount=0},Game_CharacterBase.prototype.reverseDir=function(t){return 10-t},Game_CharacterBase.prototype.canPass=function(t,e,i){var a=$gameMap.roundXWithDirection(t,i),n=$gameMap.roundYWithDirection(e,i);return!!$gameMap.isValid(a,n)&&(!(!this.isThrough()&&!this.isDebugThrough())||!(!this.isMapPassable(t,e,i)||this.isCollidedWithCharacters(a,n)))},Game_CharacterBase.prototype.canPassDiagonally=function(t,e,i,a){var n=$gameMap.roundXWithDirection(t,i),o=$gameMap.roundYWithDirection(e,a);return!!(this.canPass(t,e,a)&&this.canPass(t,o,i)||this.canPass(t,e,i)&&this.canPass(n,e,a))},Game_CharacterBase.prototype.isMapPassable=function(t,e,i){var a=$gameMap.roundXWithDirection(t,i),n=$gameMap.roundYWithDirection(e,i),o=this.reverseDir(i);return $gameMap.isPassable(t,e,i)&&$gameMap.isPassable(a,n,o)},Game_CharacterBase.prototype.isCollidedWithCharacters=function(t,e){return this.isCollidedWithEvents(t,e)||this.isCollidedWithVehicles(t,e)},Game_CharacterBase.prototype.isCollidedWithEvents=function(t,e){return $gameMap.eventsXyNt(t,e).some(function(t){return t.isNormalPriority()})},Game_CharacterBase.prototype.isCollidedWithVehicles=function(t,e){return $gameMap.boat().posNt(t,e)||$gameMap.ship().posNt(t,e)},Game_CharacterBase.prototype.setPosition=function(t,e){this._x=Math.round(t),this._y=Math.round(e),this._realX=t,this._realY=e},Game_CharacterBase.prototype.copyPosition=function(t){this._x=t._x,this._y=t._y,this._realX=t._realX,this._realY=t._realY,this._direction=t._direction},Game_CharacterBase.prototype.locate=function(t,e){this.setPosition(t,e),this.straighten(),this.refreshBushDepth()},Game_CharacterBase.prototype.direction=function(){return this._direction},Game_CharacterBase.prototype.setDirection=function(t){!this.isDirectionFixed()&&t&&(this._direction=t),this.resetStopCount()},Game_CharacterBase.prototype.isTile=function(){return 0<this._tileId&&0===this._priorityType},Game_CharacterBase.prototype.isObjectCharacter=function(){return this._isObjectCharacter},Game_CharacterBase.prototype.shiftY=function(){return this.isObjectCharacter()?0:6},Game_CharacterBase.prototype.scrolledX=function(){return $gameMap.adjustX(this._realX)},Game_CharacterBase.prototype.scrolledY=function(){return $gameMap.adjustY(this._realY)},Game_CharacterBase.prototype.screenX=function(){var t=$gameMap.tileWidth();return Math.round(this.scrolledX()*t+t/2)},Game_CharacterBase.prototype.screenY=function(){var t=$gameMap.tileHeight();return Math.round(this.scrolledY()*t+t-this.shiftY()-this.jumpHeight())},Game_CharacterBase.prototype.screenZ=function(){return 2*this._priorityType+1},Game_CharacterBase.prototype.isNearTheScreen=function(){var t=Graphics.width,e=Graphics.height,i=$gameMap.tileWidth(),a=$gameMap.tileHeight();return i=this.scrolledX()*i+i/2-t/2,a=this.scrolledY()*a+a/2-e/2,-t<=i&&i<=t&&-e<=a&&a<=e},Game_CharacterBase.prototype.update=function(){this.isStopping()&&this.updateStop(),this.isJumping()?this.updateJump():this.isMoving()&&this.updateMove(),this.updateAnimation()},Game_CharacterBase.prototype.updateStop=function(){this._stopCount++},Game_CharacterBase.prototype.updateJump=function(){this._jumpCount--,this._realX=(this._realX*this._jumpCount+this._x)/(this._jumpCount+1),this._realY=(this._realY*this._jumpCount+this._y)/(this._jumpCount+1),this.refreshBushDepth(),0===this._jumpCount&&(this._realX=this._x=$gameMap.roundX(this._x),this._realY=this._y=$gameMap.roundY(this._y))},Game_CharacterBase.prototype.updateMove=function(){this._x<this._realX&&(this._realX=Math.max(this._realX-this.distancePerFrame(),this._x)),this._x>this._realX&&(this._realX=Math.min(this._realX+this.distancePerFrame(),this._x)),this._y<this._realY&&(this._realY=Math.max(this._realY-this.distancePerFrame(),this._y)),this._y>this._realY&&(this._realY=Math.min(this._realY+this.distancePerFrame(),this._y)),this.isMoving()||this.refreshBushDepth()},Game_CharacterBase.prototype.updateAnimation=function(){this.updateAnimationCount(),this._animationCount>=this.animationWait()&&(this.updatePattern(),this._animationCount=0)},Game_CharacterBase.prototype.animationWait=function(){return 3*(9-this.realMoveSpeed())},Game_CharacterBase.prototype.updateAnimationCount=function(){this.isMoving()&&this.hasWalkAnime()?this._animationCount+=1.5:!this.hasStepAnime()&&this.isOriginalPattern()||this._animationCount++},Game_CharacterBase.prototype.updatePattern=function(){!this.hasStepAnime()&&0<this._stopCount?this.resetPattern():this._pattern=(this._pattern+1)%this.maxPattern()},Game_CharacterBase.prototype.maxPattern=function(){return 4},Game_CharacterBase.prototype.pattern=function(){return this._pattern<3?this._pattern:1},Game_CharacterBase.prototype.setPattern=function(t){this._pattern=t},Game_CharacterBase.prototype.isOriginalPattern=function(){return 1===this.pattern()},Game_CharacterBase.prototype.resetPattern=function(){this.setPattern(1)},Game_CharacterBase.prototype.refreshBushDepth=function(){this.isNormalPriority()&&!this.isObjectCharacter()&&this.isOnBush()&&!this.isJumping()?this.isMoving()||(this._bushDepth=12):this._bushDepth=0},Game_CharacterBase.prototype.isOnLadder=function(){return $gameMap.isLadder(this._x,this._y)},Game_CharacterBase.prototype.isOnBush=function(){return $gameMap.isBush(this._x,this._y)},Game_CharacterBase.prototype.terrainTag=function(){return $gameMap.terrainTag(this._x,this._y)},Game_CharacterBase.prototype.regionId=function(){return $gameMap.regionId(this._x,this._y)},Game_CharacterBase.prototype.increaseSteps=function(){this.isOnLadder()&&this.setDirection(8),this.resetStopCount(),this.refreshBushDepth()},Game_CharacterBase.prototype.tileId=function(){return this._tileId},Game_CharacterBase.prototype.characterName=function(){return this._characterName},Game_CharacterBase.prototype.characterIndex=function(){return this._characterIndex},Game_CharacterBase.prototype.setImage=function(t,e){this._tileId=0,this._characterName=t,this._characterIndex=e,this._isObjectCharacter=ImageManager.isObjectCharacter(t)},Game_CharacterBase.prototype.setTileImage=function(t){this._tileId=t,this._characterName="",this._characterIndex=0,this._isObjectCharacter=!0},Game_CharacterBase.prototype.checkEventTriggerTouchFront=function(t){var e=$gameMap.roundXWithDirection(this._x,t);t=$gameMap.roundYWithDirection(this._y,t),this.checkEventTriggerTouch(e,t)},Game_CharacterBase.prototype.checkEventTriggerTouch=function(t,e){return!1},Game_CharacterBase.prototype.isMovementSucceeded=function(t,e){return this._movementSuccess},Game_CharacterBase.prototype.setMovementSuccess=function(t){this._movementSuccess=t},Game_CharacterBase.prototype.moveStraight=function(t){this.setMovementSuccess(this.canPass(this._x,this._y,t)),this.isMovementSucceeded()?(this.setDirection(t),this._x=$gameMap.roundXWithDirection(this._x,t),this._y=$gameMap.roundYWithDirection(this._y,t),this._realX=$gameMap.xWithDirection(this._x,this.reverseDir(t)),this._realY=$gameMap.yWithDirection(this._y,this.reverseDir(t)),this.increaseSteps()):(this.setDirection(t),this.checkEventTriggerTouchFront(t))},Game_CharacterBase.prototype.moveDiagonally=function(t,e){this.setMovementSuccess(this.canPassDiagonally(this._x,this._y,t,e)),this.isMovementSucceeded()&&(this._x=$gameMap.roundXWithDirection(this._x,t),this._y=$gameMap.roundYWithDirection(this._y,e),this._realX=$gameMap.xWithDirection(this._x,this.reverseDir(t)),this._realY=$gameMap.yWithDirection(this._y,this.reverseDir(e)),this.increaseSteps()),this._direction===this.reverseDir(t)&&this.setDirection(t),this._direction===this.reverseDir(e)&&this.setDirection(e)},Game_CharacterBase.prototype.jump=function(t,e){Math.abs(t)>Math.abs(e)?0!==t&&this.setDirection(t<0?4:6):0!==e&&this.setDirection(e<0?8:2),this._x+=t,this._y+=e,this._jumpPeak=10+Math.round(Math.sqrt(t*t+e*e))-this._moveSpeed,this._jumpCount=2*this._jumpPeak,this.resetStopCount(),this.straighten()},Game_CharacterBase.prototype.hasWalkAnime=function(){return this._walkAnime},Game_CharacterBase.prototype.setWalkAnime=function(t){this._walkAnime=t},Game_CharacterBase.prototype.hasStepAnime=function(){return this._stepAnime},Game_CharacterBase.prototype.setStepAnime=function(t){this._stepAnime=t},Game_CharacterBase.prototype.isDirectionFixed=function(){return this._directionFix},Game_CharacterBase.prototype.setDirectionFix=function(t){this._directionFix=t},Game_CharacterBase.prototype.isThrough=function(){return this._through},Game_CharacterBase.prototype.setThrough=function(t){this._through=t},Game_CharacterBase.prototype.isTransparent=function(){return this._transparent},Game_CharacterBase.prototype.bushDepth=function(){return this._bushDepth},Game_CharacterBase.prototype.setTransparent=function(t){this._transparent=t},Game_CharacterBase.prototype.requestAnimation=function(t){this._animationId=t},Game_CharacterBase.prototype.requestBalloon=function(t){this._balloonId=t},Game_CharacterBase.prototype.animationId=function(){return this._animationId},Game_CharacterBase.prototype.balloonId=function(){return this._balloonId},Game_CharacterBase.prototype.startAnimation=function(){this._animationId=0,this._animationPlaying=!0},Game_CharacterBase.prototype.startBalloon=function(){this._balloonId=0,this._balloonPlaying=!0},Game_CharacterBase.prototype.isAnimationPlaying=function(){return 0<this._animationId||this._animationPlaying},Game_CharacterBase.prototype.isBalloonPlaying=function(){return 0<this._balloonId||this._balloonPlaying},Game_CharacterBase.prototype.endAnimation=function(){this._animationPlaying=!1},Game_CharacterBase.prototype.endBalloon=function(){this._balloonPlaying=!1},Game_Character.prototype=Object.create(Game_CharacterBase.prototype),Game_Character.prototype.constructor=Game_Character,Game_Character.ROUTE_END=0,Game_Character.ROUTE_MOVE_DOWN=1,Game_Character.ROUTE_MOVE_LEFT=2,Game_Character.ROUTE_MOVE_RIGHT=3,Game_Character.ROUTE_MOVE_UP=4,Game_Character.ROUTE_MOVE_LOWER_L=5,Game_Character.ROUTE_MOVE_LOWER_R=6,Game_Character.ROUTE_MOVE_UPPER_L=7,Game_Character.ROUTE_MOVE_UPPER_R=8,Game_Character.ROUTE_MOVE_RANDOM=9,Game_Character.ROUTE_MOVE_TOWARD=10,Game_Character.ROUTE_MOVE_AWAY=11,Game_Character.ROUTE_MOVE_FORWARD=12,Game_Character.ROUTE_MOVE_BACKWARD=13,Game_Character.ROUTE_JUMP=14,Game_Character.ROUTE_WAIT=15,Game_Character.ROUTE_TURN_DOWN=16,Game_Character.ROUTE_TURN_LEFT=17,Game_Character.ROUTE_TURN_RIGHT=18,Game_Character.ROUTE_TURN_UP=19,Game_Character.ROUTE_TURN_90D_R=20,Game_Character.ROUTE_TURN_90D_L=21,Game_Character.ROUTE_TURN_180D=22,Game_Character.ROUTE_TURN_90D_R_L=23,Game_Character.ROUTE_TURN_RANDOM=24,Game_Character.ROUTE_TURN_TOWARD=25,Game_Character.ROUTE_TURN_AWAY=26,Game_Character.ROUTE_SWITCH_ON=27,Game_Character.ROUTE_SWITCH_OFF=28,Game_Character.ROUTE_CHANGE_SPEED=29,Game_Character.ROUTE_CHANGE_FREQ=30,Game_Character.ROUTE_WALK_ANIME_ON=31,Game_Character.ROUTE_WALK_ANIME_OFF=32,Game_Character.ROUTE_STEP_ANIME_ON=33,Game_Character.ROUTE_STEP_ANIME_OFF=34,Game_Character.ROUTE_DIR_FIX_ON=35,Game_Character.ROUTE_DIR_FIX_OFF=36,Game_Character.ROUTE_THROUGH_ON=37,Game_Character.ROUTE_THROUGH_OFF=38,Game_Character.ROUTE_TRANSPARENT_ON=39,Game_Character.ROUTE_TRANSPARENT_OFF=40,Game_Character.ROUTE_CHANGE_IMAGE=41,Game_Character.ROUTE_CHANGE_OPACITY=42,Game_Character.ROUTE_CHANGE_BLEND_MODE=43,Game_Character.ROUTE_PLAY_SE=44,Game_Character.ROUTE_SCRIPT=45,Game_Character.prototype.initialize=function(){Game_CharacterBase.prototype.initialize.call(this)},Game_Character.prototype.initMembers=function(){Game_CharacterBase.prototype.initMembers.call(this),this._moveRouteForcing=!1,this._moveRoute=null,this._moveRouteIndex=0,this._originalMoveRoute=null,this._waitCount=this._originalMoveRouteIndex=0},Game_Character.prototype.memorizeMoveRoute=function(){this._originalMoveRoute=this._moveRoute,this._originalMoveRouteIndex=this._moveRouteIndex},Game_Character.prototype.restoreMoveRoute=function(){this._moveRoute=this._originalMoveRoute,this._moveRouteIndex=this._originalMoveRouteIndex,this._originalMoveRoute=null},Game_Character.prototype.isMoveRouteForcing=function(){return this._moveRouteForcing},Game_Character.prototype.setMoveRoute=function(t){this._moveRoute=t,this._moveRouteIndex=0,this._moveRouteForcing=!1},Game_Character.prototype.forceMoveRoute=function(t){this._originalMoveRoute||this.memorizeMoveRoute(),this._moveRoute=t,this._moveRouteIndex=0,this._moveRouteForcing=!0,this._waitCount=0},Game_Character.prototype.updateStop=function(){Game_CharacterBase.prototype.updateStop.call(this),this._moveRouteForcing&&this.updateRoutineMove()},Game_Character.prototype.updateRoutineMove=function(){if(0<this._waitCount)this._waitCount--;else{this.setMovementSuccess(!0);var t=this._moveRoute.list[this._moveRouteIndex];t&&(this.processMoveCommand(t),this.advanceMoveRouteIndex())}},Game_Character.prototype.processMoveCommand=function(a){var b=Game_Character,c=a.parameters;switch(a.code){case b.ROUTE_END:this.processRouteEnd();break;case b.ROUTE_MOVE_DOWN:this.moveStraight(2);break;case b.ROUTE_MOVE_LEFT:this.moveStraight(4);break;case b.ROUTE_MOVE_RIGHT:this.moveStraight(6);break;case b.ROUTE_MOVE_UP:this.moveStraight(8);break;case b.ROUTE_MOVE_LOWER_L:this.moveDiagonally(4,2);break;case b.ROUTE_MOVE_LOWER_R:this.moveDiagonally(6,2);break;case b.ROUTE_MOVE_UPPER_L:this.moveDiagonally(4,8);break;case b.ROUTE_MOVE_UPPER_R:this.moveDiagonally(6,8);break;case b.ROUTE_MOVE_RANDOM:this.moveRandom();break;case b.ROUTE_MOVE_TOWARD:this.moveTowardPlayer();break;case b.ROUTE_MOVE_AWAY:this.moveAwayFromPlayer();break;case b.ROUTE_MOVE_FORWARD:this.moveForward();break;case b.ROUTE_MOVE_BACKWARD:this.moveBackward();break;case b.ROUTE_JUMP:this.jump(c[0],c[1]);break;case b.ROUTE_WAIT:this._waitCount=c[0]-1;break;case b.ROUTE_TURN_DOWN:this.setDirection(2);break;case b.ROUTE_TURN_LEFT:this.setDirection(4);break;case b.ROUTE_TURN_RIGHT:this.setDirection(6);break;case b.ROUTE_TURN_UP:this.setDirection(8);break;case b.ROUTE_TURN_90D_R:this.turnRight90();break;case b.ROUTE_TURN_90D_L:this.turnLeft90();break;case b.ROUTE_TURN_180D:this.turn180();break;case b.ROUTE_TURN_90D_R_L:this.turnRightOrLeft90();break;case b.ROUTE_TURN_RANDOM:this.turnRandom();break;case b.ROUTE_TURN_TOWARD:this.turnTowardPlayer();break;case b.ROUTE_TURN_AWAY:this.turnAwayFromPlayer();break;case b.ROUTE_SWITCH_ON:$gameSwitches.setValue(c[0],!0);break;case b.ROUTE_SWITCH_OFF:$gameSwitches.setValue(c[0],!1);break;case b.ROUTE_CHANGE_SPEED:this.setMoveSpeed(c[0]);break;case b.ROUTE_CHANGE_FREQ:this.setMoveFrequency(c[0]);break;case b.ROUTE_WALK_ANIME_ON:this.setWalkAnime(!0);break;case b.ROUTE_WALK_ANIME_OFF:this.setWalkAnime(!1);break;case b.ROUTE_STEP_ANIME_ON:this.setStepAnime(!0);break;case b.ROUTE_STEP_ANIME_OFF:this.setStepAnime(!1);break;case b.ROUTE_DIR_FIX_ON:this.setDirectionFix(!0);break;case b.ROUTE_DIR_FIX_OFF:this.setDirectionFix(!1);break;case b.ROUTE_THROUGH_ON:this.setThrough(!0);break;case b.ROUTE_THROUGH_OFF:this.setThrough(!1);break;case b.ROUTE_TRANSPARENT_ON:this.setTransparent(!0);break;case b.ROUTE_TRANSPARENT_OFF:this.setTransparent(!1);break;case b.ROUTE_CHANGE_IMAGE:this.setImage(c[0],c[1]);break;case b.ROUTE_CHANGE_OPACITY:this.setOpacity(c[0]);break;case b.ROUTE_CHANGE_BLEND_MODE:this.setBlendMode(c[0]);break;case b.ROUTE_PLAY_SE:AudioManager.playSe(c[0]);break;case b.ROUTE_SCRIPT:eval(c[0])}},Game_Character.prototype.deltaXFrom=function(t){return $gameMap.deltaX(this.x,t)},Game_Character.prototype.deltaYFrom=function(t){return $gameMap.deltaY(this.y,t)},Game_Character.prototype.moveRandom=function(){var t=2+2*Math.randomInt(4);this.canPass(this.x,this.y,t)&&this.moveStraight(t)},Game_Character.prototype.moveTowardCharacter=function(t){var e=this.deltaXFrom(t.x);t=this.deltaYFrom(t.y),Math.abs(e)>Math.abs(t)?(this.moveStraight(0<e?4:6),this.isMovementSucceeded()||0===t||this.moveStraight(0<t?8:2)):0!==t&&(this.moveStraight(0<t?8:2),this.isMovementSucceeded()||0===e||this.moveStraight(0<e?4:6))},Game_Character.prototype.moveAwayFromCharacter=function(t){var e=this.deltaXFrom(t.x);t=this.deltaYFrom(t.y),Math.abs(e)>Math.abs(t)?(this.moveStraight(0<e?6:4),this.isMovementSucceeded()||0===t||this.moveStraight(0<t?2:8)):0!==t&&(this.moveStraight(0<t?2:8),this.isMovementSucceeded()||0===e||this.moveStraight(0<e?6:4))},Game_Character.prototype.turnTowardCharacter=function(t){var e=this.deltaXFrom(t.x);t=this.deltaYFrom(t.y),Math.abs(e)>Math.abs(t)?this.setDirection(0<e?4:6):0!==t&&this.setDirection(0<t?8:2)},Game_Character.prototype.turnAwayFromCharacter=function(t){var e=this.deltaXFrom(t.x);t=this.deltaYFrom(t.y),Math.abs(e)>Math.abs(t)?this.setDirection(0<e?6:4):0!==t&&this.setDirection(0<t?2:8)},Game_Character.prototype.turnTowardPlayer=function(){this.turnTowardCharacter($gamePlayer)},Game_Character.prototype.turnAwayFromPlayer=function(){this.turnAwayFromCharacter($gamePlayer)},Game_Character.prototype.moveTowardPlayer=function(){this.moveTowardCharacter($gamePlayer)},Game_Character.prototype.moveAwayFromPlayer=function(){this.moveAwayFromCharacter($gamePlayer)},Game_Character.prototype.moveForward=function(){this.moveStraight(this.direction())},Game_Character.prototype.moveBackward=function(){var t=this.isDirectionFixed();this.setDirectionFix(!0),this.moveStraight(this.reverseDir(this.direction())),this.setDirectionFix(t)},Game_Character.prototype.processRouteEnd=function(){this._moveRoute.repeat?this._moveRouteIndex=-1:this._moveRouteForcing&&(this._moveRouteForcing=!1,this.restoreMoveRoute())},Game_Character.prototype.advanceMoveRouteIndex=function(){var t=this._moveRoute;if(t&&(this.isMovementSucceeded()||t.skippable)){var e=t.list.length-1;this._moveRouteIndex++,t.repeat&&this._moveRouteIndex>=e&&(this._moveRouteIndex=0)}},Game_Character.prototype.turnRight90=function(){switch(this.direction()){case 2:this.setDirection(4);break;case 4:this.setDirection(8);break;case 6:this.setDirection(2);break;case 8:this.setDirection(6)}},Game_Character.prototype.turnLeft90=function(){switch(this.direction()){case 2:this.setDirection(6);break;case 4:this.setDirection(2);break;case 6:this.setDirection(8);break;case 8:this.setDirection(4)}},Game_Character.prototype.turn180=function(){this.setDirection(this.reverseDir(this.direction()))},Game_Character.prototype.turnRightOrLeft90=function(){switch(Math.randomInt(2)){case 0:this.turnRight90();break;case 1:this.turnLeft90()}},Game_Character.prototype.turnRandom=function(){this.setDirection(2+2*Math.randomInt(4))},Game_Character.prototype.swap=function(t){var e=t.x,i=t.y;t.locate(this.x,this.y),this.locate(e,i)},Game_Character.prototype.findDirectionTo=function(t,e){var i=this.searchLimit(),a=$gameMap.width(),n=[],o=[],r=[],s={},h=s;if(this.x===t&&this.y===e)return 0;for(s.parent=null,s.x=this.x,s.y=this.y,s.g=0,s.f=$gameMap.distance(s.x,s.y,t,e),n.push(s),o.push(s.y*a+s.x);0<n.length;){for(var p=0,c=0;c<n.length;c++)n[c].f<n[p].f&&(p=c);var u=(c=n[p]).x,l=c.y,d=l*a+u,m=c.g;if(n.splice(p,1),o.splice(o.indexOf(d),1),r.push(d),c.x===t&&c.y===e){h=c;break}if(!(i<=m))for(p=0;p<4;p++){var _=2+2*p;d=$gameMap.roundXWithDirection(u,_);var f=$gameMap.roundYWithDirection(l,_),y=f*a+d;if(!r.contains(y)&&this.canPass(u,l,_)){_=m+1;var g=o.indexOf(y);(g<0||_<n[g].g)&&(0<=g?g=n[g]:(g={},n.push(g),o.push(y)),g.parent=c,g.x=d,g.y=f,g.g=_,g.f=_+$gameMap.distance(d,f,t,e),(!h||g.f-g.g<h.f-h.g)&&(h=g))}}}for(a=h;a.parent&&a.parent!==s;)a=a.parent;return i=$gameMap.deltaX(a.x,s.x),0<(s=$gameMap.deltaY(a.y,s.y))?2:i<0?4:0<i?6:s<0?8:(t=this.deltaXFrom(t),e=this.deltaYFrom(e),Math.abs(t)>Math.abs(e)?0<t?4:6:0!==e?0<e?8:2:0)},Game_Character.prototype.searchLimit=function(){return 12},Game_Player.prototype=Object.create(Game_Character.prototype),Game_Player.prototype.constructor=Game_Player,Game_Player.prototype.initialize=function(){Game_Character.prototype.initialize.call(this),this.setTransparent($dataSystem.optTransparent)},Game_Player.prototype.initMembers=function(){Game_Character.prototype.initMembers.call(this),this._vehicleType="walk",this._transferring=this._needsMapReload=this._dashing=this._vehicleGettingOff=this._vehicleGettingOn=!1,this._fadeType=this._newDirection=this._newY=this._newX=this._newMapId=0,this._followers=new Game_Followers,this._encounterCount=0},Game_Player.prototype.clearTransferInfo=function(){this._transferring=!1,this._newDirection=this._newY=this._newX=this._newMapId=0},Game_Player.prototype.followers=function(){return this._followers},Game_Player.prototype.refresh=function(){var t=$gameParty.leader(),e=t?t.characterName():"";t=t?t.characterIndex():0,this.setImage(e,t),this._followers.refresh()},Game_Player.prototype.isStopping=function(){return!this._vehicleGettingOn&&!this._vehicleGettingOff&&Game_Character.prototype.isStopping.call(this)},Game_Player.prototype.reserveTransfer=function(t,e,i,a,n){this._transferring=!0,this._newMapId=t,this._newX=e,this._newY=i,this._newDirection=a,this._fadeType=n},Game_Player.prototype.requestMapReload=function(){this._needsMapReload=!0},Game_Player.prototype.isTransferring=function(){return this._transferring},Game_Player.prototype.newMapId=function(){return this._newMapId},Game_Player.prototype.fadeType=function(){return this._fadeType},Game_Player.prototype.performTransfer=function(){this.isTransferring()&&(this.setDirection(this._newDirection),this._newMapId===$gameMap.mapId()&&!this._needsMapReload||($gameMap.setup(this._newMapId),this._needsMapReload=!1),this.locate(this._newX,this._newY),this.refresh(),this.clearTransferInfo())},Game_Player.prototype.isMapPassable=function(t,e,i){var a=this.vehicle();return a?a.isMapPassable(t,e,i):Game_Character.prototype.isMapPassable.call(this,t,e,i)},Game_Player.prototype.vehicle=function(){return $gameMap.vehicle(this._vehicleType)},Game_Player.prototype.isInBoat=function(){return"boat"===this._vehicleType},Game_Player.prototype.isInShip=function(){return"ship"===this._vehicleType},Game_Player.prototype.isInAirship=function(){return"airship"===this._vehicleType},Game_Player.prototype.isInVehicle=function(){return this.isInBoat()||this.isInShip()||this.isInAirship()},Game_Player.prototype.isNormal=function(){return"walk"===this._vehicleType&&!this.isMoveRouteForcing()},Game_Player.prototype.isDashing=function(){return this._dashing},Game_Player.prototype.isDebugThrough=function(){return Input.isPressed("control")&&$gameTemp.isPlaytest()},Game_Player.prototype.isCollided=function(t,e){return!this.isThrough()&&(this.pos(t,e)||this._followers.isSomeoneCollided(t,e))},Game_Player.prototype.centerX=function(){return(Graphics.width/$gameMap.tileWidth()-1)/2},Game_Player.prototype.centerY=function(){return(Graphics.height/$gameMap.tileHeight()-1)/2},Game_Player.prototype.center=function(t,e){return $gameMap.setDisplayPos(t-this.centerX(),e-this.centerY())},Game_Player.prototype.locate=function(t,e){Game_Character.prototype.locate.call(this,t,e),this.center(t,e),this.makeEncounterCount(),this.isInVehicle()&&this.vehicle().refresh(),this._followers.synchronize(t,e,this.direction())},Game_Player.prototype.increaseSteps=function(){Game_Character.prototype.increaseSteps.call(this),this.isNormal()&&$gameParty.increaseSteps()},Game_Player.prototype.makeEncounterCount=function(){var t=$gameMap.encounterStep();this._encounterCount=Math.randomInt(t)+Math.randomInt(t)+1},Game_Player.prototype.makeEncounterTroopId=function(){var e=[],i=0;if($gameMap.encounterList().forEach(function(t){this.meetsEncounterConditions(t)&&(e.push(t),i+=t.weight)},this),0<i)for(var t=Math.randomInt(i),a=0;a<e.length;a++)if((t-=e[a].weight)<0)return e[a].troopId;return 0},Game_Player.prototype.meetsEncounterConditions=function(t){return 0===t.regionSet.length||t.regionSet.contains(this.regionId())},Game_Player.prototype.executeEncounter=function(){if(!$gameMap.isEventRunning()&&this._encounterCount<=0){this.makeEncounterCount();var t=this.makeEncounterTroopId();if($dataTroops[t])return BattleManager.setup(t,!0,!1),BattleManager.onEncounter(),!0}return!1},Game_Player.prototype.startMapEvent=function(t,e,i,a){$gameMap.isEventRunning()||$gameMap.eventsXy(t,e).forEach(function(t){t.isTriggerIn(i)&&t.isNormalPriority()===a&&t.start()})},Game_Player.prototype.moveByInput=function(){if(!this.isMoving()&&this.canMove()){var t=this.getInputDirection();if(0<t)$gameTemp.clearDestination();else if($gameTemp.isDestinationValid()){t=$gameTemp.destinationX();var e=$gameTemp.destinationY();t=this.findDirectionTo(t,e)}0<t&&this.executeMove(t)}},Game_Player.prototype.canMove=function(){return!($gameMap.isEventRunning()||$gameMessage.isBusy()||this.isMoveRouteForcing()||this.areFollowersGathering()||this._vehicleGettingOn||this._vehicleGettingOff||this.isInVehicle()&&!this.vehicle().canMove())},Game_Player.prototype.getInputDirection=function(){return Input.dir4},Game_Player.prototype.executeMove=function(t){this.moveStraight(t)},Game_Player.prototype.update=function(t){var e=this.scrolledX(),i=this.scrolledY(),a=this.isMoving();this.updateDashing(),t&&this.moveByInput(),Game_Character.prototype.update.call(this),this.updateScroll(e,i),this.updateVehicle(),this.isMoving()||this.updateNonmoving(a),this._followers.update()},Game_Player.prototype.updateDashing=function(){this.isMoving()||(!this.canMove()||this.isInVehicle()||$gameMap.isDashDisabled()?this._dashing=!1:this._dashing=this.isDashButtonPressed()||$gameTemp.isDestinationValid())},Game_Player.prototype.isDashButtonPressed=function(){var t=Input.isPressed("shift");return ConfigManager.alwaysDash?!t:t},Game_Player.prototype.updateScroll=function(t,e){var i=this.scrolledX(),a=this.scrolledY();e<a&&a>this.centerY()&&$gameMap.scrollDown(a-e),i<t&&i<this.centerX()&&$gameMap.scrollLeft(t-i),t<i&&i>this.centerX()&&$gameMap.scrollRight(i-t),a<e&&a<this.centerY()&&$gameMap.scrollUp(e-a)},Game_Player.prototype.updateVehicle=function(){this.isInVehicle()&&!this.areFollowersGathering()&&(this._vehicleGettingOn?this.updateVehicleGetOn():this._vehicleGettingOff?this.updateVehicleGetOff():this.vehicle().syncWithPlayer())},Game_Player.prototype.updateVehicleGetOn=function(){this.areFollowersGathering()||this.isMoving()||(this.setDirection(this.vehicle().direction()),this.setMoveSpeed(this.vehicle().moveSpeed()),this._vehicleGettingOn=!1,this.setTransparent(!0),this.isInAirship()&&this.setThrough(!0),this.vehicle().getOn())},Game_Player.prototype.updateVehicleGetOff=function(){!this.areFollowersGathering()&&this.vehicle().isLowest()&&(this._vehicleGettingOff=!1,this._vehicleType="walk",this.setTransparent(!1))},Game_Player.prototype.updateNonmoving=function(t){if(!$gameMap.isEventRunning()){if(t&&($gameParty.onPlayerWalk(),this.checkEventTriggerHere([1,2]),$gameMap.setupStartingEvent()))return;this.triggerAction()||(t?this.updateEncounterCount():$gameTemp.clearDestination())}},Game_Player.prototype.triggerAction=function(){return!(!this.canMove()||!this.triggerButtonAction()&&!this.triggerTouchAction())};function Sprite_Damage(){this.initialize.apply(this,arguments)}function Sprite_StateIcon(){this.initialize.apply(this,arguments)}function Sprite_StateOverlay(){this.initialize.apply(this,arguments)}function Sprite_Weapon(){this.initialize.apply(this,arguments)}function Sprite_Balloon(){this.initialize.apply(this,arguments)}function Sprite_Picture(){this.initialize.apply(this,arguments)}function Sprite_Timer(){this.initialize.apply(this,arguments)}function Sprite_Destination(){this.initialize.apply(this,arguments)}function Spriteset_Base(){this.initialize.apply(this,arguments)}function Spriteset_Map(){this.initialize.apply(this,arguments)}function Spriteset_Battle(){this.initialize.apply(this,arguments)}function Window_Base(){this.initialize.apply(this,arguments)}function Window_Selectable(){this.initialize.apply(this,arguments)}function Window_Command(){this.initialize.apply(this,arguments)}function Window_HorzCommand(){this.initialize.apply(this,arguments)}function Window_Help(){this.initialize.apply(this,arguments)}function Window_Gold(){this.initialize.apply(this,arguments)}function Window_MenuCommand(){this.initialize.apply(this,arguments)}function Window_MenuStatus(){this.initialize.apply(this,arguments)}function Window_MenuActor(){this.initialize.apply(this,arguments)}function Window_ItemCategory(){this.initialize.apply(this,arguments)}function Window_ItemList(){this.initialize.apply(this,arguments)}function Window_SkillType(){this.initialize.apply(this,arguments)}function Window_SkillStatus(){this.initialize.apply(this,arguments)}function Window_SkillList(){this.initialize.apply(this,arguments)}function Window_EquipStatus(){this.initialize.apply(this,arguments)}function Window_EquipCommand(){this.initialize.apply(this,arguments)}function Window_EquipSlot(){this.initialize.apply(this,arguments)}function Window_EquipItem(){this.initialize.apply(this,arguments)}function Window_Status(){this.initialize.apply(this,arguments)}function Window_Options(){this.initialize.apply(this,arguments)}function Window_SavefileList(){this.initialize.apply(this,arguments)}function Window_ShopCommand(){this.initialize.apply(this,arguments)}function Window_ShopBuy(){this.initialize.apply(this,arguments)}function Window_ShopSell(){this.initialize.apply(this,arguments)}function Window_ShopNumber(){this.initialize.apply(this,arguments)}function Window_ShopStatus(){this.initialize.apply(this,arguments)}function Window_NameEdit(){this.initialize.apply(this,arguments)}function Window_NameInput(){this.initialize.apply(this,arguments)}function Window_ChoiceList(){this.initialize.apply(this,arguments)}function Window_NumberInput(){this.initialize.apply(this,arguments)}Game_Player.prototype.triggerButtonAction=function(){if(Input.isTriggered("ok")){if(this.getOnOffVehicle())return!0;if(this.checkEventTriggerHere([0]),$gameMap.setupStartingEvent())return!0;if(this.checkEventTriggerThere([0,1,2]),$gameMap.setupStartingEvent())return!0}return!1},Game_Player.prototype.triggerTouchAction=function(){if($gameTemp.isDestinationValid()){var t=this.direction(),e=this.x,i=this.y,a=$gameMap.roundXWithDirection(e,t),n=$gameMap.roundYWithDirection(i,t),o=$gameMap.roundXWithDirection(a,t);t=$gameMap.roundYWithDirection(n,t);var r=$gameTemp.destinationX(),s=$gameTemp.destinationY();if(r===e&&s===i)return this.triggerTouchActionD1(e,i);if(r===a&&s===n)return this.triggerTouchActionD2(a,n);if(r===o&&s===t)return this.triggerTouchActionD3(a,n)}return!1},Game_Player.prototype.triggerTouchActionD1=function(t,e){return!!($gameMap.airship().pos(t,e)&&TouchInput.isTriggered()&&this.getOnOffVehicle())||(this.checkEventTriggerHere([0]),$gameMap.setupStartingEvent())},Game_Player.prototype.triggerTouchActionD2=function(t,e){return!!(($gameMap.boat().pos(t,e)||$gameMap.ship().pos(t,e))&&TouchInput.isTriggered()&&this.getOnVehicle()||(this.isInBoat()||this.isInShip())&&TouchInput.isTriggered()&&this.getOffVehicle())||(this.checkEventTriggerThere([0,1,2]),$gameMap.setupStartingEvent())},Game_Player.prototype.triggerTouchActionD3=function(t,e){return $gameMap.isCounter(t,e)&&this.checkEventTriggerThere([0,1,2]),$gameMap.setupStartingEvent()},Game_Player.prototype.updateEncounterCount=function(){this.canEncounter()&&(this._encounterCount-=this.encounterProgressValue())},Game_Player.prototype.canEncounter=function(){return!$gameParty.hasEncounterNone()&&$gameSystem.isEncounterEnabled()&&!this.isInAirship()&&!this.isMoveRouteForcing()&&!this.isDebugThrough()},Game_Player.prototype.encounterProgressValue=function(){var t=$gameMap.isBush(this.x,this.y)?2:1;return $gameParty.hasEncounterHalf()&&(t*=.5),this.isInShip()&&(t*=.5),t},Game_Player.prototype.checkEventTriggerHere=function(t){this.canStartLocalEvents()&&this.startMapEvent(this.x,this.y,t,!1)},Game_Player.prototype.checkEventTriggerThere=function(t){if(this.canStartLocalEvents()){var e=this.direction(),i=this.y,a=$gameMap.roundXWithDirection(this.x,e);i=$gameMap.roundYWithDirection(i,e),this.startMapEvent(a,i,t,!0),!$gameMap.isAnyEventStarting()&&$gameMap.isCounter(a,i)&&(a=$gameMap.roundXWithDirection(a,e),e=$gameMap.roundYWithDirection(i,e),this.startMapEvent(a,e,t,!0))}},Game_Player.prototype.checkEventTriggerTouch=function(t,e){this.canStartLocalEvents()&&this.startMapEvent(t,e,[1,2],!0)},Game_Player.prototype.canStartLocalEvents=function(){return!this.isInAirship()},Game_Player.prototype.getOnOffVehicle=function(){return this.isInVehicle()?this.getOffVehicle():this.getOnVehicle()},Game_Player.prototype.getOnVehicle=function(){var t=this.direction(),e=this.x,i=this.y,a=$gameMap.roundXWithDirection(e,t);return t=$gameMap.roundYWithDirection(i,t),$gameMap.airship().pos(e,i)?this._vehicleType="airship":$gameMap.ship().pos(a,t)?this._vehicleType="ship":$gameMap.boat().pos(a,t)&&(this._vehicleType="boat"),this.isInVehicle()&&(this._vehicleGettingOn=!0,this.isInAirship()||this.forceMoveForward(),this.gatherFollowers()),this._vehicleGettingOn},Game_Player.prototype.getOffVehicle=function(){return this.vehicle().isLandOk(this.x,this.y,this.direction())&&(this.isInAirship()&&this.setDirection(2),this._followers.synchronize(this.x,this.y,this.direction()),this.vehicle().getOff(),this.isInAirship()||(this.forceMoveForward(),this.setTransparent(!1)),this._vehicleGettingOff=!0,this.setMoveSpeed(4),this.setThrough(!1),this.makeEncounterCount(),this.gatherFollowers()),this._vehicleGettingOff},Game_Player.prototype.forceMoveForward=function(){this.setThrough(!0),this.moveForward(),this.setThrough(!1)},Game_Player.prototype.isOnDamageFloor=function(){return $gameMap.isDamageFloor(this.x,this.y)&&!this.isInAirship()},Game_Player.prototype.moveStraight=function(t){this.canPass(this.x,this.y,t)&&this._followers.updateMove(),Game_Character.prototype.moveStraight.call(this,t)},Game_Player.prototype.moveDiagonally=function(t,e){this.canPassDiagonally(this.x,this.y,t,e)&&this._followers.updateMove(),Game_Character.prototype.moveDiagonally.call(this,t,e)},Game_Player.prototype.jump=function(t,e){Game_Character.prototype.jump.call(this,t,e),this._followers.jumpAll()},Game_Player.prototype.showFollowers=function(){this._followers.show()},Game_Player.prototype.hideFollowers=function(){this._followers.hide()},Game_Player.prototype.gatherFollowers=function(){this._followers.gather()},Game_Player.prototype.areFollowersGathering=function(){return this._followers.areGathering()},Game_Player.prototype.areFollowersGathered=function(){return this._followers.areGathered()},Game_Follower.prototype=Object.create(Game_Character.prototype),Game_Follower.prototype.constructor=Game_Follower,Game_Follower.prototype.initialize=function(t){Game_Character.prototype.initialize.call(this),this._memberIndex=t,this.setTransparent($dataSystem.optTransparent),this.setThrough(!0)},Game_Follower.prototype.refresh=function(){var t=this.isVisible()?this.actor().characterName():"",e=this.isVisible()?this.actor().characterIndex():0;this.setImage(t,e)},Game_Follower.prototype.actor=function(){return $gameParty.battleMembers()[this._memberIndex]},Game_Follower.prototype.isVisible=function(){return this.actor()&&$gamePlayer.followers().isVisible()},Game_Follower.prototype.update=function(){Game_Character.prototype.update.call(this),this.setMoveSpeed($gamePlayer.realMoveSpeed()),this.setOpacity($gamePlayer.opacity()),this.setBlendMode($gamePlayer.blendMode()),this.setWalkAnime($gamePlayer.hasWalkAnime()),this.setStepAnime($gamePlayer.hasStepAnime()),this.setDirectionFix($gamePlayer.isDirectionFixed()),this.setTransparent($gamePlayer.isTransparent())},Game_Follower.prototype.chaseCharacter=function(t){var e=this.deltaXFrom(t.x);t=this.deltaYFrom(t.y),0!==e&&0!==t?this.moveDiagonally(0<e?4:6,0<t?8:2):0!==e?this.moveStraight(0<e?4:6):0!==t&&this.moveStraight(0<t?8:2),this.setMoveSpeed($gamePlayer.realMoveSpeed())},Game_Followers.prototype.initialize=function(){this._visible=$dataSystem.optFollowers,this._gathering=!1,this._data=[];for(var t=1;t<$gameParty.maxBattleMembers();t++)this._data.push(new Game_Follower(t))},Game_Followers.prototype.isVisible=function(){return this._visible},Game_Followers.prototype.show=function(){this._visible=!0},Game_Followers.prototype.hide=function(){this._visible=!1},Game_Followers.prototype.follower=function(t){return this._data[t]},Game_Followers.prototype.forEach=function(t,e){this._data.forEach(t,e)},Game_Followers.prototype.reverseEach=function(t,e){this._data.reverse(),this._data.forEach(t,e),this._data.reverse()},Game_Followers.prototype.refresh=function(){this.forEach(function(t){return t.refresh()},this)},Game_Followers.prototype.update=function(){this.areGathering()&&(this.areMoving()||this.updateMove(),this.areGathered()&&(this._gathering=!1)),this.forEach(function(t){t.update()},this)},Game_Followers.prototype.updateMove=function(){for(var t=this._data.length-1;0<=t;t--)this._data[t].chaseCharacter(0<t?this._data[t-1]:$gamePlayer)},Game_Followers.prototype.jumpAll=function(){if($gamePlayer.isJumping())for(var t=0;t<this._data.length;t++){var e=this._data[t],i=$gamePlayer.deltaXFrom(e.x),a=$gamePlayer.deltaYFrom(e.y);e.jump(i,a)}},Game_Followers.prototype.synchronize=function(e,i,a){this.forEach(function(t){t.locate(e,i),t.setDirection(a)},this)},Game_Followers.prototype.gather=function(){this._gathering=!0},Game_Followers.prototype.areGathering=function(){return this._gathering},Game_Followers.prototype.visibleFollowers=function(){return this._data.filter(function(t){return t.isVisible()},this)},Game_Followers.prototype.areMoving=function(){return this.visibleFollowers().some(function(t){return t.isMoving()},this)},Game_Followers.prototype.areGathered=function(){return this.visibleFollowers().every(function(t){return!t.isMoving()&&t.pos($gamePlayer.x,$gamePlayer.y)},this)},Game_Followers.prototype.isSomeoneCollided=function(e,i){return this.visibleFollowers().some(function(t){return t.pos(e,i)},this)},Game_Vehicle.prototype=Object.create(Game_Character.prototype),Game_Vehicle.prototype.constructor=Game_Vehicle,Game_Vehicle.prototype.initialize=function(t){Game_Character.prototype.initialize.call(this),this._type=t,this.resetDirection(),this.initMoveSpeed(),this.loadSystemSettings()},Game_Vehicle.prototype.initMembers=function(){Game_Character.prototype.initMembers.call(this),this._type="",this._altitude=this._mapId=0,this._driving=!1,this._bgm=null},Game_Vehicle.prototype.isBoat=function(){return"boat"===this._type},Game_Vehicle.prototype.isShip=function(){return"ship"===this._type},Game_Vehicle.prototype.isAirship=function(){return"airship"===this._type},Game_Vehicle.prototype.resetDirection=function(){this.setDirection(4)},Game_Vehicle.prototype.initMoveSpeed=function(){this.isBoat()?this.setMoveSpeed(4):this.isShip()?this.setMoveSpeed(5):this.isAirship()&&this.setMoveSpeed(6)},Game_Vehicle.prototype.vehicle=function(){return this.isBoat()?$dataSystem.boat:this.isShip()?$dataSystem.ship:this.isAirship()?$dataSystem.airship:null},Game_Vehicle.prototype.loadSystemSettings=function(){var t=this.vehicle();this._mapId=t.startMapId,this.setPosition(t.startX,t.startY),this.setImage(t.characterName,t.characterIndex)},Game_Vehicle.prototype.refresh=function(){this._driving?(this._mapId=$gameMap.mapId(),this.syncWithPlayer()):this._mapId===$gameMap.mapId()&&this.locate(this.x,this.y),this.isAirship()?this.setPriorityType(this._driving?2:0):this.setPriorityType(1),this.setWalkAnime(this._driving),this.setStepAnime(this._driving),this.setTransparent(this._mapId!==$gameMap.mapId())},Game_Vehicle.prototype.setLocation=function(t,e,i){this._mapId=t,this.setPosition(e,i),this.refresh()},Game_Vehicle.prototype.pos=function(t,e){return this._mapId===$gameMap.mapId()&&Game_Character.prototype.pos.call(this,t,e)},Game_Vehicle.prototype.isMapPassable=function(t,e,i){return t=$gameMap.roundXWithDirection(t,i),e=$gameMap.roundYWithDirection(e,i),this.isBoat()?$gameMap.isBoatPassable(t,e):this.isShip()?$gameMap.isShipPassable(t,e):!!this.isAirship()},Game_Vehicle.prototype.getOn=function(){this._driving=!0,this.setWalkAnime(!0),this.setStepAnime(!0),$gameSystem.saveWalkingBgm(),this.playBgm()},Game_Vehicle.prototype.getOff=function(){this._driving=!1,this.setWalkAnime(!1),this.setStepAnime(!1),this.resetDirection(),$gameSystem.replayWalkingBgm()},Game_Vehicle.prototype.setBgm=function(t){this._bgm=t},Game_Vehicle.prototype.playBgm=function(){AudioManager.playBgm(this._bgm||this.vehicle().bgm)},Game_Vehicle.prototype.syncWithPlayer=function(){this.copyPosition($gamePlayer),this.refreshBushDepth()},Game_Vehicle.prototype.screenY=function(){return Game_Character.prototype.screenY.call(this)-this._altitude},Game_Vehicle.prototype.shadowX=function(){return this.screenX()},Game_Vehicle.prototype.shadowY=function(){return this.screenY()+this._altitude},Game_Vehicle.prototype.shadowOpacity=function(){return 255*this._altitude/this.maxAltitude()},Game_Vehicle.prototype.canMove=function(){return!this.isAirship()||this.isHighest()},Game_Vehicle.prototype.update=function(){Game_Character.prototype.update.call(this),this.isAirship()&&this.updateAirship()},Game_Vehicle.prototype.updateAirship=function(){this.updateAirshipAltitude(),this.setStepAnime(this.isHighest()),this.setPriorityType(this.isLowest()?0:2)},Game_Vehicle.prototype.updateAirshipAltitude=function(){this._driving&&!this.isHighest()&&this._altitude++,this._driving||this.isLowest()||this._altitude--},Game_Vehicle.prototype.maxAltitude=function(){return 48},Game_Vehicle.prototype.isLowest=function(){return this._altitude<=0},Game_Vehicle.prototype.isHighest=function(){return this._altitude>=this.maxAltitude()},Game_Vehicle.prototype.isTakeoffOk=function(){return $gamePlayer.areFollowersGathered()},Game_Vehicle.prototype.isLandOk=function(t,e,i){if(this.isAirship()){if(!$gameMap.isAirshipLandOk(t,e)||0<$gameMap.eventsXy(t,e).length)return!1}else if(t=$gameMap.roundXWithDirection(t,i),e=$gameMap.roundYWithDirection(e,i),!$gameMap.isValid(t,e)||!$gameMap.isPassable(t,e,this.reverseDir(i))||this.isCollidedWithCharacters(t,e))return!1;return!0},Game_Event.prototype=Object.create(Game_Character.prototype),Game_Event.prototype.constructor=Game_Event,Game_Event.prototype.initialize=function(t,e){Game_Character.prototype.initialize.call(this),this._mapId=t,this._eventId=e,this.locate(this.event().x,this.event().y),this.refresh()},Game_Event.prototype.initMembers=function(){Game_Character.prototype.initMembers.call(this),this._trigger=this._moveType=0,this._erased=this._starting=!1,this._pageIndex=-2,this._originalPattern=1,this._originalDirection=2,this._prelockDirection=0,this._locked=!1},Game_Event.prototype.eventId=function(){return this._eventId},Game_Event.prototype.event=function(){return $dataMap.events[this._eventId]},Game_Event.prototype.page=function(){return this.event().pages[this._pageIndex]},Game_Event.prototype.list=function(){return this.page().list},Game_Event.prototype.isCollidedWithCharacters=function(t,e){return Game_Character.prototype.isCollidedWithCharacters.call(this,t,e)||this.isCollidedWithPlayerCharacters(t,e)},Game_Event.prototype.isCollidedWithEvents=function(t,e){return 0<$gameMap.eventsXyNt(t,e).length},Game_Event.prototype.isCollidedWithPlayerCharacters=function(t,e){return this.isNormalPriority()&&$gamePlayer.isCollided(t,e)},Game_Event.prototype.lock=function(){this._locked||(this._prelockDirection=this.direction(),this.turnTowardPlayer(),this._locked=!0)},Game_Event.prototype.unlock=function(){this._locked&&(this._locked=!1,this.setDirection(this._prelockDirection))},Game_Event.prototype.updateStop=function(){this._locked&&this.resetStopCount(),Game_Character.prototype.updateStop.call(this),this.isMoveRouteForcing()||this.updateSelfMovement()},Game_Event.prototype.updateSelfMovement=function(){if(!this._locked&&this.isNearTheScreen()&&this.checkStop(this.stopCountThreshold()))switch(this._moveType){case 1:this.moveTypeRandom();break;case 2:this.moveTypeTowardPlayer();break;case 3:this.moveTypeCustom()}},Game_Event.prototype.stopCountThreshold=function(){return 30*(5-this.moveFrequency())},Game_Event.prototype.moveTypeRandom=function(){switch(Math.randomInt(6)){case 0:case 1:this.moveRandom();break;case 2:case 3:case 4:this.moveForward();break;case 5:this.resetStopCount()}},Game_Event.prototype.moveTypeTowardPlayer=function(){if(this.isNearThePlayer())switch(Math.randomInt(6)){case 0:case 1:case 2:case 3:this.moveTowardPlayer();break;case 4:this.moveRandom();break;case 5:this.moveForward()}else this.moveRandom()},Game_Event.prototype.isNearThePlayer=function(){return Math.abs(this.deltaXFrom($gamePlayer.x))+Math.abs(this.deltaYFrom($gamePlayer.y))<20},Game_Event.prototype.moveTypeCustom=function(){this.updateRoutineMove()},Game_Event.prototype.isStarting=function(){return this._starting},Game_Event.prototype.clearStartingFlag=function(){this._starting=!1},Game_Event.prototype.isTriggerIn=function(t){return t.contains(this._trigger)},Game_Event.prototype.start=function(){var t=this.list();t&&1<t.length&&(this._starting=!0,this.isTriggerIn([0,1,2])&&this.lock())},Game_Event.prototype.erase=function(){this._erased=!0,this.refresh()},Game_Event.prototype.refresh=function(){var t=this._erased?-1:this.findProperPageIndex();this._pageIndex!==t&&(this._pageIndex=t,this.setupPage())},Game_Event.prototype.findProperPageIndex=function(){for(var t=this.event().pages,e=t.length-1;0<=e;e--)if(this.meetsConditions(t[e]))return e;return-1},Game_Event.prototype.meetsConditions=function(t){return!((t=t.conditions).switch1Valid&&!$gameSwitches.value(t.switch1Id)||t.switch2Valid&&!$gameSwitches.value(t.switch2Id)||t.variableValid&&$gameVariables.value(t.variableId)<t.variableValue||t.selfSwitchValid&&!0!==$gameSelfSwitches.value([this._mapId,this._eventId,t.selfSwitchCh])||t.itemValid&&!$gameParty.hasItem($dataItems[t.itemId])||t.actorValid&&(t=$gameActors.actor(t.actorId),!$gameParty.members().contains(t)))},Game_Event.prototype.setupPage=function(){0<=this._pageIndex?this.setupPageSettings():this.clearPageSettings(),this.refreshBushDepth(),this.clearStartingFlag(),this.checkEventTriggerAuto()},Game_Event.prototype.clearPageSettings=function(){this.setImage("",0),this._moveType=0,this._interpreter=this._trigger=null,this.setThrough(!0)},Game_Event.prototype.setupPageSettings=function(){var t=this.page(),e=t.image;0<e.tileId?this.setTileImage(e.tileId):this.setImage(e.characterName,e.characterIndex),this._originalDirection!==e.direction&&(this._originalDirection=e.direction,this._prelockDirection=0,this.setDirectionFix(!1),this.setDirection(e.direction)),this._originalPattern!==e.pattern&&(this._originalPattern=e.pattern,this.setPattern(e.pattern)),this.setMoveSpeed(t.moveSpeed),this.setMoveFrequency(t.moveFrequency),this.setPriorityType(t.priorityType),this.setWalkAnime(t.walkAnime),this.setStepAnime(t.stepAnime),this.setDirectionFix(t.directionFix),this.setThrough(t.through),this.setMoveRoute(t.moveRoute),this._moveType=t.moveType,this._trigger=t.trigger,this._interpreter=4===this._trigger?new Game_Interpreter:null},Game_Event.prototype.isOriginalPattern=function(){return this.pattern()===this._originalPattern},Game_Event.prototype.resetPattern=function(){this.setPattern(this._originalPattern)},Game_Event.prototype.checkEventTriggerTouch=function(t,e){$gameMap.isEventRunning()||2===this._trigger&&$gamePlayer.pos(t,e)&&!this.isJumping()&&this.isNormalPriority()&&this.start()},Game_Event.prototype.checkEventTriggerAuto=function(){3===this._trigger&&this.start()},Game_Event.prototype.update=function(){Game_Character.prototype.update.call(this),this.checkEventTriggerAuto(),this.updateParallel()},Game_Event.prototype.updateParallel=function(){this._interpreter&&(this._interpreter.isRunning()||this._interpreter.setup(this.list(),this._eventId),this._interpreter.update())},Game_Event.prototype.locate=function(t,e){Game_Character.prototype.locate.call(this,t,e),this._prelockDirection=0},Game_Event.prototype.forceMoveRoute=function(t){Game_Character.prototype.forceMoveRoute.call(this,t),this._prelockDirection=0},Game_Interpreter.prototype.initialize=function(t){this._depth=t||0,this.checkOverflow(),this.clear(),this._branch={},this._params=[],this._freezeChecker=this._frameCount=this._indent=0},Game_Interpreter.prototype.checkOverflow=function(){if(100<=this._depth)throw Error("Common event calls exceeded the limit")},Game_Interpreter.prototype.clear=function(){this._eventId=this._mapId=0,this._list=null,this._waitCount=this._index=0,this._comments=this._waitMode="",this._childInterpreter=this._character=null},Game_Interpreter.prototype.setup=function(t,e){this.clear(),this._mapId=$gameMap.mapId(),this._eventId=e||0,this._list=t,Game_Interpreter.requestImages(t)},Game_Interpreter.prototype.eventId=function(){return this._eventId},Game_Interpreter.prototype.isOnCurrentMap=function(){return this._mapId===$gameMap.mapId()},Game_Interpreter.prototype.setupReservedCommonEvent=function(){return!!$gameTemp.isCommonEventReserved()&&(this.setup($gameTemp.reservedCommonEvent().list),$gameTemp.clearCommonEvent(),!0)},Game_Interpreter.prototype.isRunning=function(){return!!this._list},Game_Interpreter.prototype.update=function(){for(;this.isRunning()&&!this.updateChild()&&!this.updateWait()&&!SceneManager.isSceneChanging()&&this.executeCommand()&&!this.checkFreeze(););},Game_Interpreter.prototype.updateChild=function(){if(this._childInterpreter){if(this._childInterpreter.update(),this._childInterpreter.isRunning())return!0;this._childInterpreter=null}return!1},Game_Interpreter.prototype.updateWait=function(){return this.updateWaitCount()||this.updateWaitMode()},Game_Interpreter.prototype.updateWaitCount=function(){return 0<this._waitCount&&(this._waitCount--,!0)},Game_Interpreter.prototype.updateWaitMode=function(){var t=!1;switch(this._waitMode){case"message":t=$gameMessage.isBusy();break;case"transfer":t=$gamePlayer.isTransferring();break;case"scroll":t=$gameMap.isScrolling();break;case"route":t=this._character.isMoveRouteForcing();break;case"animation":t=this._character.isAnimationPlaying();break;case"balloon":t=this._character.isBalloonPlaying();break;case"gather":t=$gamePlayer.areFollowersGathering();break;case"action":t=BattleManager.isActionForced();break;case"video":t=Graphics.isVideoPlaying();break;case"image":t=!ImageManager.isReady()}return t||(this._waitMode=""),t},Game_Interpreter.prototype.setWaitMode=function(t){this._waitMode=t},Game_Interpreter.prototype.wait=function(t){this._waitCount=t},Game_Interpreter.prototype.fadeSpeed=function(){return 24},Game_Interpreter.prototype.executeCommand=function(){var t=this.currentCommand();if(t){if(this._params=t.parameters,this._indent=t.indent,"function"==typeof this[t="command"+t.code]&&!this[t]())return!1;this._index++}else this.terminate();return!0},Game_Interpreter.prototype.checkFreeze=function(){return this._frameCount!==Graphics.frameCount&&(this._frameCount=Graphics.frameCount,this._freezeChecker=0),1e5<=this._freezeChecker++},Game_Interpreter.prototype.terminate=function(){this._list=null,this._comments=""},Game_Interpreter.prototype.skipBranch=function(){for(;this._list[this._index+1].indent>this._indent;)this._index++},Game_Interpreter.prototype.currentCommand=function(){return this._list[this._index]},Game_Interpreter.prototype.nextEventCode=function(){var t=this._list[this._index+1];return t?t.code:0},Game_Interpreter.prototype.iterateActorId=function(t,e){0===t?$gameParty.members().forEach(e):(t=$gameActors.actor(t))&&e(t)},Game_Interpreter.prototype.iterateActorEx=function(t,e,i){0===t?this.iterateActorId(e,i):this.iterateActorId($gameVariables.value(e),i)},Game_Interpreter.prototype.iterateActorIndex=function(t,e){t<0?$gameParty.members().forEach(e):(t=$gameParty.members()[t])&&e(t)},Game_Interpreter.prototype.iterateEnemyIndex=function(t,e){t<0?$gameTroop.members().forEach(e):(t=$gameTroop.members()[t])&&e(t)},Game_Interpreter.prototype.iterateBattler=function(t,e,i){$gameParty.inBattle()&&(0===t?this.iterateEnemyIndex(e,i):this.iterateActorId(e,i))},Game_Interpreter.prototype.character=function(t){return $gameParty.inBattle()?null:t<0?$gamePlayer:this.isOnCurrentMap()?$gameMap.event(0<t?t:this._eventId):null},Game_Interpreter.prototype.operateValue=function(t,e,i){return e=0===e?i:$gameVariables.value(i),0===t?e:-e},Game_Interpreter.prototype.changeHp=function(t,e,i){t.isAlive()&&(!i&&t.hp<=-e&&(e=1-t.hp),t.gainHp(e),t.isDead()&&t.performCollapse())},Game_Interpreter.prototype.command101=function(){if(!$gameMessage.isBusy()){for($gameMessage.setFaceImage(this._params[0],this._params[1]),$gameMessage.setBackground(this._params[2]),$gameMessage.setPositionType(this._params[3]);401===this.nextEventCode();)this._index++,$gameMessage.add(this.currentCommand().parameters[0]);switch(this.nextEventCode()){case 102:this._index++,this.setupChoices(this.currentCommand().parameters);break;case 103:this._index++,this.setupNumInput(this.currentCommand().parameters);break;case 104:this._index++,this.setupItemChoice(this.currentCommand().parameters)}this._index++,this.setWaitMode("message")}return!1},Game_Interpreter.prototype.command102=function(){return $gameMessage.isBusy()||(this.setupChoices(this._params),this._index++,this.setWaitMode("message")),!1},Game_Interpreter.prototype.setupChoices=function(t){var e=t[0].clone(),i=t[1],a=2<t.length?t[2]:0,n=3<t.length?t[3]:2;t=4<t.length?t[4]:0,i>=e.length&&(i=-2),$gameMessage.setChoices(e,a,i),$gameMessage.setChoiceBackground(t),$gameMessage.setChoicePositionType(n),$gameMessage.setChoiceCallback(function(t){this._branch[this._indent]=t}.bind(this))},Game_Interpreter.prototype.command402=function(){return this._branch[this._indent]!==this._params[0]&&this.skipBranch(),!0},Game_Interpreter.prototype.command403=function(){return 0<=this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command103=function(){return $gameMessage.isBusy()||(this.setupNumInput(this._params),this._index++,this.setWaitMode("message")),!1},Game_Interpreter.prototype.setupNumInput=function(t){$gameMessage.setNumberInput(t[0],t[1])},Game_Interpreter.prototype.command104=function(){return $gameMessage.isBusy()||(this.setupItemChoice(this._params),this._index++,this.setWaitMode("message")),!1},Game_Interpreter.prototype.setupItemChoice=function(t){$gameMessage.setItemChoice(t[0],t[1]||2)},Game_Interpreter.prototype.command105=function(){if(!$gameMessage.isBusy()){for($gameMessage.setScroll(this._params[0],this._params[1]);405===this.nextEventCode();)this._index++,$gameMessage.add(this.currentCommand().parameters[0]);this._index++,this.setWaitMode("message")}return!1},Game_Interpreter.prototype.command108=function(){for(this._comments=[this._params[0]];408===this.nextEventCode();)this._index++,this._comments.push(this.currentCommand().parameters[0]);return!0},Game_Interpreter.prototype.command111=function(){var a=!1;switch(this._params[0]){case 0:a=$gameSwitches.value(this._params[1])===(0===this._params[2]);break;case 1:var b=$gameVariables.value(this._params[1]),c=0===this._params[2]?this._params[3]:$gameVariables.value(this._params[3]);switch(this._params[4]){case 0:a=b===c;break;case 1:a=c<=b;break;case 2:a=b<=c;break;case 3:a=c<b;break;case 4:a=b<c;break;case 5:a=b!==c}break;case 2:0<this._eventId&&(a=$gameSelfSwitches.value([this._mapId,this._eventId,this._params[1]])===(0===this._params[2]));break;case 3:$gameTimer.isWorking()&&(a=0===this._params[2]?$gameTimer.seconds()>=this._params[1]:$gameTimer.seconds()<=this._params[1]);break;case 4:if(b=$gameActors.actor(this._params[1]))switch(c=this._params[3],this._params[2]){case 0:a=$gameParty.members().contains(b);break;case 1:a=b.name()===c;break;case 2:a=b.isClass($dataClasses[c]);break;case 3:a=b.hasSkill(c);break;case 4:a=b.hasWeapon($dataWeapons[c]);break;case 5:a=b.hasArmor($dataArmors[c]);break;case 6:a=b.isStateAffected(c)}break;case 5:if(b=$gameTroop.members()[this._params[1]])switch(this._params[2]){case 0:a=b.isAlive();break;case 1:a=b.isStateAffected(this._params[3])}break;case 6:(b=this.character(this._params[1]))&&(a=b.direction()===this._params[2]);break;case 7:switch(this._params[2]){case 0:a=$gameParty.gold()>=this._params[1];break;case 1:a=$gameParty.gold()<=this._params[1];break;case 2:a=$gameParty.gold()<this._params[1]}break;case 8:a=$gameParty.hasItem($dataItems[this._params[1]]);break;case 9:a=$gameParty.hasItem($dataWeapons[this._params[1]],this._params[2]);break;case 10:a=$gameParty.hasItem($dataArmors[this._params[1]],this._params[2]);break;case 11:a=Input.isPressed(this._params[1]);break;case 12:a=!!eval(this._params[1]);break;case 13:a=$gamePlayer.vehicle()===$gameMap.vehicle(this._params[1])}return this._branch[this._indent]=a,!1===this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command411=function(){return!1!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command112=function(){return!0},Game_Interpreter.prototype.command413=function(){for(;this._index--,this.currentCommand().indent!==this._indent;);return!0},Game_Interpreter.prototype.command113=function(){for(var t=0;this._index<this._list.length-1;){this._index++;var e=this.currentCommand();if(112===e.code&&t++,413===e.code){if(!(0<t))break;t--}}return!0},Game_Interpreter.prototype.command115=function(){return this._index=this._list.length,!0},Game_Interpreter.prototype.command117=function(){var t=$dataCommonEvents[this._params[0]];if(t){var e=this.isOnCurrentMap()?this._eventId:0;this.setupChild(t.list,e)}return!0},Game_Interpreter.prototype.setupChild=function(t,e){this._childInterpreter=new Game_Interpreter(this._depth+1),this._childInterpreter.setup(t,e)},Game_Interpreter.prototype.command118=function(){return!0},Game_Interpreter.prototype.command119=function(){for(var t=this._params[0],e=0;e<this._list.length;e++){var i=this._list[e];if(118===i.code&&i.parameters[0]===t)return void this.jumpTo(e)}return!0},Game_Interpreter.prototype.jumpTo=function(t){var e=this._index,i=Math.max(t,e),a=this._indent;for(e=Math.min(t,e);e<=i;e++){var n=this._list[e].indent;n!==a&&(this._branch[a]=null,a=n)}this._index=t},Game_Interpreter.prototype.command121=function(){for(var t=this._params[0];t<=this._params[1];t++)$gameSwitches.setValue(t,0===this._params[2]);return!0},Game_Interpreter.prototype.command122=function(){var a=0;switch(this._params[3]){case 0:a=this._params[4];break;case 1:a=$gameVariables.value(this._params[4]);break;case 2:a=this._params[5]-this._params[4]+1;for(var b=this._params[0];b<=this._params[1];b++)this.operateVariable(b,this._params[2],this._params[4]+Math.randomInt(a));return!0;case 3:a=this.gameDataOperand(this._params[4],this._params[5],this._params[6]);break;case 4:a=eval(this._params[4])}for(b=this._params[0];b<=this._params[1];b++)this.operateVariable(b,this._params[2],a);return!0},Game_Interpreter.prototype.gameDataOperand=function(t,e,i){switch(t){case 0:return $gameParty.numItems($dataItems[e]);case 1:return $gameParty.numItems($dataWeapons[e]);case 2:return $gameParty.numItems($dataArmors[e]);case 3:if(t=$gameActors.actor(e))switch(i){case 0:return t.level;case 1:return t.currentExp();case 2:return t.hp;case 3:return t.mp;default:if(4<=i&&i<=11)return t.param(i-4)}break;case 4:if(t=$gameTroop.members()[e])switch(i){case 0:return t.hp;case 1:return t.mp;default:if(2<=i&&i<=9)return t.param(i-2)}break;case 5:if(t=this.character(e))switch(i){case 0:return t.x;case 1:return t.y;case 2:return t.direction();case 3:return t.screenX();case 4:return t.screenY()}break;case 6:return(t=$gameParty.members()[e])?t.actorId():0;case 7:switch(e){case 0:return $gameMap.mapId();case 1:return $gameParty.size();case 2:return $gameParty.gold();case 3:return $gameParty.steps();case 4:return $gameSystem.playtime();case 5:return $gameTimer.seconds();case 6:return $gameSystem.saveCount();case 7:return $gameSystem.battleCount();case 8:return $gameSystem.winCount();case 9:return $gameSystem.escapeCount()}}return 0},Game_Interpreter.prototype.operateVariable=function(e,t,i){try{var a=$gameVariables.value(e);switch(t){case 0:$gameVariables.setValue(e,i);break;case 1:$gameVariables.setValue(e,a+i);break;case 2:$gameVariables.setValue(e,a-i);break;case 3:$gameVariables.setValue(e,a*i);break;case 4:$gameVariables.setValue(e,a/i);break;case 5:$gameVariables.setValue(e,a%i)}}catch(t){$gameVariables.setValue(e,0)}},Game_Interpreter.prototype.command123=function(){return 0<this._eventId&&$gameSelfSwitches.setValue([this._mapId,this._eventId,this._params[0]],0===this._params[1]),!0},Game_Interpreter.prototype.command124=function(){return 0===this._params[0]?$gameTimer.start(60*this._params[1]):$gameTimer.stop(),!0},Game_Interpreter.prototype.command125=function(){var t=this.operateValue(this._params[0],this._params[1],this._params[2]);return $gameParty.gainGold(t),!0},Game_Interpreter.prototype.command126=function(){var t=this.operateValue(this._params[1],this._params[2],this._params[3]);return $gameParty.gainItem($dataItems[this._params[0]],t),!0},Game_Interpreter.prototype.command127=function(){var t=this.operateValue(this._params[1],this._params[2],this._params[3]);return $gameParty.gainItem($dataWeapons[this._params[0]],t,this._params[4]),!0},Game_Interpreter.prototype.command128=function(){var t=this.operateValue(this._params[1],this._params[2],this._params[3]);return $gameParty.gainItem($dataArmors[this._params[0]],t,this._params[4]),!0},Game_Interpreter.prototype.command129=function(){return $gameActors.actor(this._params[0])&&(0===this._params[1]?(this._params[2]&&$gameActors.actor(this._params[0]).setup(this._params[0]),$gameParty.addActor(this._params[0])):$gameParty.removeActor(this._params[0])),!0},Game_Interpreter.prototype.command132=function(){return $gameSystem.setBattleBgm(this._params[0]),!0},Game_Interpreter.prototype.command133=function(){return $gameSystem.setVictoryMe(this._params[0]),!0},Game_Interpreter.prototype.command134=function(){return 0===this._params[0]?$gameSystem.disableSave():$gameSystem.enableSave(),!0},Game_Interpreter.prototype.command135=function(){return 0===this._params[0]?$gameSystem.disableMenu():$gameSystem.enableMenu(),!0},Game_Interpreter.prototype.command136=function(){return 0===this._params[0]?$gameSystem.disableEncounter():$gameSystem.enableEncounter(),$gamePlayer.makeEncounterCount(),!0},Game_Interpreter.prototype.command137=function(){return 0===this._params[0]?$gameSystem.disableFormation():$gameSystem.enableFormation(),!0},Game_Interpreter.prototype.command138=function(){return $gameSystem.setWindowTone(this._params[0]),!0},Game_Interpreter.prototype.command139=function(){return $gameSystem.setDefeatMe(this._params[0]),!0},Game_Interpreter.prototype.command140=function(){var t=$gameMap.vehicle(this._params[0]);return t&&t.setBgm(this._params[1]),!0},Game_Interpreter.prototype.command201=function(){if(!$gameParty.inBattle()&&!$gameMessage.isBusy()){if(0===this._params[0])var t=this._params[1],e=this._params[2],i=this._params[3];else t=$gameVariables.value(this._params[1]),e=$gameVariables.value(this._params[2]),i=$gameVariables.value(this._params[3]);$gamePlayer.reserveTransfer(t,e,i,this._params[4],this._params[5]),this.setWaitMode("transfer"),this._index++}return!1},Game_Interpreter.prototype.command202=function(){if(0===this._params[1])var t=this._params[2],e=this._params[3],i=this._params[4];else t=$gameVariables.value(this._params[2]),e=$gameVariables.value(this._params[3]),i=$gameVariables.value(this._params[4]);var a=$gameMap.vehicle(this._params[0]);return a&&a.setLocation(t,e,i),!0},Game_Interpreter.prototype.command203=function(){var t=this.character(this._params[0]);if(t){if(0===this._params[1])t.locate(this._params[2],this._params[3]);else if(1===this._params[1]){var e=$gameVariables.value(this._params[2]),i=$gameVariables.value(this._params[3]);t.locate(e,i)}else(e=this.character(this._params[2]))&&t.swap(e);0<this._params[4]&&t.setDirection(this._params[4])}return!0},Game_Interpreter.prototype.command204=function(){if(!$gameParty.inBattle()){if($gameMap.isScrolling())return this.setWaitMode("scroll"),!1;$gameMap.startScroll(this._params[0],this._params[1],this._params[2])}return!0},Game_Interpreter.prototype.command205=function(){return $gameMap.refreshIfNeeded(),(this._character=this.character(this._params[0]))&&(this._character.forceMoveRoute(this._params[1]),this._params[1].wait&&this.setWaitMode("route")),!0},Game_Interpreter.prototype.command206=function(){return $gamePlayer.getOnOffVehicle(),!0},Game_Interpreter.prototype.command211=function(){return $gamePlayer.setTransparent(0===this._params[0]),!0},Game_Interpreter.prototype.command212=function(){return(this._character=this.character(this._params[0]))&&(this._character.requestAnimation(this._params[1]),this._params[2]&&this.setWaitMode("animation")),!0},Game_Interpreter.prototype.command213=function(){return(this._character=this.character(this._params[0]))&&(this._character.requestBalloon(this._params[1]),this._params[2]&&this.setWaitMode("balloon")),!0},Game_Interpreter.prototype.command214=function(){return this.isOnCurrentMap()&&0<this._eventId&&$gameMap.eraseEvent(this._eventId),!0},Game_Interpreter.prototype.command216=function(){return 0===this._params[0]?$gamePlayer.showFollowers():$gamePlayer.hideFollowers(),$gamePlayer.refresh(),!0},Game_Interpreter.prototype.command217=function(){return $gameParty.inBattle()||($gamePlayer.gatherFollowers(),this.setWaitMode("gather")),!0},Game_Interpreter.prototype.command221=function(){return $gameMessage.isBusy()||($gameScreen.startFadeOut(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++),!1},Game_Interpreter.prototype.command222=function(){return $gameMessage.isBusy()||($gameScreen.startFadeIn(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++),!1},Game_Interpreter.prototype.command223=function(){return $gameScreen.startTint(this._params[0],this._params[1]),this._params[2]&&this.wait(this._params[1]),!0},Game_Interpreter.prototype.command224=function(){return $gameScreen.startFlash(this._params[0],this._params[1]),this._params[2]&&this.wait(this._params[1]),!0},Game_Interpreter.prototype.command225=function(){return $gameScreen.startShake(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2]),!0},Game_Interpreter.prototype.command230=function(){return this.wait(this._params[0]),!0},Game_Interpreter.prototype.command231=function(){if(0===this._params[3])var t=this._params[4],e=this._params[5];else t=$gameVariables.value(this._params[4]),e=$gameVariables.value(this._params[5]);return $gameScreen.showPicture(this._params[0],this._params[1],this._params[2],t,e,this._params[6],this._params[7],this._params[8],this._params[9]),!0},Game_Interpreter.prototype.command232=function(){if(0===this._params[3])var t=this._params[4],e=this._params[5];else t=$gameVariables.value(this._params[4]),e=$gameVariables.value(this._params[5]);return $gameScreen.movePicture(this._params[0],this._params[2],t,e,this._params[6],this._params[7],this._params[8],this._params[9],this._params[10]),this._params[11]&&this.wait(this._params[10]),!0},Game_Interpreter.prototype.command233=function(){return $gameScreen.rotatePicture(this._params[0],this._params[1]),!0},Game_Interpreter.prototype.command234=function(){return $gameScreen.tintPicture(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2]),!0},Game_Interpreter.prototype.command235=function(){return $gameScreen.erasePicture(this._params[0]),!0},Game_Interpreter.prototype.command236=function(){return $gameParty.inBattle()||($gameScreen.changeWeather(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2])),!0},Game_Interpreter.prototype.command241=function(){return AudioManager.playBgm(this._params[0]),!0},Game_Interpreter.prototype.command242=function(){return AudioManager.fadeOutBgm(this._params[0]),!0},Game_Interpreter.prototype.command243=function(){return $gameSystem.saveBgm(),!0},Game_Interpreter.prototype.command244=function(){return $gameSystem.replayBgm(),!0},Game_Interpreter.prototype.command245=function(){return AudioManager.playBgs(this._params[0]),!0},Game_Interpreter.prototype.command246=function(){return AudioManager.fadeOutBgs(this._params[0]),!0},Game_Interpreter.prototype.command249=function(){return AudioManager.playMe(this._params[0]),!0},Game_Interpreter.prototype.command250=function(){return AudioManager.playSe(this._params[0]),!0},Game_Interpreter.prototype.command251=function(){return AudioManager.stopSe(),!0},Game_Interpreter.prototype.command261=function(){if(!$gameMessage.isBusy()){var t=this._params[0];if(0<t.length){var e=this.videoFileExt();Graphics.playVideo("movies/"+t+e),this.setWaitMode("video")}this._index++}return!1},Game_Interpreter.prototype.videoFileExt=function(){return Graphics.canPlayVideoType("video/webm")&&!Utils.isMobileDevice()?".webm":".mp4"},Game_Interpreter.prototype.command281=function(){return 0===this._params[0]?$gameMap.enableNameDisplay():$gameMap.disableNameDisplay(),!0},Game_Interpreter.prototype.command282=function(){var t=$dataTilesets[this._params[0]];return this._imageReservationId||(this._imageReservationId=Utils.generateRuntimeId()),!!t.tilesetNames.map(function(t){return ImageManager.reserveTileset(t,0,this._imageReservationId)},this).every(function(t){return t.isReady()})&&($gameMap.changeTileset(this._params[0]),ImageManager.releaseReservation(this._imageReservationId),!(this._imageReservationId=null))},Game_Interpreter.prototype.command283=function(){return $gameMap.changeBattleback(this._params[0],this._params[1]),!0},Game_Interpreter.prototype.command284=function(){return $gameMap.changeParallax(this._params[0],this._params[1],this._params[2],this._params[3],this._params[4]),!0},Game_Interpreter.prototype.command285=function(){if(0===this._params[2])var t=this._params[3],e=this._params[4];else t=$gameVariables.value(this._params[3]),e=$gameVariables.value(this._params[4]);switch(this._params[1]){case 0:t=$gameMap.terrainTag(t,e);break;case 1:t=$gameMap.eventIdXy(t,e);break;case 2:case 3:case 4:case 5:t=$gameMap.tileId(t,e,this._params[1]-2);break;default:t=$gameMap.regionId(t,e)}return $gameVariables.setValue(this._params[0],t),!0},Game_Interpreter.prototype.command301=function(){if(!$gameParty.inBattle()){var t=0===this._params[0]?this._params[1]:1===this._params[0]?$gameVariables.value(this._params[1]):$gamePlayer.makeEncounterTroopId();$dataTroops[t]&&(BattleManager.setup(t,this._params[2],this._params[3]),BattleManager.setEventCallback(function(t){this._branch[this._indent]=t}.bind(this)),$gamePlayer.makeEncounterCount(),SceneManager.push(Scene_Battle))}return!0},Game_Interpreter.prototype.command601=function(){return 0!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command602=function(){return 1!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command603=function(){return 2!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command302=function(){if(!$gameParty.inBattle()){for(var t=[this._params];605===this.nextEventCode();)this._index++,t.push(this.currentCommand().parameters);SceneManager.push(Scene_Shop),SceneManager.prepareNextScene(t,this._params[4])}return!0},Game_Interpreter.prototype.command303=function(){return!$gameParty.inBattle()&&$dataActors[this._params[0]]&&(SceneManager.push(Scene_Name),SceneManager.prepareNextScene(this._params[0],this._params[1])),!0},Game_Interpreter.prototype.command311=function(){var e=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],function(t){this.changeHp(t,e,this._params[5])}.bind(this)),!0},Game_Interpreter.prototype.command312=function(){var e=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],function(t){t.gainMp(e)}.bind(this)),!0},Game_Interpreter.prototype.command326=function(){var e=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],function(t){t.gainTp(e)}.bind(this)),!0},Game_Interpreter.prototype.command313=function(){return this.iterateActorEx(this._params[0],this._params[1],function(t){var e=t.isDead();0===this._params[2]?t.addState(this._params[3]):t.removeState(this._params[3]),t.isDead()&&!e&&t.performCollapse(),t.clearResult()}.bind(this)),!0},Game_Interpreter.prototype.command314=function(){return this.iterateActorEx(this._params[0],this._params[1],function(t){t.recoverAll()}.bind(this)),!0},Game_Interpreter.prototype.command315=function(){var e=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],function(t){t.changeExp(t.currentExp()+e,this._params[5])}.bind(this)),!0},Game_Interpreter.prototype.command316=function(){var e=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],function(t){t.changeLevel(t.level+e,this._params[5])}.bind(this)),!0},Game_Interpreter.prototype.command317=function(){var e=this.operateValue(this._params[3],this._params[4],this._params[5]);return this.iterateActorEx(this._params[0],this._params[1],function(t){t.addParam(this._params[2],e)}.bind(this)),!0},Game_Interpreter.prototype.command318=function(){return this.iterateActorEx(this._params[0],this._params[1],function(t){0===this._params[2]?t.learnSkill(this._params[3]):t.forgetSkill(this._params[3])}.bind(this)),!0},Game_Interpreter.prototype.command319=function(){var t=$gameActors.actor(this._params[0]);return t&&t.changeEquipById(this._params[1],this._params[2]),!0},Game_Interpreter.prototype.command320=function(){var t=$gameActors.actor(this._params[0]);return t&&t.setName(this._params[1]),!0},Game_Interpreter.prototype.command321=function(){var t=$gameActors.actor(this._params[0]);return t&&$dataClasses[this._params[1]]&&t.changeClass(this._params[1],this._params[2]),!0},Game_Interpreter.prototype.command322=function(){var t=$gameActors.actor(this._params[0]);return t&&(t.setCharacterImage(this._params[1],this._params[2]),t.setFaceImage(this._params[3],this._params[4]),t.setBattlerImage(this._params[5])),$gamePlayer.refresh(),!0},Game_Interpreter.prototype.command323=function(){var t=$gameMap.vehicle(this._params[0]);return t&&t.setImage(this._params[1],this._params[2]),!0},Game_Interpreter.prototype.command324=function(){var t=$gameActors.actor(this._params[0]);return t&&t.setNickname(this._params[1]),!0},Game_Interpreter.prototype.command325=function(){var t=$gameActors.actor(this._params[0]);return t&&t.setProfile(this._params[1]),!0},Game_Interpreter.prototype.command331=function(){var e=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],function(t){this.changeHp(t,e,this._params[4])}.bind(this)),!0},Game_Interpreter.prototype.command332=function(){var e=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],function(t){t.gainMp(e)}.bind(this)),!0},Game_Interpreter.prototype.command342=function(){var e=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],function(t){t.gainTp(e)}.bind(this)),!0},Game_Interpreter.prototype.command333=function(){return this.iterateEnemyIndex(this._params[0],function(t){var e=t.isDead();0===this._params[1]?t.addState(this._params[2]):t.removeState(this._params[2]),t.isDead()&&!e&&t.performCollapse(),t.clearResult()}.bind(this)),!0},Game_Interpreter.prototype.command334=function(){return this.iterateEnemyIndex(this._params[0],function(t){t.recoverAll()}.bind(this)),!0},Game_Interpreter.prototype.command335=function(){return this.iterateEnemyIndex(this._params[0],function(t){t.appear(),$gameTroop.makeUniqueNames()}.bind(this)),!0},Game_Interpreter.prototype.command336=function(){return this.iterateEnemyIndex(this._params[0],function(t){t.transform(this._params[1]),$gameTroop.makeUniqueNames()}.bind(this)),!0},Game_Interpreter.prototype.command337=function(){return 1==this._params[2]?this.iterateEnemyIndex(-1,function(t){t.isAlive()&&t.startAnimation(this._params[1],!1,0)}.bind(this)):this.iterateEnemyIndex(this._params[0],function(t){t.isAlive()&&t.startAnimation(this._params[1],!1,0)}.bind(this)),!0},Game_Interpreter.prototype.command339=function(){return this.iterateBattler(this._params[0],this._params[1],function(t){t.isDeathStateAffected()||(t.forceAction(this._params[2],this._params[3]),BattleManager.forceAction(t),this.setWaitMode("action"))}.bind(this)),!0},Game_Interpreter.prototype.command340=function(){return BattleManager.abort(),!0},Game_Interpreter.prototype.command351=function(){return $gameParty.inBattle()||(SceneManager.push(Scene_Menu),Window_MenuCommand.initCommandPosition()),!0},Game_Interpreter.prototype.command352=function(){return $gameParty.inBattle()||SceneManager.push(Scene_Save),!0},Game_Interpreter.prototype.command353=function(){return SceneManager.goto(Scene_Gameover),!0},Game_Interpreter.prototype.command354=function(){return SceneManager.goto(Scene_Title),!0},Game_Interpreter.prototype.command355=function(){for(var a=this.currentCommand().parameters[0]+"\n";655===this.nextEventCode();)this._index++,a+=this.currentCommand().parameters[0]+"\n";return eval(a),!0},Game_Interpreter.prototype.command356=function(){var t=this._params[0].split(" "),e=t.shift();return this.pluginCommand(e,t),!0},Game_Interpreter.prototype.pluginCommand=function(t,e){},Game_Interpreter.requestImages=function(t,a){t&&t.forEach(function(t){var e=t.parameters;switch(t.code){case 101:ImageManager.requestFace(e[0]);break;case 117:(t=$dataCommonEvents[e[0]])&&(a||(a=[]),a.contains(e[0])||(a.push(e[0]),Game_Interpreter.requestImages(t.list,a)));break;case 129:(t=$gameActors.actor(e[0]))&&0===e[1]&&(e=t.characterName(),ImageManager.requestCharacter(e));break;case 205:e[1]&&e[1].list.forEach(function(t){var e=t.parameters;t.code===Game_Character.ROUTE_CHANGE_IMAGE&&ImageManager.requestCharacter(e[0])});break;case 212:case 337:if(e[1]){t=(e=$dataAnimations[e[1]]).animation2Name;var i=e.animation2Hue;ImageManager.requestAnimation(e.animation1Name,e.animation1Hue),ImageManager.requestAnimation(t,i)}break;case 216:0===e[0]&&$gamePlayer.followers().forEach(function(t){t=t.characterName(),ImageManager.requestCharacter(t)});break;case 231:ImageManager.requestPicture(e[1]);break;case 282:$dataTilesets[e[0]].tilesetNames.forEach(function(t){ImageManager.requestTileset(t)});break;case 283:$gameParty.inBattle()&&(ImageManager.requestBattleback1(e[0]),ImageManager.requestBattleback2(e[1]));break;case 284:$gameParty.inBattle()||ImageManager.requestParallax(e[0]);break;case 322:ImageManager.requestCharacter(e[1]),ImageManager.requestFace(e[3]),ImageManager.requestSvActor(e[5]);break;case 323:$gameMap.vehicle(e[0])&&ImageManager.requestCharacter(e[1]);break;case 336:e=(t=$dataEnemies[e[1]]).battlerName,t=t.battlerHue,$gameSystem.isSideView()?ImageManager.requestSvEnemy(e,t):ImageManager.requestEnemy(e,t)}})},Scene_Base.prototype=Object.create(Stage.prototype),Scene_Base.prototype.constructor=Scene_Base,Scene_Base.prototype.initialize=function(){Stage.prototype.initialize.call(this),this._active=!1,this._fadeDuration=this._fadeSign=0,this._fadeSprite=null,this._imageReservationId=Utils.generateRuntimeId()},Scene_Base.prototype.attachReservation=function(){ImageManager.setDefaultReservationId(this._imageReservationId)},Scene_Base.prototype.detachReservation=function(){ImageManager.releaseReservation(this._imageReservationId)},Scene_Base.prototype.create=function(){},Scene_Base.prototype.isActive=function(){return this._active},Scene_Base.prototype.isReady=function(){return ImageManager.isReady()},Scene_Base.prototype.start=function(){this._active=!0},Scene_Base.prototype.update=function(){this.updateFade(),this.updateChildren()},Scene_Base.prototype.stop=function(){this._active=!1},Scene_Base.prototype.isBusy=function(){return 0<this._fadeDuration},Scene_Base.prototype.terminate=function(){},Scene_Base.prototype.createWindowLayer=function(){var t=Graphics.boxWidth,e=Graphics.boxHeight,i=(Graphics.width-t)/2,a=(Graphics.height-e)/2;this._windowLayer=new WindowLayer,this._windowLayer.move(i,a,t,e),this.addChild(this._windowLayer)},Scene_Base.prototype.addWindow=function(t){this._windowLayer.addChild(t)},Scene_Base.prototype.startFadeIn=function(t,e){this.createFadeSprite(e),this._fadeSign=1,this._fadeDuration=t||30,this._fadeSprite.opacity=255},Scene_Base.prototype.startFadeOut=function(t,e){this.createFadeSprite(e),this._fadeSign=-1,this._fadeDuration=t||30,this._fadeSprite.opacity=0},Scene_Base.prototype.createFadeSprite=function(t){this._fadeSprite||(this._fadeSprite=new ScreenSprite,this.addChild(this._fadeSprite)),t?this._fadeSprite.setWhite():this._fadeSprite.setBlack()},Scene_Base.prototype.updateFade=function(){if(0<this._fadeDuration){var t=this._fadeDuration;this._fadeSprite.opacity=0<this._fadeSign?this._fadeSprite.opacity-this._fadeSprite.opacity/t:this._fadeSprite.opacity+(255-this._fadeSprite.opacity)/t,this._fadeDuration--}},Scene_Base.prototype.updateChildren=function(){this.children.forEach(function(t){t.update&&t.update()})},Scene_Base.prototype.popScene=function(){SceneManager.pop()},Scene_Base.prototype.checkGameover=function(){$gameParty.isAllDead()&&SceneManager.goto(Scene_Gameover)},Scene_Base.prototype.fadeOutAll=function(){var t=this.slowFadeSpeed()/60;AudioManager.fadeOutBgm(t),AudioManager.fadeOutBgs(t),AudioManager.fadeOutMe(t),this.startFadeOut(this.slowFadeSpeed())},Scene_Base.prototype.fadeSpeed=function(){return 24},Scene_Base.prototype.slowFadeSpeed=function(){return 2*this.fadeSpeed()},Scene_Boot.prototype=Object.create(Scene_Base.prototype),Scene_Boot.prototype.constructor=Scene_Boot,Scene_Boot.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this),this._startDate=Date.now()},Scene_Boot.prototype.create=function(){Scene_Base.prototype.create.call(this),DataManager.loadDatabase(),ConfigManager.load(),this.loadSystemWindowImage()},Scene_Boot.prototype.loadSystemWindowImage=function(){ImageManager.reserveSystem("Window")},Scene_Boot.loadSystemImages=function(){ImageManager.reserveSystem("IconSet"),ImageManager.reserveSystem("Balloon"),ImageManager.reserveSystem("Shadow1"),ImageManager.reserveSystem("Shadow2"),ImageManager.reserveSystem("Damage"),ImageManager.reserveSystem("States"),ImageManager.reserveSystem("Weapons1"),ImageManager.reserveSystem("Weapons2"),ImageManager.reserveSystem("Weapons3"),ImageManager.reserveSystem("ButtonSet")},Scene_Boot.prototype.isReady=function(){return!!Scene_Base.prototype.isReady.call(this)&&(DataManager.isDatabaseLoaded()&&this.isGameFontLoaded())},Scene_Boot.prototype.isGameFontLoaded=function(){if(Graphics.isFontLoaded("GameFont"))return!0;if(!Graphics.canUseCssFontLoading()&&6e4<=Date.now()-this._startDate)throw Error("Failed to load GameFont")},Scene_Boot.prototype.start=function(){Scene_Base.prototype.start.call(this),SoundManager.preloadImportantSounds(),DataManager.isBattleTest()?(DataManager.setupBattleTest(),SceneManager.goto(Scene_Battle)):DataManager.isEventTest()?(DataManager.setupEventTest(),SceneManager.goto(Scene_Map)):(this.checkPlayerLocation(),DataManager.setupNewGame(),SceneManager.goto(Scene_Title),Window_TitleCommand.initCommandPosition()),this.updateDocumentTitle()},Scene_Boot.prototype.updateDocumentTitle=function(){document.title=$dataSystem.gameTitle},Scene_Boot.prototype.checkPlayerLocation=function(){if(0===$dataSystem.startMapId)throw Error("Player's starting position is not set")},Scene_Title.prototype=Object.create(Scene_Base.prototype),Scene_Title.prototype.constructor=Scene_Title,Scene_Title.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this)},Scene_Title.prototype.create=function(){Scene_Base.prototype.create.call(this),this.createBackground(),this.createForeground(),this.createWindowLayer(),this.createCommandWindow()},Scene_Title.prototype.start=function(){Scene_Base.prototype.start.call(this),SceneManager.clearStack(),this.centerSprite(this._backSprite1),this.centerSprite(this._backSprite2),this.playTitleMusic(),this.startFadeIn(this.fadeSpeed(),!1)},Scene_Title.prototype.update=function(){this.isBusy()||this._commandWindow.open(),Scene_Base.prototype.update.call(this)},Scene_Title.prototype.isBusy=function(){return this._commandWindow.isClosing()||Scene_Base.prototype.isBusy.call(this)},Scene_Title.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this),SceneManager.snapForBackground()},Scene_Title.prototype.createBackground=function(){this._backSprite1=new Sprite(ImageManager.loadTitle1($dataSystem.title1Name)),this._backSprite2=new Sprite(ImageManager.loadTitle2($dataSystem.title2Name)),this.addChild(this._backSprite1),this.addChild(this._backSprite2)},Scene_Title.prototype.createForeground=function(){this._gameTitleSprite=new Sprite(new Bitmap(Graphics.width,Graphics.height)),this.addChild(this._gameTitleSprite),$dataSystem.optDrawTitle&&this.drawGameTitle()},Scene_Title.prototype.drawGameTitle=function(){var t=Graphics.height/4,e=Graphics.width-40,i=$dataSystem.gameTitle;this._gameTitleSprite.bitmap.outlineColor="black",this._gameTitleSprite.bitmap.outlineWidth=8,this._gameTitleSprite.bitmap.fontSize=72,this._gameTitleSprite.bitmap.drawText(i,20,t,e,48,"center")},Scene_Title.prototype.centerSprite=function(t){t.x=Graphics.width/2,t.y=Graphics.height/2,t.anchor.x=.5,t.anchor.y=.5},Scene_Title.prototype.createCommandWindow=function(){this._commandWindow=new Window_TitleCommand,this._commandWindow.setHandler("newGame",this.commandNewGame.bind(this)),this._commandWindow.setHandler("continue",this.commandContinue.bind(this)),this._commandWindow.setHandler("options",this.commandOptions.bind(this)),this.addWindow(this._commandWindow)},Scene_Title.prototype.commandNewGame=function(){DataManager.setupNewGame(),this._commandWindow.close(),this.fadeOutAll(),SceneManager.goto(Scene_Map)},Scene_Title.prototype.commandContinue=function(){this._commandWindow.close(),SceneManager.push(Scene_Load)},Scene_Title.prototype.commandOptions=function(){this._commandWindow.close(),SceneManager.push(Scene_Options)},Scene_Title.prototype.playTitleMusic=function(){AudioManager.playBgm($dataSystem.titleBgm),AudioManager.stopBgs(),AudioManager.stopMe()},Scene_Map.prototype=Object.create(Scene_Base.prototype),Scene_Map.prototype.constructor=Scene_Map,Scene_Map.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this),this._encounterEffectDuration=this._waitCount=0,this._mapLoaded=!1,this._touchCount=0},Scene_Map.prototype.create=function(){Scene_Base.prototype.create.call(this);var t=(this._transfer=$gamePlayer.isTransferring())?$gamePlayer.newMapId():$gameMap.mapId();DataManager.loadMapData(t)},Scene_Map.prototype.isReady=function(){return!this._mapLoaded&&DataManager.isMapLoaded()&&(this.onMapLoaded(),this._mapLoaded=!0),this._mapLoaded&&Scene_Base.prototype.isReady.call(this)},Scene_Map.prototype.onMapLoaded=function(){this._transfer&&$gamePlayer.performTransfer(),this.createDisplayObjects()},Scene_Map.prototype.start=function(){Scene_Base.prototype.start.call(this),SceneManager.clearStack(),this._transfer?(this.fadeInForTransfer(),this._mapNameWindow.open(),$gameMap.autoplay()):this.needsFadeIn()&&this.startFadeIn(this.fadeSpeed(),!1),this.menuCalling=!1},Scene_Map.prototype.update=function(){this.updateDestination(),this.updateMainMultiply(),this.isSceneChangeOk()?this.updateScene():SceneManager.isNextScene(Scene_Battle)&&this.updateEncounterEffect(),this.updateWaitCount(),Scene_Base.prototype.update.call(this)},Scene_Map.prototype.updateMainMultiply=function(){this.updateMain(),this.isFastForward()&&this.updateMain()},Scene_Map.prototype.updateMain=function(){var t=this.isActive();$gameMap.update(t),$gamePlayer.update(t),$gameTimer.update(t),$gameScreen.update()},Scene_Map.prototype.isFastForward=function(){return $gameMap.isEventRunning()&&!SceneManager.isSceneChanging()&&(Input.isLongPressed("ok")||TouchInput.isLongPressed())},Scene_Map.prototype.stop=function(){Scene_Base.prototype.stop.call(this),$gamePlayer.straighten(),this._mapNameWindow.close(),this.needsSlowFadeOut()?this.startFadeOut(this.slowFadeSpeed(),!1):SceneManager.isNextScene(Scene_Map)?this.fadeOutForTransfer():SceneManager.isNextScene(Scene_Battle)&&this.launchBattle()},Scene_Map.prototype.isBusy=function(){return this._messageWindow&&this._messageWindow.isClosing()||0<this._waitCount||0<this._encounterEffectDuration||Scene_Base.prototype.isBusy.call(this)},Scene_Map.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this),SceneManager.isNextScene(Scene_Battle)?ImageManager.clearRequest():(this._spriteset.update(),this._mapNameWindow.hide(),SceneManager.snapForBackground()),SceneManager.isNextScene(Scene_Map)&&ImageManager.clearRequest(),$gameScreen.clearZoom(),this.removeChild(this._fadeSprite),this.removeChild(this._mapNameWindow),this.removeChild(this._windowLayer),this.removeChild(this._spriteset)},Scene_Map.prototype.needsFadeIn=function(){return SceneManager.isPreviousScene(Scene_Battle)||SceneManager.isPreviousScene(Scene_Load)},Scene_Map.prototype.needsSlowFadeOut=function(){return SceneManager.isNextScene(Scene_Title)||SceneManager.isNextScene(Scene_Gameover)},Scene_Map.prototype.updateWaitCount=function(){return 0<this._waitCount&&(this._waitCount--,!0)},Scene_Map.prototype.updateDestination=function(){this.isMapTouchOk()?this.processMapTouch():($gameTemp.clearDestination(),this._touchCount=0)},Scene_Map.prototype.isMapTouchOk=function(){return this.isActive()&&$gamePlayer.canMove()},Scene_Map.prototype.processMapTouch=function(){if(TouchInput.isTriggered()||0<this._touchCount)if(TouchInput.isPressed()){if(0===this._touchCount||15<=this._touchCount){var t=$gameMap.canvasToMapX(TouchInput.x),e=$gameMap.canvasToMapY(TouchInput.y);$gameTemp.setDestination(t,e)}this._touchCount++}else this._touchCount=0},Scene_Map.prototype.isSceneChangeOk=function(){return this.isActive()&&!$gameMessage.isBusy()},Scene_Map.prototype.updateScene=function(){this.checkGameover(),SceneManager.isSceneChanging()||this.updateTransferPlayer(),SceneManager.isSceneChanging()||this.updateEncounter(),SceneManager.isSceneChanging()||this.updateCallMenu(),SceneManager.isSceneChanging()||this.updateCallDebug()},Scene_Map.prototype.createDisplayObjects=function(){this.createSpriteset(),this.createMapNameWindow(),this.createWindowLayer(),this.createAllWindows()},Scene_Map.prototype.createSpriteset=function(){this._spriteset=new Spriteset_Map,this.addChild(this._spriteset)},Scene_Map.prototype.createAllWindows=function(){this.createMessageWindow(),this.createScrollTextWindow()},Scene_Map.prototype.createMapNameWindow=function(){this._mapNameWindow=new Window_MapName,this.addChild(this._mapNameWindow)},Scene_Map.prototype.createMessageWindow=function(){this._messageWindow=new Window_Message,this.addWindow(this._messageWindow),this._messageWindow.subWindows().forEach(function(t){this.addWindow(t)},this)},Scene_Map.prototype.createScrollTextWindow=function(){this._scrollTextWindow=new Window_ScrollText,this.addWindow(this._scrollTextWindow)},Scene_Map.prototype.updateTransferPlayer=function(){$gamePlayer.isTransferring()&&SceneManager.goto(Scene_Map)},Scene_Map.prototype.updateEncounter=function(){$gamePlayer.executeEncounter()&&SceneManager.push(Scene_Battle)},Scene_Map.prototype.updateCallMenu=function(){this.isMenuEnabled()?(this.isMenuCalled()&&(this.menuCalling=!0),this.menuCalling&&!$gamePlayer.isMoving()&&this.callMenu()):this.menuCalling=!1},Scene_Map.prototype.isMenuEnabled=function(){return $gameSystem.isMenuEnabled()&&!$gameMap.isEventRunning()},Scene_Map.prototype.isMenuCalled=function(){return Input.isTriggered("menu")||TouchInput.isCancelled()},Scene_Map.prototype.callMenu=function(){SoundManager.playOk(),SceneManager.push(Scene_Menu),Window_MenuCommand.initCommandPosition(),$gameTemp.clearDestination(),this._mapNameWindow.hide(),this._waitCount=2},Scene_Map.prototype.updateCallDebug=function(){this.isDebugCalled()&&SceneManager.push(Scene_Debug)},Scene_Map.prototype.isDebugCalled=function(){return Input.isTriggered("debug")&&$gameTemp.isPlaytest()},Scene_Map.prototype.fadeInForTransfer=function(){var t=$gamePlayer.fadeType();switch(t){case 0:case 1:this.startFadeIn(this.fadeSpeed(),1===t)}},Scene_Map.prototype.fadeOutForTransfer=function(){var t=$gamePlayer.fadeType();switch(t){case 0:case 1:this.startFadeOut(this.fadeSpeed(),1===t)}},Scene_Map.prototype.launchBattle=function(){BattleManager.saveBgmAndBgs(),this.stopAudioOnBattleStart(),SoundManager.playBattleStart(),this.startEncounterEffect(),this._mapNameWindow.hide()},Scene_Map.prototype.stopAudioOnBattleStart=function(){AudioManager.isCurrentBgm($gameSystem.battleBgm())||AudioManager.stopBgm(),AudioManager.stopBgs(),AudioManager.stopMe(),AudioManager.stopSe()},Scene_Map.prototype.startEncounterEffect=function(){this._spriteset.hideCharacters(),this._encounterEffectDuration=this.encounterEffectSpeed()},Scene_Map.prototype.updateEncounterEffect=function(){if(0<this._encounterEffectDuration){this._encounterEffectDuration--;var t=this.encounterEffectSpeed(),e=t-this._encounterEffectDuration,i=e/t;i=(20*(i-1)*i+5)*i+1;var a=$gamePlayer.screenX(),n=$gamePlayer.screenY()-24;2==e&&($gameScreen.setZoom(a,n,1),this.snapForBattleBackground(),this.startFlashForEncounter(t/2)),$gameScreen.setZoom(a,n,i),e===Math.floor(t/6)&&this.startFlashForEncounter(t/2),e===Math.floor(t/2)&&(BattleManager.playBattleBgm(),this.startFadeOut(this.fadeSpeed()))}},Scene_Map.prototype.snapForBattleBackground=function(){this._windowLayer.visible=!1,SceneManager.snapForBackground(),this._windowLayer.visible=!0},Scene_Map.prototype.startFlashForEncounter=function(t){$gameScreen.startFlash([255,255,255,255],t)},Scene_Map.prototype.encounterEffectSpeed=function(){return 60},Scene_MenuBase.prototype=Object.create(Scene_Base.prototype),Scene_MenuBase.prototype.constructor=Scene_MenuBase,Scene_MenuBase.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this)},Scene_MenuBase.prototype.create=function(){Scene_Base.prototype.create.call(this),this.createBackground(),this.updateActor(),this.createWindowLayer()},Scene_MenuBase.prototype.actor=function(){return this._actor},Scene_MenuBase.prototype.updateActor=function(){this._actor=$gameParty.menuActor()},Scene_MenuBase.prototype.createBackground=function(){this._backgroundSprite=new Sprite,this._backgroundSprite.bitmap=SceneManager.backgroundBitmap(),this.addChild(this._backgroundSprite)},Scene_MenuBase.prototype.setBackgroundOpacity=function(t){this._backgroundSprite.opacity=t},Scene_MenuBase.prototype.createHelpWindow=function(){this._helpWindow=new Window_Help,this.addWindow(this._helpWindow)},Scene_MenuBase.prototype.nextActor=function(){$gameParty.makeMenuActorNext(),this.updateActor(),this.onActorChange()},Scene_MenuBase.prototype.previousActor=function(){$gameParty.makeMenuActorPrevious(),this.updateActor(),this.onActorChange()},Scene_MenuBase.prototype.onActorChange=function(){},Scene_Menu.prototype=Object.create(Scene_MenuBase.prototype),Scene_Menu.prototype.constructor=Scene_Menu,Scene_Menu.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_Menu.prototype.create=function(){Scene_MenuBase.prototype.create.call(this),this.createCommandWindow(),this.createGoldWindow(),this.createStatusWindow()},Scene_Menu.prototype.start=function(){Scene_MenuBase.prototype.start.call(this),this._statusWindow.refresh()},Scene_Menu.prototype.createCommandWindow=function(){this._commandWindow=new Window_MenuCommand(0,0),this._commandWindow.setHandler("item",this.commandItem.bind(this)),this._commandWindow.setHandler("skill",this.commandPersonal.bind(this)),this._commandWindow.setHandler("equip",this.commandPersonal.bind(this)),this._commandWindow.setHandler("status",this.commandPersonal.bind(this)),this._commandWindow.setHandler("formation",this.commandFormation.bind(this)),this._commandWindow.setHandler("options",this.commandOptions.bind(this)),this._commandWindow.setHandler("save",this.commandSave.bind(this)),this._commandWindow.setHandler("gameEnd",this.commandGameEnd.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._commandWindow)},Scene_Menu.prototype.createGoldWindow=function(){this._goldWindow=new Window_Gold(0,0),this._goldWindow.y=Graphics.boxHeight-this._goldWindow.height,this.addWindow(this._goldWindow)},Scene_Menu.prototype.createStatusWindow=function(){this._statusWindow=new Window_MenuStatus(this._commandWindow.width,0),this._statusWindow.reserveFaceImages(),this.addWindow(this._statusWindow)},Scene_Menu.prototype.commandItem=function(){SceneManager.push(Scene_Item)},Scene_Menu.prototype.commandPersonal=function(){this._statusWindow.setFormationMode(!1),this._statusWindow.selectLast(),this._statusWindow.activate(),this._statusWindow.setHandler("ok",this.onPersonalOk.bind(this)),this._statusWindow.setHandler("cancel",this.onPersonalCancel.bind(this))},Scene_Menu.prototype.commandFormation=function(){this._statusWindow.setFormationMode(!0),this._statusWindow.selectLast(),this._statusWindow.activate(),this._statusWindow.setHandler("ok",this.onFormationOk.bind(this)),this._statusWindow.setHandler("cancel",this.onFormationCancel.bind(this))},Scene_Menu.prototype.commandOptions=function(){SceneManager.push(Scene_Options)},Scene_Menu.prototype.commandSave=function(){SceneManager.push(Scene_Save)},Scene_Menu.prototype.commandGameEnd=function(){SceneManager.push(Scene_GameEnd)},Scene_Menu.prototype.onPersonalOk=function(){switch(this._commandWindow.currentSymbol()){case"skill":SceneManager.push(Scene_Skill);break;case"equip":SceneManager.push(Scene_Equip);break;case"status":SceneManager.push(Scene_Status)}},Scene_Menu.prototype.onPersonalCancel=function(){this._statusWindow.deselect(),this._commandWindow.activate()},Scene_Menu.prototype.onFormationOk=function(){var t=this._statusWindow.index();$gameParty.members();var e=this._statusWindow.pendingIndex();0<=e?($gameParty.swapOrder(t,e),this._statusWindow.setPendingIndex(-1),this._statusWindow.redrawItem(t)):this._statusWindow.setPendingIndex(t),this._statusWindow.activate()},Scene_Menu.prototype.onFormationCancel=function(){0<=this._statusWindow.pendingIndex()?(this._statusWindow.setPendingIndex(-1),this._statusWindow.activate()):(this._statusWindow.deselect(),this._commandWindow.activate())},Scene_ItemBase.prototype=Object.create(Scene_MenuBase.prototype),Scene_ItemBase.prototype.constructor=Scene_ItemBase,Scene_ItemBase.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_ItemBase.prototype.create=function(){Scene_MenuBase.prototype.create.call(this)},Scene_ItemBase.prototype.createActorWindow=function(){this._actorWindow=new Window_MenuActor,this._actorWindow.setHandler("ok",this.onActorOk.bind(this)),this._actorWindow.setHandler("cancel",this.onActorCancel.bind(this)),this.addWindow(this._actorWindow)},Scene_ItemBase.prototype.item=function(){return this._itemWindow.item()},Scene_ItemBase.prototype.user=function(){return null},Scene_ItemBase.prototype.isCursorLeft=function(){return 0==this._itemWindow.index()%2},Scene_ItemBase.prototype.showSubWindow=function(t){t.x=this.isCursorLeft()?Graphics.boxWidth-t.width:0,t.show(),t.activate()},Scene_ItemBase.prototype.hideSubWindow=function(t){t.hide(),t.deactivate(),this.activateItemWindow()},Scene_ItemBase.prototype.onActorOk=function(){this.canUse()?this.useItem():SoundManager.playBuzzer()},Scene_ItemBase.prototype.onActorCancel=function(){this.hideSubWindow(this._actorWindow)},Scene_ItemBase.prototype.determineItem=function(){var t=new Game_Action(this.user()),e=this.item();t.setItemObject(e),t.isForFriend()?(this.showSubWindow(this._actorWindow),this._actorWindow.selectForItem(this.item())):(this.useItem(),this.activateItemWindow())},Scene_ItemBase.prototype.useItem=function(){this.playSeForItem(),this.user().useItem(this.item()),this.applyItem(),this.checkCommonEvent(),this.checkGameover(),this._actorWindow.refresh()},Scene_ItemBase.prototype.activateItemWindow=function(){this._itemWindow.refresh(),this._itemWindow.activate()},Scene_ItemBase.prototype.itemTargetActors=function(){var t=new Game_Action(this.user());return t.setItemObject(this.item()),t.isForFriend()?t.isForAll()?$gameParty.members():[$gameParty.members()[this._actorWindow.index()]]:[]},Scene_ItemBase.prototype.canUse=function(){return this.user().canUse(this.item())&&this.isItemEffectsValid()},Scene_ItemBase.prototype.isItemEffectsValid=function(){var e=new Game_Action(this.user());return e.setItemObject(this.item()),this.itemTargetActors().some(function(t){return e.testApply(t)},this)},Scene_ItemBase.prototype.applyItem=function(){var i=new Game_Action(this.user());i.setItemObject(this.item()),this.itemTargetActors().forEach(function(t){for(var e=0;e<i.numRepeats();e++)i.apply(t)},this),i.applyGlobal()},Scene_ItemBase.prototype.checkCommonEvent=function(){$gameTemp.isCommonEventReserved()&&SceneManager.goto(Scene_Map)},Scene_Item.prototype=Object.create(Scene_ItemBase.prototype),Scene_Item.prototype.constructor=Scene_Item,Scene_Item.prototype.initialize=function(){Scene_ItemBase.prototype.initialize.call(this)},Scene_Item.prototype.create=function(){Scene_ItemBase.prototype.create.call(this),this.createHelpWindow(),this.createCategoryWindow(),this.createItemWindow(),this.createActorWindow()},Scene_Item.prototype.createCategoryWindow=function(){this._categoryWindow=new Window_ItemCategory,this._categoryWindow.setHelpWindow(this._helpWindow),this._categoryWindow.y=this._helpWindow.height,this._categoryWindow.setHandler("ok",this.onCategoryOk.bind(this)),this._categoryWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._categoryWindow)},Scene_Item.prototype.createItemWindow=function(){var t=this._categoryWindow.y+this._categoryWindow.height;this._itemWindow=new Window_ItemList(0,t,Graphics.boxWidth,Graphics.boxHeight-t),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this.addWindow(this._itemWindow),this._categoryWindow.setItemWindow(this._itemWindow)},Scene_Item.prototype.user=function(){for(var t=$gameParty.movableMembers(),e=t[0],i=0,a=0;a<t.length;a++)t[a].pha>i&&(i=t[a].pha,e=t[a]);return e},Scene_Item.prototype.onCategoryOk=function(){this._itemWindow.activate(),this._itemWindow.selectLast()},Scene_Item.prototype.onItemOk=function(){$gameParty.setLastItem(this.item()),this.determineItem()},Scene_Item.prototype.onItemCancel=function(){this._itemWindow.deselect(),this._categoryWindow.activate()},Scene_Item.prototype.playSeForItem=function(){SoundManager.playUseItem()},Scene_Item.prototype.useItem=function(){Scene_ItemBase.prototype.useItem.call(this),this._itemWindow.redrawCurrentItem()},Scene_Skill.prototype=Object.create(Scene_ItemBase.prototype),Scene_Skill.prototype.constructor=Scene_Skill,Scene_Skill.prototype.initialize=function(){Scene_ItemBase.prototype.initialize.call(this)},Scene_Skill.prototype.create=function(){Scene_ItemBase.prototype.create.call(this),this.createHelpWindow(),this.createSkillTypeWindow(),this.createStatusWindow(),this.createItemWindow(),this.createActorWindow()},Scene_Skill.prototype.start=function(){Scene_ItemBase.prototype.start.call(this),this.refreshActor()},Scene_Skill.prototype.createSkillTypeWindow=function(){this._skillTypeWindow=new Window_SkillType(0,this._helpWindow.height),this._skillTypeWindow.setHelpWindow(this._helpWindow),this._skillTypeWindow.setHandler("skill",this.commandSkill.bind(this)),this._skillTypeWindow.setHandler("cancel",this.popScene.bind(this)),this._skillTypeWindow.setHandler("pagedown",this.nextActor.bind(this)),this._skillTypeWindow.setHandler("pageup",this.previousActor.bind(this)),this.addWindow(this._skillTypeWindow)},Scene_Skill.prototype.createStatusWindow=function(){var t=this._skillTypeWindow.width;this._statusWindow=new Window_SkillStatus(t,this._helpWindow.height,Graphics.boxWidth-t,this._skillTypeWindow.height),this._statusWindow.reserveFaceImages(),this.addWindow(this._statusWindow)},Scene_Skill.prototype.createItemWindow=function(){var t=this._statusWindow.y+this._statusWindow.height;this._itemWindow=new Window_SkillList(0,t,Graphics.boxWidth,Graphics.boxHeight-t),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this._skillTypeWindow.setSkillWindow(this._itemWindow),this.addWindow(this._itemWindow)},Scene_Skill.prototype.refreshActor=function(){var t=this.actor();this._skillTypeWindow.setActor(t),this._statusWindow.setActor(t),this._itemWindow.setActor(t)},Scene_Skill.prototype.user=function(){return this.actor()},Scene_Skill.prototype.commandSkill=function(){this._itemWindow.activate(),this._itemWindow.selectLast()},Scene_Skill.prototype.onItemOk=function(){this.actor().setLastMenuSkill(this.item()),this.determineItem()},Scene_Skill.prototype.onItemCancel=function(){this._itemWindow.deselect(),this._skillTypeWindow.activate()},Scene_Skill.prototype.playSeForItem=function(){SoundManager.playUseSkill()},Scene_Skill.prototype.useItem=function(){Scene_ItemBase.prototype.useItem.call(this),this._statusWindow.refresh(),this._itemWindow.refresh()},Scene_Skill.prototype.onActorChange=function(){this.refreshActor(),this._skillTypeWindow.activate()},Scene_Equip.prototype=Object.create(Scene_MenuBase.prototype),Scene_Equip.prototype.constructor=Scene_Equip,Scene_Equip.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_Equip.prototype.create=function(){Scene_MenuBase.prototype.create.call(this),this.createHelpWindow(),this.createStatusWindow(),this.createCommandWindow(),this.createSlotWindow(),this.createItemWindow(),this.refreshActor()},Scene_Equip.prototype.createStatusWindow=function(){this._statusWindow=new Window_EquipStatus(0,this._helpWindow.height),this.addWindow(this._statusWindow)},Scene_Equip.prototype.createCommandWindow=function(){this._commandWindow=new Window_EquipCommand(this._statusWindow.width,this._helpWindow.height,Graphics.boxWidth-this._statusWindow.width),this._commandWindow.setHelpWindow(this._helpWindow),this._commandWindow.setHandler("equip",this.commandEquip.bind(this)),this._commandWindow.setHandler("optimize",this.commandOptimize.bind(this)),this._commandWindow.setHandler("clear",this.commandClear.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this._commandWindow.setHandler("pagedown",this.nextActor.bind(this)),this._commandWindow.setHandler("pageup",this.previousActor.bind(this)),this.addWindow(this._commandWindow)},Scene_Equip.prototype.createSlotWindow=function(){this._slotWindow=new Window_EquipSlot(this._statusWindow.width,this._commandWindow.y+this._commandWindow.height,Graphics.boxWidth-this._statusWindow.width,this._statusWindow.height-this._commandWindow.height),this._slotWindow.setHelpWindow(this._helpWindow),this._slotWindow.setStatusWindow(this._statusWindow),this._slotWindow.setHandler("ok",this.onSlotOk.bind(this)),this._slotWindow.setHandler("cancel",this.onSlotCancel.bind(this)),this.addWindow(this._slotWindow)},Scene_Equip.prototype.createItemWindow=function(){var t=this._statusWindow.y+this._statusWindow.height;this._itemWindow=new Window_EquipItem(0,t,Graphics.boxWidth,Graphics.boxHeight-t),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setStatusWindow(this._statusWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this._slotWindow.setItemWindow(this._itemWindow),this.addWindow(this._itemWindow)},Scene_Equip.prototype.refreshActor=function(){var t=this.actor();this._statusWindow.setActor(t),this._slotWindow.setActor(t),this._itemWindow.setActor(t)},Scene_Equip.prototype.commandEquip=function(){this._slotWindow.activate(),this._slotWindow.select(0)},Scene_Equip.prototype.commandOptimize=function(){SoundManager.playEquip(),this.actor().optimizeEquipments(),this._statusWindow.refresh(),this._slotWindow.refresh(),this._commandWindow.activate()},Scene_Equip.prototype.commandClear=function(){SoundManager.playEquip(),this.actor().clearEquipments(),this._statusWindow.refresh(),this._slotWindow.refresh(),this._commandWindow.activate()},Scene_Equip.prototype.onSlotOk=function(){this._itemWindow.activate(),this._itemWindow.select(0)},Scene_Equip.prototype.onSlotCancel=function(){this._slotWindow.deselect(),this._commandWindow.activate()},Scene_Equip.prototype.onItemOk=function(){SoundManager.playEquip(),this.actor().changeEquip(this._slotWindow.index(),this._itemWindow.item()),this._slotWindow.activate(),this._slotWindow.refresh(),this._itemWindow.deselect(),this._itemWindow.refresh(),this._statusWindow.refresh()},Scene_Equip.prototype.onItemCancel=function(){this._slotWindow.activate(),this._itemWindow.deselect()},Scene_Equip.prototype.onActorChange=function(){this.refreshActor(),this._commandWindow.activate()},Scene_Status.prototype=Object.create(Scene_MenuBase.prototype),Scene_Status.prototype.constructor=Scene_Status,Scene_Status.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_Status.prototype.create=function(){Scene_MenuBase.prototype.create.call(this),this._statusWindow=new Window_Status,this._statusWindow.setHandler("cancel",this.popScene.bind(this)),this._statusWindow.setHandler("pagedown",this.nextActor.bind(this)),this._statusWindow.setHandler("pageup",this.previousActor.bind(this)),this._statusWindow.reserveFaceImages(),this.addWindow(this._statusWindow)},Scene_Status.prototype.start=function(){Scene_MenuBase.prototype.start.call(this),this.refreshActor()},Scene_Status.prototype.refreshActor=function(){var t=this.actor();this._statusWindow.setActor(t)},Scene_Status.prototype.onActorChange=function(){this.refreshActor(),this._statusWindow.activate()},Scene_Options.prototype=Object.create(Scene_MenuBase.prototype),Scene_Options.prototype.constructor=Scene_Options,Scene_Options.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_Options.prototype.create=function(){Scene_MenuBase.prototype.create.call(this),this.createOptionsWindow()},Scene_Options.prototype.terminate=function(){Scene_MenuBase.prototype.terminate.call(this),ConfigManager.save()},Scene_Options.prototype.createOptionsWindow=function(){this._optionsWindow=new Window_Options,this._optionsWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._optionsWindow)},Scene_File.prototype=Object.create(Scene_MenuBase.prototype),Scene_File.prototype.constructor=Scene_File,Scene_File.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_File.prototype.create=function(){Scene_MenuBase.prototype.create.call(this),DataManager.loadAllSavefileImages(),this.createHelpWindow(),this.createListWindow()},Scene_File.prototype.start=function(){Scene_MenuBase.prototype.start.call(this),this._listWindow.refresh()},Scene_File.prototype.savefileId=function(){return this._listWindow.index()+1},Scene_File.prototype.createHelpWindow=function(){this._helpWindow=new Window_Help(1),this._helpWindow.setText(this.helpWindowText()),this.addWindow(this._helpWindow)},Scene_File.prototype.createListWindow=function(){var t=this._helpWindow.height;this._listWindow=new Window_SavefileList(0,t,Graphics.boxWidth,Graphics.boxHeight-t),this._listWindow.setHandler("ok",this.onSavefileOk.bind(this)),this._listWindow.setHandler("cancel",this.popScene.bind(this)),this._listWindow.select(this.firstSavefileIndex()),this._listWindow.setTopRow(this.firstSavefileIndex()-2),this._listWindow.setMode(this.mode()),this._listWindow.refresh(),this.addWindow(this._listWindow)},Scene_File.prototype.mode=function(){return null},Scene_File.prototype.activateListWindow=function(){this._listWindow.activate()},Scene_File.prototype.helpWindowText=function(){return""},Scene_File.prototype.firstSavefileIndex=function(){return 0},Scene_File.prototype.onSavefileOk=function(){},Scene_Save.prototype=Object.create(Scene_File.prototype),Scene_Save.prototype.constructor=Scene_Save,Scene_Save.prototype.initialize=function(){Scene_File.prototype.initialize.call(this)},Scene_Save.prototype.mode=function(){return"save"},Scene_Save.prototype.helpWindowText=function(){return TextManager.saveMessage},Scene_Save.prototype.firstSavefileIndex=function(){return DataManager.lastAccessedSavefileId()-1},Scene_Save.prototype.onSavefileOk=function(){Scene_File.prototype.onSavefileOk.call(this),$gameSystem.onBeforeSave(),DataManager.saveGame(this.savefileId())?this.onSaveSuccess():this.onSaveFailure()},Scene_Save.prototype.onSaveSuccess=function(){SoundManager.playSave(),StorageManager.cleanBackup(this.savefileId()),this.popScene()},Scene_Save.prototype.onSaveFailure=function(){SoundManager.playBuzzer(),this.activateListWindow()},Scene_Load.prototype=Object.create(Scene_File.prototype),Scene_Load.prototype.constructor=Scene_Load,Scene_Load.prototype.initialize=function(){Scene_File.prototype.initialize.call(this),this._loadSuccess=!1},Scene_Load.prototype.terminate=function(){Scene_File.prototype.terminate.call(this),this._loadSuccess&&$gameSystem.onAfterLoad()},Scene_Load.prototype.mode=function(){return"load"},Scene_Load.prototype.helpWindowText=function(){return TextManager.loadMessage},Scene_Load.prototype.firstSavefileIndex=function(){return DataManager.latestSavefileId()-1},Scene_Load.prototype.onSavefileOk=function(){Scene_File.prototype.onSavefileOk.call(this),DataManager.loadGame(this.savefileId())?this.onLoadSuccess():this.onLoadFailure()},Scene_Load.prototype.onLoadSuccess=function(){SoundManager.playLoad(),this.fadeOutAll(),this.reloadMapIfUpdated(),SceneManager.goto(Scene_Map),this._loadSuccess=!0},Scene_Load.prototype.onLoadFailure=function(){SoundManager.playBuzzer(),this.activateListWindow()},Scene_Load.prototype.reloadMapIfUpdated=function(){$gameSystem.versionId()!==$dataSystem.versionId&&($gamePlayer.reserveTransfer($gameMap.mapId(),$gamePlayer.x,$gamePlayer.y),$gamePlayer.requestMapReload())},Scene_GameEnd.prototype=Object.create(Scene_MenuBase.prototype),Scene_GameEnd.prototype.constructor=Scene_GameEnd,Scene_GameEnd.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_GameEnd.prototype.create=function(){Scene_MenuBase.prototype.create.call(this),this.createCommandWindow()},Scene_GameEnd.prototype.stop=function(){Scene_MenuBase.prototype.stop.call(this),this._commandWindow.close()},Scene_GameEnd.prototype.createBackground=function(){Scene_MenuBase.prototype.createBackground.call(this),this.setBackgroundOpacity(128)},Scene_GameEnd.prototype.createCommandWindow=function(){this._commandWindow=new Window_GameEnd,this._commandWindow.setHandler("toTitle",this.commandToTitle.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._commandWindow)},Scene_GameEnd.prototype.commandToTitle=function(){this.fadeOutAll(),SceneManager.goto(Scene_Title)},Scene_Shop.prototype=Object.create(Scene_MenuBase.prototype),Scene_Shop.prototype.constructor=Scene_Shop,Scene_Shop.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_Shop.prototype.prepare=function(t,e){this._goods=t,this._purchaseOnly=e,this._item=null},Scene_Shop.prototype.create=function(){Scene_MenuBase.prototype.create.call(this),this.createHelpWindow(),this.createGoldWindow(),this.createCommandWindow(),this.createDummyWindow(),this.createNumberWindow(),this.createStatusWindow(),this.createBuyWindow(),this.createCategoryWindow(),this.createSellWindow()},Scene_Shop.prototype.createGoldWindow=function(){this._goldWindow=new Window_Gold(0,this._helpWindow.height),this._goldWindow.x=Graphics.boxWidth-this._goldWindow.width,this.addWindow(this._goldWindow)},Scene_Shop.prototype.createCommandWindow=function(){this._commandWindow=new Window_ShopCommand(this._goldWindow.x,this._purchaseOnly),this._commandWindow.y=this._helpWindow.height,this._commandWindow.setHandler("buy",this.commandBuy.bind(this)),this._commandWindow.setHandler("sell",this.commandSell.bind(this)),this._commandWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._commandWindow)},Scene_Shop.prototype.createDummyWindow=function(){var t=this._commandWindow.y+this._commandWindow.height;this._dummyWindow=new Window_Base(0,t,Graphics.boxWidth,Graphics.boxHeight-t),this.addWindow(this._dummyWindow)},Scene_Shop.prototype.createNumberWindow=function(){this._numberWindow=new Window_ShopNumber(0,this._dummyWindow.y,this._dummyWindow.height),this._numberWindow.hide(),this._numberWindow.setHandler("ok",this.onNumberOk.bind(this)),this._numberWindow.setHandler("cancel",this.onNumberCancel.bind(this)),this.addWindow(this._numberWindow)},Scene_Shop.prototype.createStatusWindow=function(){var t=this._numberWindow.width;this._statusWindow=new Window_ShopStatus(t,this._dummyWindow.y,Graphics.boxWidth-t,this._dummyWindow.height),this._statusWindow.hide(),this.addWindow(this._statusWindow)},Scene_Shop.prototype.createBuyWindow=function(){this._buyWindow=new Window_ShopBuy(0,this._dummyWindow.y,this._dummyWindow.height,this._goods),this._buyWindow.setHelpWindow(this._helpWindow),this._buyWindow.setStatusWindow(this._statusWindow),this._buyWindow.hide(),this._buyWindow.setHandler("ok",this.onBuyOk.bind(this)),this._buyWindow.setHandler("cancel",this.onBuyCancel.bind(this)),this.addWindow(this._buyWindow)},Scene_Shop.prototype.createCategoryWindow=function(){this._categoryWindow=new Window_ItemCategory,this._categoryWindow.setHelpWindow(this._helpWindow),this._categoryWindow.y=this._dummyWindow.y,this._categoryWindow.hide(),this._categoryWindow.deactivate(),this._categoryWindow.setHandler("ok",this.onCategoryOk.bind(this)),this._categoryWindow.setHandler("cancel",this.onCategoryCancel.bind(this)),this.addWindow(this._categoryWindow)},Scene_Shop.prototype.createSellWindow=function(){var t=this._categoryWindow.y+this._categoryWindow.height;this._sellWindow=new Window_ShopSell(0,t,Graphics.boxWidth,Graphics.boxHeight-t),this._sellWindow.setHelpWindow(this._helpWindow),this._sellWindow.hide(),this._sellWindow.setHandler("ok",this.onSellOk.bind(this)),this._sellWindow.setHandler("cancel",this.onSellCancel.bind(this)),this._categoryWindow.setItemWindow(this._sellWindow),this.addWindow(this._sellWindow)},Scene_Shop.prototype.activateBuyWindow=function(){this._buyWindow.setMoney(this.money()),this._buyWindow.show(),this._buyWindow.activate(),this._statusWindow.show()},Scene_Shop.prototype.activateSellWindow=function(){this._categoryWindow.show(),this._sellWindow.refresh(),this._sellWindow.show(),this._sellWindow.activate(),this._statusWindow.hide()},Scene_Shop.prototype.commandBuy=function(){this._dummyWindow.hide(),this.activateBuyWindow()},Scene_Shop.prototype.commandSell=function(){this._dummyWindow.hide(),this._categoryWindow.show(),this._categoryWindow.activate(),this._sellWindow.show(),this._sellWindow.deselect(),this._sellWindow.refresh()},Scene_Shop.prototype.onBuyOk=function(){this._item=this._buyWindow.item(),this._buyWindow.hide(),this._numberWindow.setup(this._item,this.maxBuy(),this.buyingPrice()),this._numberWindow.setCurrencyUnit(this.currencyUnit()),this._numberWindow.show(),this._numberWindow.activate()},Scene_Shop.prototype.onBuyCancel=function(){this._commandWindow.activate(),this._dummyWindow.show(),this._buyWindow.hide(),this._statusWindow.hide(),this._statusWindow.setItem(null),this._helpWindow.clear()},Scene_Shop.prototype.onCategoryOk=function(){this.activateSellWindow(),this._sellWindow.select(0)},Scene_Shop.prototype.onCategoryCancel=function(){this._commandWindow.activate(),this._dummyWindow.show(),this._categoryWindow.hide(),this._sellWindow.hide()},Scene_Shop.prototype.onSellOk=function(){this._item=this._sellWindow.item(),this._categoryWindow.hide(),this._sellWindow.hide(),this._numberWindow.setup(this._item,this.maxSell(),this.sellingPrice()),this._numberWindow.setCurrencyUnit(this.currencyUnit()),this._numberWindow.show(),this._numberWindow.activate(),this._statusWindow.setItem(this._item),this._statusWindow.show()},Scene_Shop.prototype.onSellCancel=function(){this._sellWindow.deselect(),this._categoryWindow.activate(),this._statusWindow.setItem(null),this._helpWindow.clear()},Scene_Shop.prototype.onNumberOk=function(){switch(SoundManager.playShop(),this._commandWindow.currentSymbol()){case"buy":this.doBuy(this._numberWindow.number());break;case"sell":this.doSell(this._numberWindow.number())}this.endNumberInput(),this._goldWindow.refresh(),this._statusWindow.refresh()},Scene_Shop.prototype.onNumberCancel=function(){SoundManager.playCancel(),this.endNumberInput()},Scene_Shop.prototype.doBuy=function(t){$gameParty.loseGold(t*this.buyingPrice()),$gameParty.gainItem(this._item,t)},Scene_Shop.prototype.doSell=function(t){$gameParty.gainGold(t*this.sellingPrice()),$gameParty.loseItem(this._item,t)},Scene_Shop.prototype.endNumberInput=function(){switch(this._numberWindow.hide(),this._commandWindow.currentSymbol()){case"buy":this.activateBuyWindow();break;case"sell":this.activateSellWindow()}},Scene_Shop.prototype.maxBuy=function(){var t=$gameParty.maxItems(this._item)-$gameParty.numItems(this._item),e=this.buyingPrice();return 0<e?Math.min(t,Math.floor(this.money()/e)):t},Scene_Shop.prototype.maxSell=function(){return $gameParty.numItems(this._item)},Scene_Shop.prototype.money=function(){return this._goldWindow.value()},Scene_Shop.prototype.currencyUnit=function(){return this._goldWindow.currencyUnit()},Scene_Shop.prototype.buyingPrice=function(){return this._buyWindow.price(this._item)},Scene_Shop.prototype.sellingPrice=function(){return Math.floor(this._item.price/2)},Scene_Name.prototype=Object.create(Scene_MenuBase.prototype),Scene_Name.prototype.constructor=Scene_Name,Scene_Name.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_Name.prototype.prepare=function(t,e){this._actorId=t,this._maxLength=e},Scene_Name.prototype.create=function(){Scene_MenuBase.prototype.create.call(this),this._actor=$gameActors.actor(this._actorId),this.createEditWindow(),this.createInputWindow()},Scene_Name.prototype.start=function(){Scene_MenuBase.prototype.start.call(this),this._editWindow.refresh()},Scene_Name.prototype.createEditWindow=function(){this._editWindow=new Window_NameEdit(this._actor,this._maxLength),this.addWindow(this._editWindow)},Scene_Name.prototype.createInputWindow=function(){this._inputWindow=new Window_NameInput(this._editWindow),this._inputWindow.setHandler("ok",this.onInputOk.bind(this)),this.addWindow(this._inputWindow)},Scene_Name.prototype.onInputOk=function(){this._actor.setName(this._editWindow.name()),this.popScene()},Scene_Debug.prototype=Object.create(Scene_MenuBase.prototype),Scene_Debug.prototype.constructor=Scene_Debug,Scene_Debug.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)},Scene_Debug.prototype.create=function(){Scene_MenuBase.prototype.create.call(this),this.createRangeWindow(),this.createEditWindow(),this.createDebugHelpWindow()},Scene_Debug.prototype.createRangeWindow=function(){this._rangeWindow=new Window_DebugRange(0,0),this._rangeWindow.setHandler("ok",this.onRangeOk.bind(this)),this._rangeWindow.setHandler("cancel",this.popScene.bind(this)),this.addWindow(this._rangeWindow)},Scene_Debug.prototype.createEditWindow=function(){var t=this._rangeWindow.width;this._editWindow=new Window_DebugEdit(t,0,Graphics.boxWidth-t),this._editWindow.setHandler("cancel",this.onEditCancel.bind(this)),this._rangeWindow.setEditWindow(this._editWindow),this.addWindow(this._editWindow)},Scene_Debug.prototype.createDebugHelpWindow=function(){var t=this._editWindow.height;this._debugHelpWindow=new Window_Base(this._editWindow.x,t,this._editWindow.width,Graphics.boxHeight-t),this.addWindow(this._debugHelpWindow)},Scene_Debug.prototype.onRangeOk=function(){this._editWindow.activate(),this._editWindow.select(0),this.refreshHelpWindow()},Scene_Debug.prototype.onEditCancel=function(){this._rangeWindow.activate(),this._editWindow.deselect(),this.refreshHelpWindow()},Scene_Debug.prototype.refreshHelpWindow=function(){this._debugHelpWindow.contents.clear(),this._editWindow.active&&this._debugHelpWindow.drawTextEx(this.helpText(),4,0)},Scene_Debug.prototype.helpText=function(){return"switch"===this._rangeWindow.mode()?"Enter : ON / OFF":"Left     :  -1\nRight    :  +1\nPageup   : -10\nPagedown : +10"},Scene_Battle.prototype=Object.create(Scene_Base.prototype),Scene_Battle.prototype.constructor=Scene_Battle,Scene_Battle.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this)},Scene_Battle.prototype.create=function(){Scene_Base.prototype.create.call(this),this.createDisplayObjects()},Scene_Battle.prototype.start=function(){Scene_Base.prototype.start.call(this),this.startFadeIn(this.fadeSpeed(),!1),BattleManager.playBattleBgm(),BattleManager.startBattle()},Scene_Battle.prototype.update=function(){var t=this.isActive();$gameTimer.update(t),$gameScreen.update(),this.updateStatusWindow(),this.updateWindowPositions(),t&&!this.isBusy()&&this.updateBattleProcess(),Scene_Base.prototype.update.call(this)},Scene_Battle.prototype.updateBattleProcess=function(){this.isAnyInputWindowActive()&&!BattleManager.isAborting()&&!BattleManager.isBattleEnd()||(BattleManager.update(),this.changeInputWindow())},Scene_Battle.prototype.isAnyInputWindowActive=function(){return this._partyCommandWindow.active||this._actorCommandWindow.active||this._skillWindow.active||this._itemWindow.active||this._actorWindow.active||this._enemyWindow.active},Scene_Battle.prototype.changeInputWindow=function(){BattleManager.isInputting()?BattleManager.actor()?this.startActorCommandSelection():this.startPartyCommandSelection():this.endCommandSelection()},Scene_Battle.prototype.stop=function(){Scene_Base.prototype.stop.call(this),this.needsSlowFadeOut()?this.startFadeOut(this.slowFadeSpeed(),!1):this.startFadeOut(this.fadeSpeed(),!1),this._statusWindow.close(),this._partyCommandWindow.close(),this._actorCommandWindow.close()},Scene_Battle.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this),$gameParty.onBattleEnd(),$gameTroop.onBattleEnd(),AudioManager.stopMe(),ImageManager.clearRequest()},Scene_Battle.prototype.needsSlowFadeOut=function(){return SceneManager.isNextScene(Scene_Title)||SceneManager.isNextScene(Scene_Gameover)},Scene_Battle.prototype.updateStatusWindow=function(){$gameMessage.isBusy()?(this._statusWindow.close(),this._partyCommandWindow.close(),this._actorCommandWindow.close()):this.isActive()&&!this._messageWindow.isClosing()&&this._statusWindow.open()},Scene_Battle.prototype.updateWindowPositions=function(){var t=BattleManager.isInputting()?this._partyCommandWindow.width:this._partyCommandWindow.width/2;this._statusWindow.x<t&&(this._statusWindow.x+=16,this._statusWindow.x>t&&(this._statusWindow.x=t)),this._statusWindow.x>t&&(this._statusWindow.x-=16,this._statusWindow.x<t&&(this._statusWindow.x=t))},Scene_Battle.prototype.createDisplayObjects=function(){this.createSpriteset(),this.createWindowLayer(),this.createAllWindows(),BattleManager.setLogWindow(this._logWindow),BattleManager.setStatusWindow(this._statusWindow),BattleManager.setSpriteset(this._spriteset),this._logWindow.setSpriteset(this._spriteset)},Scene_Battle.prototype.createSpriteset=function(){this._spriteset=new Spriteset_Battle,this.addChild(this._spriteset)},Scene_Battle.prototype.createAllWindows=function(){this.createLogWindow(),this.createStatusWindow(),this.createPartyCommandWindow(),this.createActorCommandWindow(),this.createHelpWindow(),this.createSkillWindow(),this.createItemWindow(),this.createActorWindow(),this.createEnemyWindow(),this.createMessageWindow(),this.createScrollTextWindow()},Scene_Battle.prototype.createLogWindow=function(){this._logWindow=new Window_BattleLog,this.addWindow(this._logWindow)},Scene_Battle.prototype.createStatusWindow=function(){this._statusWindow=new Window_BattleStatus,this.addWindow(this._statusWindow)},Scene_Battle.prototype.createPartyCommandWindow=function(){this._partyCommandWindow=new Window_PartyCommand,this._partyCommandWindow.setHandler("fight",this.commandFight.bind(this)),this._partyCommandWindow.setHandler("escape",this.commandEscape.bind(this)),this._partyCommandWindow.deselect(),this.addWindow(this._partyCommandWindow)},Scene_Battle.prototype.createActorCommandWindow=function(){this._actorCommandWindow=new Window_ActorCommand,this._actorCommandWindow.setHandler("attack",this.commandAttack.bind(this)),this._actorCommandWindow.setHandler("skill",this.commandSkill.bind(this)),this._actorCommandWindow.setHandler("guard",this.commandGuard.bind(this)),this._actorCommandWindow.setHandler("item",this.commandItem.bind(this)),this._actorCommandWindow.setHandler("cancel",this.selectPreviousCommand.bind(this)),this.addWindow(this._actorCommandWindow)},Scene_Battle.prototype.createHelpWindow=function(){this._helpWindow=new Window_Help,this._helpWindow.visible=!1,this.addWindow(this._helpWindow)},Scene_Battle.prototype.createSkillWindow=function(){var t=this._helpWindow.y+this._helpWindow.height;this._skillWindow=new Window_BattleSkill(0,t,Graphics.boxWidth,this._statusWindow.y-t),this._skillWindow.setHelpWindow(this._helpWindow),this._skillWindow.setHandler("ok",this.onSkillOk.bind(this)),this._skillWindow.setHandler("cancel",this.onSkillCancel.bind(this)),this.addWindow(this._skillWindow)},Scene_Battle.prototype.createItemWindow=function(){var t=this._helpWindow.y+this._helpWindow.height;this._itemWindow=new Window_BattleItem(0,t,Graphics.boxWidth,this._statusWindow.y-t),this._itemWindow.setHelpWindow(this._helpWindow),this._itemWindow.setHandler("ok",this.onItemOk.bind(this)),this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this)),this.addWindow(this._itemWindow)},Scene_Battle.prototype.createActorWindow=function(){this._actorWindow=new Window_BattleActor(0,this._statusWindow.y),this._actorWindow.setHandler("ok",this.onActorOk.bind(this)),this._actorWindow.setHandler("cancel",this.onActorCancel.bind(this)),this.addWindow(this._actorWindow)},Scene_Battle.prototype.createEnemyWindow=function(){this._enemyWindow=new Window_BattleEnemy(0,this._statusWindow.y),this._enemyWindow.x=Graphics.boxWidth-this._enemyWindow.width,this._enemyWindow.setHandler("ok",this.onEnemyOk.bind(this)),this._enemyWindow.setHandler("cancel",this.onEnemyCancel.bind(this)),this.addWindow(this._enemyWindow)},Scene_Battle.prototype.createMessageWindow=function(){this._messageWindow=new Window_Message,this.addWindow(this._messageWindow),this._messageWindow.subWindows().forEach(function(t){this.addWindow(t)},this)},Scene_Battle.prototype.createScrollTextWindow=function(){this._scrollTextWindow=new Window_ScrollText,this.addWindow(this._scrollTextWindow)},Scene_Battle.prototype.refreshStatus=function(){this._statusWindow.refresh()},Scene_Battle.prototype.startPartyCommandSelection=function(){this.refreshStatus(),this._statusWindow.deselect(),this._statusWindow.open(),this._actorCommandWindow.close(),this._partyCommandWindow.setup()},Scene_Battle.prototype.commandFight=function(){this.selectNextCommand()},Scene_Battle.prototype.commandEscape=function(){BattleManager.processEscape(),this.changeInputWindow()},Scene_Battle.prototype.startActorCommandSelection=function(){this._statusWindow.select(BattleManager.actor().index()),this._partyCommandWindow.close(),this._actorCommandWindow.setup(BattleManager.actor())},Scene_Battle.prototype.commandAttack=function(){BattleManager.inputtingAction().setAttack(),this.selectEnemySelection()},Scene_Battle.prototype.commandSkill=function(){this._skillWindow.setActor(BattleManager.actor()),this._skillWindow.setStypeId(this._actorCommandWindow.currentExt()),this._skillWindow.refresh(),this._skillWindow.show(),this._skillWindow.activate()},Scene_Battle.prototype.commandGuard=function(){BattleManager.inputtingAction().setGuard(),this.selectNextCommand()},Scene_Battle.prototype.commandItem=function(){this._itemWindow.refresh(),this._itemWindow.show(),this._itemWindow.activate()},Scene_Battle.prototype.selectNextCommand=function(){BattleManager.selectNextCommand(),this.changeInputWindow()},Scene_Battle.prototype.selectPreviousCommand=function(){BattleManager.selectPreviousCommand(),this.changeInputWindow()},Scene_Battle.prototype.selectActorSelection=function(){this._actorWindow.refresh(),this._actorWindow.show(),this._actorWindow.activate()},Scene_Battle.prototype.onActorOk=function(){BattleManager.inputtingAction().setTarget(this._actorWindow.index()),this._actorWindow.hide(),this._skillWindow.hide(),this._itemWindow.hide(),this.selectNextCommand()},Scene_Battle.prototype.onActorCancel=function(){switch(this._actorWindow.hide(),this._actorCommandWindow.currentSymbol()){case"skill":this._skillWindow.show(),this._skillWindow.activate();break;case"item":this._itemWindow.show(),this._itemWindow.activate()}},Scene_Battle.prototype.selectEnemySelection=function(){this._enemyWindow.refresh(),this._enemyWindow.show(),this._enemyWindow.select(0),this._enemyWindow.activate()},Scene_Battle.prototype.onEnemyOk=function(){BattleManager.inputtingAction().setTarget(this._enemyWindow.enemyIndex()),this._enemyWindow.hide(),this._skillWindow.hide(),this._itemWindow.hide(),this.selectNextCommand()},Scene_Battle.prototype.onEnemyCancel=function(){switch(this._enemyWindow.hide(),this._actorCommandWindow.currentSymbol()){case"attack":this._actorCommandWindow.activate();break;case"skill":this._skillWindow.show(),this._skillWindow.activate();break;case"item":this._itemWindow.show(),this._itemWindow.activate()}},Scene_Battle.prototype.onSkillOk=function(){var t=this._skillWindow.item();BattleManager.inputtingAction().setSkill(t.id),BattleManager.actor().setLastBattleSkill(t),this.onSelectAction()},Scene_Battle.prototype.onSkillCancel=function(){this._skillWindow.hide(),this._actorCommandWindow.activate()},Scene_Battle.prototype.onItemOk=function(){var t=this._itemWindow.item();BattleManager.inputtingAction().setItem(t.id),$gameParty.setLastItem(t),this.onSelectAction()},Scene_Battle.prototype.onItemCancel=function(){this._itemWindow.hide(),this._actorCommandWindow.activate()},Scene_Battle.prototype.onSelectAction=function(){var t=BattleManager.inputtingAction();this._skillWindow.hide(),this._itemWindow.hide(),t.needsSelection()?t.isForOpponent()?this.selectEnemySelection():this.selectActorSelection():this.selectNextCommand()},Scene_Battle.prototype.endCommandSelection=function(){this._partyCommandWindow.close(),this._actorCommandWindow.close(),this._statusWindow.deselect()},Scene_Gameover.prototype=Object.create(Scene_Base.prototype),Scene_Gameover.prototype.constructor=Scene_Gameover,Scene_Gameover.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this)},Scene_Gameover.prototype.create=function(){Scene_Base.prototype.create.call(this),this.playGameoverMusic(),this.createBackground()},Scene_Gameover.prototype.start=function(){Scene_Base.prototype.start.call(this),this.startFadeIn(this.slowFadeSpeed(),!1)},Scene_Gameover.prototype.update=function(){this.isActive()&&!this.isBusy()&&this.isTriggered()&&this.gotoTitle(),Scene_Base.prototype.update.call(this)},Scene_Gameover.prototype.stop=function(){Scene_Base.prototype.stop.call(this),this.fadeOutAll()},Scene_Gameover.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this),AudioManager.stopAll()},Scene_Gameover.prototype.playGameoverMusic=function(){AudioManager.stopBgm(),AudioManager.stopBgs(),AudioManager.playMe($dataSystem.gameoverMe)},Scene_Gameover.prototype.createBackground=function(){this._backSprite=new Sprite,this._backSprite.bitmap=ImageManager.loadSystem("GameOver"),this.addChild(this._backSprite)},Scene_Gameover.prototype.isTriggered=function(){return Input.isTriggered("ok")||TouchInput.isTriggered()},Scene_Gameover.prototype.gotoTitle=function(){SceneManager.goto(Scene_Title)},Sprite_Base.prototype=Object.create(Sprite.prototype),Sprite_Base.prototype.constructor=Sprite_Base,Sprite_Base.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._animationSprites=[],(this._effectTarget=this)._hiding=!1},Sprite_Base.prototype.update=function(){Sprite.prototype.update.call(this),this.updateVisibility(),this.updateAnimationSprites()},Sprite_Base.prototype.hide=function(){this._hiding=!0,this.updateVisibility()},Sprite_Base.prototype.show=function(){this._hiding=!1,this.updateVisibility()},Sprite_Base.prototype.updateVisibility=function(){this.visible=!this._hiding},Sprite_Base.prototype.updateAnimationSprites=function(){if(0<this._animationSprites.length){var t=this._animationSprites.clone();this._animationSprites=[];for(var e=0;e<t.length;e++){var i=t[e];i.isPlaying()?this._animationSprites.push(i):i.remove()}}},Sprite_Base.prototype.startAnimation=function(t,e,i){var a=new Sprite_Animation;a.setup(this._effectTarget,t,e,i),this.parent.addChild(a),this._animationSprites.push(a)},Sprite_Base.prototype.isAnimationPlaying=function(){return 0<this._animationSprites.length},Sprite_Button.prototype=Object.create(Sprite.prototype),Sprite_Button.prototype.constructor=Sprite_Button,Sprite_Button.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._touching=!1,this._clickHandler=this._hotFrame=this._coldFrame=null},Sprite_Button.prototype.update=function(){Sprite.prototype.update.call(this),this.updateFrame(),this.processTouch()},Sprite_Button.prototype.updateFrame=function(){var t;(t=this._touching?this._hotFrame:this._coldFrame)&&this.setFrame(t.x,t.y,t.width,t.height)},Sprite_Button.prototype.setColdFrame=function(t,e,i,a){this._coldFrame=new Rectangle(t,e,i,a)},Sprite_Button.prototype.setHotFrame=function(t,e,i,a){this._hotFrame=new Rectangle(t,e,i,a)},Sprite_Button.prototype.setClickHandler=function(t){this._clickHandler=t},Sprite_Button.prototype.callClickHandler=function(){this._clickHandler&&this._clickHandler()},Sprite_Button.prototype.processTouch=function(){this.isActive()?(TouchInput.isTriggered()&&this.isButtonTouched()&&(this._touching=!0),!this._touching||!TouchInput.isReleased()&&this.isButtonTouched()||(this._touching=!1,TouchInput.isReleased()&&this.callClickHandler())):this._touching=!1},Sprite_Button.prototype.isActive=function(){for(var t=this;t;){if(!t.visible)return!1;t=t.parent}return!0},Sprite_Button.prototype.isButtonTouched=function(){var t=this.canvasToLocalX(TouchInput.x),e=this.canvasToLocalY(TouchInput.y);return 0<=t&&0<=e&&t<this.width&&e<this.height},Sprite_Button.prototype.canvasToLocalX=function(t){for(var e=this;e;)t-=e.x,e=e.parent;return t},Sprite_Button.prototype.canvasToLocalY=function(t){for(var e=this;e;)t-=e.y,e=e.parent;return t},Sprite_Character.prototype=Object.create(Sprite_Base.prototype),Sprite_Character.prototype.constructor=Sprite_Character,Sprite_Character.prototype.initialize=function(t){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.setCharacter(t)},Sprite_Character.prototype.initMembers=function(){this.anchor.x=.5,this.anchor.y=1,this._character=null,this._tilesetId=this._balloonDuration=0,this._lowerBody=this._upperBody=null},Sprite_Character.prototype.setCharacter=function(t){this._character=t},Sprite_Character.prototype.update=function(){Sprite_Base.prototype.update.call(this),this.updateBitmap(),this.updateFrame(),this.updatePosition(),this.updateAnimation(),this.updateBalloon(),this.updateOther()},Sprite_Character.prototype.updateVisibility=function(){Sprite_Base.prototype.updateVisibility.call(this),this._character.isTransparent()&&(this.visible=!1)},Sprite_Character.prototype.isTile=function(){return 0<this._character.tileId},Sprite_Character.prototype.tilesetBitmap=function(t){var e=$gameMap.tileset();return ImageManager.loadTileset(e.tilesetNames[5+Math.floor(t/256)])},Sprite_Character.prototype.updateBitmap=function(){this.isImageChanged()&&(this._tilesetId=$gameMap.tilesetId(),this._tileId=this._character.tileId(),this._characterName=this._character.characterName(),this._characterIndex=this._character.characterIndex(),0<this._tileId?this.setTileBitmap():this.setCharacterBitmap())},Sprite_Character.prototype.isImageChanged=function(){return this._tilesetId!==$gameMap.tilesetId()||this._tileId!==this._character.tileId()||this._characterName!==this._character.characterName()||this._characterIndex!==this._character.characterIndex()},Sprite_Character.prototype.setTileBitmap=function(){this.bitmap=this.tilesetBitmap(this._tileId)},Sprite_Character.prototype.setCharacterBitmap=function(){this.bitmap=ImageManager.loadCharacter(this._characterName),this._isBigCharacter=ImageManager.isBigCharacter(this._characterName)},Sprite_Character.prototype.updateFrame=function(){0<this._tileId?this.updateTileFrame():this.updateCharacterFrame()},Sprite_Character.prototype.updateTileFrame=function(){var t=this.patternWidth(),e=this.patternHeight();this.setFrame((Math.floor(this._tileId/128)%2*8+this._tileId%8)*t,Math.floor(this._tileId%256/8)%16*e,t,e)},Sprite_Character.prototype.updateCharacterFrame=function(){var t=this.patternWidth(),e=this.patternHeight(),i=(this.characterBlockX()+this.characterPatternX())*t,a=(this.characterBlockY()+this.characterPatternY())*e;if(this.updateHalfBodySprites(),0<this._bushDepth){var n=this._bushDepth;this._upperBody.setFrame(i,a,t,e-n),this._lowerBody.setFrame(i,a+e-n,t,n),this.setFrame(i,a,0,e)}else this.setFrame(i,a,t,e)},Sprite_Character.prototype.characterBlockX=function(){return this._isBigCharacter?0:this._character.characterIndex()%4*3},Sprite_Character.prototype.characterBlockY=function(){if(this._isBigCharacter)return 0;var t=this._character.characterIndex();return 4*Math.floor(t/4)},Sprite_Character.prototype.characterPatternX=function(){return this._character.pattern()},Sprite_Character.prototype.characterPatternY=function(){return(this._character.direction()-2)/2},Sprite_Character.prototype.patternWidth=function(){return 0<this._tileId?$gameMap.tileWidth():this._isBigCharacter?this.bitmap.width/3:this.bitmap.width/12},Sprite_Character.prototype.patternHeight=function(){return 0<this._tileId?$gameMap.tileHeight():this._isBigCharacter?this.bitmap.height/4:this.bitmap.height/8},Sprite_Character.prototype.updateHalfBodySprites=function(){0<this._bushDepth?(this.createHalfBodySprites(),this._upperBody.bitmap=this.bitmap,this._upperBody.visible=!0,this._upperBody.y=-this._bushDepth,this._lowerBody.bitmap=this.bitmap,this._lowerBody.visible=!0,this._upperBody.setBlendColor(this.getBlendColor()),this._lowerBody.setBlendColor(this.getBlendColor()),this._upperBody.setColorTone(this.getColorTone()),this._lowerBody.setColorTone(this.getColorTone())):this._upperBody&&(this._upperBody.visible=!1,this._lowerBody.visible=!1)},Sprite_Character.prototype.createHalfBodySprites=function(){this._upperBody||(this._upperBody=new Sprite,this._upperBody.anchor.x=.5,this._upperBody.anchor.y=1,this.addChild(this._upperBody)),this._lowerBody||(this._lowerBody=new Sprite,this._lowerBody.anchor.x=.5,this._lowerBody.anchor.y=1,this._lowerBody.opacity=128,this.addChild(this._lowerBody))},Sprite_Character.prototype.updatePosition=function(){this.x=this._character.screenX(),this.y=this._character.screenY(),this.z=this._character.screenZ()},Sprite_Character.prototype.updateAnimation=function(){this.setupAnimation(),this.isAnimationPlaying()||this._character.endAnimation(),this.isBalloonPlaying()||this._character.endBalloon()},Sprite_Character.prototype.updateOther=function(){this.opacity=this._character.opacity(),this.blendMode=this._character.blendMode(),this._bushDepth=this._character.bushDepth()},Sprite_Character.prototype.setupAnimation=function(){if(0<this._character.animationId()){var t=$dataAnimations[this._character.animationId()];this.startAnimation(t,!1,0),this._character.startAnimation()}},Sprite_Character.prototype.setupBalloon=function(){0<this._character.balloonId()&&(this.startBalloon(),this._character.startBalloon())},Sprite_Character.prototype.startBalloon=function(){this._balloonSprite||(this._balloonSprite=new Sprite_Balloon),this._balloonSprite.setup(this._character.balloonId()),this.parent.addChild(this._balloonSprite)},Sprite_Character.prototype.updateBalloon=function(){this.setupBalloon(),this._balloonSprite&&(this._balloonSprite.x=this.x,this._balloonSprite.y=this.y-this.height,this._balloonSprite.isPlaying()||this.endBalloon())},Sprite_Character.prototype.endBalloon=function(){this._balloonSprite&&(this.parent.removeChild(this._balloonSprite),this._balloonSprite=null)},Sprite_Character.prototype.isBalloonPlaying=function(){return!!this._balloonSprite},Sprite_Battler.prototype=Object.create(Sprite_Base.prototype),Sprite_Battler.prototype.constructor=Sprite_Battler,Sprite_Battler.prototype.initialize=function(t){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.setBattler(t)},Sprite_Battler.prototype.initMembers=function(){this.anchor.x=.5,this.anchor.y=1,this._battler=null,this._damages=[],this._offsetY=this._offsetX=this._homeY=this._homeX=0,this._targetOffsetY=this._targetOffsetX=NaN,this._selectionEffectCount=this._movementDuration=0},Sprite_Battler.prototype.setBattler=function(t){this._battler=t},Sprite_Battler.prototype.setHome=function(t,e){this._homeX=t,this._homeY=e,this.updatePosition()},Sprite_Battler.prototype.update=function(){Sprite_Base.prototype.update.call(this),this._battler?(this.updateMain(),this.updateAnimation(),this.updateDamagePopup(),this.updateSelectionEffect()):this.bitmap=null},Sprite_Battler.prototype.updateVisibility=function(){Sprite_Base.prototype.updateVisibility.call(this),this._battler&&this._battler.isSpriteVisible()||(this.visible=!1)},Sprite_Battler.prototype.updateMain=function(){this._battler.isSpriteVisible()&&(this.updateBitmap(),this.updateFrame()),this.updateMove(),this.updatePosition()},Sprite_Battler.prototype.updateBitmap=function(){},Sprite_Battler.prototype.updateFrame=function(){},Sprite_Battler.prototype.updateMove=function(){if(0<this._movementDuration){var t=this._movementDuration;this._offsetX=(this._offsetX*(t-1)+this._targetOffsetX)/t,this._offsetY=(this._offsetY*(t-1)+this._targetOffsetY)/t,this._movementDuration--,0===this._movementDuration&&this.onMoveEnd()}},Sprite_Battler.prototype.updatePosition=function(){this.x=this._homeX+this._offsetX,this.y=this._homeY+this._offsetY},Sprite_Battler.prototype.updateAnimation=function(){this.setupAnimation()},Sprite_Battler.prototype.updateDamagePopup=function(){if(this.setupDamagePopup(),0<this._damages.length){for(var t=0;t<this._damages.length;t++)this._damages[t].update();this._damages[0].isPlaying()||(this.parent.removeChild(this._damages[0]),this._damages.shift())}},Sprite_Battler.prototype.updateSelectionEffect=function(){var t=this._effectTarget;this._battler.isSelected()?(this._selectionEffectCount++,this._selectionEffectCount%30<15?t.setBlendColor([255,255,255,64]):t.setBlendColor([0,0,0,0])):0<this._selectionEffectCount&&(this._selectionEffectCount=0,t.setBlendColor([0,0,0,0]))},Sprite_Battler.prototype.setupAnimation=function(){for(;this._battler.isAnimationRequested();){var t=this._battler.shiftAnimation(),e=$dataAnimations[t.animationId];for(this.startAnimation(e,t.mirror,3===e.position?0:t.delay),t=0;t<this._animationSprites.length;t++)this._animationSprites[t].visible=this._battler.isSpriteVisible()}},Sprite_Battler.prototype.setupDamagePopup=function(){if(this._battler.isDamagePopupRequested()){if(this._battler.isSpriteVisible()){var t=new Sprite_Damage;t.x=this.x+this.damageOffsetX(),t.y=this.y+this.damageOffsetY(),t.setup(this._battler),this._damages.push(t),this.parent.addChild(t)}this._battler.clearDamagePopup(),this._battler.clearResult()}},Sprite_Battler.prototype.damageOffsetX=function(){return 0},Sprite_Battler.prototype.damageOffsetY=function(){return 0},Sprite_Battler.prototype.startMove=function(t,e,i){this._targetOffsetX===t&&this._targetOffsetY===e||(this._targetOffsetX=t,this._targetOffsetY=e,0===(this._movementDuration=i)&&(this._offsetX=t,this._offsetY=e))},Sprite_Battler.prototype.onMoveEnd=function(){},Sprite_Battler.prototype.isEffecting=function(){return!1},Sprite_Battler.prototype.isMoving=function(){return 0<this._movementDuration},Sprite_Battler.prototype.inHomePosition=function(){return 0===this._offsetX&&0===this._offsetY},Sprite_Actor.prototype=Object.create(Sprite_Battler.prototype),Sprite_Actor.prototype.constructor=Sprite_Actor,Sprite_Actor.MOTIONS={walk:{index:0,loop:!0},wait:{index:1,loop:!0},chant:{index:2,loop:!0},guard:{index:3,loop:!0},damage:{index:4,loop:!1},evade:{index:5,loop:!1},thrust:{index:6,loop:!1},swing:{index:7,loop:!1},missile:{index:8,loop:!1},skill:{index:9,loop:!1},spell:{index:10,loop:!1},item:{index:11,loop:!1},escape:{index:12,loop:!0},victory:{index:13,loop:!0},dying:{index:14,loop:!0},abnormal:{index:15,loop:!0},sleep:{index:16,loop:!0},dead:{index:17,loop:!0}},Sprite_Actor.prototype.initialize=function(t){Sprite_Battler.prototype.initialize.call(this,t),this.moveToStartPosition()},Sprite_Actor.prototype.initMembers=function(){Sprite_Battler.prototype.initMembers.call(this),this._battlerName="",this._motion=null,this._pattern=this._motionCount=0,this.createShadowSprite(),this.createWeaponSprite(),this.createMainSprite(),this.createStateSprite()},Sprite_Actor.prototype.createMainSprite=function(){this._mainSprite=new Sprite_Base,this._mainSprite.anchor.x=.5,this._mainSprite.anchor.y=1,this.addChild(this._mainSprite),this._effectTarget=this._mainSprite},Sprite_Actor.prototype.createShadowSprite=function(){this._shadowSprite=new Sprite,this._shadowSprite.bitmap=ImageManager.loadSystem("Shadow2"),this._shadowSprite.anchor.x=.5,this._shadowSprite.anchor.y=.5,this._shadowSprite.y=-2,this.addChild(this._shadowSprite)},Sprite_Actor.prototype.createWeaponSprite=function(){this._weaponSprite=new Sprite_Weapon,this.addChild(this._weaponSprite)},Sprite_Actor.prototype.createStateSprite=function(){this._stateSprite=new Sprite_StateOverlay,this.addChild(this._stateSprite)},Sprite_Actor.prototype.setBattler=function(t){Sprite_Battler.prototype.setBattler.call(this,t),t!==this._actor&&((this._actor=t)&&this.setActorHome(t.index()),this.startEntryMotion(),this._stateSprite.setup(t))},Sprite_Actor.prototype.moveToStartPosition=function(){this.startMove(300,0,0)},Sprite_Actor.prototype.setActorHome=function(t){this.setHome(600+32*t,280+48*t)},Sprite_Actor.prototype.update=function(){Sprite_Battler.prototype.update.call(this),this.updateShadow(),this._actor&&this.updateMotion()},Sprite_Actor.prototype.updateShadow=function(){this._shadowSprite.visible=!!this._actor},Sprite_Actor.prototype.updateMain=function(){Sprite_Battler.prototype.updateMain.call(this),this._actor.isSpriteVisible()&&!this.isMoving()&&this.updateTargetPosition()},Sprite_Actor.prototype.setupMotion=function(){this._actor.isMotionRequested()&&(this.startMotion(this._actor.motionType()),this._actor.clearMotion())},Sprite_Actor.prototype.setupWeaponAnimation=function(){this._actor.isWeaponAnimationRequested()&&(this._weaponSprite.setup(this._actor.weaponImageId()),this._actor.clearWeaponAnimation())},Sprite_Actor.prototype.startMotion=function(t){t=Sprite_Actor.MOTIONS[t],this._motion!==t&&(this._motion=t,this._pattern=this._motionCount=0)},Sprite_Actor.prototype.updateTargetPosition=function(){this._actor.isInputting()||this._actor.isActing()?this.stepForward():this._actor.canMove()&&BattleManager.isEscaped()?this.retreat():this.inHomePosition()||this.stepBack()},Sprite_Actor.prototype.updateBitmap=function(){Sprite_Battler.prototype.updateBitmap.call(this);var t=this._actor.battlerName();this._battlerName!==t&&(this._battlerName=t,this._mainSprite.bitmap=ImageManager.loadSvActor(t))},Sprite_Actor.prototype.updateFrame=function(){Sprite_Battler.prototype.updateFrame.call(this);var t=this._mainSprite.bitmap;if(t){var e=this._motion?this._motion.index:0,i=t.width/9;t=t.height/6,this._mainSprite.setFrame((3*Math.floor(e/6)+(this._pattern<3?this._pattern:1))*i,e%6*t,i,t)}},Sprite_Actor.prototype.updateMove=function(){var t=this._mainSprite.bitmap;t&&!t.isReady()||Sprite_Battler.prototype.updateMove.call(this)},Sprite_Actor.prototype.updateMotion=function(){this.setupMotion(),this.setupWeaponAnimation(),this._actor.isMotionRefreshRequested()&&(this.refreshMotion(),this._actor.clearMotion()),this.updateMotionCount()},Sprite_Actor.prototype.updateMotionCount=function(){this._motion&&++this._motionCount>=this.motionSpeed()&&(this._motion.loop?this._pattern=(this._pattern+1)%4:this._pattern<2?this._pattern++:this.refreshMotion(),this._motionCount=0)},Sprite_Actor.prototype.motionSpeed=function(){return 12},Sprite_Actor.prototype.refreshMotion=function(){var t=this._actor,e=Sprite_Actor.MOTIONS.guard;t&&(this._motion!==e||BattleManager.isInputting())&&(e=t.stateMotionIndex(),t.isInputting()||t.isActing()?this.startMotion("walk"):3===e?this.startMotion("dead"):2===e?this.startMotion("sleep"):t.isChanting()?this.startMotion("chant"):t.isGuard()||t.isGuardWaiting()?this.startMotion("guard"):1===e?this.startMotion("abnormal"):t.isDying()?this.startMotion("dying"):t.isUndecided()?this.startMotion("walk"):this.startMotion("wait"))},Sprite_Actor.prototype.startEntryMotion=function(){this._actor&&this._actor.canMove()?(this.startMotion("walk"),this.startMove(0,0,30)):this.isMoving()||(this.refreshMotion(),this.startMove(0,0,0))},Sprite_Actor.prototype.stepForward=function(){this.startMove(-48,0,12)},Sprite_Actor.prototype.stepBack=function(){this.startMove(0,0,12)},Sprite_Actor.prototype.retreat=function(){this.startMove(300,0,30)},Sprite_Actor.prototype.onMoveEnd=function(){Sprite_Battler.prototype.onMoveEnd.call(this),BattleManager.isBattleEnd()||this.refreshMotion()},Sprite_Actor.prototype.damageOffsetX=function(){return-32},Sprite_Actor.prototype.damageOffsetY=function(){return 0},Sprite_Enemy.prototype=Object.create(Sprite_Battler.prototype),Sprite_Enemy.prototype.constructor=Sprite_Enemy,Sprite_Enemy.prototype.initialize=function(t){Sprite_Battler.prototype.initialize.call(this,t)},Sprite_Enemy.prototype.initMembers=function(){Sprite_Battler.prototype.initMembers.call(this),this._enemy=null,this._appeared=!1,this._battlerName="",this._battlerHue=0,this._effectType=null,this._shake=this._effectDuration=0,this.createStateIconSprite()},Sprite_Enemy.prototype.createStateIconSprite=function(){this._stateIconSprite=new Sprite_StateIcon,this.addChild(this._stateIconSprite)},Sprite_Enemy.prototype.setBattler=function(t){Sprite_Battler.prototype.setBattler.call(this,t),this._enemy=t,this.setHome(t.screenX(),t.screenY()),this._stateIconSprite.setup(t)},Sprite_Enemy.prototype.update=function(){Sprite_Battler.prototype.update.call(this),this._enemy&&(this.updateEffect(),this.updateStateSprite())},Sprite_Enemy.prototype.updateBitmap=function(){Sprite_Battler.prototype.updateBitmap.call(this);var t=this._enemy.battlerName(),e=this._enemy.battlerHue();this._battlerName===t&&this._battlerHue===e||(this._battlerName=t,this._battlerHue=e,this.loadBitmap(t,e),this.initVisibility())},Sprite_Enemy.prototype.loadBitmap=function(t,e){$gameSystem.isSideView()?this.bitmap=ImageManager.loadSvEnemy(t,e):this.bitmap=ImageManager.loadEnemy(t,e)},Sprite_Enemy.prototype.updateFrame=function(){Sprite_Battler.prototype.updateFrame.call(this);var t=this.bitmap.height;"bossCollapse"===this._effectType&&(t=this._effectDuration),this.setFrame(0,0,this.bitmap.width,t)},Sprite_Enemy.prototype.updatePosition=function(){Sprite_Battler.prototype.updatePosition.call(this),this.x+=this._shake},Sprite_Enemy.prototype.updateStateSprite=function(){this._stateIconSprite.y=-Math.round(.9*(this.bitmap.height+40)),this._stateIconSprite.y<20-this.y&&(this._stateIconSprite.y=20-this.y)},Sprite_Enemy.prototype.initVisibility=function(){this._appeared=this._enemy.isAlive(),this._appeared||(this.opacity=0)},Sprite_Enemy.prototype.setupEffect=function(){this._appeared&&this._enemy.isEffectRequested()&&(this.startEffect(this._enemy.effectType()),this._enemy.clearEffect()),!this._appeared&&this._enemy.isAlive()?this.startEffect("appear"):this._appeared&&this._enemy.isHidden()&&this.startEffect("disappear")},Sprite_Enemy.prototype.startEffect=function(t){switch(this._effectType=t,this._effectType){case"appear":this.startAppear();break;case"disappear":this.startDisappear();break;case"whiten":this.startWhiten();break;case"blink":this.startBlink();break;case"collapse":this.startCollapse();break;case"bossCollapse":this.startBossCollapse();break;case"instantCollapse":this.startInstantCollapse()}this.revertToNormal()},Sprite_Enemy.prototype.startAppear=function(){this._effectDuration=16,this._appeared=!0},Sprite_Enemy.prototype.startDisappear=function(){this._effectDuration=32,this._appeared=!1},Sprite_Enemy.prototype.startWhiten=function(){this._effectDuration=16},Sprite_Enemy.prototype.startBlink=function(){this._effectDuration=20},Sprite_Enemy.prototype.startCollapse=function(){this._effectDuration=32,this._appeared=!1},Sprite_Enemy.prototype.startBossCollapse=function(){this._effectDuration=this.bitmap.height,this._appeared=!1},Sprite_Enemy.prototype.startInstantCollapse=function(){this._effectDuration=16,this._appeared=!1},Sprite_Enemy.prototype.updateEffect=function(){if(this.setupEffect(),0<this._effectDuration){switch(this._effectDuration--,this._effectType){case"whiten":this.updateWhiten();break;case"blink":this.updateBlink();break;case"appear":this.updateAppear();break;case"disappear":this.updateDisappear();break;case"collapse":this.updateCollapse();break;case"bossCollapse":this.updateBossCollapse();break;case"instantCollapse":this.updateInstantCollapse()}0===this._effectDuration&&(this._effectType=null)}},Sprite_Enemy.prototype.isEffecting=function(){return null!==this._effectType},Sprite_Enemy.prototype.revertToNormal=function(){this.blendMode=this._shake=0,this.opacity=255,this.setBlendColor([0,0,0,0])},Sprite_Enemy.prototype.updateWhiten=function(){this.setBlendColor([255,255,255,128-10*(16-this._effectDuration)])},Sprite_Enemy.prototype.updateBlink=function(){this.opacity=this._effectDuration%10<5?255:0},Sprite_Enemy.prototype.updateAppear=function(){this.opacity=16*(16-this._effectDuration)},Sprite_Enemy.prototype.updateDisappear=function(){this.opacity=256-10*(32-this._effectDuration)},Sprite_Enemy.prototype.updateCollapse=function(){this.blendMode=Graphics.BLEND_ADD,this.setBlendColor([255,128,128,128]),this.opacity*=this._effectDuration/(this._effectDuration+1)},Sprite_Enemy.prototype.updateBossCollapse=function(){this._shake=this._effectDuration%2*4-2,this.blendMode=Graphics.BLEND_ADD,this.opacity*=this._effectDuration/(this._effectDuration+1),this.setBlendColor([255,255,255,255-this.opacity]),19==this._effectDuration%20&&SoundManager.playBossCollapse2()},Sprite_Enemy.prototype.updateInstantCollapse=function(){this.opacity=0},Sprite_Enemy.prototype.damageOffsetX=function(){return 0},Sprite_Enemy.prototype.damageOffsetY=function(){return-8},Sprite_Animation.prototype=Object.create(Sprite.prototype),Sprite_Animation.prototype.constructor=Sprite_Animation,Sprite_Animation._checker1={},Sprite_Animation._checker2={},Sprite_Animation.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._reduceArtifacts=!0,this.initMembers()},Sprite_Animation.prototype.initMembers=function(){this._animation=this._target=null,this._mirror=!1,this._delay=0,this._rate=4,this._duration=0,this._flashColor=[0,0,0,0],this._hidingDuration=this._screenFlashDuration=this._flashDuration=0,this._bitmap2=this._bitmap1=null,this._cellSprites=[],this._screenFlashSprite=null,this._duplicated=!1,this.z=8},Sprite_Animation.prototype.setup=function(t,e,i,a){this._target=t,this._animation=e,this._mirror=i,this._delay=a,this._animation&&(this.remove(),this.setupRate(),this.setupDuration(),this.loadBitmaps(),this.createSprites())},Sprite_Animation.prototype.remove=function(){this.parent&&this.parent.removeChild(this)&&(this._target.setBlendColor([0,0,0,0]),this._target.show())},Sprite_Animation.prototype.setupRate=function(){this._rate=4},Sprite_Animation.prototype.setupDuration=function(){this._duration=this._animation.frames.length*this._rate+1},Sprite_Animation.prototype.update=function(){Sprite.prototype.update.call(this),this.updateMain(),this.updateFlash(),this.updateScreenFlash(),this.updateHiding(),Sprite_Animation._checker1={},Sprite_Animation._checker2={}},Sprite_Animation.prototype.updateFlash=function(){if(0<this._flashDuration){var t=this._flashDuration--;this._flashColor[3]*=(t-1)/t,this._target.setBlendColor(this._flashColor)}};function Window_EventItem(){this.initialize.apply(this,arguments)}function Window_Message(){this.initialize.apply(this,arguments)}function Window_ScrollText(){this.initialize.apply(this,arguments)}function Window_MapName(){this.initialize.apply(this,arguments)}function Window_BattleLog(){this.initialize.apply(this,arguments)}function Window_PartyCommand(){this.initialize.apply(this,arguments)}function Window_ActorCommand(){this.initialize.apply(this,arguments)}function Window_BattleStatus(){this.initialize.apply(this,arguments)}function Window_BattleActor(){this.initialize.apply(this,arguments)}function Window_BattleEnemy(){this.initialize.apply(this,arguments)}function Window_BattleSkill(){this.initialize.apply(this,arguments)}function Window_BattleItem(){this.initialize.apply(this,arguments)}function Window_TitleCommand(){this.initialize.apply(this,arguments)}function Window_GameEnd(){this.initialize.apply(this,arguments)}function Window_DebugRange(){this.initialize.apply(this,arguments)}function Window_DebugEdit(){this.initialize.apply(this,arguments)}Sprite_Animation.prototype.updateScreenFlash=function(){if(0<this._screenFlashDuration){var t=this._screenFlashDuration--;this._screenFlashSprite&&(this._screenFlashSprite.x=-this.absoluteX(),this._screenFlashSprite.y=-this.absoluteY(),this._screenFlashSprite.opacity*=(t-1)/t,this._screenFlashSprite.visible=0<this._screenFlashDuration)}},Sprite_Animation.prototype.absoluteX=function(){for(var t=0,e=this;e;)t+=e.x,e=e.parent;return t},Sprite_Animation.prototype.absoluteY=function(){for(var t=0,e=this;e;)t+=e.y,e=e.parent;return t},Sprite_Animation.prototype.updateHiding=function(){0<this._hidingDuration&&(this._hidingDuration--,0===this._hidingDuration&&this._target.show())},Sprite_Animation.prototype.isPlaying=function(){return 0<this._duration},Sprite_Animation.prototype.loadBitmaps=function(){var t=this._animation.animation2Name,e=this._animation.animation2Hue;this._bitmap1=ImageManager.loadAnimation(this._animation.animation1Name,this._animation.animation1Hue),this._bitmap2=ImageManager.loadAnimation(t,e)},Sprite_Animation.prototype.isReady=function(){return this._bitmap1&&this._bitmap1.isReady()&&this._bitmap2&&this._bitmap2.isReady()},Sprite_Animation.prototype.createSprites=function(){Sprite_Animation._checker2[this._animation]||(this.createCellSprites(),3===this._animation.position&&(Sprite_Animation._checker2[this._animation]=!0),this.createScreenFlashSprite()),Sprite_Animation._checker1[this._animation]?this._duplicated=!0:(this._duplicated=!1,3===this._animation.position&&(Sprite_Animation._checker1[this._animation]=!0))},Sprite_Animation.prototype.createCellSprites=function(){this._cellSprites=[];for(var t=0;t<16;t++){var e=new Sprite;e.anchor.x=.5,e.anchor.y=.5,this._cellSprites.push(e),this.addChild(e)}},Sprite_Animation.prototype.createScreenFlashSprite=function(){this._screenFlashSprite=new ScreenSprite,this.addChild(this._screenFlashSprite)},Sprite_Animation.prototype.updateMain=function(){this.isPlaying()&&this.isReady()&&(0<this._delay?this._delay--:(this._duration--,this.updatePosition(),0==this._duration%this._rate&&this.updateFrame()))},Sprite_Animation.prototype.updatePosition=function(){if(3===this._animation.position)this.x=this.parent.width/2,this.y=this.parent.height/2;else{var t=this._target.parent,e=t?t.parent:null;this.x=this._target.x,this.y=this._target.y,this.parent===e&&(this.x+=t.x,this.y+=t.y),0===this._animation.position?this.y-=this._target.height:1===this._animation.position&&(this.y-=this._target.height/2)}},Sprite_Animation.prototype.updateFrame=function(){if(0<this._duration){var e=this.currentFrameIndex();this.updateAllCellSprites(this._animation.frames[e]),this._animation.timings.forEach(function(t){t.frame===e&&this.processTimingData(t)},this)}},Sprite_Animation.prototype.currentFrameIndex=function(){return this._animation.frames.length-Math.floor((this._duration+this._rate-1)/this._rate)},Sprite_Animation.prototype.updateAllCellSprites=function(t){for(var e=0;e<this._cellSprites.length;e++){var i=this._cellSprites[e];e<t.length?this.updateCellSprite(i,t[e]):i.visible=!1}},Sprite_Animation.prototype.updateCellSprite=function(t,e){var i=e[0];if(0<=i){var a=192*Math.floor(i%100/5),n=this._mirror;t.bitmap=i<100?this._bitmap1:this._bitmap2,t.setFrame(i%5*192,a,192,192),t.x=e[1],t.y=e[2],t.rotation=e[4]*Math.PI/180,t.scale.x=e[3]/100,e[5]&&(t.scale.x*=-1),n&&(t.x*=-1,t.rotation*=-1,t.scale.x*=-1),t.scale.y=e[3]/100,t.opacity=e[6],t.blendMode=e[7],t.visible=!0}else t.visible=!1},Sprite_Animation.prototype.processTimingData=function(t){var e=t.flashDuration*this._rate;switch(t.flashScope){case 1:this.startFlash(t.flashColor,e);break;case 2:this.startScreenFlash(t.flashColor,e);break;case 3:this.startHiding(e)}!this._duplicated&&t.se&&AudioManager.playSe(t.se)},Sprite_Animation.prototype.startFlash=function(t,e){this._flashColor=t.clone(),this._flashDuration=e},Sprite_Animation.prototype.startScreenFlash=function(t,e){this._screenFlashDuration=e,this._screenFlashSprite&&(this._screenFlashSprite.setColor(t[0],t[1],t[2]),this._screenFlashSprite.opacity=t[3])},Sprite_Animation.prototype.startHiding=function(t){this._hidingDuration=t,this._target.hide()},Sprite_Damage.prototype=Object.create(Sprite.prototype),Sprite_Damage.prototype.constructor=Sprite_Damage,Sprite_Damage.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._duration=90,this._flashColor=[0,0,0,0],this._flashDuration=0,this._damageBitmap=ImageManager.loadSystem("Damage")},Sprite_Damage.prototype.setup=function(t){var e=t.result();e.missed||e.evaded?this.createMiss():e.hpAffected?this.createDigits(0,e.hpDamage):t.isAlive()&&0!==e.mpDamage&&this.createDigits(2,e.mpDamage),e.critical&&this.setupCriticalEffect()},Sprite_Damage.prototype.setupCriticalEffect=function(){this._flashColor=[255,0,0,160],this._flashDuration=60},Sprite_Damage.prototype.digitWidth=function(){return this._damageBitmap?this._damageBitmap.width/10:0},Sprite_Damage.prototype.digitHeight=function(){return this._damageBitmap?this._damageBitmap.height/5:0},Sprite_Damage.prototype.createMiss=function(){var t=this.digitWidth(),e=this.digitHeight(),i=this.createChildSprite();i.setFrame(0,4*e,4*t,e),i.dy=0},Sprite_Damage.prototype.createDigits=function(t,e){var i=Math.abs(e).toString();t+=e<0?1:0,e=this.digitWidth();for(var a=this.digitHeight(),n=0;n<i.length;n++){var o=this.createChildSprite();o.setFrame(Number(i[n])*e,t*a,e,a),o.x=(n-(i.length-1)/2)*e,o.dy=-n}},Sprite_Damage.prototype.createChildSprite=function(){var t=new Sprite;return t.bitmap=this._damageBitmap,t.anchor.x=.5,t.anchor.y=1,t.y=-40,t.ry=t.y,this.addChild(t),t},Sprite_Damage.prototype.update=function(){if(Sprite.prototype.update.call(this),0<this._duration){this._duration--;for(var t=0;t<this.children.length;t++)this.updateChild(this.children[t])}this.updateFlash(),this.updateOpacity()},Sprite_Damage.prototype.updateChild=function(t){t.dy+=.5,t.ry+=t.dy,0<=t.ry&&(t.ry=0,t.dy*=-.6),t.y=Math.round(t.ry),t.setBlendColor(this._flashColor)},Sprite_Damage.prototype.updateFlash=function(){if(0<this._flashDuration){var t=this._flashDuration--;this._flashColor[3]*=(t-1)/t}},Sprite_Damage.prototype.updateOpacity=function(){this._duration<10&&(this.opacity=255*this._duration/10)},Sprite_Damage.prototype.isPlaying=function(){return 0<this._duration},Sprite_StateIcon.prototype=Object.create(Sprite.prototype),Sprite_StateIcon.prototype.constructor=Sprite_StateIcon,Sprite_StateIcon.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this.initMembers(),this.loadBitmap()},Sprite_StateIcon._iconWidth=32,Sprite_StateIcon._iconHeight=32,Sprite_StateIcon.prototype.initMembers=function(){this._battler=null,this._animationIndex=this._animationCount=this._iconIndex=0,this.anchor.x=.5,this.anchor.y=.5},Sprite_StateIcon.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("IconSet"),this.setFrame(0,0,0,0)},Sprite_StateIcon.prototype.setup=function(t){this._battler=t},Sprite_StateIcon.prototype.update=function(){Sprite.prototype.update.call(this),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updateIcon(),this.updateFrame(),this._animationCount=0)},Sprite_StateIcon.prototype.animationWait=function(){return 40},Sprite_StateIcon.prototype.updateIcon=function(){var t=[];this._battler&&this._battler.isAlive()&&(t=this._battler.allIcons()),0<t.length?(this._animationIndex++,this._animationIndex>=t.length&&(this._animationIndex=0),this._iconIndex=t[this._animationIndex]):this._iconIndex=this._animationIndex=0},Sprite_StateIcon.prototype.updateFrame=function(){var t=Sprite_StateIcon._iconWidth,e=Sprite_StateIcon._iconHeight;this.setFrame(this._iconIndex%16*t,Math.floor(this._iconIndex/16)*e,t,e)},Sprite_StateOverlay.prototype=Object.create(Sprite_Base.prototype),Sprite_StateOverlay.prototype.constructor=Sprite_StateOverlay,Sprite_StateOverlay.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.loadBitmap()},Sprite_StateOverlay.prototype.initMembers=function(){this._battler=null,this._pattern=this._animationCount=this._overlayIndex=0,this.anchor.x=.5,this.anchor.y=1},Sprite_StateOverlay.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("States"),this.setFrame(0,0,0,0)},Sprite_StateOverlay.prototype.setup=function(t){this._battler=t},Sprite_StateOverlay.prototype.update=function(){Sprite_Base.prototype.update.call(this),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)},Sprite_StateOverlay.prototype.animationWait=function(){return 8},Sprite_StateOverlay.prototype.updatePattern=function(){this._pattern++,this._pattern%=8,this._battler&&(this._overlayIndex=this._battler.stateOverlayIndex())},Sprite_StateOverlay.prototype.updateFrame=function(){0<this._overlayIndex?this.setFrame(96*this._pattern,96*(this._overlayIndex-1),96,96):this.setFrame(0,0,0,0)},Sprite_Weapon.prototype=Object.create(Sprite_Base.prototype),Sprite_Weapon.prototype.constructor=Sprite_Weapon,Sprite_Weapon.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this),this.initMembers()},Sprite_Weapon.prototype.initMembers=function(){this._pattern=this._animationCount=this._weaponImageId=0,this.anchor.x=.5,this.anchor.y=1,this.x=-16},Sprite_Weapon.prototype.setup=function(t){this._weaponImageId=t,this._pattern=this._animationCount=0,this.loadBitmap(),this.updateFrame()},Sprite_Weapon.prototype.update=function(){Sprite_Base.prototype.update.call(this),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)},Sprite_Weapon.prototype.animationWait=function(){return 12},Sprite_Weapon.prototype.updatePattern=function(){this._pattern++,3<=this._pattern&&(this._weaponImageId=0)},Sprite_Weapon.prototype.loadBitmap=function(){var t=Math.floor((this._weaponImageId-1)/12)+1;this.bitmap=1<=t?ImageManager.loadSystem("Weapons"+t):ImageManager.loadSystem("")},Sprite_Weapon.prototype.updateFrame=function(){if(0<this._weaponImageId){var t=(this._weaponImageId-1)%12;this.setFrame(96*(3*Math.floor(t/6)+this._pattern),64*Math.floor(t%6),96,64)}else this.setFrame(0,0,0,0)},Sprite_Weapon.prototype.isPlaying=function(){return 0<this._weaponImageId},Sprite_Balloon.prototype=Object.create(Sprite_Base.prototype),Sprite_Balloon.prototype.constructor=Sprite_Balloon,Sprite_Balloon.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.loadBitmap()},Sprite_Balloon.prototype.initMembers=function(){this._duration=this._balloonId=0,this.anchor.x=.5,this.anchor.y=1,this.z=7},Sprite_Balloon.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("Balloon"),this.setFrame(0,0,0,0)},Sprite_Balloon.prototype.setup=function(t){this._balloonId=t,this._duration=8*this.speed()+this.waitTime()},Sprite_Balloon.prototype.update=function(){Sprite_Base.prototype.update.call(this),0<this._duration&&(this._duration--,0<this._duration&&this.updateFrame())},Sprite_Balloon.prototype.updateFrame=function(){var t=48*this.frameIndex();this.setFrame(t,48*(this._balloonId-1),48,48)},Sprite_Balloon.prototype.speed=function(){return 8},Sprite_Balloon.prototype.waitTime=function(){return 12},Sprite_Balloon.prototype.frameIndex=function(){var t=(this._duration-this.waitTime())/this.speed();return 7-Math.max(Math.floor(t),0)},Sprite_Balloon.prototype.isPlaying=function(){return 0<this._duration},Sprite_Picture.prototype=Object.create(Sprite.prototype),Sprite_Picture.prototype.constructor=Sprite_Picture,Sprite_Picture.prototype.initialize=function(t){Sprite.prototype.initialize.call(this),this._pictureId=t,this._pictureName="",this._isPicture=!0,this.update()},Sprite_Picture.prototype.picture=function(){return $gameScreen.picture(this._pictureId)},Sprite_Picture.prototype.update=function(){Sprite.prototype.update.call(this),this.updateBitmap(),this.visible&&(this.updateOrigin(),this.updatePosition(),this.updateScale(),this.updateTone(),this.updateOther())},Sprite_Picture.prototype.updateBitmap=function(){var t=this.picture();t?(t=t.name(),this._pictureName!==t&&(this._pictureName=t,this.loadBitmap()),this.visible=!0):(this._pictureName="",this.bitmap=null,this.visible=!1)},Sprite_Picture.prototype.updateOrigin=function(){0===this.picture().origin()?(this.anchor.x=0,this.anchor.y=0):(this.anchor.x=.5,this.anchor.y=.5)},Sprite_Picture.prototype.updatePosition=function(){var t=this.picture();this.x=Math.floor(t.x()),this.y=Math.floor(t.y())},Sprite_Picture.prototype.updateScale=function(){var t=this.picture();this.scale.x=t.scaleX()/100,this.scale.y=t.scaleY()/100},Sprite_Picture.prototype.updateTone=function(){var t=this.picture();t.tone()?this.setColorTone(t.tone()):this.setColorTone([0,0,0,0])},Sprite_Picture.prototype.updateOther=function(){var t=this.picture();this.opacity=t.opacity(),this.blendMode=t.blendMode(),this.rotation=t.angle()*Math.PI/180},Sprite_Picture.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadPicture(this._pictureName)},Sprite_Timer.prototype=Object.create(Sprite.prototype),Sprite_Timer.prototype.constructor=Sprite_Timer,Sprite_Timer.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._seconds=0,this.createBitmap(),this.update()},Sprite_Timer.prototype.createBitmap=function(){this.bitmap=new Bitmap(96,48),this.bitmap.fontSize=32},Sprite_Timer.prototype.update=function(){Sprite.prototype.update.call(this),this.updateBitmap(),this.updatePosition(),this.updateVisibility()},Sprite_Timer.prototype.updateBitmap=function(){this._seconds!==$gameTimer.seconds()&&(this._seconds=$gameTimer.seconds(),this.redraw())},Sprite_Timer.prototype.redraw=function(){var t=this.timerText(),e=this.bitmap.width,i=this.bitmap.height;this.bitmap.clear(),this.bitmap.drawText(t,0,0,e,i,"center")},Sprite_Timer.prototype.timerText=function(){var t=this._seconds%60;return(Math.floor(this._seconds/60)%60).padZero(2)+":"+t.padZero(2)},Sprite_Timer.prototype.updatePosition=function(){this.x=Graphics.width-this.bitmap.width,this.y=0},Sprite_Timer.prototype.updateVisibility=function(){this.visible=$gameTimer.isWorking()},Sprite_Destination.prototype=Object.create(Sprite.prototype),Sprite_Destination.prototype.constructor=Sprite_Destination,Sprite_Destination.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this.createBitmap(),this._frameCount=0},Sprite_Destination.prototype.update=function(){Sprite.prototype.update.call(this),$gameTemp.isDestinationValid()?(this.updatePosition(),this.updateAnimation(),this.visible=!0):(this._frameCount=0,this.visible=!1)},Sprite_Destination.prototype.createBitmap=function(){var t=$gameMap.tileWidth(),e=$gameMap.tileHeight();this.bitmap=new Bitmap(t,e),this.bitmap.fillAll("white"),this.anchor.x=.5,this.anchor.y=.5,this.blendMode=Graphics.BLEND_ADD},Sprite_Destination.prototype.updatePosition=function(){var t=$gameMap.tileWidth(),e=$gameMap.tileHeight(),i=$gameTemp.destinationX(),a=$gameTemp.destinationY();this.x=($gameMap.adjustX(i)+.5)*t,this.y=($gameMap.adjustY(a)+.5)*e},Sprite_Destination.prototype.updateAnimation=function(){this._frameCount++,this._frameCount%=20,this.opacity=6*(20-this._frameCount),this.scale.x=1+this._frameCount/20,this.scale.y=this.scale.x},Spriteset_Base.prototype=Object.create(Sprite.prototype),Spriteset_Base.prototype.constructor=Spriteset_Base,Spriteset_Base.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this.setFrame(0,0,Graphics.width,Graphics.height),this._tone=[0,0,0,0],this.opaque=!0,this.createLowerLayer(),this.createToneChanger(),this.createUpperLayer(),this.update()},Spriteset_Base.prototype.createLowerLayer=function(){this.createBaseSprite()},Spriteset_Base.prototype.createUpperLayer=function(){this.createPictures(),this.createTimer(),this.createScreenSprites()},Spriteset_Base.prototype.update=function(){Sprite.prototype.update.call(this),this.updateScreenSprites(),this.updateToneChanger(),this.updatePosition()},Spriteset_Base.prototype.createBaseSprite=function(){this._baseSprite=new Sprite,this._baseSprite.setFrame(0,0,this.width,this.height),this._blackScreen=new ScreenSprite,this._blackScreen.opacity=255,this.addChild(this._baseSprite),this._baseSprite.addChild(this._blackScreen)},Spriteset_Base.prototype.createToneChanger=function(){Graphics.isWebGL()?this.createWebGLToneChanger():this.createCanvasToneChanger()},Spriteset_Base.prototype.createWebGLToneChanger=function(){var t=Graphics.width+96,e=Graphics.height+96;this._toneFilter=new ToneFilter,this._baseSprite.filters=[this._toneFilter],this._baseSprite.filterArea=new Rectangle(-48,-48,t,e)},Spriteset_Base.prototype.createCanvasToneChanger=function(){this._toneSprite=new ToneSprite,this.addChild(this._toneSprite)},Spriteset_Base.prototype.createPictures=function(){var t=Graphics.boxWidth,e=Graphics.boxHeight,i=(Graphics.width-t)/2,a=(Graphics.height-e)/2;for(this._pictureContainer=new Sprite,this._pictureContainer.setFrame(i,a,t,e),t=1;t<=$gameScreen.maxPictures();t++)this._pictureContainer.addChild(new Sprite_Picture(t));this.addChild(this._pictureContainer)},Spriteset_Base.prototype.createTimer=function(){this._timerSprite=new Sprite_Timer,this.addChild(this._timerSprite)},Spriteset_Base.prototype.createScreenSprites=function(){this._flashSprite=new ScreenSprite,this._fadeSprite=new ScreenSprite,this.addChild(this._flashSprite),this.addChild(this._fadeSprite)},Spriteset_Base.prototype.updateScreenSprites=function(){var t=$gameScreen.flashColor();this._flashSprite.setColor(t[0],t[1],t[2]),this._flashSprite.opacity=t[3],this._fadeSprite.opacity=255-$gameScreen.brightness()},Spriteset_Base.prototype.updateToneChanger=function(){var t=$gameScreen.tone();this._tone.equals(t)||(this._tone=t.clone(),Graphics.isWebGL()?this.updateWebGLToneChanger():this.updateCanvasToneChanger())},Spriteset_Base.prototype.updateWebGLToneChanger=function(){var t=this._tone;this._toneFilter.reset(),this._toneFilter.adjustTone(t[0],t[1],t[2]),this._toneFilter.adjustSaturation(-t[3])},Spriteset_Base.prototype.updateCanvasToneChanger=function(){var t=this._tone;this._toneSprite.setTone(t[0],t[1],t[2],t[3])},Spriteset_Base.prototype.updatePosition=function(){var t=$gameScreen,e=t.zoomScale();this.scale.x=e,this.scale.y=e,this.x=Math.round(-t.zoomX()*(e-1)),this.y=Math.round(-t.zoomY()*(e-1)),this.x+=Math.round(t.shake())},Spriteset_Map.prototype=Object.create(Spriteset_Base.prototype),Spriteset_Map.prototype.constructor=Spriteset_Map,Spriteset_Map.prototype.initialize=function(){Spriteset_Base.prototype.initialize.call(this)},Spriteset_Map.prototype.createLowerLayer=function(){Spriteset_Base.prototype.createLowerLayer.call(this),this.createParallax(),this.createTilemap(),this.createCharacters(),this.createShadow(),this.createDestination(),this.createWeather()},Spriteset_Map.prototype.update=function(){Spriteset_Base.prototype.update.call(this),this.updateTileset(),this.updateParallax(),this.updateTilemap(),this.updateShadow(),this.updateWeather()},Spriteset_Map.prototype.hideCharacters=function(){for(var t=0;t<this._characterSprites.length;t++){var e=this._characterSprites[t];e.isTile()||e.hide()}},Spriteset_Map.prototype.createParallax=function(){this._parallax=new TilingSprite,this._parallax.move(0,0,Graphics.width,Graphics.height),this._baseSprite.addChild(this._parallax)},Spriteset_Map.prototype.createTilemap=function(){Graphics.isWebGL()?this._tilemap=new ShaderTilemap:this._tilemap=new Tilemap,this._tilemap.tileWidth=$gameMap.tileWidth(),this._tilemap.tileHeight=$gameMap.tileHeight(),this._tilemap.setData($gameMap.width(),$gameMap.height(),$gameMap.data()),this._tilemap.horizontalWrap=$gameMap.isLoopHorizontal(),this._tilemap.verticalWrap=$gameMap.isLoopVertical(),this.loadTileset(),this._baseSprite.addChild(this._tilemap)},Spriteset_Map.prototype.loadTileset=function(){if(this._tileset=$gameMap.tileset()){for(var t=this._tileset.tilesetNames,e=0;e<t.length;e++)this._tilemap.bitmaps[e]=ImageManager.loadTileset(t[e]);t=$gameMap.tilesetFlags(),this._tilemap.refreshTileset(),this._tilemap.flags.equals(t)||this._tilemap.refresh(),this._tilemap.flags=t}},Spriteset_Map.prototype.createCharacters=function(){this._characterSprites=[],$gameMap.events().forEach(function(t){this._characterSprites.push(new Sprite_Character(t))},this),$gameMap.vehicles().forEach(function(t){this._characterSprites.push(new Sprite_Character(t))},this),$gamePlayer.followers().reverseEach(function(t){this._characterSprites.push(new Sprite_Character(t))},this),this._characterSprites.push(new Sprite_Character($gamePlayer));for(var t=0;t<this._characterSprites.length;t++)this._tilemap.addChild(this._characterSprites[t])},Spriteset_Map.prototype.createShadow=function(){this._shadowSprite=new Sprite,this._shadowSprite.bitmap=ImageManager.loadSystem("Shadow1"),this._shadowSprite.anchor.x=.5,this._shadowSprite.anchor.y=1,this._shadowSprite.z=6,this._tilemap.addChild(this._shadowSprite)},Spriteset_Map.prototype.createDestination=function(){this._destinationSprite=new Sprite_Destination,this._destinationSprite.z=9,this._tilemap.addChild(this._destinationSprite)},Spriteset_Map.prototype.createWeather=function(){this._weather=new Weather,this.addChild(this._weather)},Spriteset_Map.prototype.updateTileset=function(){this._tileset!==$gameMap.tileset()&&this.loadTileset()},Spriteset_Map.prototype._canvasReAddParallax=function(){var t=this._baseSprite.children.indexOf(this._parallax);this._baseSprite.removeChild(this._parallax),this._parallax=new TilingSprite,this._parallax.move(0,0,Graphics.width,Graphics.height),this._parallax.bitmap=ImageManager.loadParallax(this._parallaxName),this._baseSprite.addChildAt(this._parallax,t)},Spriteset_Map.prototype.updateParallax=function(){this._parallaxName!==$gameMap.parallaxName()&&(this._parallaxName=$gameMap.parallaxName(),this._parallax.bitmap&&1!=Graphics.isWebGL()?this._canvasReAddParallax():this._parallax.bitmap=ImageManager.loadParallax(this._parallaxName)),this._parallax.bitmap&&(this._parallax.origin.x=$gameMap.parallaxOx(),this._parallax.origin.y=$gameMap.parallaxOy())},Spriteset_Map.prototype.updateTilemap=function(){this._tilemap.origin.x=$gameMap.displayX()*$gameMap.tileWidth(),this._tilemap.origin.y=$gameMap.displayY()*$gameMap.tileHeight()},Spriteset_Map.prototype.updateShadow=function(){var t=$gameMap.airship();this._shadowSprite.x=t.shadowX(),this._shadowSprite.y=t.shadowY(),this._shadowSprite.opacity=t.shadowOpacity()},Spriteset_Map.prototype.updateWeather=function(){this._weather.type=$gameScreen.weatherType(),this._weather.power=$gameScreen.weatherPower(),this._weather.origin.x=$gameMap.displayX()*$gameMap.tileWidth(),this._weather.origin.y=$gameMap.displayY()*$gameMap.tileHeight()},Spriteset_Battle.prototype=Object.create(Spriteset_Base.prototype),Spriteset_Battle.prototype.constructor=Spriteset_Battle,Spriteset_Battle.prototype.initialize=function(){Spriteset_Base.prototype.initialize.call(this),this._battlebackLocated=!1},Spriteset_Battle.prototype.createLowerLayer=function(){Spriteset_Base.prototype.createLowerLayer.call(this),this.createBackground(),this.createBattleField(),this.createBattleback(),this.createEnemies(),this.createActors()},Spriteset_Battle.prototype.createBackground=function(){this._backgroundSprite=new Sprite,this._backgroundSprite.bitmap=SceneManager.backgroundBitmap(),this._baseSprite.addChild(this._backgroundSprite)},Spriteset_Battle.prototype.update=function(){Spriteset_Base.prototype.update.call(this),this.updateActors(),this.updateBattleback()},Spriteset_Battle.prototype.createBattleField=function(){var t=Graphics.boxWidth,e=Graphics.boxHeight,i=(Graphics.width-t)/2,a=(Graphics.height-e)/2;this._battleField=new Sprite,this._battleField.setFrame(i,a,t,e),this._battleField.x=i,this._battleField.y=a,this._baseSprite.addChild(this._battleField)},Spriteset_Battle.prototype.createBattleback=function(){var t=-this._battleField.x-32,e=-this._battleField.y-32,i=Graphics.width+64,a=Graphics.height+64;this._back1Sprite=new TilingSprite,this._back2Sprite=new TilingSprite,this._back1Sprite.bitmap=this.battleback1Bitmap(),this._back2Sprite.bitmap=this.battleback2Bitmap(),this._back1Sprite.move(t,e,i,a),this._back2Sprite.move(t,e,i,a),this._battleField.addChild(this._back1Sprite),this._battleField.addChild(this._back2Sprite)},Spriteset_Battle.prototype.updateBattleback=function(){this._battlebackLocated||(this.locateBattleback(),this._battlebackLocated=!0)},Spriteset_Battle.prototype.locateBattleback=function(){var t=this._battleField.width,e=this._battleField.height,i=this._back1Sprite,a=this._back2Sprite;i.origin.x=i.x+(i.bitmap.width-t)/2,a.origin.x=i.y+(a.bitmap.width-t)/2,$gameSystem.isSideView()&&(i.origin.y=i.x+i.bitmap.height-e,a.origin.y=i.y+a.bitmap.height-e)},Spriteset_Battle.prototype.battleback1Bitmap=function(){return ImageManager.loadBattleback1(this.battleback1Name())},Spriteset_Battle.prototype.battleback2Bitmap=function(){return ImageManager.loadBattleback2(this.battleback2Name())},Spriteset_Battle.prototype.battleback1Name=function(){return BattleManager.isBattleTest()?$dataSystem.battleback1Name:$gameMap.battleback1Name()?$gameMap.battleback1Name():$gameMap.isOverworld()?this.overworldBattleback1Name():""},Spriteset_Battle.prototype.battleback2Name=function(){return BattleManager.isBattleTest()?$dataSystem.battleback2Name:$gameMap.battleback2Name()?$gameMap.battleback2Name():$gameMap.isOverworld()?this.overworldBattleback2Name():""},Spriteset_Battle.prototype.overworldBattleback1Name=function(){return""===$gameMap.battleback1Name()?"":$gamePlayer.isInVehicle()?this.shipBattleback1Name():this.normalBattleback1Name()},Spriteset_Battle.prototype.overworldBattleback2Name=function(){return""===$gameMap.battleback2Name()?"":$gamePlayer.isInVehicle()?this.shipBattleback2Name():this.normalBattleback2Name()},Spriteset_Battle.prototype.normalBattleback1Name=function(){return this.terrainBattleback1Name(this.autotileType(1))||this.terrainBattleback1Name(this.autotileType(0))||this.defaultBattleback1Name()},Spriteset_Battle.prototype.normalBattleback2Name=function(){return this.terrainBattleback2Name(this.autotileType(1))||this.terrainBattleback2Name(this.autotileType(0))||this.defaultBattleback2Name()},Spriteset_Battle.prototype.terrainBattleback1Name=function(t){switch(t){case 24:case 25:return"Wasteland";case 26:case 27:return"DirtField";case 32:case 33:return"Desert";case 34:return"Lava1";case 35:return"Lava2";case 40:case 41:return"Snowfield";case 42:return"Clouds";case 4:case 5:return"PoisonSwamp";default:return null}},Spriteset_Battle.prototype.terrainBattleback2Name=function(t){switch(t){case 20:case 21:return"Forest";case 22:case 30:case 38:return"Cliff";case 24:case 25:case 26:case 27:return"Wasteland";case 32:case 33:return"Desert";case 34:case 35:return"Lava";case 40:case 41:return"Snowfield";case 42:return"Clouds";case 4:case 5:return"PoisonSwamp"}},Spriteset_Battle.prototype.defaultBattleback1Name=function(){return"Grassland"},Spriteset_Battle.prototype.defaultBattleback2Name=function(){return"Grassland"},Spriteset_Battle.prototype.shipBattleback1Name=function(){return"Ship"},Spriteset_Battle.prototype.shipBattleback2Name=function(){return"Ship"},Spriteset_Battle.prototype.autotileType=function(t){return $gameMap.autotileType($gamePlayer.x,$gamePlayer.y,t)},Spriteset_Battle.prototype.createEnemies=function(){for(var t=$gameTroop.members(),e=[],i=0;i<t.length;i++)e[i]=new Sprite_Enemy(t[i]);for(e.sort(this.compareEnemySprite.bind(this)),t=0;t<e.length;t++)this._battleField.addChild(e[t]);this._enemySprites=e},Spriteset_Battle.prototype.compareEnemySprite=function(t,e){return t.y!==e.y?t.y-e.y:e.spriteId-t.spriteId},Spriteset_Battle.prototype.createActors=function(){this._actorSprites=[];for(var t=0;t<$gameParty.maxBattleMembers();t++)this._actorSprites[t]=new Sprite_Actor,this._battleField.addChild(this._actorSprites[t])},Spriteset_Battle.prototype.updateActors=function(){for(var t=$gameParty.battleMembers(),e=0;e<this._actorSprites.length;e++)this._actorSprites[e].setBattler(t[e])},Spriteset_Battle.prototype.battlerSprites=function(){return this._enemySprites.concat(this._actorSprites)},Spriteset_Battle.prototype.isAnimationPlaying=function(){return this.battlerSprites().some(function(t){return t.isAnimationPlaying()})},Spriteset_Battle.prototype.isEffecting=function(){return this.battlerSprites().some(function(t){return t.isEffecting()})},Spriteset_Battle.prototype.isAnyoneMoving=function(){return this.battlerSprites().some(function(t){return t.isMoving()})},Spriteset_Battle.prototype.isBusy=function(){return this.isAnimationPlaying()||this.isAnyoneMoving()},Window_Base.prototype=Object.create(Window.prototype),Window_Base.prototype.constructor=Window_Base,Window_Base.prototype.initialize=function(t,e,i,a){Window.prototype.initialize.call(this),this.loadWindowskin(),this.move(t,e,i,a),this.updatePadding(),this.updateBackOpacity(),this.updateTone(),this.createContents(),this._closing=this._opening=!1,this._dimmerSprite=null},Window_Base._iconWidth=32,Window_Base._iconHeight=32,Window_Base._faceWidth=144,Window_Base._faceHeight=144,Window_Base.prototype.lineHeight=function(){return 36},Window_Base.prototype.standardFontFace=function(){return $gameSystem.isChinese()?"SimHei, Heiti TC, sans-serif":$gameSystem.isKorean()?"Dotum, AppleGothic, sans-serif":"GameFont"},Window_Base.prototype.standardFontSize=function(){return 28},Window_Base.prototype.standardPadding=function(){return 18},Window_Base.prototype.textPadding=function(){return 6},Window_Base.prototype.standardBackOpacity=function(){return 192},Window_Base.prototype.loadWindowskin=function(){this.windowskin=ImageManager.loadSystem("Window")},Window_Base.prototype.updatePadding=function(){this.padding=this.standardPadding()},Window_Base.prototype.updateBackOpacity=function(){this.backOpacity=this.standardBackOpacity()},Window_Base.prototype.contentsWidth=function(){return this.width-2*this.standardPadding()},Window_Base.prototype.contentsHeight=function(){return this.height-2*this.standardPadding()},Window_Base.prototype.fittingHeight=function(t){return t*this.lineHeight()+2*this.standardPadding()},Window_Base.prototype.updateTone=function(){var t=$gameSystem.windowTone();this.setTone(t[0],t[1],t[2])},Window_Base.prototype.createContents=function(){this.contents=new Bitmap(this.contentsWidth(),this.contentsHeight()),this.resetFontSettings()},Window_Base.prototype.resetFontSettings=function(){this.contents.fontFace=this.standardFontFace(),this.contents.fontSize=this.standardFontSize(),this.resetTextColor()},Window_Base.prototype.resetTextColor=function(){this.changeTextColor(this.normalColor())},Window_Base.prototype.update=function(){Window.prototype.update.call(this),this.updateTone(),this.updateOpen(),this.updateClose(),this.updateBackgroundDimmer()},Window_Base.prototype.updateOpen=function(){this._opening&&(this.openness+=32,this.isOpen()&&(this._opening=!1))},Window_Base.prototype.updateClose=function(){this._closing&&(this.openness-=32,this.isClosed()&&(this._closing=!1))},Window_Base.prototype.open=function(){this.isOpen()||(this._opening=!0),this._closing=!1},Window_Base.prototype.close=function(){this.isClosed()||(this._closing=!0),this._opening=!1},Window_Base.prototype.isOpening=function(){return this._opening},Window_Base.prototype.isClosing=function(){return this._closing},Window_Base.prototype.show=function(){this.visible=!0},Window_Base.prototype.hide=function(){this.visible=!1},Window_Base.prototype.activate=function(){this.active=!0},Window_Base.prototype.deactivate=function(){this.active=!1},Window_Base.prototype.textColor=function(t){return this.windowskin.getPixel(t%8*12+102,12*Math.floor(t/8)+150)},Window_Base.prototype.normalColor=function(){return this.textColor(0)},Window_Base.prototype.systemColor=function(){return this.textColor(16)},Window_Base.prototype.crisisColor=function(){return this.textColor(17)},Window_Base.prototype.deathColor=function(){return this.textColor(18)},Window_Base.prototype.gaugeBackColor=function(){return this.textColor(19)},Window_Base.prototype.hpGaugeColor1=function(){return this.textColor(20)},Window_Base.prototype.hpGaugeColor2=function(){return this.textColor(21)},Window_Base.prototype.mpGaugeColor1=function(){return this.textColor(22)},Window_Base.prototype.mpGaugeColor2=function(){return this.textColor(23)},Window_Base.prototype.mpCostColor=function(){return this.textColor(23)},Window_Base.prototype.powerUpColor=function(){return this.textColor(24)},Window_Base.prototype.powerDownColor=function(){return this.textColor(25)},Window_Base.prototype.tpGaugeColor1=function(){return this.textColor(28)},Window_Base.prototype.tpGaugeColor2=function(){return this.textColor(29)},Window_Base.prototype.tpCostColor=function(){return this.textColor(29)},Window_Base.prototype.pendingColor=function(){return this.windowskin.getPixel(120,120)},Window_Base.prototype.translucentOpacity=function(){return 160},Window_Base.prototype.changeTextColor=function(t){this.contents.textColor=t},Window_Base.prototype.changePaintOpacity=function(t){this.contents.paintOpacity=t?255:this.translucentOpacity()},Window_Base.prototype.drawText=function(t,e,i,a,n){this.contents.drawText(t,e,i,a,this.lineHeight(),n)},Window_Base.prototype.textWidth=function(t){return this.contents.measureTextWidth(t)},Window_Base.prototype.drawTextEx=function(t,e,i){if(t){for((i={index:0,x:e,y:i,left:e}).text=this.convertEscapeCharacters(t),i.height=this.calcTextHeight(i,!1),this.resetFontSettings();i.index<i.text.length;)this.processCharacter(i);return i.x-e}return 0},Window_Base.prototype.convertEscapeCharacters=function(t){return(t=(t=(t=(t=(t=(t=t.replace(/\\/g,"")).replace(/\x1b\x1b/g,"\\")).replace(/\x1bV\[(\d+)\]/gi,function(t,e){return $gameVariables.value(parseInt(e))}.bind(this))).replace(/\x1bV\[(\d+)\]/gi,function(t,e){return $gameVariables.value(parseInt(e))}.bind(this))).replace(/\x1bN\[(\d+)\]/gi,function(t,e){return this.actorName(parseInt(e))}.bind(this))).replace(/\x1bP\[(\d+)\]/gi,function(t,e){return this.partyMemberName(parseInt(e))}.bind(this))).replace(/\x1bG/gi,TextManager.currencyUnit)},Window_Base.prototype.actorName=function(t){return(t=1<=t?$gameActors.actor(t):null)?t.name():""},Window_Base.prototype.partyMemberName=function(t){return(t=1<=t?$gameParty.members()[t-1]:null)?t.name():""},Window_Base.prototype.processCharacter=function(t){switch(t.text[t.index]){case"\n":this.processNewLine(t);break;case"\f":this.processNewPage(t);break;case"":this.processEscapeCharacter(this.obtainEscapeCode(t),t);break;default:this.processNormalCharacter(t)}},Window_Base.prototype.processNormalCharacter=function(t){var e=t.text[t.index++],i=this.textWidth(e);this.contents.drawText(e,t.x,t.y,2*i,t.height),t.x+=i},Window_Base.prototype.processNewLine=function(t){t.x=t.left,t.y+=t.height,t.height=this.calcTextHeight(t,!1),t.index++},Window_Base.prototype.processNewPage=function(t){t.index++},Window_Base.prototype.obtainEscapeCode=function(t){t.index++;var e=/^[\$\.\|\^!><\{\}\\]|^[A-Z]+/i.exec(t.text.slice(t.index));return e?(t.index+=e[0].length,e[0].toUpperCase()):""},Window_Base.prototype.obtainEscapeParam=function(t){var e=/^\[\d+\]/.exec(t.text.slice(t.index));return e?(t.index+=e[0].length,parseInt(e[0].slice(1))):""},Window_Base.prototype.processEscapeCharacter=function(t,e){switch(t){case"C":this.changeTextColor(this.textColor(this.obtainEscapeParam(e)));break;case"I":this.processDrawIcon(this.obtainEscapeParam(e),e);break;case"{":this.makeFontBigger();break;case"}":this.makeFontSmaller()}},Window_Base.prototype.processDrawIcon=function(t,e){this.drawIcon(t,e.x+2,e.y+2),e.x+=Window_Base._iconWidth+4},Window_Base.prototype.makeFontBigger=function(){this.contents.fontSize<=96&&(this.contents.fontSize+=12)},Window_Base.prototype.makeFontSmaller=function(){24<=this.contents.fontSize&&(this.contents.fontSize-=12)},Window_Base.prototype.calcTextHeight=function(t,e){var i=this.contents.fontSize,a=0;t=t.text.slice(t.index).split("\n"),e=e?t.length:1;for(var n=0;n<e;n++){for(var o=this.contents.fontSize,r=/\x1b[\{\}]/g;;){var s=r.exec(t[n]);if(!s)break;"{"===s[0]&&this.makeFontBigger(),"}"===s[0]&&this.makeFontSmaller(),o<this.contents.fontSize&&(o=this.contents.fontSize)}a+=o+8}return this.contents.fontSize=i,a},Window_Base.prototype.drawIcon=function(t,e,i){var a=ImageManager.loadSystem("IconSet"),n=Window_Base._iconWidth,o=Window_Base._iconHeight;this.contents.blt(a,t%16*n,Math.floor(t/16)*o,n,o,e,i)},Window_Base.prototype.drawFace=function(t,e,i,a,n,o){n=n||Window_Base._faceWidth,o=o||Window_Base._faceHeight,t=ImageManager.loadFace(t);var r=Window_Base._faceWidth,s=Window_Base._faceHeight,h=Math.min(n,r),p=Math.min(o,s);this.contents.blt(t,e%4*r+(r-h)/2,Math.floor(e/4)*s+(s-p)/2,h,p,Math.floor(i+Math.max(n-r,0)/2),Math.floor(a+Math.max(o-s,0)/2))},Window_Base.prototype.drawCharacter=function(t,e,i,a){var n=ImageManager.loadCharacter(t),o=ImageManager.isBigCharacter(t);t=n.width/(o?3:12),o=n.height/(o?4:8),this.contents.blt(n,(e%4*3+1)*t,4*Math.floor(e/4)*o,t,o,i-t/2,a-o)},Window_Base.prototype.drawGauge=function(t,e,i,a,n,o){a=Math.floor(i*a),e=e+this.lineHeight()-8,this.contents.fillRect(t,e,i,6,this.gaugeBackColor()),this.contents.gradientFillRect(t,e,a,6,n,o)},Window_Base.prototype.hpColor=function(t){return t.isDead()?this.deathColor():t.isDying()?this.crisisColor():this.normalColor()},Window_Base.prototype.mpColor=function(t){return this.normalColor()},Window_Base.prototype.tpColor=function(t){return this.normalColor()},Window_Base.prototype.drawActorCharacter=function(t,e,i){this.drawCharacter(t.characterName(),t.characterIndex(),e,i)},Window_Base.prototype.drawActorFace=function(t,e,i,a,n){this.drawFace(t.faceName(),t.faceIndex(),e,i,a,n)},Window_Base.prototype.drawActorName=function(t,e,i,a){a=a||168,this.changeTextColor(this.hpColor(t)),this.drawText(t.name(),e,i,a)},Window_Base.prototype.drawActorClass=function(t,e,i,a){a=a||168,this.resetTextColor(),this.drawText(t.currentClass().name,e,i,a)},Window_Base.prototype.drawActorNickname=function(t,e,i,a){a=a||270,this.resetTextColor(),this.drawText(t.nickname(),e,i,a)},Window_Base.prototype.drawActorLevel=function(t,e,i){this.changeTextColor(this.systemColor()),this.drawText(TextManager.levelA,e,i,48),this.resetTextColor(),this.drawText(t.level,e+84,i,36,"right")},Window_Base.prototype.drawActorIcons=function(t,e,i,a){for(a=a||144,t=t.allIcons().slice(0,Math.floor(a/Window_Base._iconWidth)),a=0;a<t.length;a++)this.drawIcon(t[a],e+Window_Base._iconWidth*a,i+2)},Window_Base.prototype.drawCurrentAndMax=function(t,e,i,a,n,o,r){var s=this.textWidth("HP"),h=this.textWidth("0000"),p=this.textWidth("/"),c=(n=i+n-h)-p,u=c-h;i+s<=u?(this.changeTextColor(o),this.drawText(t,u,a,h,"right"),this.changeTextColor(r),this.drawText("/",c,a,p,"right"),this.drawText(e,n,a,h,"right")):(this.changeTextColor(o),this.drawText(t,n,a,h,"right"))},Window_Base.prototype.drawActorHp=function(t,e,i,a){a=a||186;var n=this.hpGaugeColor1(),o=this.hpGaugeColor2();this.drawGauge(e,i,a,t.hpRate(),n,o),this.changeTextColor(this.systemColor()),this.drawText(TextManager.hpA,e,i,44),this.drawCurrentAndMax(t.hp,t.mhp,e,i,a,this.hpColor(t),this.normalColor())},Window_Base.prototype.drawActorMp=function(t,e,i,a){a=a||186;var n=this.mpGaugeColor1(),o=this.mpGaugeColor2();this.drawGauge(e,i,a,t.mpRate(),n,o),this.changeTextColor(this.systemColor()),this.drawText(TextManager.mpA,e,i,44),this.drawCurrentAndMax(t.mp,t.mmp,e,i,a,this.mpColor(t),this.normalColor())},Window_Base.prototype.drawActorTp=function(t,e,i,a){a=a||96;var n=this.tpGaugeColor1(),o=this.tpGaugeColor2();this.drawGauge(e,i,a,t.tpRate(),n,o),this.changeTextColor(this.systemColor()),this.drawText(TextManager.tpA,e,i,44),this.changeTextColor(this.tpColor(t)),this.drawText(t.tp,e+a-64,i,64,"right")},Window_Base.prototype.drawActorSimpleStatus=function(t,e,i,a){var n=this.lineHeight(),o=e+180;a=Math.min(200,a-180-this.textPadding()),this.drawActorName(t,e,i),this.drawActorLevel(t,e,i+1*n),this.drawActorIcons(t,e,i+2*n),this.drawActorClass(t,o,i),this.drawActorHp(t,o,i+1*n,a),this.drawActorMp(t,o,i+2*n,a)},Window_Base.prototype.drawItemName=function(t,e,i,a){if(a=a||312,t){var n=Window_Base._iconWidth+4;this.resetTextColor(),this.drawIcon(t.iconIndex,e+2,i+2),this.drawText(t.name,e+n,i,a-n)}},Window_Base.prototype.drawCurrencyValue=function(t,e,i,a,n){var o=Math.min(80,this.textWidth(e));this.resetTextColor(),this.drawText(t,i,a,n-o-6,"right"),this.changeTextColor(this.systemColor()),this.drawText(e,i+n-o,a,o,"right")},Window_Base.prototype.paramchangeTextColor=function(t){return 0<t?this.powerUpColor():t<0?this.powerDownColor():this.normalColor()},Window_Base.prototype.setBackgroundType=function(t){this.opacity=0===t?255:0,1===t?this.showBackgroundDimmer():this.hideBackgroundDimmer()},Window_Base.prototype.showBackgroundDimmer=function(){this._dimmerSprite||(this._dimmerSprite=new Sprite,this._dimmerSprite.bitmap=new Bitmap(0,0),this.addChildToBack(this._dimmerSprite));var t=this._dimmerSprite.bitmap;t.width===this.width&&t.height===this.height||this.refreshDimmerBitmap(),this._dimmerSprite.visible=!0,this.updateBackgroundDimmer()},Window_Base.prototype.hideBackgroundDimmer=function(){this._dimmerSprite&&(this._dimmerSprite.visible=!1)},Window_Base.prototype.updateBackgroundDimmer=function(){this._dimmerSprite&&(this._dimmerSprite.opacity=this.openness)},Window_Base.prototype.refreshDimmerBitmap=function(){if(this._dimmerSprite){var t=this._dimmerSprite.bitmap,e=this.width,i=this.height,a=this.padding,n=this.dimColor1(),o=this.dimColor2();t.resize(e,i),t.gradientFillRect(0,0,e,a,o,n,!0),t.fillRect(0,a,e,i-2*a,n),t.gradientFillRect(0,i-a,e,a,n,o,!0),this._dimmerSprite.setFrame(0,0,e,i)}},Window_Base.prototype.dimColor1=function(){return"rgba(0, 0, 0, 0.6)"},Window_Base.prototype.dimColor2=function(){return"rgba(0, 0, 0, 0)"},Window_Base.prototype.canvasToLocalX=function(t){for(var e=this;e;)t-=e.x,e=e.parent;return t},Window_Base.prototype.canvasToLocalY=function(t){for(var e=this;e;)t-=e.y,e=e.parent;return t},Window_Base.prototype.reserveFaceImages=function(){$gameParty.members().forEach(function(t){ImageManager.reserveFace(t.faceName())},this)},Window_Selectable.prototype=Object.create(Window_Base.prototype),Window_Selectable.prototype.constructor=Window_Selectable,Window_Selectable.prototype.initialize=function(t,e,i,a){Window_Base.prototype.initialize.call(this,t,e,i,a),this._index=-1,this._cursorAll=this._cursorFixed=!1,this._stayCount=0,this._helpWindow=null,this._handlers={},this._touching=!1,this._scrollY=this._scrollX=0,this.deactivate()},Window_Selectable.prototype.index=function(){return this._index},Window_Selectable.prototype.cursorFixed=function(){return this._cursorFixed},Window_Selectable.prototype.setCursorFixed=function(t){this._cursorFixed=t},Window_Selectable.prototype.cursorAll=function(){return this._cursorAll},Window_Selectable.prototype.setCursorAll=function(t){this._cursorAll=t},Window_Selectable.prototype.maxCols=function(){return 1},Window_Selectable.prototype.maxItems=function(){return 0},Window_Selectable.prototype.spacing=function(){return 12},Window_Selectable.prototype.itemWidth=function(){return Math.floor((this.width-2*this.padding+this.spacing())/this.maxCols()-this.spacing())},Window_Selectable.prototype.itemHeight=function(){return this.lineHeight()},Window_Selectable.prototype.maxRows=function(){return Math.max(Math.ceil(this.maxItems()/this.maxCols()),1)},Window_Selectable.prototype.activate=function(){Window_Base.prototype.activate.call(this),this.reselect()},Window_Selectable.prototype.deactivate=function(){Window_Base.prototype.deactivate.call(this),this.reselect()},Window_Selectable.prototype.select=function(t){this._index=t,this._stayCount=0,this.ensureCursorVisible(),this.updateCursor(),this.callUpdateHelp()},Window_Selectable.prototype.deselect=function(){this.select(-1)},Window_Selectable.prototype.reselect=function(){this.select(this._index)},Window_Selectable.prototype.row=function(){return Math.floor(this.index()/this.maxCols())},Window_Selectable.prototype.topRow=function(){return Math.floor(this._scrollY/this.itemHeight())},Window_Selectable.prototype.maxTopRow=function(){return Math.max(0,this.maxRows()-this.maxPageRows())},Window_Selectable.prototype.setTopRow=function(t){t=t.clamp(0,this.maxTopRow())*this.itemHeight(),this._scrollY!==t&&(this._scrollY=t,this.refresh(),this.updateCursor())},Window_Selectable.prototype.resetScroll=function(){this.setTopRow(0)},Window_Selectable.prototype.maxPageRows=function(){return Math.floor((this.height-2*this.padding)/this.itemHeight())},Window_Selectable.prototype.maxPageItems=function(){return this.maxPageRows()*this.maxCols()},Window_Selectable.prototype.isHorizontal=function(){return 1===this.maxPageRows()},Window_Selectable.prototype.bottomRow=function(){return Math.max(0,this.topRow()+this.maxPageRows()-1)},Window_Selectable.prototype.setBottomRow=function(t){this.setTopRow(t-(this.maxPageRows()-1))},Window_Selectable.prototype.topIndex=function(){return this.topRow()*this.maxCols()},Window_Selectable.prototype.itemRect=function(t){var e=new Rectangle,i=this.maxCols();return e.width=this.itemWidth(),e.height=this.itemHeight(),e.x=t%i*(e.width+this.spacing())-this._scrollX,e.y=Math.floor(t/i)*e.height-this._scrollY,e},Window_Selectable.prototype.itemRectForText=function(t){return(t=this.itemRect(t)).x+=this.textPadding(),t.width-=2*this.textPadding(),t},Window_Selectable.prototype.setHelpWindow=function(t){this._helpWindow=t,this.callUpdateHelp()},Window_Selectable.prototype.showHelpWindow=function(){this._helpWindow&&this._helpWindow.show()},Window_Selectable.prototype.hideHelpWindow=function(){this._helpWindow&&this._helpWindow.hide()},Window_Selectable.prototype.setHandler=function(t,e){this._handlers[t]=e},Window_Selectable.prototype.isHandled=function(t){return!!this._handlers[t]},Window_Selectable.prototype.callHandler=function(t){this.isHandled(t)&&this._handlers[t]()},Window_Selectable.prototype.isOpenAndActive=function(){return this.isOpen()&&this.active},Window_Selectable.prototype.isCursorMovable=function(){return this.isOpenAndActive()&&!this._cursorFixed&&!this._cursorAll&&0<this.maxItems()},Window_Selectable.prototype.cursorDown=function(t){var e=this.index(),i=this.maxItems(),a=this.maxCols();(e<i-a||t&&1===a)&&this.select((e+a)%i)},Window_Selectable.prototype.cursorUp=function(t){var e=this.index(),i=this.maxItems(),a=this.maxCols();(a<=e||t&&1===a)&&this.select((e-a+i)%i)},Window_Selectable.prototype.cursorRight=function(t){var e=this.index(),i=this.maxItems();2<=this.maxCols()&&(e<i-1||t&&this.isHorizontal())&&this.select((e+1)%i)},Window_Selectable.prototype.cursorLeft=function(t){var e=this.index(),i=this.maxItems();2<=this.maxCols()&&(0<e||t&&this.isHorizontal())&&this.select((e-1+i)%i)},Window_Selectable.prototype.cursorPagedown=function(){var t=this.index(),e=this.maxItems();this.topRow()+this.maxPageRows()<this.maxRows()&&(this.setTopRow(this.topRow()+this.maxPageRows()),this.select(Math.min(t+this.maxPageItems(),e-1)))},Window_Selectable.prototype.cursorPageup=function(){var t=this.index();0<this.topRow()&&(this.setTopRow(this.topRow()-this.maxPageRows()),this.select(Math.max(t-this.maxPageItems(),0)))},Window_Selectable.prototype.scrollDown=function(){this.topRow()+1<this.maxRows()&&this.setTopRow(this.topRow()+1)},Window_Selectable.prototype.scrollUp=function(){0<this.topRow()&&this.setTopRow(this.topRow()-1)},Window_Selectable.prototype.update=function(){Window_Base.prototype.update.call(this),this.updateArrows(),this.processCursorMove(),this.processHandling(),this.processWheel(),this.processTouch(),this._stayCount++},Window_Selectable.prototype.updateArrows=function(){var t=this.topRow(),e=this.maxTopRow();this.downArrowVisible=0<e&&t<e,this.upArrowVisible=0<t},Window_Selectable.prototype.processCursorMove=function(){if(this.isCursorMovable()){var t=this.index();Input.isRepeated("down")&&this.cursorDown(Input.isTriggered("down")),Input.isRepeated("up")&&this.cursorUp(Input.isTriggered("up")),Input.isRepeated("right")&&this.cursorRight(Input.isTriggered("right")),Input.isRepeated("left")&&this.cursorLeft(Input.isTriggered("left")),!this.isHandled("pagedown")&&Input.isTriggered("pagedown")&&this.cursorPagedown(),!this.isHandled("pageup")&&Input.isTriggered("pageup")&&this.cursorPageup(),this.index()!==t&&SoundManager.playCursor()}},Window_Selectable.prototype.processHandling=function(){this.isOpenAndActive()&&(this.isOkEnabled()&&this.isOkTriggered()?this.processOk():this.isCancelEnabled()&&this.isCancelTriggered()?this.processCancel():this.isHandled("pagedown")&&Input.isTriggered("pagedown")?this.processPagedown():this.isHandled("pageup")&&Input.isTriggered("pageup")&&this.processPageup())},Window_Selectable.prototype.processWheel=function(){this.isOpenAndActive()&&(20<=TouchInput.wheelY&&this.scrollDown(),TouchInput.wheelY<=-20&&this.scrollUp())},Window_Selectable.prototype.processTouch=function(){this.isOpenAndActive()?(TouchInput.isTriggered()&&this.isTouchedInsideFrame()?(this._touching=!0,this.onTouch(!0)):TouchInput.isCancelled()&&this.isCancelEnabled()&&this.processCancel(),this._touching&&(TouchInput.isPressed()?this.onTouch(!1):this._touching=!1)):this._touching=!1},Window_Selectable.prototype.isTouchedInsideFrame=function(){var t=this.canvasToLocalX(TouchInput.x),e=this.canvasToLocalY(TouchInput.y);return 0<=t&&0<=e&&t<this.width&&e<this.height},Window_Selectable.prototype.onTouch=function(t){var e=this.index(),i=this.canvasToLocalX(TouchInput.x),a=this.canvasToLocalY(TouchInput.y);0<=(i=this.hitTest(i,a))?i===this.index()?t&&this.isTouchOkEnabled()&&this.processOk():this.isCursorMovable()&&this.select(i):10<=this._stayCount&&(a<this.padding?this.cursorUp():a>=this.height-this.padding&&this.cursorDown()),this.index()!==e&&SoundManager.playCursor()},Window_Selectable.prototype.hitTest=function(t,e){if(this.isContentsArea(t,e)){t-=this.padding,e-=this.padding;for(var i=this.topIndex(),a=0;a<this.maxPageItems();a++){var n=i+a;if(n<this.maxItems()){var o=this.itemRect(n),r=o.x+o.width,s=o.y+o.height;if(t>=o.x&&e>=o.y&&t<r&&e<s)return n}}}return-1},Window_Selectable.prototype.isContentsArea=function(t,e){var i=this.padding,a=this.width-this.padding,n=this.height-this.padding;return t>=this.padding&&i<=e&&t<a&&e<n},Window_Selectable.prototype.isTouchOkEnabled=function(){return this.isOkEnabled()},Window_Selectable.prototype.isOkEnabled=function(){return this.isHandled("ok")},Window_Selectable.prototype.isCancelEnabled=function(){return this.isHandled("cancel")},Window_Selectable.prototype.isOkTriggered=function(){return Input.isRepeated("ok")},Window_Selectable.prototype.isCancelTriggered=function(){return Input.isRepeated("cancel")},Window_Selectable.prototype.processOk=function(){this.isCurrentItemEnabled()?(this.playOkSound(),this.updateInputData(),this.deactivate(),this.callOkHandler()):this.playBuzzerSound()},Window_Selectable.prototype.playOkSound=function(){SoundManager.playOk()},Window_Selectable.prototype.playBuzzerSound=function(){SoundManager.playBuzzer()},Window_Selectable.prototype.callOkHandler=function(){this.callHandler("ok")},Window_Selectable.prototype.processCancel=function(){SoundManager.playCancel(),this.updateInputData(),this.deactivate(),this.callCancelHandler()},Window_Selectable.prototype.callCancelHandler=function(){this.callHandler("cancel")},Window_Selectable.prototype.processPageup=function(){SoundManager.playCursor(),this.updateInputData(),this.deactivate(),this.callHandler("pageup")},Window_Selectable.prototype.processPagedown=function(){SoundManager.playCursor(),this.updateInputData(),this.deactivate(),this.callHandler("pagedown")},Window_Selectable.prototype.updateInputData=function(){Input.update(),TouchInput.update()},Window_Selectable.prototype.updateCursor=function(){if(this._cursorAll){var t=this.maxRows()*this.itemHeight();this.setCursorRect(0,0,this.contents.width,t),this.setTopRow(0)}else this.isCursorVisible()?(t=this.itemRect(this.index()),this.setCursorRect(t.x,t.y,t.width,t.height)):this.setCursorRect(0,0,0,0)},Window_Selectable.prototype.isCursorVisible=function(){var t=this.row();return t>=this.topRow()&&t<=this.bottomRow()},Window_Selectable.prototype.ensureCursorVisible=function(){var t=this.row();t<this.topRow()?this.setTopRow(t):t>this.bottomRow()&&this.setBottomRow(t)},Window_Selectable.prototype.callUpdateHelp=function(){this.active&&this._helpWindow&&this.updateHelp()},Window_Selectable.prototype.updateHelp=function(){this._helpWindow.clear()},Window_Selectable.prototype.setHelpWindowItem=function(t){this._helpWindow&&this._helpWindow.setItem(t)},Window_Selectable.prototype.isCurrentItemEnabled=function(){return!0},Window_Selectable.prototype.drawAllItems=function(){for(var t=this.topIndex(),e=0;e<this.maxPageItems();e++){var i=t+e;i<this.maxItems()&&this.drawItem(i)}},Window_Selectable.prototype.drawItem=function(t){},Window_Selectable.prototype.clearItem=function(t){t=this.itemRect(t),this.contents.clearRect(t.x,t.y,t.width,t.height)},Window_Selectable.prototype.redrawItem=function(t){0<=t&&(this.clearItem(t),this.drawItem(t))},Window_Selectable.prototype.redrawCurrentItem=function(){this.redrawItem(this.index())},Window_Selectable.prototype.refresh=function(){this.contents&&(this.contents.clear(),this.drawAllItems())},Window_Command.prototype=Object.create(Window_Selectable.prototype),Window_Command.prototype.constructor=Window_Command,Window_Command.prototype.initialize=function(t,e){this.clearCommandList(),this.makeCommandList();var i=this.windowWidth(),a=this.windowHeight();Window_Selectable.prototype.initialize.call(this,t,e,i,a),this.refresh(),this.select(0),this.activate()},Window_Command.prototype.windowWidth=function(){return 240},Window_Command.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())},Window_Command.prototype.numVisibleRows=function(){return Math.ceil(this.maxItems()/this.maxCols())},Window_Command.prototype.maxItems=function(){return this._list.length},Window_Command.prototype.clearCommandList=function(){this._list=[]},Window_Command.prototype.makeCommandList=function(){},Window_Command.prototype.addCommand=function(t,e,i,a){void 0===i&&(i=!0),void 0===a&&(a=null),this._list.push({name:t,symbol:e,enabled:i,ext:a})},Window_Command.prototype.commandName=function(t){return this._list[t].name},Window_Command.prototype.commandSymbol=function(t){return this._list[t].symbol},Window_Command.prototype.isCommandEnabled=function(t){return this._list[t].enabled},Window_Command.prototype.currentData=function(){return 0<=this.index()?this._list[this.index()]:null},Window_Command.prototype.isCurrentItemEnabled=function(){return!!this.currentData()&&this.currentData().enabled},Window_Command.prototype.currentSymbol=function(){return this.currentData()?this.currentData().symbol:null},Window_Command.prototype.currentExt=function(){return this.currentData()?this.currentData().ext:null},Window_Command.prototype.findSymbol=function(t){for(var e=0;e<this._list.length;e++)if(this._list[e].symbol===t)return e;return-1},Window_Command.prototype.selectSymbol=function(t){0<=(t=this.findSymbol(t))?this.select(t):this.select(0)},Window_Command.prototype.findExt=function(t){for(var e=0;e<this._list.length;e++)if(this._list[e].ext===t)return e;return-1},Window_Command.prototype.selectExt=function(t){0<=(t=this.findExt(t))?this.select(t):this.select(0)},Window_Command.prototype.drawItem=function(t){var e=this.itemRectForText(t),i=this.itemTextAlign();this.resetTextColor(),this.changePaintOpacity(this.isCommandEnabled(t)),this.drawText(this.commandName(t),e.x,e.y,e.width,i)},Window_Command.prototype.itemTextAlign=function(){return"left"},Window_Command.prototype.isOkEnabled=function(){return!0},Window_Command.prototype.callOkHandler=function(){var t=this.currentSymbol();this.isHandled(t)?this.callHandler(t):this.isHandled("ok")?Window_Selectable.prototype.callOkHandler.call(this):this.activate()},Window_Command.prototype.refresh=function(){this.clearCommandList(),this.makeCommandList(),this.createContents(),Window_Selectable.prototype.refresh.call(this)},Window_HorzCommand.prototype=Object.create(Window_Command.prototype),Window_HorzCommand.prototype.constructor=Window_HorzCommand,Window_HorzCommand.prototype.initialize=function(t,e){Window_Command.prototype.initialize.call(this,t,e)},Window_HorzCommand.prototype.numVisibleRows=function(){return 1},Window_HorzCommand.prototype.maxCols=function(){return 4},Window_HorzCommand.prototype.itemTextAlign=function(){return"center"},Window_Help.prototype=Object.create(Window_Base.prototype),Window_Help.prototype.constructor=Window_Help,Window_Help.prototype.initialize=function(t){var e=Graphics.boxWidth;t=this.fittingHeight(t||2),Window_Base.prototype.initialize.call(this,0,0,e,t),this._text=""},Window_Help.prototype.setText=function(t){this._text!==t&&(this._text=t,this.refresh())},Window_Help.prototype.clear=function(){this.setText("")},Window_Help.prototype.setItem=function(t){this.setText(t?t.description:"")},Window_Help.prototype.refresh=function(){this.contents.clear(),this.drawTextEx(this._text,this.textPadding(),0)},Window_Gold.prototype=Object.create(Window_Base.prototype),Window_Gold.prototype.constructor=Window_Gold,Window_Gold.prototype.initialize=function(t,e){var i=this.windowWidth(),a=this.windowHeight();Window_Base.prototype.initialize.call(this,t,e,i,a),this.refresh()},Window_Gold.prototype.windowWidth=function(){return 240},Window_Gold.prototype.windowHeight=function(){return this.fittingHeight(1)},Window_Gold.prototype.refresh=function(){var t=this.textPadding(),e=this.contents.width-2*this.textPadding();this.contents.clear(),this.drawCurrencyValue(this.value(),this.currencyUnit(),t,0,e)},Window_Gold.prototype.value=function(){return $gameParty.gold()},Window_Gold.prototype.currencyUnit=function(){return TextManager.currencyUnit},Window_Gold.prototype.open=function(){this.refresh(),Window_Base.prototype.open.call(this)},Window_MenuCommand.prototype=Object.create(Window_Command.prototype),Window_MenuCommand.prototype.constructor=Window_MenuCommand,Window_MenuCommand.prototype.initialize=function(t,e){Window_Command.prototype.initialize.call(this,t,e),this.selectLast()},Window_MenuCommand._lastCommandSymbol=null,Window_MenuCommand.initCommandPosition=function(){this._lastCommandSymbol=null},Window_MenuCommand.prototype.windowWidth=function(){return 240},Window_MenuCommand.prototype.numVisibleRows=function(){return this.maxItems()},Window_MenuCommand.prototype.makeCommandList=function(){this.addMainCommands(),this.addFormationCommand(),this.addOriginalCommands(),this.addOptionsCommand(),this.addSaveCommand(),this.addGameEndCommand()},Window_MenuCommand.prototype.addMainCommands=function(){var t=this.areMainCommandsEnabled();this.needsCommand("item")&&this.addCommand(TextManager.item,"item",t),this.needsCommand("skill")&&this.addCommand(TextManager.skill,"skill",t),this.needsCommand("equip")&&this.addCommand(TextManager.equip,"equip",t),this.needsCommand("status")&&this.addCommand(TextManager.status,"status",t)},Window_MenuCommand.prototype.addFormationCommand=function(){if(this.needsCommand("formation")){var t=this.isFormationEnabled();this.addCommand(TextManager.formation,"formation",t)}},Window_MenuCommand.prototype.addOriginalCommands=function(){},Window_MenuCommand.prototype.addOptionsCommand=function(){if(this.needsCommand("options")){var t=this.isOptionsEnabled();this.addCommand(TextManager.options,"options",t)}},Window_MenuCommand.prototype.addSaveCommand=function(){if(this.needsCommand("save")){var t=this.isSaveEnabled();this.addCommand(TextManager.save,"save",t)}},Window_MenuCommand.prototype.addGameEndCommand=function(){var t=this.isGameEndEnabled();this.addCommand(TextManager.gameEnd,"gameEnd",t)},Window_MenuCommand.prototype.needsCommand=function(t){var e=$dataSystem.menuCommands;if(e)switch(t){case"item":return e[0];case"skill":return e[1];case"equip":return e[2];case"status":return e[3];case"formation":return e[4];case"save":return e[5]}return!0},Window_MenuCommand.prototype.areMainCommandsEnabled=function(){return $gameParty.exists()},Window_MenuCommand.prototype.isFormationEnabled=function(){return 2<=$gameParty.size()&&$gameSystem.isFormationEnabled()},Window_MenuCommand.prototype.isOptionsEnabled=function(){return!0},Window_MenuCommand.prototype.isSaveEnabled=function(){return!DataManager.isEventTest()&&$gameSystem.isSaveEnabled()},Window_MenuCommand.prototype.isGameEndEnabled=function(){return!0},Window_MenuCommand.prototype.processOk=function(){Window_MenuCommand._lastCommandSymbol=this.currentSymbol(),Window_Command.prototype.processOk.call(this)},Window_MenuCommand.prototype.selectLast=function(){this.selectSymbol(Window_MenuCommand._lastCommandSymbol)},Window_MenuStatus.prototype=Object.create(Window_Selectable.prototype),Window_MenuStatus.prototype.constructor=Window_MenuStatus,Window_MenuStatus.prototype.initialize=function(t,e){var i=this.windowWidth(),a=this.windowHeight();Window_Selectable.prototype.initialize.call(this,t,e,i,a),this._formationMode=!1,this._pendingIndex=-1,this.refresh()},Window_MenuStatus.prototype.windowWidth=function(){return Graphics.boxWidth-240},Window_MenuStatus.prototype.windowHeight=function(){return Graphics.boxHeight},Window_MenuStatus.prototype.maxItems=function(){return $gameParty.size()},Window_MenuStatus.prototype.itemHeight=function(){return Math.floor((this.height-2*this.padding)/this.numVisibleRows())},Window_MenuStatus.prototype.numVisibleRows=function(){return 4},Window_MenuStatus.prototype.loadImages=function(){$gameParty.members().forEach(function(t){ImageManager.reserveFace(t.faceName())},this)},Window_MenuStatus.prototype.drawItem=function(t){this.drawItemBackground(t),this.drawItemImage(t),this.drawItemStatus(t)},Window_MenuStatus.prototype.drawItemBackground=function(t){if(t===this._pendingIndex){t=this.itemRect(t);var e=this.pendingColor();this.changePaintOpacity(!1),this.contents.fillRect(t.x,t.y,t.width,t.height,e),this.changePaintOpacity(!0)}},Window_MenuStatus.prototype.drawItemImage=function(t){var e=$gameParty.members()[t];t=this.itemRect(t),this.changePaintOpacity(e.isBattleMember()),this.drawActorFace(e,t.x+1,t.y+1,Window_Base._faceWidth,Window_Base._faceHeight),this.changePaintOpacity(!0)},Window_MenuStatus.prototype.drawItemStatus=function(t){var e=$gameParty.members()[t],i=this.itemRect(t);t=i.x+162;var a=i.y+i.height/2-1.5*this.lineHeight();i=i.width-t-this.textPadding(),this.drawActorSimpleStatus(e,t,a,i)},Window_MenuStatus.prototype.processOk=function(){Window_Selectable.prototype.processOk.call(this),$gameParty.setMenuActor($gameParty.members()[this.index()])},Window_MenuStatus.prototype.isCurrentItemEnabled=function(){if(this._formationMode){var t=$gameParty.members()[this.index()];return t&&t.isFormationChangeOk()}return!0},Window_MenuStatus.prototype.selectLast=function(){this.select($gameParty.menuActor().index()||0)},Window_MenuStatus.prototype.formationMode=function(){return this._formationMode},Window_MenuStatus.prototype.setFormationMode=function(t){this._formationMode=t},Window_MenuStatus.prototype.pendingIndex=function(){return this._pendingIndex},Window_MenuStatus.prototype.setPendingIndex=function(t){var e=this._pendingIndex;this._pendingIndex=t,this.redrawItem(this._pendingIndex),this.redrawItem(e)},Window_MenuActor.prototype=Object.create(Window_MenuStatus.prototype),Window_MenuActor.prototype.constructor=Window_MenuActor,Window_MenuActor.prototype.initialize=function(){Window_MenuStatus.prototype.initialize.call(this,0,0),this.hide()},Window_MenuActor.prototype.processOk=function(){this.cursorAll()||$gameParty.setTargetActor($gameParty.members()[this.index()]),this.callOkHandler()},Window_MenuActor.prototype.selectLast=function(){this.select($gameParty.targetActor().index()||0)},Window_MenuActor.prototype.selectForItem=function(t){var e=$gameParty.menuActor(),i=new Game_Action(e);i.setItemObject(t),this.setCursorFixed(!1),this.setCursorAll(!1),i.isForUser()?DataManager.isSkill(t)?(this.setCursorFixed(!0),this.select(e.index())):this.selectLast():i.isForAll()?(this.setCursorAll(!0),this.select(0)):this.selectLast()},Window_ItemCategory.prototype=Object.create(Window_HorzCommand.prototype),Window_ItemCategory.prototype.constructor=Window_ItemCategory,Window_ItemCategory.prototype.initialize=function(){Window_HorzCommand.prototype.initialize.call(this,0,0)},Window_ItemCategory.prototype.windowWidth=function(){return Graphics.boxWidth},Window_ItemCategory.prototype.maxCols=function(){return 4},Window_ItemCategory.prototype.update=function(){Window_HorzCommand.prototype.update.call(this),this._itemWindow&&this._itemWindow.setCategory(this.currentSymbol())},Window_ItemCategory.prototype.makeCommandList=function(){this.addCommand(TextManager.item,"item"),this.addCommand(TextManager.weapon,"weapon"),this.addCommand(TextManager.armor,"armor"),this.addCommand(TextManager.keyItem,"keyItem")},Window_ItemCategory.prototype.setItemWindow=function(t){this._itemWindow=t},Window_ItemList.prototype=Object.create(Window_Selectable.prototype),Window_ItemList.prototype.constructor=Window_ItemList,Window_ItemList.prototype.initialize=function(t,e,i,a){Window_Selectable.prototype.initialize.call(this,t,e,i,a),this._category="none",this._data=[]},Window_ItemList.prototype.setCategory=function(t){this._category!==t&&(this._category=t,this.refresh(),this.resetScroll())},Window_ItemList.prototype.maxCols=function(){return 2},Window_ItemList.prototype.spacing=function(){return 48},Window_ItemList.prototype.maxItems=function(){return this._data?this._data.length:1},Window_ItemList.prototype.item=function(){var t=this.index();return this._data&&0<=t?this._data[t]:null},Window_ItemList.prototype.isCurrentItemEnabled=function(){return this.isEnabled(this.item())},Window_ItemList.prototype.includes=function(t){switch(this._category){case"item":return DataManager.isItem(t)&&1===t.itypeId;case"weapon":return DataManager.isWeapon(t);case"armor":return DataManager.isArmor(t);case"keyItem":return DataManager.isItem(t)&&2===t.itypeId;default:return!1}},Window_ItemList.prototype.needsNumber=function(){return!0},Window_ItemList.prototype.isEnabled=function(t){return $gameParty.canUse(t)},Window_ItemList.prototype.makeItemList=function(){this._data=$gameParty.allItems().filter(function(t){return this.includes(t)},this),this.includes(null)&&this._data.push(null)},Window_ItemList.prototype.selectLast=function(){var t=this._data.indexOf($gameParty.lastItem());this.select(0<=t?t:0)},Window_ItemList.prototype.drawItem=function(t){var e=this._data[t];if(e){var i=this.numberWidth();(t=this.itemRect(t)).width-=this.textPadding(),this.changePaintOpacity(this.isEnabled(e)),this.drawItemName(e,t.x,t.y,t.width-i),this.drawItemNumber(e,t.x,t.y,t.width),this.changePaintOpacity(1)}},Window_ItemList.prototype.numberWidth=function(){return this.textWidth("000")},Window_ItemList.prototype.drawItemNumber=function(t,e,i,a){this.needsNumber()&&(this.drawText(":",e,i,a-this.textWidth("00"),"right"),this.drawText($gameParty.numItems(t),e,i,a,"right"))},Window_ItemList.prototype.updateHelp=function(){this.setHelpWindowItem(this.item())},Window_ItemList.prototype.refresh=function(){this.makeItemList(),this.createContents(),this.drawAllItems()},Window_SkillType.prototype=Object.create(Window_Command.prototype),Window_SkillType.prototype.constructor=Window_SkillType,Window_SkillType.prototype.initialize=function(t,e){Window_Command.prototype.initialize.call(this,t,e),this._actor=null},Window_SkillType.prototype.windowWidth=function(){return 240},Window_SkillType.prototype.setActor=function(t){this._actor!==t&&(this._actor=t,this.refresh(),this.selectLast())},Window_SkillType.prototype.numVisibleRows=function(){return 4},Window_SkillType.prototype.makeCommandList=function(){if(this._actor){var t=this._actor.addedSkillTypes();t.sort(function(t,e){return t-e}),t.forEach(function(t){this.addCommand($dataSystem.skillTypes[t],"skill",!0,t)},this)}},Window_SkillType.prototype.update=function(){Window_Command.prototype.update.call(this),this._skillWindow&&this._skillWindow.setStypeId(this.currentExt())},Window_SkillType.prototype.setSkillWindow=function(t){this._skillWindow=t},Window_SkillType.prototype.selectLast=function(){var t=this._actor.lastMenuSkill();t?this.selectExt(t.stypeId):this.select(0)},Window_SkillStatus.prototype=Object.create(Window_Base.prototype),Window_SkillStatus.prototype.constructor=Window_SkillStatus,Window_SkillStatus.prototype.initialize=function(t,e,i,a){Window_Base.prototype.initialize.call(this,t,e,i,a),this._actor=null},Window_SkillStatus.prototype.setActor=function(t){this._actor!==t&&(this._actor=t,this.refresh())},Window_SkillStatus.prototype.refresh=function(){if(this.contents.clear(),this._actor){var t=this.width-2*this.padding,e=this.height-2*this.padding,i=e/2-1.5*this.lineHeight();t=t-162-this.textPadding(),this.drawActorFace(this._actor,0,0,144,e),this.drawActorSimpleStatus(this._actor,162,i,t)}},Window_SkillList.prototype=Object.create(Window_Selectable.prototype),Window_SkillList.prototype.constructor=Window_SkillList,Window_SkillList.prototype.initialize=function(t,e,i,a){Window_Selectable.prototype.initialize.call(this,t,e,i,a),this._actor=null,this._stypeId=0,this._data=[]},Window_SkillList.prototype.setActor=function(t){this._actor!==t&&(this._actor=t,this.refresh(),this.resetScroll())},Window_SkillList.prototype.setStypeId=function(t){this._stypeId!==t&&(this._stypeId=t,this.refresh(),this.resetScroll())},Window_SkillList.prototype.maxCols=function(){return 2},Window_SkillList.prototype.spacing=function(){return 48},Window_SkillList.prototype.maxItems=function(){return this._data?this._data.length:1},Window_SkillList.prototype.item=function(){return this._data&&0<=this.index()?this._data[this.index()]:null},Window_SkillList.prototype.isCurrentItemEnabled=function(){return this.isEnabled(this._data[this.index()])},Window_SkillList.prototype.includes=function(t){return t&&t.stypeId===this._stypeId},Window_SkillList.prototype.isEnabled=function(t){return this._actor&&this._actor.canUse(t)},Window_SkillList.prototype.makeItemList=function(){this._data=this._actor?this._actor.skills().filter(function(t){return this.includes(t)},this):[]},Window_SkillList.prototype.selectLast=function(){var t=$gameParty.inBattle()?this._actor.lastBattleSkill():this._actor.lastMenuSkill();t=this._data.indexOf(t),this.select(0<=t?t:0)},Window_SkillList.prototype.drawItem=function(t){var e=this._data[t];if(e){var i=this.costWidth();(t=this.itemRect(t)).width-=this.textPadding(),this.changePaintOpacity(this.isEnabled(e)),this.drawItemName(e,t.x,t.y,t.width-i),this.drawSkillCost(e,t.x,t.y,t.width),this.changePaintOpacity(1)}},Window_SkillList.prototype.costWidth=function(){return this.textWidth("000")},Window_SkillList.prototype.drawSkillCost=function(t,e,i,a){0<this._actor.skillTpCost(t)?(this.changeTextColor(this.tpCostColor()),this.drawText(this._actor.skillTpCost(t),e,i,a,"right")):0<this._actor.skillMpCost(t)&&(this.changeTextColor(this.mpCostColor()),this.drawText(this._actor.skillMpCost(t),e,i,a,"right"))},Window_SkillList.prototype.updateHelp=function(){this.setHelpWindowItem(this.item())},Window_SkillList.prototype.refresh=function(){this.makeItemList(),this.createContents(),this.drawAllItems()},Window_EquipStatus.prototype=Object.create(Window_Base.prototype),Window_EquipStatus.prototype.constructor=Window_EquipStatus,Window_EquipStatus.prototype.initialize=function(t,e){var i=this.windowWidth(),a=this.windowHeight();Window_Base.prototype.initialize.call(this,t,e,i,a),this._tempActor=this._actor=null,this.refresh()},Window_EquipStatus.prototype.windowWidth=function(){return 312},Window_EquipStatus.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())},Window_EquipStatus.prototype.numVisibleRows=function(){return 7},Window_EquipStatus.prototype.setActor=function(t){this._actor!==t&&(this._actor=t,this.refresh())},Window_EquipStatus.prototype.refresh=function(){if(this.contents.clear(),this._actor){this.drawActorName(this._actor,this.textPadding(),0);for(var t=0;t<6;t++)this.drawItem(0,this.lineHeight()*(1+t),2+t)}},Window_EquipStatus.prototype.setTempActor=function(t){this._tempActor!==t&&(this._tempActor=t,this.refresh())},Window_EquipStatus.prototype.drawItem=function(t,e,i){this.drawParamName(t+this.textPadding(),e,i),this._actor&&this.drawCurrentParam(t+140,e,i),this.drawRightArrow(t+188,e),this._tempActor&&this.drawNewParam(t+222,e,i)},Window_EquipStatus.prototype.drawParamName=function(t,e,i){this.changeTextColor(this.systemColor()),this.drawText(TextManager.param(i),t,e,120)},Window_EquipStatus.prototype.drawCurrentParam=function(t,e,i){this.resetTextColor(),this.drawText(this._actor.param(i),t,e,48,"right")},Window_EquipStatus.prototype.drawRightArrow=function(t,e){this.changeTextColor(this.systemColor()),this.drawText("→",t,e,32,"center")},Window_EquipStatus.prototype.drawNewParam=function(t,e,i){var a=this._tempActor.param(i);i=a-this._actor.param(i),this.changeTextColor(this.paramchangeTextColor(i)),this.drawText(a,t,e,48,"right")},Window_EquipCommand.prototype=Object.create(Window_HorzCommand.prototype),Window_EquipCommand.prototype.constructor=Window_EquipCommand,Window_EquipCommand.prototype.initialize=function(t,e,i){this._windowWidth=i,Window_HorzCommand.prototype.initialize.call(this,t,e)},Window_EquipCommand.prototype.windowWidth=function(){return this._windowWidth},Window_EquipCommand.prototype.maxCols=function(){return 3},Window_EquipCommand.prototype.makeCommandList=function(){this.addCommand(TextManager.equip2,"equip"),this.addCommand(TextManager.optimize,"optimize"),this.addCommand(TextManager.clear,"clear")},Window_EquipSlot.prototype=Object.create(Window_Selectable.prototype),Window_EquipSlot.prototype.constructor=Window_EquipSlot,Window_EquipSlot.prototype.initialize=function(t,e,i,a){Window_Selectable.prototype.initialize.call(this,t,e,i,a),this._actor=null,this.refresh()},Window_EquipSlot.prototype.setActor=function(t){this._actor!==t&&(this._actor=t,this.refresh())},Window_EquipSlot.prototype.update=function(){Window_Selectable.prototype.update.call(this),this._itemWindow&&this._itemWindow.setSlotId(this.index())},Window_EquipSlot.prototype.maxItems=function(){return this._actor?this._actor.equipSlots().length:0},Window_EquipSlot.prototype.item=function(){return this._actor?this._actor.equips()[this.index()]:null},Window_EquipSlot.prototype.drawItem=function(t){if(this._actor){var e=this.itemRectForText(t);this.changeTextColor(this.systemColor()),this.changePaintOpacity(this.isEnabled(t)),this.drawText(this.slotName(t),e.x,e.y,138,this.lineHeight()),this.drawItemName(this._actor.equips()[t],e.x+138,e.y),this.changePaintOpacity(!0)}},Window_EquipSlot.prototype.slotName=function(t){var e=this._actor.equipSlots();return this._actor?$dataSystem.equipTypes[e[t]]:""},Window_EquipSlot.prototype.isEnabled=function(t){return!!this._actor&&this._actor.isEquipChangeOk(t)},Window_EquipSlot.prototype.isCurrentItemEnabled=function(){return this.isEnabled(this.index())},Window_EquipSlot.prototype.setStatusWindow=function(t){this._statusWindow=t,this.callUpdateHelp()},Window_EquipSlot.prototype.setItemWindow=function(t){this._itemWindow=t},Window_EquipSlot.prototype.updateHelp=function(){Window_Selectable.prototype.updateHelp.call(this),this.setHelpWindowItem(this.item()),this._statusWindow&&this._statusWindow.setTempActor(null)},Window_EquipItem.prototype=Object.create(Window_ItemList.prototype),Window_EquipItem.prototype.constructor=Window_EquipItem,Window_EquipItem.prototype.initialize=function(t,e,i,a){Window_ItemList.prototype.initialize.call(this,t,e,i,a),this._actor=null,this._slotId=0},Window_EquipItem.prototype.setActor=function(t){this._actor!==t&&(this._actor=t,this.refresh(),this.resetScroll())},Window_EquipItem.prototype.setSlotId=function(t){this._slotId!==t&&(this._slotId=t,this.refresh(),this.resetScroll())},Window_EquipItem.prototype.includes=function(t){return null===t||!(this._slotId<0||t.etypeId!==this._actor.equipSlots()[this._slotId])&&this._actor.canEquip(t)},Window_EquipItem.prototype.isEnabled=function(t){return!0},Window_EquipItem.prototype.selectLast=function(){},Window_EquipItem.prototype.setStatusWindow=function(t){this._statusWindow=t,this.callUpdateHelp()},Window_EquipItem.prototype.updateHelp=function(){if(Window_ItemList.prototype.updateHelp.call(this),this._actor&&this._statusWindow){var t=JsonEx.makeDeepCopy(this._actor);t.forceChangeEquip(this._slotId,this.item()),this._statusWindow.setTempActor(t)}},Window_EquipItem.prototype.playOkSound=function(){},Window_Status.prototype=Object.create(Window_Selectable.prototype),Window_Status.prototype.constructor=Window_Status,Window_Status.prototype.initialize=function(){Window_Selectable.prototype.initialize.call(this,0,0,Graphics.boxWidth,Graphics.boxHeight),this._actor=null,this.refresh(),this.activate()},Window_Status.prototype.setActor=function(t){this._actor!==t&&(this._actor=t,this.refresh())},Window_Status.prototype.refresh=function(){if(this.contents.clear(),this._actor){var t=this.lineHeight();this.drawBlock1(0*t),this.drawHorzLine(1*t),this.drawBlock2(2*t),this.drawHorzLine(6*t),this.drawBlock3(7*t),this.drawHorzLine(13*t),this.drawBlock4(14*t)}},Window_Status.prototype.drawBlock1=function(t){this.drawActorName(this._actor,6,t),this.drawActorClass(this._actor,192,t),this.drawActorNickname(this._actor,432,t)},Window_Status.prototype.drawBlock2=function(t){this.drawActorFace(this._actor,12,t),this.drawBasicInfo(204,t),this.drawExpInfo(456,t)},Window_Status.prototype.drawBlock3=function(t){this.drawParameters(48,t),this.drawEquipments(432,t)},Window_Status.prototype.drawBlock4=function(t){this.drawProfile(6,t)},Window_Status.prototype.drawHorzLine=function(t){t=t+this.lineHeight()/2-1,this.contents.paintOpacity=48,this.contents.fillRect(0,t,this.contentsWidth(),2,this.lineColor()),this.contents.paintOpacity=255},Window_Status.prototype.lineColor=function(){return this.normalColor()},Window_Status.prototype.drawBasicInfo=function(t,e){var i=this.lineHeight();this.drawActorLevel(this._actor,t,e+0*i),this.drawActorIcons(this._actor,t,e+1*i),this.drawActorHp(this._actor,t,e+2*i),this.drawActorMp(this._actor,t,e+3*i)},Window_Status.prototype.drawParameters=function(t,e){for(var i=this.lineHeight(),a=0;a<6;a++){var n=a+2,o=e+i*a;this.changeTextColor(this.systemColor()),this.drawText(TextManager.param(n),t,o,160),this.resetTextColor(),this.drawText(this._actor.param(n),t+160,o,60,"right")}},Window_Status.prototype.drawExpInfo=function(t,e){var i=this.lineHeight(),a=TextManager.expTotal.format(TextManager.exp),n=TextManager.expNext.format(TextManager.level),o=this._actor.currentExp(),r=this._actor.nextRequiredExp();this._actor.isMaxLevel()&&(r=o="-------"),this.changeTextColor(this.systemColor()),this.drawText(a,t,e+0*i,270),this.drawText(n,t,e+2*i,270),this.resetTextColor(),this.drawText(o,t,e+1*i,270,"right"),this.drawText(r,t,e+3*i,270,"right")},Window_Status.prototype.drawEquipments=function(t,e){for(var i=this._actor.equips(),a=Math.min(i.length,this.maxEquipmentLines()),n=0;n<a;n++)this.drawItemName(i[n],t,e+this.lineHeight()*n)},Window_Status.prototype.drawProfile=function(t,e){this.drawTextEx(this._actor.profile(),t,e)},Window_Status.prototype.maxEquipmentLines=function(){return 6},Window_Options.prototype=Object.create(Window_Command.prototype),Window_Options.prototype.constructor=Window_Options,Window_Options.prototype.initialize=function(){Window_Command.prototype.initialize.call(this,0,0),this.updatePlacement()},Window_Options.prototype.windowWidth=function(){return 400},Window_Options.prototype.windowHeight=function(){return this.fittingHeight(Math.min(this.numVisibleRows(),12))},Window_Options.prototype.updatePlacement=function(){this.x=(Graphics.boxWidth-this.width)/2,this.y=(Graphics.boxHeight-this.height)/2},Window_Options.prototype.makeCommandList=function(){this.addGeneralOptions(),this.addVolumeOptions()},Window_Options.prototype.addGeneralOptions=function(){this.addCommand(TextManager.alwaysDash,"alwaysDash"),this.addCommand(TextManager.commandRemember,"commandRemember")},Window_Options.prototype.addVolumeOptions=function(){this.addCommand(TextManager.bgmVolume,"bgmVolume"),this.addCommand(TextManager.bgsVolume,"bgsVolume"),this.addCommand(TextManager.meVolume,"meVolume"),this.addCommand(TextManager.seVolume,"seVolume")},Window_Options.prototype.drawItem=function(t){var e=this.itemRectForText(t),i=this.statusWidth(),a=e.width-i;this.resetTextColor(),this.changePaintOpacity(this.isCommandEnabled(t)),this.drawText(this.commandName(t),e.x,e.y,a,"left"),this.drawText(this.statusText(t),a,e.y,i,"right")},Window_Options.prototype.statusWidth=function(){return 120},Window_Options.prototype.statusText=function(t){t=this.commandSymbol(t);var e=this.getConfigValue(t);return this.isVolumeSymbol(t)?this.volumeStatusText(e):this.booleanStatusText(e)},Window_Options.prototype.isVolumeSymbol=function(t){return t.contains("Volume")},Window_Options.prototype.booleanStatusText=function(t){return t?"ON":"OFF"},Window_Options.prototype.volumeStatusText=function(t){return t+"%"},Window_Options.prototype.processOk=function(){var t=this.index();t=this.commandSymbol(t);var e=this.getConfigValue(t);this.isVolumeSymbol(t)?(100<(e+=this.volumeOffset())&&(e=0),e=e.clamp(0,100),this.changeValue(t,e)):this.changeValue(t,!e)},Window_Options.prototype.cursorRight=function(t){t=this.index(),t=this.commandSymbol(t);var e=this.getConfigValue(t);this.isVolumeSymbol(t)?(e=(e+=this.volumeOffset()).clamp(0,100),this.changeValue(t,e)):this.changeValue(t,!0)},Window_Options.prototype.cursorLeft=function(t){t=this.index(),t=this.commandSymbol(t);var e=this.getConfigValue(t);this.isVolumeSymbol(t)?(e=(e-=this.volumeOffset()).clamp(0,100),this.changeValue(t,e)):this.changeValue(t,!1)},Window_Options.prototype.volumeOffset=function(){return 20},Window_Options.prototype.changeValue=function(t,e){this.getConfigValue(t)!==e&&(this.setConfigValue(t,e),this.redrawItem(this.findSymbol(t)),SoundManager.playCursor())},Window_Options.prototype.getConfigValue=function(t){return ConfigManager[t]},Window_Options.prototype.setConfigValue=function(t,e){ConfigManager[t]=e},Window_SavefileList.prototype=Object.create(Window_Selectable.prototype),Window_SavefileList.prototype.constructor=Window_SavefileList,Window_SavefileList.prototype.initialize=function(t,e,i,a){Window_Selectable.prototype.initialize.call(this,t,e,i,a),this.activate(),this._mode=null},Window_SavefileList.prototype.setMode=function(t){this._mode=t},Window_SavefileList.prototype.maxItems=function(){return DataManager.maxSavefiles()},Window_SavefileList.prototype.maxVisibleItems=function(){return 5},Window_SavefileList.prototype.itemHeight=function(){return Math.floor((this.height-2*this.padding)/this.maxVisibleItems())},Window_SavefileList.prototype.drawItem=function(t){var e=t+1,i=DataManager.isThisGameFile(e),a=DataManager.loadSavefileInfo(e);t=this.itemRectForText(t),this.resetTextColor(),"load"===this._mode&&this.changePaintOpacity(i),this.drawFileId(e,t.x,t.y),a&&(this.changePaintOpacity(i),this.drawContents(a,t,i),this.changePaintOpacity(!0))},Window_SavefileList.prototype.drawFileId=function(t,e,i){this.drawText(TextManager.file+" "+t,e,i,180)},Window_SavefileList.prototype.drawContents=function(t,e,i){var a=e.y+e.height;420<=e.width&&(this.drawGameTitle(t,e.x+192,e.y,e.width-192),i&&this.drawPartyCharacters(t,e.x+220,a-4)),(i=this.lineHeight())<=(a-=i)&&this.drawPlaytime(t,e.x,a,e.width)},Window_SavefileList.prototype.drawGameTitle=function(t,e,i,a){t.title&&this.drawText(t.title,e,i,a)},Window_SavefileList.prototype.drawPartyCharacters=function(t,e,i){if(t.characters)for(var a=0;a<t.characters.length;a++){var n=t.characters[a];this.drawCharacter(n[0],n[1],e+48*a,i)}},Window_SavefileList.prototype.drawPlaytime=function(t,e,i,a){t.playtime&&this.drawText(t.playtime,e,i,a,"right")},Window_SavefileList.prototype.playOkSound=function(){},Window_ShopCommand.prototype=Object.create(Window_HorzCommand.prototype),Window_ShopCommand.prototype.constructor=Window_ShopCommand,Window_ShopCommand.prototype.initialize=function(t,e){this._windowWidth=t,this._purchaseOnly=e,Window_HorzCommand.prototype.initialize.call(this,0,0)},Window_ShopCommand.prototype.windowWidth=function(){return this._windowWidth},Window_ShopCommand.prototype.maxCols=function(){return 3},Window_ShopCommand.prototype.makeCommandList=function(){this.addCommand(TextManager.buy,"buy"),this.addCommand(TextManager.sell,"sell",!this._purchaseOnly),this.addCommand(TextManager.cancel,"cancel")},Window_ShopBuy.prototype=Object.create(Window_Selectable.prototype),Window_ShopBuy.prototype.constructor=Window_ShopBuy,Window_ShopBuy.prototype.initialize=function(t,e,i,a){var n=this.windowWidth();Window_Selectable.prototype.initialize.call(this,t,e,n,i),this._shopGoods=a,this._money=0,this.refresh(),this.select(0)},Window_ShopBuy.prototype.windowWidth=function(){return 456},Window_ShopBuy.prototype.maxItems=function(){return this._data?this._data.length:1},Window_ShopBuy.prototype.item=function(){return this._data[this.index()]},Window_ShopBuy.prototype.setMoney=function(t){this._money=t,this.refresh()},Window_ShopBuy.prototype.isCurrentItemEnabled=function(){return this.isEnabled(this._data[this.index()])},Window_ShopBuy.prototype.price=function(t){return this._price[this._data.indexOf(t)]||0},Window_ShopBuy.prototype.isEnabled=function(t){return t&&this.price(t)<=this._money&&!$gameParty.hasMaxItems(t)},Window_ShopBuy.prototype.refresh=function(){this.makeItemList(),this.createContents(),this.drawAllItems()},Window_ShopBuy.prototype.makeItemList=function(){this._data=[],this._price=[],this._shopGoods.forEach(function(t){var e=null;switch(t[0]){case 0:e=$dataItems[t[1]];break;case 1:e=$dataWeapons[t[1]];break;case 2:e=$dataArmors[t[1]]}e&&(this._data.push(e),this._price.push(0===t[2]?e.price:t[3]))},this)},Window_ShopBuy.prototype.drawItem=function(t){var e=this._data[t];(t=this.itemRect(t)).width-=this.textPadding(),this.changePaintOpacity(this.isEnabled(e)),this.drawItemName(e,t.x,t.y,t.width-96),this.drawText(this.price(e),t.x+t.width-96,t.y,96,"right"),this.changePaintOpacity(!0)},Window_ShopBuy.prototype.setStatusWindow=function(t){this._statusWindow=t,this.callUpdateHelp()},Window_ShopBuy.prototype.updateHelp=function(){this.setHelpWindowItem(this.item()),this._statusWindow&&this._statusWindow.setItem(this.item())},Window_ShopSell.prototype=Object.create(Window_ItemList.prototype),Window_ShopSell.prototype.constructor=Window_ShopSell,Window_ShopSell.prototype.initialize=function(t,e,i,a){Window_ItemList.prototype.initialize.call(this,t,e,i,a)},Window_ShopSell.prototype.isEnabled=function(t){return t&&0<t.price},Window_ShopNumber.prototype=Object.create(Window_Selectable.prototype),Window_ShopNumber.prototype.constructor=Window_ShopNumber,Window_ShopNumber.prototype.initialize=function(t,e,i){var a=this.windowWidth();Window_Selectable.prototype.initialize.call(this,t,e,a,i),this._item=null,this._max=1,this._price=0,this._number=1,this._currencyUnit=TextManager.currencyUnit,this.createButtons()},Window_ShopNumber.prototype.windowWidth=function(){return 456},Window_ShopNumber.prototype.number=function(){return this._number},Window_ShopNumber.prototype.setup=function(t,e,i){this._item=t,this._max=Math.floor(e),this._price=i,this._number=1,this.placeButtons(),this.updateButtonsVisiblity(),this.refresh()},Window_ShopNumber.prototype.setCurrencyUnit=function(t){this._currencyUnit=t,this.refresh()},Window_ShopNumber.prototype.createButtons=function(){var t=ImageManager.loadSystem("ButtonSet");this._buttons=[];for(var e=0;e<5;e++){var i=new Sprite_Button,a=48*e,n=48*(4===e?2:1);i.bitmap=t,i.setColdFrame(a,0,n,48),i.setHotFrame(a,48,n,48),i.visible=!1,this._buttons.push(i),this.addChild(i)}this._buttons[0].setClickHandler(this.onButtonDown2.bind(this)),this._buttons[1].setClickHandler(this.onButtonDown.bind(this)),this._buttons[2].setClickHandler(this.onButtonUp.bind(this)),this._buttons[3].setClickHandler(this.onButtonUp2.bind(this)),this._buttons[4].setClickHandler(this.onButtonOk.bind(this))},Window_ShopNumber.prototype.placeButtons=function(){for(var t=this._buttons.length,e=-16,i=0;i<t;i++)e+=this._buttons[i].width+16;for(e=(this.width-e)/2,i=0;i<t;i++){var a=this._buttons[i];a.x=e,a.y=this.buttonY(),e+=a.width+16}},Window_ShopNumber.prototype.updateButtonsVisiblity=function(){TouchInput.date>Input.date?this.showButtons():this.hideButtons()},Window_ShopNumber.prototype.showButtons=function(){for(var t=0;t<this._buttons.length;t++)this._buttons[t].visible=!0},Window_ShopNumber.prototype.hideButtons=function(){for(var t=0;t<this._buttons.length;t++)this._buttons[t].visible=!1},Window_ShopNumber.prototype.refresh=function(){this.contents.clear(),this.drawItemName(this._item,0,this.itemY()),this.drawMultiplicationSign(),this.drawNumber(),this.drawTotalPrice()},Window_ShopNumber.prototype.drawMultiplicationSign=function(){var t=this.textWidth("×"),e=this.cursorX()-2*t,i=this.itemY();this.resetTextColor(),this.drawText("×",e,i,t)},Window_ShopNumber.prototype.drawNumber=function(){var t=this.cursorX(),e=this.itemY(),i=this.cursorWidth()-this.textPadding();this.resetTextColor(),this.drawText(this._number,t,e,i,"right")},Window_ShopNumber.prototype.drawTotalPrice=function(){var t=this._price*this._number,e=this.contentsWidth()-this.textPadding();this.drawCurrencyValue(t,this._currencyUnit,0,this.priceY(),e)},Window_ShopNumber.prototype.itemY=function(){return Math.round(this.contentsHeight()/2-1.5*this.lineHeight())},Window_ShopNumber.prototype.priceY=function(){return Math.round(this.contentsHeight()/2+this.lineHeight()/2)},Window_ShopNumber.prototype.buttonY=function(){return Math.round(this.priceY()+2.5*this.lineHeight())},Window_ShopNumber.prototype.cursorWidth=function(){var t=this.textWidth("0");return this.maxDigits()*t+2*this.textPadding()},Window_ShopNumber.prototype.cursorX=function(){return this.contentsWidth()-this.cursorWidth()-this.textPadding()},Window_ShopNumber.prototype.maxDigits=function(){return 2},Window_ShopNumber.prototype.update=function(){Window_Selectable.prototype.update.call(this),this.processNumberChange()},Window_ShopNumber.prototype.isOkTriggered=function(){return Input.isTriggered("ok")},Window_ShopNumber.prototype.playOkSound=function(){},Window_ShopNumber.prototype.processNumberChange=function(){this.isOpenAndActive()&&(Input.isRepeated("right")&&this.changeNumber(1),Input.isRepeated("left")&&this.changeNumber(-1),Input.isRepeated("up")&&this.changeNumber(10),Input.isRepeated("down")&&this.changeNumber(-10))},Window_ShopNumber.prototype.changeNumber=function(t){var e=this._number;this._number=(this._number+t).clamp(1,this._max),this._number!==e&&(SoundManager.playCursor(),this.refresh())},Window_ShopNumber.prototype.updateCursor=function(){this.setCursorRect(this.cursorX(),this.itemY(),this.cursorWidth(),this.lineHeight())},Window_ShopNumber.prototype.onButtonUp=function(){this.changeNumber(1)},Window_ShopNumber.prototype.onButtonUp2=function(){this.changeNumber(10)},Window_ShopNumber.prototype.onButtonDown=function(){this.changeNumber(-1)},Window_ShopNumber.prototype.onButtonDown2=function(){this.changeNumber(-10)},Window_ShopNumber.prototype.onButtonOk=function(){this.processOk()},Window_ShopStatus.prototype=Object.create(Window_Base.prototype),Window_ShopStatus.prototype.constructor=Window_ShopStatus,Window_ShopStatus.prototype.initialize=function(t,e,i,a){Window_Base.prototype.initialize.call(this,t,e,i,a),this._item=null,this._pageIndex=0,this.refresh()},Window_ShopStatus.prototype.refresh=function(){if(this.contents.clear(),this._item){var t=this.textPadding();this.drawPossession(t,0),this.isEquipItem()&&this.drawEquipInfo(t,2*this.lineHeight())}},Window_ShopStatus.prototype.setItem=function(t){this._item=t,this.refresh()},Window_ShopStatus.prototype.isEquipItem=function(){return DataManager.isWeapon(this._item)||DataManager.isArmor(this._item)},Window_ShopStatus.prototype.drawPossession=function(t,e){var i=this.contents.width-this.textPadding()-t,a=this.textWidth("0000");this.changeTextColor(this.systemColor()),this.drawText(TextManager.possession,t,e,i-a),this.resetTextColor(),this.drawText($gameParty.numItems(this._item),t,e,i,"right")},Window_ShopStatus.prototype.drawEquipInfo=function(t,e){for(var i=this.statusMembers(),a=0;a<i.length;a++)this.drawActorEquipInfo(t,e+2.4*this.lineHeight()*a,i[a])},Window_ShopStatus.prototype.statusMembers=function(){var t=this._pageIndex*this.pageSize(),e=t+this.pageSize();return $gameParty.members().slice(t,e)},Window_ShopStatus.prototype.pageSize=function(){return 4},Window_ShopStatus.prototype.maxPages=function(){return Math.floor(($gameParty.size()+this.pageSize()-1)/this.pageSize())},Window_ShopStatus.prototype.drawActorEquipInfo=function(t,e,i){var a=i.canEquip(this._item);this.changePaintOpacity(a),this.resetTextColor(),this.drawText(i.name(),t,e,168);var n=this.currentEquippedItem(i,this._item.etypeId);a&&this.drawActorParamChange(t,e,i,n),this.drawItemName(n,t,e+this.lineHeight()),this.changePaintOpacity(!0)},Window_ShopStatus.prototype.drawActorParamChange=function(t,e,i,a){i=this.contents.width-this.textPadding()-t;var n=this.paramId();a=this._item.params[n]-(a?a.params[n]:0),this.changeTextColor(this.paramchangeTextColor(a)),this.drawText((0<a?"+":"")+a,t,e,i,"right")},Window_ShopStatus.prototype.paramId=function(){return DataManager.isWeapon(this._item)?2:3},Window_ShopStatus.prototype.currentEquippedItem=function(t,e){var i=[],a=t.equips();t=t.equipSlots();for(var n=0;n<t.length;n++)t[n]===e&&i.push(a[n]);for(e=this.paramId(),a=Number.MAX_VALUE,t=null,n=0;n<i.length;n++)i[n]&&i[n].params[e]<a&&(a=i[n].params[e],t=i[n]);return t},Window_ShopStatus.prototype.update=function(){Window_Base.prototype.update.call(this),this.updatePage()},Window_ShopStatus.prototype.updatePage=function(){this.isPageChangeEnabled()&&this.isPageChangeRequested()&&this.changePage()},Window_ShopStatus.prototype.isPageChangeEnabled=function(){return this.visible&&2<=this.maxPages()},Window_ShopStatus.prototype.isPageChangeRequested=function(){return!!(Input.isTriggered("shift")||TouchInput.isTriggered()&&this.isTouchedInsideFrame())},Window_ShopStatus.prototype.isTouchedInsideFrame=function(){var t=this.canvasToLocalX(TouchInput.x),e=this.canvasToLocalY(TouchInput.y);return 0<=t&&0<=e&&t<this.width&&e<this.height},Window_ShopStatus.prototype.changePage=function(){this._pageIndex=(this._pageIndex+1)%this.maxPages(),this.refresh(),SoundManager.playCursor()},Window_NameEdit.prototype=Object.create(Window_Base.prototype),Window_NameEdit.prototype.constructor=Window_NameEdit,Window_NameEdit.prototype.initialize=function(t,e){var i=this.windowWidth(),a=this.windowHeight(),n=(Graphics.boxWidth-i)/2,o=(Graphics.boxHeight-(a+this.fittingHeight(9)+8))/2;Window_Base.prototype.initialize.call(this,n,o,i,a),this._actor=t,this._name=t.name().slice(0,this._maxLength),this._index=this._name.length,this._maxLength=e,this._defaultName=this._name,this.deactivate(),this.refresh(),ImageManager.reserveFace(t.faceName())},Window_NameEdit.prototype.windowWidth=function(){return 480},Window_NameEdit.prototype.windowHeight=function(){return this.fittingHeight(4)},Window_NameEdit.prototype.name=function(){return this._name},Window_NameEdit.prototype.restoreDefault=function(){return this._name=this._defaultName,this._index=this._name.length,this.refresh(),0<this._name.length},Window_NameEdit.prototype.add=function(t){return this._index<this._maxLength&&(this._name+=t,this._index++,this.refresh(),!0)},Window_NameEdit.prototype.back=function(){return 0<this._index&&(this._index--,this._name=this._name.slice(0,this._index),this.refresh(),!0)},Window_NameEdit.prototype.faceWidth=function(){return 144},Window_NameEdit.prototype.charWidth=function(){var t=$gameSystem.isJapanese()?"Ａ":"A";return this.textWidth(t)},Window_NameEdit.prototype.left=function(){var t=(this.contentsWidth()+this.faceWidth())/2,e=(this._maxLength+1)*this.charWidth();return Math.min(t-e/2,this.contentsWidth()-e)},Window_NameEdit.prototype.itemRect=function(t){return{x:this.left()+t*this.charWidth(),y:54,width:this.charWidth(),height:this.lineHeight()}},Window_NameEdit.prototype.underlineRect=function(t){return(t=this.itemRect(t)).x++,t.y+=t.height-4,t.width-=2,t.height=2,t},Window_NameEdit.prototype.underlineColor=function(){return this.normalColor()},Window_NameEdit.prototype.drawUnderline=function(t){t=this.underlineRect(t);var e=this.underlineColor();this.contents.paintOpacity=48,this.contents.fillRect(t.x,t.y,t.width,t.height,e),this.contents.paintOpacity=255},Window_NameEdit.prototype.drawChar=function(t){var e=this.itemRect(t);this.resetTextColor(),this.drawText(this._name[t]||"",e.x,e.y)},Window_NameEdit.prototype.refresh=function(){this.contents.clear(),this.drawActorFace(this._actor,0,0);for(var t=0;t<this._maxLength;t++)this.drawUnderline(t);for(t=0;t<this._name.length;t++)this.drawChar(t);t=this.itemRect(this._index),this.setCursorRect(t.x,t.y,t.width,t.height)},Window_NameInput.prototype=Object.create(Window_Selectable.prototype),Window_NameInput.prototype.constructor=Window_NameInput,Window_NameInput.LATIN1="A,B,C,D,E,a,b,c,d,e,F,G,H,I,J,f,g,h,i,j,K,L,M,N,O,k,l,m,n,o,P,Q,R,S,T,p,q,r,s,t,U,V,W,X,Y,u,v,w,x,y,Z,[,],^,_,z,{,},|,~,0,1,2,3,4,!,#,$,%,&,5,6,7,8,9,(,),*,+,-,/,=,@,<,>,:,;, ,Page,OK".split(","),Window_NameInput.LATIN2="Á;É;Í;Ó;Ú;á;é;í;ó;ú;À;È;Ì;Ò;Ù;à;è;ì;ò;ù;Â;Ê;Î;Ô;Û;â;ê;î;ô;û;Ä;Ë;Ï;Ö;Ü;ä;ë;ï;ö;ü;Ā;Ē;Ī;Ō;Ū;ā;ē;ī;ō;ū;Ã;Å;Æ;Ç;Ð;ã;å;æ;ç;ð;Ñ;Õ;Ø;Š;Ŵ;ñ;õ;ø;š;ŵ;Ý;Ŷ;Ÿ;Ž;Þ;ý;ÿ;ŷ;ž;þ;Ĳ;Œ;ĳ;œ;ß;«;»; ;Page;OK".split(";"),Window_NameInput.RUSSIA="А,Б,В,Г,Д,а,б,в,г,д,Е,Ё,Ж,З,И,е,ё,ж,з,и,Й,К,Л,М,Н,й,к,л,м,н,О,П,Р,С,Т,о,п,р,с,т,У,Ф,Х,Ц,Ч,у,ф,х,ц,ч,Ш,Щ,Ъ,Ы,Ь,ш,щ,ъ,ы,ь,Э,Ю,Я,^,_,э,ю,я,%,&,0,1,2,3,4,(,),*,+,-,5,6,7,8,9,:,;, ,,OK".split(","),Window_NameInput.JAPAN1="あ い う え お が ぎ ぐ げ ご か き く け こ ざ じ ず ぜ ぞ さ し す せ そ だ ぢ づ で ど た ち つ て と ば び ぶ べ ぼ な に ぬ ね の ぱ ぴ ぷ ぺ ぽ は ひ ふ へ ほ ぁ ぃ ぅ ぇ ぉ ま み む め も っ ゃ ゅ ょ ゎ や ゆ よ わ ん ー ～ ・ ＝ ☆ ら り る れ ろ ゔ を 　 カナ 決定".split(" "),Window_NameInput.JAPAN2="ア イ ウ エ オ ガ ギ グ ゲ ゴ カ キ ク ケ コ ザ ジ ズ ゼ ゾ サ シ ス セ ソ ダ ヂ ヅ デ ド タ チ ツ テ ト バ ビ ブ ベ ボ ナ ニ ヌ ネ ノ パ ピ プ ペ ポ ハ ヒ フ ヘ ホ ァ ィ ゥ ェ ォ マ ミ ム メ モ ッ ャ ュ ョ ヮ ヤ ユ ヨ ワ ン ー ～ ・ ＝ ☆ ラ リ ル レ ロ ヴ ヲ 　 英数 決定".split(" "),Window_NameInput.JAPAN3="Ａ Ｂ Ｃ Ｄ Ｅ ａ ｂ ｃ ｄ ｅ Ｆ Ｇ Ｈ Ｉ Ｊ ｆ ｇ ｈ ｉ ｊ Ｋ Ｌ Ｍ Ｎ Ｏ ｋ ｌ ｍ ｎ ｏ Ｐ Ｑ Ｒ Ｓ Ｔ ｐ ｑ ｒ ｓ ｔ Ｕ Ｖ Ｗ Ｘ Ｙ ｕ ｖ ｗ ｘ ｙ Ｚ ［ ］ ＾ ＿ ｚ ｛ ｝ ｜ ～ ０ １ ２ ３ ４ ！ ＃ ＄ ％ ＆ ５ ６ ７ ８ ９ （ ） ＊ ＋ － ／ ＝ ＠ ＜ ＞ ： ； 　 かな 決定".split(" "),Window_NameInput.prototype.initialize=function(t){var e=t.x,i=t.y+t.height+8,a=t.width,n=this.windowHeight();Window_Selectable.prototype.initialize.call(this,e,i,a,n),this._editWindow=t,this._index=this._page=0,this.refresh(),this.updateCursor(),this.activate()},Window_NameInput.prototype.windowHeight=function(){return this.fittingHeight(9)},Window_NameInput.prototype.table=function(){return $gameSystem.isJapanese()?[Window_NameInput.JAPAN1,Window_NameInput.JAPAN2,Window_NameInput.JAPAN3]:$gameSystem.isRussian()?[Window_NameInput.RUSSIA]:[Window_NameInput.LATIN1,Window_NameInput.LATIN2]},Window_NameInput.prototype.maxCols=function(){return 10},Window_NameInput.prototype.maxItems=function(){return 90},Window_NameInput.prototype.character=function(){return this._index<88?this.table()[this._page][this._index]:""},Window_NameInput.prototype.isPageChange=function(){return 88===this._index},Window_NameInput.prototype.isOk=function(){return 89===this._index},Window_NameInput.prototype.itemRect=function(t){return{x:t%10*42+24*Math.floor(t%10/5),y:Math.floor(t/10)*this.lineHeight(),width:42,height:this.lineHeight()}},Window_NameInput.prototype.refresh=function(){var t=this.table();this.contents.clear(),this.resetTextColor();for(var e=0;e<90;e++){var i=this.itemRect(e);i.x+=3,i.width-=6,this.drawText(t[this._page][e],i.x,i.y,i.width,"center")}},Window_NameInput.prototype.updateCursor=function(){var t=this.itemRect(this._index);this.setCursorRect(t.x,t.y,t.width,t.height)},Window_NameInput.prototype.isCursorMovable=function(){return this.active},Window_NameInput.prototype.cursorDown=function(t){(this._index<80||t)&&(this._index=(this._index+10)%90)},Window_NameInput.prototype.cursorUp=function(t){(10<=this._index||t)&&(this._index=(this._index+80)%90)},Window_NameInput.prototype.cursorRight=function(t){this._index%10<9?this._index++:t&&(this._index-=9)},Window_NameInput.prototype.cursorLeft=function(t){0<this._index%10?this._index--:t&&(this._index+=9)},Window_NameInput.prototype.cursorPagedown=function(){this._page=(this._page+1)%this.table().length,this.refresh()},Window_NameInput.prototype.cursorPageup=function(){this._page=(this._page+this.table().length-1)%this.table().length,this.refresh()},Window_NameInput.prototype.processCursorMove=function(){var t=this._page;Window_Selectable.prototype.processCursorMove.call(this),this.updateCursor(),this._page!==t&&SoundManager.playCursor()},Window_NameInput.prototype.processHandling=function(){this.isOpen()&&this.active&&(Input.isTriggered("shift")&&this.processJump(),Input.isRepeated("cancel")&&this.processBack(),Input.isRepeated("ok")&&this.processOk())},Window_NameInput.prototype.isCancelEnabled=function(){return!0},Window_NameInput.prototype.processCancel=function(){this.processBack()},Window_NameInput.prototype.processJump=function(){89!==this._index&&(this._index=89,SoundManager.playCursor())},Window_NameInput.prototype.processBack=function(){this._editWindow.back()&&SoundManager.playCancel()},Window_NameInput.prototype.processOk=function(){this.character()?this.onNameAdd():this.isPageChange()?(SoundManager.playOk(),this.cursorPagedown()):this.isOk()&&this.onNameOk()},Window_NameInput.prototype.onNameAdd=function(){this._editWindow.add(this.character())?SoundManager.playOk():SoundManager.playBuzzer()},Window_NameInput.prototype.onNameOk=function(){""===this._editWindow.name()?this._editWindow.restoreDefault()?SoundManager.playOk():SoundManager.playBuzzer():(SoundManager.playOk(),this.callOkHandler())},Window_ChoiceList.prototype=Object.create(Window_Command.prototype),Window_ChoiceList.prototype.constructor=Window_ChoiceList,Window_ChoiceList.prototype.initialize=function(t){this._messageWindow=t,Window_Command.prototype.initialize.call(this,0,0),this.openness=0,this.deactivate(),this._background=0},Window_ChoiceList.prototype.start=function(){this.updatePlacement(),this.updateBackground(),this.refresh(),this.selectDefault(),this.open(),this.activate()},Window_ChoiceList.prototype.selectDefault=function(){this.select($gameMessage.choiceDefaultType())},Window_ChoiceList.prototype.updatePlacement=function(){var t=$gameMessage.choicePositionType(),e=this._messageWindow.y;switch(this.width=this.windowWidth(),this.height=this.windowHeight(),t){case 0:this.x=0;break;case 1:this.x=(Graphics.boxWidth-this.width)/2;break;case 2:this.x=Graphics.boxWidth-this.width}this.y=e>=Graphics.boxHeight/2?e-this.height:e+this._messageWindow.height},Window_ChoiceList.prototype.updateBackground=function(){this._background=$gameMessage.choiceBackground(),this.setBackgroundType(this._background)},Window_ChoiceList.prototype.windowWidth=function(){var t=this.maxChoiceWidth()+2*this.padding;return Math.min(t,Graphics.boxWidth)},Window_ChoiceList.prototype.numVisibleRows=function(){var t=this._messageWindow.y,e=this._messageWindow.height,i=Graphics.boxHeight/2,a=$gameMessage.choices().length,n=8;return t<i&&i<t+e&&(n=4),n<a&&(a=n),a},Window_ChoiceList.prototype.maxChoiceWidth=function(){for(var t=96,e=$gameMessage.choices(),i=0;i<e.length;i++){var a=this.textWidthEx(e[i])+2*this.textPadding();t<a&&(t=a)}return t},Window_ChoiceList.prototype.textWidthEx=function(t){return this.drawTextEx(t,0,this.contents.height)},Window_ChoiceList.prototype.contentsHeight=function(){return this.maxItems()*this.itemHeight()},Window_ChoiceList.prototype.makeCommandList=function(){for(var t=$gameMessage.choices(),e=0;e<t.length;e++)this.addCommand(t[e],"choice")},Window_ChoiceList.prototype.drawItem=function(t){var e=this.itemRectForText(t);this.drawTextEx(this.commandName(t),e.x,e.y)},Window_ChoiceList.prototype.isCancelEnabled=function(){return-1!==$gameMessage.choiceCancelType()},Window_ChoiceList.prototype.isOkTriggered=function(){return Input.isTriggered("ok")},Window_ChoiceList.prototype.callOkHandler=function(){$gameMessage.onChoice(this.index()),this._messageWindow.terminateMessage(),this.close()},Window_ChoiceList.prototype.callCancelHandler=function(){$gameMessage.onChoice($gameMessage.choiceCancelType()),this._messageWindow.terminateMessage(),this.close()},Window_NumberInput.prototype=Object.create(Window_Selectable.prototype),Window_NumberInput.prototype.constructor=Window_NumberInput,Window_NumberInput.prototype.initialize=function(t){this._messageWindow=t,Window_Selectable.prototype.initialize.call(this,0,0,0,0),this._number=0,this._maxDigits=1,this.openness=0,this.createButtons(),this.deactivate()},Window_NumberInput.prototype.start=function(){this._maxDigits=$gameMessage.numInputMaxDigits(),this._number=$gameVariables.value($gameMessage.numInputVariableId()),this._number=this._number.clamp(0,Math.pow(10,this._maxDigits)-1),this.updatePlacement(),this.placeButtons(),this.updateButtonsVisiblity(),this.createContents(),this.refresh(),this.open(),this.activate(),this.select(0)},Window_NumberInput.prototype.updatePlacement=function(){var t=this._messageWindow.y;this.width=this.windowWidth(),this.height=this.windowHeight(),this.x=(Graphics.boxWidth-this.width)/2,this.y=t>=Graphics.boxHeight/2?t-this.height-8:t+this._messageWindow.height+8},Window_NumberInput.prototype.windowWidth=function(){return this.maxCols()*this.itemWidth()+2*this.padding},Window_NumberInput.prototype.windowHeight=function(){return this.fittingHeight(1)},Window_NumberInput.prototype.maxCols=function(){return this._maxDigits},Window_NumberInput.prototype.maxItems=function(){return this._maxDigits},Window_NumberInput.prototype.spacing=function(){return 0},Window_NumberInput.prototype.itemWidth=function(){return 32},Window_NumberInput.prototype.createButtons=function(){var t=ImageManager.loadSystem("ButtonSet");this._buttons=[];for(var e=0;e<3;e++){var i=new Sprite_Button,a=48*[1,2,4][e],n=48*(2===e?2:1);i.bitmap=t,i.setColdFrame(a,0,n,48),i.setHotFrame(a,48,n,48),i.visible=!1,this._buttons.push(i),this.addChild(i)}this._buttons[0].setClickHandler(this.onButtonDown.bind(this)),this._buttons[1].setClickHandler(this.onButtonUp.bind(this)),this._buttons[2].setClickHandler(this.onButtonOk.bind(this))},Window_NumberInput.prototype.placeButtons=function(){for(var t=this._buttons.length,e=-16,i=0;i<t;i++)e+=this._buttons[i].width+16;for(e=(this.width-e)/2,i=0;i<t;i++){var a=this._buttons[i];a.x=e,a.y=this.buttonY(),e+=a.width+16}},Window_NumberInput.prototype.updateButtonsVisiblity=function(){TouchInput.date>Input.date?this.showButtons():this.hideButtons()},Window_NumberInput.prototype.showButtons=function(){for(var t=0;t<this._buttons.length;t++)this._buttons[t].visible=!0},Window_NumberInput.prototype.hideButtons=function(){for(var t=0;t<this._buttons.length;t++)this._buttons[t].visible=!1},Window_NumberInput.prototype.buttonY=function(){return this._messageWindow.y>=Graphics.boxHeight/2?0-this._buttons[0].height-8:this.height+8},Window_NumberInput.prototype.update=function(){Window_Selectable.prototype.update.call(this),this.processDigitChange()},Window_NumberInput.prototype.processDigitChange=function(){this.isOpenAndActive()&&(Input.isRepeated("up")?this.changeDigit(!0):Input.isRepeated("down")&&this.changeDigit(!1))},Window_NumberInput.prototype.changeDigit=function(t){var e=this.index();e=Math.pow(10,this._maxDigits-1-e);var i=Math.floor(this._number/e)%10;this._number-=i*e,this._number+=(t?(1+i)%10:(9+i)%10)*e,this.refresh(),SoundManager.playCursor()},Window_NumberInput.prototype.isTouchOkEnabled=function(){return!1},Window_NumberInput.prototype.isOkEnabled=function(){return!0},Window_NumberInput.prototype.isCancelEnabled=function(){return!1},Window_NumberInput.prototype.isOkTriggered=function(){return Input.isTriggered("ok")},Window_NumberInput.prototype.processOk=function(){SoundManager.playOk(),$gameVariables.setValue($gameMessage.numInputVariableId(),this._number),this._messageWindow.terminateMessage(),this.updateInputData(),this.deactivate(),this.close()},Window_NumberInput.prototype.drawItem=function(t){var e=this.itemRect(t);t=this._number.padZero(this._maxDigits).slice(t,t+1),this.resetTextColor(),this.drawText(t,e.x,e.y,e.width,"center")},Window_NumberInput.prototype.onButtonUp=function(){this.changeDigit(!0)};Window_NumberInput.prototype.onButtonDown=function(){this.changeDigit(!1)},Window_NumberInput.prototype.onButtonOk=function(){this.processOk(),this.hideButtons()},Window_EventItem.prototype=Object.create(Window_ItemList.prototype),Window_EventItem.prototype.constructor=Window_EventItem,Window_EventItem.prototype.initialize=function(t){this._messageWindow=t,t=Graphics.boxWidth;var e=this.windowHeight();Window_ItemList.prototype.initialize.call(this,0,0,t,e),this.openness=0,this.deactivate(),this.setHandler("ok",this.onOk.bind(this)),this.setHandler("cancel",this.onCancel.bind(this))},Window_EventItem.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())},Window_EventItem.prototype.numVisibleRows=function(){return 4},Window_EventItem.prototype.start=function(){this.refresh(),this.updatePlacement(),this.select(0),this.open(),this.activate()},Window_EventItem.prototype.updatePlacement=function(){this.y=this._messageWindow.y>=Graphics.boxHeight/2?0:Graphics.boxHeight-this.height},Window_EventItem.prototype.includes=function(t){var e=$gameMessage.itemChoiceItypeId();return DataManager.isItem(t)&&t.itypeId===e},Window_EventItem.prototype.isEnabled=function(t){return!0},Window_EventItem.prototype.onOk=function(){var t=this.item();t=t?t.id:0,$gameVariables.setValue($gameMessage.itemChoiceVariableId(),t),this._messageWindow.terminateMessage(),this.close()},Window_EventItem.prototype.onCancel=function(){$gameVariables.setValue($gameMessage.itemChoiceVariableId(),0),this._messageWindow.terminateMessage(),this.close()},Window_Message.prototype=Object.create(Window_Base.prototype),Window_Message.prototype.constructor=Window_Message,Window_Message.prototype.initialize=function(){var t=this.windowWidth(),e=this.windowHeight();Window_Base.prototype.initialize.call(this,(Graphics.boxWidth-t)/2,0,t,e),this.openness=0,this.initMembers(),this.createSubWindows(),this.updatePlacement()},Window_Message.prototype.initMembers=function(){this._imageReservationId=Utils.generateRuntimeId(),this._background=0,this._positionType=2,this._waitCount=0,this._textState=this._faceBitmap=null,this.clearFlags()},Window_Message.prototype.subWindows=function(){return[this._goldWindow,this._choiceWindow,this._numberWindow,this._itemWindow]},Window_Message.prototype.createSubWindows=function(){this._goldWindow=new Window_Gold(0,0),this._goldWindow.x=Graphics.boxWidth-this._goldWindow.width,this._goldWindow.openness=0,this._choiceWindow=new Window_ChoiceList(this),this._numberWindow=new Window_NumberInput(this),this._itemWindow=new Window_EventItem(this)},Window_Message.prototype.windowWidth=function(){return Graphics.boxWidth},Window_Message.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())},Window_Message.prototype.clearFlags=function(){this._pauseSkip=this._lineShowFast=this._showFast=!1},Window_Message.prototype.numVisibleRows=function(){return 4},Window_Message.prototype.update=function(){for(this.checkToNotClose(),Window_Base.prototype.update.call(this);!(this.isOpening()||this.isClosing()||this.updateWait()||this.updateLoading()||this.updateInput()||this.updateMessage());){if(!this.canStart()){this.startInput();break}this.startMessage()}},Window_Message.prototype.checkToNotClose=function(){this.isClosing()&&this.isOpen()&&this.doesContinue()&&this.open()},Window_Message.prototype.canStart=function(){return $gameMessage.hasText()&&!$gameMessage.scrollMode()},Window_Message.prototype.startMessage=function(){this._textState={},this._textState.index=0,this._textState.text=this.convertEscapeCharacters($gameMessage.allText()),this.newPage(this._textState),this.updatePlacement(),this.updateBackground(),this.open()},Window_Message.prototype.updatePlacement=function(){this._positionType=$gameMessage.positionType(),this.y=this._positionType*(Graphics.boxHeight-this.height)/2,this._goldWindow.y=0<this.y?0:Graphics.boxHeight-this._goldWindow.height},Window_Message.prototype.updateBackground=function(){this._background=$gameMessage.background(),this.setBackgroundType(this._background)},Window_Message.prototype.terminateMessage=function(){this.close(),this._goldWindow.close(),$gameMessage.clear()},Window_Message.prototype.updateWait=function(){return 0<this._waitCount&&(this._waitCount--,!0)},Window_Message.prototype.updateLoading=function(){return!!this._faceBitmap&&(!this._faceBitmap.isReady()||(this.drawMessageFace(),this._faceBitmap=null,!1))},Window_Message.prototype.updateInput=function(){return!!this.isAnySubWindowActive()||!!this.pause&&(this.isTriggered()&&(Input.update(),this.pause=!1,this._textState||this.terminateMessage()),!0)},Window_Message.prototype.isAnySubWindowActive=function(){return this._choiceWindow.active||this._numberWindow.active||this._itemWindow.active},Window_Message.prototype.updateMessage=function(){if(this._textState){for(;!this.isEndOfText(this._textState)&&(this.needsNewPage(this._textState)&&this.newPage(this._textState),this.updateShowFast(),this.processCharacter(this._textState),this._showFast||this._lineShowFast)&&!(this.pause||0<this._waitCount););return this.isEndOfText(this._textState)&&this.onEndOfText(),!0}return!1},Window_Message.prototype.onEndOfText=function(){this.startInput()||(this._pauseSkip?this.terminateMessage():this.startPause()),this._textState=null},Window_Message.prototype.startInput=function(){return $gameMessage.isChoice()?(this._choiceWindow.start(),!0):$gameMessage.isNumberInput()?(this._numberWindow.start(),!0):!!$gameMessage.isItemChoice()&&(this._itemWindow.start(),!0)},Window_Message.prototype.isTriggered=function(){return Input.isRepeated("ok")||Input.isRepeated("cancel")||TouchInput.isRepeated()},Window_Message.prototype.doesContinue=function(){return $gameMessage.hasText()&&!$gameMessage.scrollMode()&&!this.areSettingsChanged()},Window_Message.prototype.areSettingsChanged=function(){return this._background!==$gameMessage.background()||this._positionType!==$gameMessage.positionType()},Window_Message.prototype.updateShowFast=function(){this.isTriggered()&&(this._showFast=!0)},Window_Message.prototype.newPage=function(t){this.contents.clear(),this.resetFontSettings(),this.clearFlags(),this.loadMessageFace(),t.x=this.newLineX(),t.y=0,t.left=this.newLineX(),t.height=this.calcTextHeight(t,!1)},Window_Message.prototype.loadMessageFace=function(){this._faceBitmap=ImageManager.reserveFace($gameMessage.faceName(),0,this._imageReservationId)},Window_Message.prototype.drawMessageFace=function(){this.drawFace($gameMessage.faceName(),$gameMessage.faceIndex(),0,0),ImageManager.releaseReservation(this._imageReservationId)},Window_Message.prototype.newLineX=function(){return""===$gameMessage.faceName()?0:168},Window_Message.prototype.processNewLine=function(t){this._lineShowFast=!1,Window_Base.prototype.processNewLine.call(this,t),this.needsNewPage(t)&&this.startPause()},Window_Message.prototype.processNewPage=function(t){Window_Base.prototype.processNewPage.call(this,t),"\n"===t.text[t.index]&&t.index++,t.y=this.contents.height,this.startPause()},Window_Message.prototype.isEndOfText=function(t){return t.index>=t.text.length},Window_Message.prototype.needsNewPage=function(t){return!this.isEndOfText(t)&&t.y+t.height>this.contents.height},Window_Message.prototype.processEscapeCharacter=function(t,e){switch(t){case"$":this._goldWindow.open();break;case".":this.startWait(15);break;case"|":this.startWait(60);break;case"!":this.startPause();break;case">":this._lineShowFast=!0;break;case"<":this._lineShowFast=!1;break;case"^":this._pauseSkip=!0;break;default:Window_Base.prototype.processEscapeCharacter.call(this,t,e)}},Window_Message.prototype.startWait=function(t){this._waitCount=t},Window_Message.prototype.startPause=function(){this.startWait(10),this.pause=!0},Window_ScrollText.prototype=Object.create(Window_Base.prototype),Window_ScrollText.prototype.constructor=Window_ScrollText,Window_ScrollText.prototype.initialize=function(){Window_Base.prototype.initialize.call(this,0,0,Graphics.boxWidth,Graphics.boxHeight),this.opacity=0,this.hide(),this._text="",this._allTextHeight=0},Window_ScrollText.prototype.update=function(){Window_Base.prototype.update.call(this),$gameMessage.scrollMode()&&(this._text&&this.updateMessage(),!this._text&&$gameMessage.hasText()&&this.startMessage())},Window_ScrollText.prototype.startMessage=function(){this._text=$gameMessage.allText(),this.refresh(),this.show()},Window_ScrollText.prototype.refresh=function(){var t={index:0};t.text=this.convertEscapeCharacters(this._text),this.resetFontSettings(),this._allTextHeight=this.calcTextHeight(t,!0),this.createContents(),this.origin.y=-this.height,this.drawTextEx(this._text,this.textPadding(),1)},Window_ScrollText.prototype.contentsHeight=function(){return Math.max(this._allTextHeight,1)},Window_ScrollText.prototype.updateMessage=function(){this.origin.y+=this.scrollSpeed(),this.origin.y>=this.contents.height&&this.terminateMessage()},Window_ScrollText.prototype.scrollSpeed=function(){var t=$gameMessage.scrollSpeed()/2;return this.isFastForward()&&(t*=this.fastForwardRate()),t},Window_ScrollText.prototype.isFastForward=function(){return!$gameMessage.scrollNoFast()&&(Input.isPressed("ok")||Input.isPressed("shift")||TouchInput.isPressed())},Window_ScrollText.prototype.fastForwardRate=function(){return 3},Window_ScrollText.prototype.terminateMessage=function(){this._text=null,$gameMessage.clear(),this.hide()},Window_MapName.prototype=Object.create(Window_Base.prototype),Window_MapName.prototype.constructor=Window_MapName,Window_MapName.prototype.initialize=function(){var t=this.windowWidth(),e=this.windowHeight();Window_Base.prototype.initialize.call(this,0,0,t,e),this._showCount=this.contentsOpacity=this.opacity=0,this.refresh()},Window_MapName.prototype.windowWidth=function(){return 360},Window_MapName.prototype.windowHeight=function(){return this.fittingHeight(1)},Window_MapName.prototype.update=function(){Window_Base.prototype.update.call(this),0<this._showCount&&$gameMap.isNameDisplayEnabled()?(this.updateFadeIn(),this._showCount--):this.updateFadeOut()},Window_MapName.prototype.updateFadeIn=function(){this.contentsOpacity+=16},Window_MapName.prototype.updateFadeOut=function(){this.contentsOpacity-=16},Window_MapName.prototype.open=function(){this.refresh(),this._showCount=150},Window_MapName.prototype.close=function(){this._showCount=0},Window_MapName.prototype.refresh=function(){if(this.contents.clear(),$gameMap.displayName()){var t=this.contentsWidth();this.drawBackground(0,0,t,this.lineHeight()),this.drawText($gameMap.displayName(),0,0,t,"center")}},Window_MapName.prototype.drawBackground=function(t,e,i,a){var n=this.dimColor1(),o=this.dimColor2();this.contents.gradientFillRect(t,e,i/2,a,o,n),this.contents.gradientFillRect(t+i/2,e,i/2,a,n,o)},Window_BattleLog.prototype=Object.create(Window_Selectable.prototype),Window_BattleLog.prototype.constructor=Window_BattleLog,Window_BattleLog.prototype.initialize=function(){var t=this.windowWidth(),e=this.windowHeight();Window_Selectable.prototype.initialize.call(this,0,0,t,e),this.opacity=0,this._lines=[],this._methods=[],this._waitCount=0,this._waitMode="",this._baseLineStack=[],this._spriteset=null,this.createBackBitmap(),this.createBackSprite(),this.refresh()},Window_BattleLog.prototype.setSpriteset=function(t){this._spriteset=t},Window_BattleLog.prototype.windowWidth=function(){return Graphics.boxWidth},Window_BattleLog.prototype.windowHeight=function(){return this.fittingHeight(this.maxLines())},Window_BattleLog.prototype.maxLines=function(){return 10},Window_BattleLog.prototype.createBackBitmap=function(){this._backBitmap=new Bitmap(this.width,this.height)},Window_BattleLog.prototype.createBackSprite=function(){this._backSprite=new Sprite,this._backSprite.bitmap=this._backBitmap,this._backSprite.y=this.y,this.addChildToBack(this._backSprite)},Window_BattleLog.prototype.numLines=function(){return this._lines.length},Window_BattleLog.prototype.messageSpeed=function(){return 16},Window_BattleLog.prototype.isBusy=function(){return 0<this._waitCount||this._waitMode||0<this._methods.length},Window_BattleLog.prototype.update=function(){this.updateWait()||this.callNextMethod()},Window_BattleLog.prototype.updateWait=function(){return this.updateWaitCount()||this.updateWaitMode()},Window_BattleLog.prototype.updateWaitCount=function(){return 0<this._waitCount&&(this._waitCount-=this.isFastForward()?3:1,this._waitCount<0&&(this._waitCount=0),!0)},Window_BattleLog.prototype.updateWaitMode=function(){var t=!1;switch(this._waitMode){case"effect":t=this._spriteset.isEffecting();break;case"movement":t=this._spriteset.isAnyoneMoving()}return t||(this._waitMode=""),t},Window_BattleLog.prototype.setWaitMode=function(t){this._waitMode=t},Window_BattleLog.prototype.callNextMethod=function(){if(0<this._methods.length){var t=this._methods.shift();if(!t.name||!this[t.name])throw Error("Method not found: "+t.name);this[t.name].apply(this,t.params)}},Window_BattleLog.prototype.isFastForward=function(){return Input.isLongPressed("ok")||Input.isPressed("shift")||TouchInput.isLongPressed()},Window_BattleLog.prototype.push=function(t){var e=Array.prototype.slice.call(arguments,1);this._methods.push({name:t,params:e})},Window_BattleLog.prototype.clear=function(){this._lines=[],this._baseLineStack=[],this.refresh()},Window_BattleLog.prototype.wait=function(){this._waitCount=this.messageSpeed()},Window_BattleLog.prototype.waitForEffect=function(){this.setWaitMode("effect")},Window_BattleLog.prototype.waitForMovement=function(){this.setWaitMode("movement")},Window_BattleLog.prototype.addText=function(t){this._lines.push(t),this.refresh(),this.wait()},Window_BattleLog.prototype.pushBaseLine=function(){this._baseLineStack.push(this._lines.length)},Window_BattleLog.prototype.popBaseLine=function(){for(var t=this._baseLineStack.pop();this._lines.length>t;)this._lines.pop()},Window_BattleLog.prototype.waitForNewLine=function(){var t=0;0<this._baseLineStack.length&&(t=this._baseLineStack[this._baseLineStack.length-1]),this._lines.length>t&&this.wait()},Window_BattleLog.prototype.popupDamage=function(t){t.startDamagePopup()},Window_BattleLog.prototype.performActionStart=function(t,e){t.performActionStart(e)},Window_BattleLog.prototype.performAction=function(t,e){t.performAction(e)},Window_BattleLog.prototype.performActionEnd=function(t){t.performActionEnd()},Window_BattleLog.prototype.performDamage=function(t){t.performDamage()},Window_BattleLog.prototype.performMiss=function(t){t.performMiss()},Window_BattleLog.prototype.performRecovery=function(t){t.performRecovery()},Window_BattleLog.prototype.performEvasion=function(t){t.performEvasion()},Window_BattleLog.prototype.performMagicEvasion=function(t){t.performMagicEvasion()},Window_BattleLog.prototype.performCounter=function(t){t.performCounter()},Window_BattleLog.prototype.performReflection=function(t){t.performReflection()},Window_BattleLog.prototype.performSubstitute=function(t,e){t.performSubstitute(e)},Window_BattleLog.prototype.performCollapse=function(t){t.performCollapse()},Window_BattleLog.prototype.showAnimation=function(t,e,i){i<0?this.showAttackAnimation(t,e):this.showNormalAnimation(e,i)},Window_BattleLog.prototype.showAttackAnimation=function(t,e){t.isActor()?this.showActorAttackAnimation(t,e):this.showEnemyAttackAnimation(t,e)},Window_BattleLog.prototype.showActorAttackAnimation=function(t,e){this.showNormalAnimation(e,t.attackAnimationId1(),!1),this.showNormalAnimation(e,t.attackAnimationId2(),!0)},Window_BattleLog.prototype.showEnemyAttackAnimation=function(t,e){SoundManager.playEnemyAttack()},Window_BattleLog.prototype.showNormalAnimation=function(t,e,i){if($dataAnimations[e]){var a=this.animationBaseDelay(),n=this.animationNextDelay();t.forEach(function(t){t.startAnimation(e,i,a),a+=n})}},Window_BattleLog.prototype.animationBaseDelay=function(){return 8},Window_BattleLog.prototype.animationNextDelay=function(){return 12},Window_BattleLog.prototype.refresh=function(){this.drawBackground(),this.contents.clear();for(var t=0;t<this._lines.length;t++)this.drawLineText(t)},Window_BattleLog.prototype.drawBackground=function(){var t=this.backRect(),e=this.backColor();this._backBitmap.clear(),this._backBitmap.paintOpacity=this.backPaintOpacity(),this._backBitmap.fillRect(t.x,t.y,t.width,t.height,e),this._backBitmap.paintOpacity=255},Window_BattleLog.prototype.backRect=function(){return{x:0,y:this.padding,width:this.width,height:this.numLines()*this.lineHeight()}},Window_BattleLog.prototype.backColor=function(){return"#000000"},Window_BattleLog.prototype.backPaintOpacity=function(){return 64},Window_BattleLog.prototype.drawLineText=function(t){var e=this.itemRectForText(t);this.contents.clearRect(e.x,e.y,e.width,e.height),this.drawTextEx(this._lines[t],e.x,e.y,e.width)},Window_BattleLog.prototype.startTurn=function(){this.push("wait")},Window_BattleLog.prototype.startAction=function(t,e,i){var a=e.item();this.push("performActionStart",t,e),this.push("waitForMovement"),this.push("performAction",t,e),this.push("showAnimation",t,i.clone(),a.animationId),this.displayAction(t,a)},Window_BattleLog.prototype.endAction=function(t){this.push("waitForNewLine"),this.push("clear"),this.push("performActionEnd",t)},Window_BattleLog.prototype.displayCurrentState=function(t){var e=t.mostImportantStateText();e&&(this.push("addText",t.name()+e),this.push("wait"),this.push("clear"))},Window_BattleLog.prototype.displayRegeneration=function(t){this.push("popupDamage",t)},Window_BattleLog.prototype.displayAction=function(t,e){var i=this._methods.length;DataManager.isSkill(e)?(e.message1&&this.push("addText",t.name()+e.message1.format(e.name)),e.message2&&this.push("addText",e.message2.format(e.name))):this.push("addText",TextManager.useItem.format(t.name(),e.name)),this._methods.length===i&&this.push("wait")},Window_BattleLog.prototype.displayCounter=function(t){this.push("performCounter",t),this.push("addText",TextManager.counterAttack.format(t.name()))},Window_BattleLog.prototype.displayReflection=function(t){this.push("performReflection",t),this.push("addText",TextManager.magicReflection.format(t.name()))},Window_BattleLog.prototype.displaySubstitute=function(t,e){var i=t.name();this.push("performSubstitute",t,e),this.push("addText",TextManager.substitute.format(i,e.name()))},Window_BattleLog.prototype.displayActionResults=function(t,e){e.result().used&&(this.push("pushBaseLine"),this.displayCritical(e),this.push("popupDamage",e),this.push("popupDamage",t),this.displayDamage(e),this.displayAffectedStatus(e),this.displayFailure(e),this.push("waitForNewLine"),this.push("popBaseLine"))},Window_BattleLog.prototype.displayFailure=function(t){t.result().isHit()&&!t.result().success&&this.push("addText",TextManager.actionFailure.format(t.name()))},Window_BattleLog.prototype.displayCritical=function(t){t.result().critical&&(t.isActor()?this.push("addText",TextManager.criticalToActor):this.push("addText",TextManager.criticalToEnemy))},Window_BattleLog.prototype.displayDamage=function(t){t.result().missed?this.displayMiss(t):t.result().evaded?this.displayEvasion(t):(this.displayHpDamage(t),this.displayMpDamage(t),this.displayTpDamage(t))},Window_BattleLog.prototype.displayMiss=function(t){if(t.result().physical){var e=t.isActor()?TextManager.actorNoHit:TextManager.enemyNoHit;this.push("performMiss",t)}else e=TextManager.actionFailure;this.push("addText",e.format(t.name()))},Window_BattleLog.prototype.displayEvasion=function(t){if(t.result().physical){var e=TextManager.evasion;this.push("performEvasion",t)}else e=TextManager.magicEvasion,this.push("performMagicEvasion",t);this.push("addText",e.format(t.name()))},Window_BattleLog.prototype.displayHpDamage=function(t){t.result().hpAffected&&(0<t.result().hpDamage&&!t.result().drain&&this.push("performDamage",t),t.result().hpDamage<0&&this.push("performRecovery",t),this.push("addText",this.makeHpDamageText(t)))},Window_BattleLog.prototype.displayMpDamage=function(t){t.isAlive()&&0!==t.result().mpDamage&&(t.result().mpDamage<0&&this.push("performRecovery",t),this.push("addText",this.makeMpDamageText(t)))},Window_BattleLog.prototype.displayTpDamage=function(t){t.isAlive()&&0!==t.result().tpDamage&&(t.result().tpDamage<0&&this.push("performRecovery",t),this.push("addText",this.makeTpDamageText(t)))},Window_BattleLog.prototype.displayAffectedStatus=function(t){t.result().isStatusAffected()&&(this.push("pushBaseLine"),this.displayChangedStates(t),this.displayChangedBuffs(t),this.push("waitForNewLine"),this.push("popBaseLine"))},Window_BattleLog.prototype.displayAutoAffectedStatus=function(t){t.result().isStatusAffected()&&(this.displayAffectedStatus(t,null),this.push("clear"))},Window_BattleLog.prototype.displayChangedStates=function(t){this.displayAddedStates(t),this.displayRemovedStates(t)},Window_BattleLog.prototype.displayAddedStates=function(i){i.result().addedStateObjects().forEach(function(t){var e=i.isActor()?t.message1:t.message2;t.id===i.deathStateId()&&this.push("performCollapse",i),e&&(this.push("popBaseLine"),this.push("pushBaseLine"),this.push("addText",i.name()+e),this.push("waitForEffect"))},this)},Window_BattleLog.prototype.displayRemovedStates=function(e){e.result().removedStateObjects().forEach(function(t){t.message4&&(this.push("popBaseLine"),this.push("pushBaseLine"),this.push("addText",e.name()+t.message4))},this)},Window_BattleLog.prototype.displayChangedBuffs=function(t){var e=t.result();this.displayBuffs(t,e.addedBuffs,TextManager.buffAdd),this.displayBuffs(t,e.addedDebuffs,TextManager.debuffAdd),this.displayBuffs(t,e.removedBuffs,TextManager.buffRemove)},Window_BattleLog.prototype.displayBuffs=function(e,t,i){t.forEach(function(t){this.push("popBaseLine"),this.push("pushBaseLine"),this.push("addText",i.format(e.name(),TextManager.param(t)))},this)},Window_BattleLog.prototype.makeHpDamageText=function(t){var e=t.result(),i=e.hpDamage,a=t.isActor();return 0<i&&e.drain?(e=a?TextManager.actorDrain:TextManager.enemyDrain).format(t.name(),TextManager.hp,i):0<i?(e=a?TextManager.actorDamage:TextManager.enemyDamage).format(t.name(),i):i<0?(e=a?TextManager.actorRecovery:TextManager.enemyRecovery).format(t.name(),TextManager.hp,-i):(e=a?TextManager.actorNoDamage:TextManager.enemyNoDamage).format(t.name())},Window_BattleLog.prototype.makeMpDamageText=function(t){var e=t.result(),i=e.mpDamage,a=t.isActor();return 0<i&&e.drain?(e=a?TextManager.actorDrain:TextManager.enemyDrain).format(t.name(),TextManager.mp,i):0<i?(e=a?TextManager.actorLoss:TextManager.enemyLoss).format(t.name(),TextManager.mp,i):i<0?(e=a?TextManager.actorRecovery:TextManager.enemyRecovery).format(t.name(),TextManager.mp,-i):""},Window_BattleLog.prototype.makeTpDamageText=function(t){var e=t.result().tpDamage,i=t.isActor();return 0<e?(i=i?TextManager.actorLoss:TextManager.enemyLoss).format(t.name(),TextManager.tp,e):e<0?(i=i?TextManager.actorGain:TextManager.enemyGain).format(t.name(),TextManager.tp,-e):""},Window_PartyCommand.prototype=Object.create(Window_Command.prototype),Window_PartyCommand.prototype.constructor=Window_PartyCommand,Window_PartyCommand.prototype.initialize=function(){var t=Graphics.boxHeight-this.windowHeight();Window_Command.prototype.initialize.call(this,0,t),this.openness=0,this.deactivate()},Window_PartyCommand.prototype.windowWidth=function(){return 192},Window_PartyCommand.prototype.numVisibleRows=function(){return 4},Window_PartyCommand.prototype.makeCommandList=function(){this.addCommand(TextManager.fight,"fight"),this.addCommand(TextManager.escape,"escape",BattleManager.canEscape())},Window_PartyCommand.prototype.setup=function(){this.clearCommandList(),this.makeCommandList(),this.refresh(),this.select(0),this.activate(),this.open()},Window_ActorCommand.prototype=Object.create(Window_Command.prototype),Window_ActorCommand.prototype.constructor=Window_ActorCommand,Window_ActorCommand.prototype.initialize=function(){var t=Graphics.boxHeight-this.windowHeight();Window_Command.prototype.initialize.call(this,0,t),this.openness=0,this.deactivate(),this._actor=null},Window_ActorCommand.prototype.windowWidth=function(){return 192},Window_ActorCommand.prototype.numVisibleRows=function(){return 4},Window_ActorCommand.prototype.makeCommandList=function(){this._actor&&(this.addAttackCommand(),this.addSkillCommands(),this.addGuardCommand(),this.addItemCommand())},Window_ActorCommand.prototype.addAttackCommand=function(){this.addCommand(TextManager.attack,"attack",this._actor.canAttack())},Window_ActorCommand.prototype.addSkillCommands=function(){var t=this._actor.addedSkillTypes();t.sort(function(t,e){return t-e}),t.forEach(function(t){this.addCommand($dataSystem.skillTypes[t],"skill",!0,t)},this)},Window_ActorCommand.prototype.addGuardCommand=function(){this.addCommand(TextManager.guard,"guard",this._actor.canGuard())},Window_ActorCommand.prototype.addItemCommand=function(){this.addCommand(TextManager.item,"item")},Window_ActorCommand.prototype.setup=function(t){this._actor=t,this.clearCommandList(),this.makeCommandList(),this.refresh(),this.selectLast(),this.activate(),this.open()},Window_ActorCommand.prototype.processOk=function(){this._actor&&(ConfigManager.commandRemember?this._actor.setLastCommandSymbol(this.currentSymbol()):this._actor.setLastCommandSymbol("")),Window_Command.prototype.processOk.call(this)},Window_ActorCommand.prototype.selectLast=function(){if(this.select(0),this._actor&&ConfigManager.commandRemember){var t=this._actor.lastCommandSymbol();this.selectSymbol(t),"skill"===t&&(t=this._actor.lastBattleSkill())&&this.selectExt(t.stypeId)}},Window_BattleStatus.prototype=Object.create(Window_Selectable.prototype),Window_BattleStatus.prototype.constructor=Window_BattleStatus,Window_BattleStatus.prototype.initialize=function(){var t=this.windowWidth(),e=this.windowHeight();Window_Selectable.prototype.initialize.call(this,Graphics.boxWidth-t,Graphics.boxHeight-e,t,e),this.refresh(),this.openness=0},Window_BattleStatus.prototype.windowWidth=function(){return Graphics.boxWidth-192},Window_BattleStatus.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())},Window_BattleStatus.prototype.numVisibleRows=function(){return 4},Window_BattleStatus.prototype.maxItems=function(){return $gameParty.battleMembers().length},Window_BattleStatus.prototype.refresh=function(){this.contents.clear(),this.drawAllItems()},Window_BattleStatus.prototype.drawItem=function(t){var e=$gameParty.battleMembers()[t];this.drawBasicArea(this.basicAreaRect(t),e),this.drawGaugeArea(this.gaugeAreaRect(t),e)},Window_BattleStatus.prototype.basicAreaRect=function(t){return(t=this.itemRectForText(t)).width-=this.gaugeAreaWidth()+15,t},Window_BattleStatus.prototype.gaugeAreaRect=function(t){return(t=this.itemRectForText(t)).x+=t.width-this.gaugeAreaWidth(),t.width=this.gaugeAreaWidth(),t},Window_BattleStatus.prototype.gaugeAreaWidth=function(){return 330},Window_BattleStatus.prototype.drawBasicArea=function(t,e){this.drawActorName(e,t.x+0,t.y,150),this.drawActorIcons(e,t.x+156,t.y,t.width-156)},Window_BattleStatus.prototype.drawGaugeArea=function(t,e){$dataSystem.optDisplayTp?this.drawGaugeAreaWithTp(t,e):this.drawGaugeAreaWithoutTp(t,e)},Window_BattleStatus.prototype.drawGaugeAreaWithTp=function(t,e){this.drawActorHp(e,t.x+0,t.y,108),this.drawActorMp(e,t.x+123,t.y,96),this.drawActorTp(e,t.x+234,t.y,96)},Window_BattleStatus.prototype.drawGaugeAreaWithoutTp=function(t,e){this.drawActorHp(e,t.x+0,t.y,201),this.drawActorMp(e,t.x+216,t.y,114)},Window_BattleActor.prototype=Object.create(Window_BattleStatus.prototype),Window_BattleActor.prototype.constructor=Window_BattleActor,Window_BattleActor.prototype.initialize=function(t,e){Window_BattleStatus.prototype.initialize.call(this),this.x=t,this.y=e,this.openness=255,this.hide()},Window_BattleActor.prototype.show=function(){this.select(0),Window_BattleStatus.prototype.show.call(this)},Window_BattleActor.prototype.hide=function(){Window_BattleStatus.prototype.hide.call(this),$gameParty.select(null)},Window_BattleActor.prototype.select=function(t){Window_BattleStatus.prototype.select.call(this,t),$gameParty.select(this.actor())},Window_BattleActor.prototype.actor=function(){return $gameParty.members()[this.index()]},Window_BattleEnemy.prototype=Object.create(Window_Selectable.prototype),Window_BattleEnemy.prototype.constructor=Window_BattleEnemy,Window_BattleEnemy.prototype.initialize=function(t,e){this._enemies=[];var i=this.windowWidth(),a=this.windowHeight();Window_Selectable.prototype.initialize.call(this,t,e,i,a),this.refresh(),this.hide()},Window_BattleEnemy.prototype.windowWidth=function(){return Graphics.boxWidth-192},Window_BattleEnemy.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())},Window_BattleEnemy.prototype.numVisibleRows=function(){return 4},Window_BattleEnemy.prototype.maxCols=function(){return 2},Window_BattleEnemy.prototype.maxItems=function(){return this._enemies.length},Window_BattleEnemy.prototype.enemy=function(){return this._enemies[this.index()]},Window_BattleEnemy.prototype.enemyIndex=function(){var t=this.enemy();return t?t.index():-1},Window_BattleEnemy.prototype.drawItem=function(t){this.resetTextColor();var e=this._enemies[t].name();t=this.itemRectForText(t),this.drawText(e,t.x,t.y,t.width)},Window_BattleEnemy.prototype.show=function(){this.refresh(),this.select(0),Window_Selectable.prototype.show.call(this)},Window_BattleEnemy.prototype.hide=function(){Window_Selectable.prototype.hide.call(this),$gameTroop.select(null)},Window_BattleEnemy.prototype.refresh=function(){this._enemies=$gameTroop.aliveMembers(),Window_Selectable.prototype.refresh.call(this)},Window_BattleEnemy.prototype.select=function(t){Window_Selectable.prototype.select.call(this,t),$gameTroop.select(this.enemy())},Window_BattleSkill.prototype=Object.create(Window_SkillList.prototype),Window_BattleSkill.prototype.constructor=Window_BattleSkill,Window_BattleSkill.prototype.initialize=function(t,e,i,a){Window_SkillList.prototype.initialize.call(this,t,e,i,a),this.hide()},Window_BattleSkill.prototype.show=function(){this.selectLast(),this.showHelpWindow(),Window_SkillList.prototype.show.call(this)},Window_BattleSkill.prototype.hide=function(){this.hideHelpWindow(),Window_SkillList.prototype.hide.call(this)},Window_BattleItem.prototype=Object.create(Window_ItemList.prototype),Window_BattleItem.prototype.constructor=Window_BattleItem,Window_BattleItem.prototype.initialize=function(t,e,i,a){Window_ItemList.prototype.initialize.call(this,t,e,i,a),this.hide()},Window_BattleItem.prototype.includes=function(t){return $gameParty.canUse(t)},Window_BattleItem.prototype.show=function(){this.selectLast(),this.showHelpWindow(),Window_ItemList.prototype.show.call(this)},Window_BattleItem.prototype.hide=function(){this.hideHelpWindow(),Window_ItemList.prototype.hide.call(this)},Window_TitleCommand.prototype=Object.create(Window_Command.prototype),Window_TitleCommand.prototype.constructor=Window_TitleCommand,Window_TitleCommand.prototype.initialize=function(){Window_Command.prototype.initialize.call(this,0,0),this.updatePlacement(),this.openness=0,this.selectLast()},Window_TitleCommand._lastCommandSymbol=null,Window_TitleCommand.initCommandPosition=function(){this._lastCommandSymbol=null},Window_TitleCommand.prototype.windowWidth=function(){return 240},Window_TitleCommand.prototype.updatePlacement=function(){this.x=(Graphics.boxWidth-this.width)/2,this.y=Graphics.boxHeight-this.height-96},Window_TitleCommand.prototype.makeCommandList=function(){this.addCommand(TextManager.newGame,"newGame"),this.addCommand(TextManager.continue_,"continue",this.isContinueEnabled()),this.addCommand(TextManager.options,"options")},Window_TitleCommand.prototype.isContinueEnabled=function(){return DataManager.isAnySavefileExists()},Window_TitleCommand.prototype.processOk=function(){Window_TitleCommand._lastCommandSymbol=this.currentSymbol(),Window_Command.prototype.processOk.call(this)},Window_TitleCommand.prototype.selectLast=function(){Window_TitleCommand._lastCommandSymbol?this.selectSymbol(Window_TitleCommand._lastCommandSymbol):this.isContinueEnabled()&&this.selectSymbol("continue")},Window_GameEnd.prototype=Object.create(Window_Command.prototype),Window_GameEnd.prototype.constructor=Window_GameEnd,Window_GameEnd.prototype.initialize=function(){Window_Command.prototype.initialize.call(this,0,0),this.updatePlacement(),this.openness=0,this.open()},Window_GameEnd.prototype.windowWidth=function(){return 240},Window_GameEnd.prototype.updatePlacement=function(){this.x=(Graphics.boxWidth-this.width)/2,this.y=(Graphics.boxHeight-this.height)/2},Window_GameEnd.prototype.makeCommandList=function(){this.addCommand(TextManager.toTitle,"toTitle"),this.addCommand(TextManager.cancel,"cancel")},Window_DebugRange.prototype=Object.create(Window_Selectable.prototype),Window_DebugRange.prototype.constructor=Window_DebugRange,Window_DebugRange.lastTopRow=0,Window_DebugRange.lastIndex=0,Window_DebugRange.prototype.initialize=function(t,e){this._maxSwitches=Math.ceil(($dataSystem.switches.length-1)/10),this._maxVariables=Math.ceil(($dataSystem.variables.length-1)/10);var i=this.windowWidth(),a=this.windowHeight();Window_Selectable.prototype.initialize.call(this,t,e,i,a),this.refresh(),this.setTopRow(Window_DebugRange.lastTopRow),this.select(Window_DebugRange.lastIndex),this.activate()},Window_DebugRange.prototype.windowWidth=function(){return 246},Window_DebugRange.prototype.windowHeight=function(){return Graphics.boxHeight},Window_DebugRange.prototype.maxItems=function(){return this._maxSwitches+this._maxVariables},Window_DebugRange.prototype.update=function(){Window_Selectable.prototype.update.call(this),this._editWindow&&(this._editWindow.setMode(this.mode()),this._editWindow.setTopId(this.topId()))},Window_DebugRange.prototype.mode=function(){return this.index()<this._maxSwitches?"switch":"variable"},Window_DebugRange.prototype.topId=function(){var t=this.index();return t<this._maxSwitches?10*t+1:10*(t-this._maxSwitches)+1},Window_DebugRange.prototype.refresh=function(){this.createContents(),this.drawAllItems()},Window_DebugRange.prototype.drawItem=function(t){var e=this.itemRectForText(t);if(t<this._maxSwitches){t=10*t+1;var i="S"}else t=10*(t-this._maxSwitches)+1,i="V";var a=t+9;i+=" ["+t.padZero(4)+"-"+a.padZero(4)+"]",this.drawText(i,e.x,e.y,e.width)},Window_DebugRange.prototype.isCancelTriggered=function(){return Window_Selectable.prototype.isCancelTriggered()||Input.isTriggered("debug")},Window_DebugRange.prototype.processCancel=function(){Window_Selectable.prototype.processCancel.call(this),Window_DebugRange.lastTopRow=this.topRow(),Window_DebugRange.lastIndex=this.index()},Window_DebugRange.prototype.setEditWindow=function(t){this._editWindow=t},Window_DebugEdit.prototype=Object.create(Window_Selectable.prototype),Window_DebugEdit.prototype.constructor=Window_DebugEdit,Window_DebugEdit.prototype.initialize=function(t,e,i){var a=this.fittingHeight(10);Window_Selectable.prototype.initialize.call(this,t,e,i,a),this._mode="switch",this._topId=1,this.refresh()},Window_DebugEdit.prototype.maxItems=function(){return 10},Window_DebugEdit.prototype.refresh=function(){this.contents.clear(),this.drawAllItems()},Window_DebugEdit.prototype.drawItem=function(t){var e=this._topId+t,i=e.padZero(4)+":",a=this.textWidth(i),n=this.textWidth("-00000000"),o=this.itemName(e);e=this.itemStatus(e),t=this.itemRectForText(t),this.resetTextColor(),this.drawText(i,t.x,t.y,t.width),t.x+=a,t.width-=a+n,this.drawText(o,t.x,t.y,t.width),this.drawText(e,t.x+t.width,t.y,n,"right")},Window_DebugEdit.prototype.itemName=function(t){return"switch"===this._mode?$dataSystem.switches[t]:$dataSystem.variables[t]},Window_DebugEdit.prototype.itemStatus=function(t){return"switch"===this._mode?$gameSwitches.value(t)?"[ON]":"[OFF]":String($gameVariables.value(t))},Window_DebugEdit.prototype.setMode=function(t){this._mode!==t&&(this._mode=t,this.refresh())},Window_DebugEdit.prototype.setTopId=function(t){this._topId!==t&&(this._topId=t,this.refresh())},Window_DebugEdit.prototype.currentId=function(){return this._topId+this.index()},Window_DebugEdit.prototype.update=function(){Window_Selectable.prototype.update.call(this),this.active&&("switch"===this._mode?this.updateSwitch():this.updateVariable())},Window_DebugEdit.prototype.updateSwitch=function(){if(Input.isRepeated("ok")){var t=this.currentId();SoundManager.playCursor(),$gameSwitches.setValue(t,!$gameSwitches.value(t)),this.redrawCurrentItem()}},Window_DebugEdit.prototype.updateVariable=function(){var t=this.currentId(),e=$gameVariables.value(t);"number"==typeof e&&(Input.isRepeated("right")&&e++,Input.isRepeated("left")&&e--,Input.isRepeated("pagedown")&&(e+=10),Input.isRepeated("pageup")&&(e-=10),$gameVariables.value(t)!==e&&($gameVariables.setValue(t,e),SoundManager.playCursor(),this.redrawCurrentItem()))};